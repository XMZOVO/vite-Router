var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,g,e){m!=Array.prototype&&m!=Object.prototype&&(m[g]=e.value)};$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global&&null!=global?global:m};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(m,g,e,M){if(g){e=$jscomp.global;m=m.split(".");for(M=0;M<m.length-1;M++){var C=m[M];C in e||(e[C]={});e=e[C]}m=m[m.length-1];M=e[m];g=g(M);g!=M&&null!=g&&$jscomp.defineProperty(e,m,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Number.isFinite",function(m){return m?m:function(g){return"number"!==typeof g?!1:!isNaN(g)&&Infinity!==g&&-Infinity!==g}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(m){return m?m:function(g){return Number.isFinite(g)?g===Math.floor(g):!1}},"es6","es3");$jscomp.arrayIteratorImpl=function(m){var g=0;return function(){return g<m.length?{done:!1,value:m[g++]}:{done:!0}}};$jscomp.arrayIterator=function(m){return{next:$jscomp.arrayIteratorImpl(m)}};$jscomp.makeIterator=function(m){var g="undefined"!=typeof Symbol&&Symbol.iterator&&m[Symbol.iterator];return g?g.call(m):$jscomp.arrayIterator(m)};
$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(m){function g(){this.batch_=null}function e(e){return e instanceof C?e:new C(function(g,a){g(e)})}if(m&&!$jscomp.FORCE_POLYFILL_PROMISE)return m;g.prototype.asyncExecute=function(e){if(null==this.batch_){this.batch_=[];var g=this;this.asyncExecuteFunction(function(){g.executeBatch_()})}this.batch_.push(e)};var M=$jscomp.global.setTimeout;g.prototype.asyncExecuteFunction=function(e){M(e,0)};g.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=
this.batch_;this.batch_=[];for(var g=0;g<e.length;++g){var a=e[g];e[g]=null;try{a()}catch(c){this.asyncThrow_(c)}}}this.batch_=null};g.prototype.asyncThrow_=function(e){this.asyncExecuteFunction(function(){throw e;})};var C=function(e){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var g=this.createResolveAndReject_();try{e(g.resolve,g.reject)}catch(a){g.reject(a)}};C.prototype.createResolveAndReject_=function(){function e(c){return function(b){a||(a=!0,c.call(g,b))}}var g=this,a=!1;
return{resolve:e(this.resolveTo_),reject:e(this.reject_)}};C.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof C)this.settleSameAsPromise_(e);else{a:switch(typeof e){case "object":var g=null!=e;break a;case "function":g=!0;break a;default:g=!1}g?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}};C.prototype.resolveToNonPromiseObj_=function(e){var g=void 0;try{g=e.then}catch(a){this.reject_(a);return}"function"==typeof g?
this.settleSameAsThenable_(g,e):this.fulfill_(e)};C.prototype.reject_=function(e){this.settle_(2,e)};C.prototype.fulfill_=function(e){this.settle_(1,e)};C.prototype.settle_=function(e,g){if(0!=this.state_)throw Error("Cannot settle("+e+", "+g+"): Promise already settled in state"+this.state_);this.state_=e;this.result_=g;this.executeOnSettledCallbacks_()};C.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=0;e<this.onSettledCallbacks_.length;++e)ja.asyncExecute(this.onSettledCallbacks_[e]);
this.onSettledCallbacks_=null}};var ja=new g;C.prototype.settleSameAsPromise_=function(e){var g=this.createResolveAndReject_();e.callWhenSettled_(g.resolve,g.reject)};C.prototype.settleSameAsThenable_=function(e,g){var a=this.createResolveAndReject_();try{e.call(g,a.resolve,a.reject)}catch(c){a.reject(c)}};C.prototype.then=function(e,g){function a(a,d){return"function"==typeof a?function(d){try{c(a(d))}catch(q){b(q)}}:d}var c,b,d=new C(function(a,d){c=a;b=d});this.callWhenSettled_(a(e,c),a(g,b));
return d};C.prototype.catch=function(e){return this.then(void 0,e)};C.prototype.callWhenSettled_=function(e,g){function a(){switch(c.state_){case 1:e(c.result_);break;case 2:g(c.result_);break;default:throw Error("Unexpected state: "+c.state_);}}var c=this;null==this.onSettledCallbacks_?ja.asyncExecute(a):this.onSettledCallbacks_.push(a)};C.resolve=e;C.reject=function(e){return new C(function(g,a){a(e)})};C.race=function(g){return new C(function(m,a){for(var c=$jscomp.makeIterator(g),b=c.next();!b.done;b=
c.next())e(b.value).callWhenSettled_(m,a)})};C.all=function(g){var m=$jscomp.makeIterator(g),a=m.next();return a.done?e([]):new C(function(c,b){function d(a){return function(b){z[a]=b;g--;0==g&&c(z)}}var z=[],g=0;do z.push(void 0),g++,e(a.value).callWhenSettled_(d(z.length-1),b),a=m.next();while(!a.done)})};return C},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(m,g){this.$jscomp$symbol$id_=m;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function m(e){if(this instanceof m)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+g++,e)}var g=0;return m}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.iterator;m||(m=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[m]&&$jscomp.defineProperty(Array.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.asyncIterator;m||(m=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(m){$jscomp.initSymbolIterator();m={next:m};m[$jscomp.global.Symbol.iterator]=function(){return this};return m};
$jscomp.iteratorFromArray=function(m,g){$jscomp.initSymbolIterator();m instanceof String&&(m+="");var e=0,M={next:function(){if(e<m.length){var C=e++;return{value:g(C,m[C]),done:!1}}M.next=function(){return{done:!0,value:void 0}};return M.next()}};M[Symbol.iterator]=function(){return M};return M};$jscomp.polyfill("Array.prototype.entries",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(g,e){return[g,e]})}},"es6","es3");
JSROOT.define(["d3","painter","base3d","latex","hist"],function(m,g,e,M){function C(a,c,b,d){if(c&&c.children)for(var e=0;e<c.children.length;++e){var g=c.children[e];if(g.axis_draw)break;g=void 0}if(g)if(a){b=b?!0:!1;d=d?!0:!1;var u=1;a=a.position;0>a.x&&0<=a.y&&(u=2);0<=a.x&&0<=a.y&&(u=3);0<=a.x&&0>a.y&&(u=4);a=function(a,b){a<=u&&(a+=4);return a>u&&a<u+b};for(c=0;c<g.children.length;++c)if(e=g.children[c],e.grid)e.visible=d&&a(e.grid,3);else if(e.zid)e.visible=a(e.zid,2);else if(e.xyid)e.visible=
a(e.xyid,3);else if(e.xyboxid){var q=5,n=0;d&&!b?(q=3,n=-2):b&&!d?q=3:b||d||(q=e.bottom?3:0);e.visible=a(e.xyboxid+n,q);!e.visible&&e.bottom&&d&&(e.visible=a(e.xyboxid,3))}else e.zboxid&&(q=2,n=0,b&&d?q=5:d&&!b?q=4:!d&&b&&(n=-2,q=4),e.visible=a(e.zboxid+n,q))}else c.remove(g)}function ja(a,c){var b=a.getPadPainter().getRootPad(!0),d=Math.max(.75*a.size_x3d,a.size_z3d),e=Math.max(.75*a.size_y3d,a.size_z3d);c&&(d===e?a.camera.position.set(-1.6*d,-3.5*e,1.4*a.size_z3d):d>e?a.camera.position.set(-2*d,
-3.5*e,1.4*a.size_z3d):a.camera.position.set(-3.5*d,-2*e,1.4*a.size_z3d));if(b&&(c||!a.zoomChangedInteractive())&&Number.isFinite(b.fTheta)&&Number.isFinite(b.fPhi)&&(b.fTheta!==a.camera_Theta||b.fPhi!==a.camera_Phi)){d=3*Math.max(a.size_x3d,a.size_z3d);e=3*Math.max(a.size_y3d,a.size_z3d);c=(-b.fPhi-90)/180*Math.PI;var g=b.fTheta/180*Math.PI;a.camera_Phi=b.fPhi;a.camera_Theta=b.fTheta;a.camera.position.set(d*Math.cos(c)*Math.cos(g),e*Math.sin(c)*Math.cos(g),a.size_z3d+.5*(d+e)*Math.sin(g));c=!0}c&&
a.camera.lookAt(a.lookat)}function O(a,c){JSROOT.THistPainter.call(this,a,c);this.mode3d=!0}function ia(a,c){JSROOT.ObjectPainter.call(this,a,c)}JSROOT.TFramePainter.prototype.create3DScene=function(a,c,b){if(-1===a)this.mode3d&&(this.clear3dCanvas?(C(null,this.toplevel),this.clear3dCanvas(),g.disposeThreejsObject(this.scene),this.control&&this.control.cleanup(),g.cleanupRender3D(this.renderer),delete this.size_x3d,delete this.size_y3d,delete this.size_z3d,delete this.tooltip_mesh,delete this.scene,
delete this.toplevel,delete this.camera,delete this.pointLight,delete this.renderer,delete this.control,this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.mode3d=!1):console.error("Strange, why mode3d is configured!!!!",this.mode3d));else if(this.mode3d=!0,"toplevel"in this)this.scene.remove(this.toplevel),g.disposeThreejsObject(this.toplevel),delete this.tooltip_mesh,delete this.toplevel,this.control&&this.control.HideTooltip(),a=new e.Object3D,this.scene.add(a),this.toplevel=
a,this.resize3D(),ja(this,!1);else{a=g.getRender3DKind(a);g.assign3DHandler(this);var d=this.getSizeFor3d(void 0,a);this.size_z3d=100;this.size_x3d=this.size_y3d=10<d.height&&10<d.width?Math.round(d.width/d.height*this.size_z3d):this.size_z3d;c&&(this.size_x3d*=c);b&&(this.size_y3d*=b);this.scene=new e.Scene;this.toplevel=new e.Object3D;this.scene.add(this.toplevel);this.scene_width=d.width;this.scene_height=d.height;this.camera=new e.PerspectiveCamera(45,this.scene_width/this.scene_height,1,40*this.size_z3d);
this.camera_Theta=this.camera_Phi=30;this.pointLight=new e.PointLight(16777215,1);this.camera.add(this.pointLight);this.pointLight.position.set(this.size_x3d/2,this.size_y3d/2,this.size_z3d/2);this.lookat=new e.Vector3(0,0,.8*this.size_z3d);this.camera.up=new e.Vector3(0,0,1);this.scene.add(this.camera);ja(this,!0);this.renderer=g.createRender3D(this.scene_width,this.scene_height,a);this.webgl=a===JSROOT.constants.Render3D.WebGL;this.add3dCanvas(d,this.renderer.jsroot_dom,this.webgl);this.first_render_tm=
0;this.enable_highlight=!1;if(!JSROOT.batch_mode&&this.webgl){this.control=g.createOrbitControl(this,this.camera,this.scene,this.renderer,this.lookat);var z=this,R=this.getMainPainter();this.control.ProcessMouseMove=function(a){for(var b=null,c=null,d=null,e=0;e<a.length;++e)if(a[e].object.tooltip){if(b=a[e].object.tooltip(a[e])){c=a[e].object;break}}else a[e].object.zoom&&!d&&(d=a[e].object);if(b&&!b.use_itself){a=1E-4*z.size_x3d;e=1E-4*z.size_y3d;var f=1E-4*z.size_z3d;(b.x1>b.x2||b.y1>b.y2||b.z1>
b.z2)&&console.warn("check 3D hints coordinates");b.x1-=a;b.x2+=a;b.y1-=e;b.y2+=e;b.z1-=f;b.z2+=f}z.highlightBin3D(b,c);return!b&&d&&z.get3dZoomCoord?(c=d.globalIntersect(this.raycaster),b=d.zoom,c=z.get3dZoomCoord(c,b),"z"===b&&d.use_y_for_z&&(b="y"),d=z.getAxis(b),a={name:b,title:"TAxis",line:"any info",only_status:!0},d&&(a.name=d.fName,a.title=d.fTitle||"histogram TAxis object"),a.line=b+" : "+z.axisAsText(b,c),a):b&&b.lines?b:""};this.control.ProcessMouseLeave=function(){z.highlightBin3D(null)};
this.control.contextMenu=function(a,b){var d="painter",c=R;if(b)for(var e=0;e<b.length;++e){var f=b[e].object;if(f.zoom){d=f.zoom;c=null;break}if(f.painter&&"function"===typeof f.painter.fillContextMenu){c=f.painter;break}}(b=R.getFramePainter())&&b.showContextMenu&&b.showContextMenu(d,a,c)}}}};JSROOT.TFramePainter.prototype.render3D=function(a){var c=this;if(-1111===a){var b=JSROOT._.get_document();a=e.CreateSVGRenderer(!1,0,b);a.setSize(this.scene_width,this.scene_height);a.render(this.scene,this.camera);
return a.makeOuterHTML?(b=b.createElement("div"),b.innerHTML=a.makeOuterHTML(),b.childNodes[0]):a.domElement}void 0===a&&(a=5);0<a&&!this.usesvg&&!JSROOT.batch_mode?this.render_tmout||(this.render_tmout=setTimeout(function(){return c.render3D(0)},a)):(this.render_tmout&&(clearTimeout(this.render_tmout),delete this.render_tmout),this.renderer&&(g.beforeRender3D(this.renderer),a=new Date,this.opt3d||(this.opt3d={FrontBox:!0,BackBox:!0}),C(this.camera,this.toplevel,this.opt3d.FrontBox,this.opt3d.BackBox),
this.renderer.render(this.scene,this.camera),g.afterRender3D(this.renderer),b=new Date,0===this.first_render_tm&&(this.first_render_tm=b.getTime()-a.getTime(),this.enable_highlight=1200>this.first_render_tm&&this.isTooltipAllowed(),console.log("three.js r"+e.REVISION+", first render tm = "+this.first_render_tm))))};JSROOT.TFramePainter.prototype.resize3D=function(){var a=this.getSizeFor3d(this.access3dKind());this.apply3dSize(a);if(this.scene_width===a.width&&this.scene_height===a.height||10>a.width||
10>a.height)return!1;this.scene_width=a.width;this.scene_height=a.height;this.camera.aspect=this.scene_width/this.scene_height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.scene_width,this.scene_height);this.renderer.setJSROOTSize&&this.renderer.setJSROOTSize(this.scene_width,this.scene_height);return!0};JSROOT.TFramePainter.prototype.highlightBin3D=function(a,c){var b=!1,d=null,z=!0,R=!a||void 0===a.x1||!this.enable_highlight,u=this.getMainPainter();!u||u.provideUserTooltip&&u.hasUserTooltip()||
(u=null);this.tooltip_selfmesh&&(z=this.tooltip_selfmesh!==c,this.tooltip_selfmesh.material.color=this.tooltip_selfmesh.save_color,delete this.tooltip_selfmesh,b=!0);this.tooltip_mesh&&(d=this.tooltip_mesh,this.toplevel.remove(this.tooltip_mesh),delete this.tooltip_mesh,b=!0);if(R)b&&this.render3D(),b&&u&&u.provideUserTooltip(null);else{if(a.use_itself)c.save_color=c.material.color,c.material.color=new e.Color(a.color),this.tooltip_selfmesh=c,b=z;else{b=!0;c=g.Box3D.Indexes;z=g.Box3D.Normals;R=g.Box3D.Vertices;
var q=new e.Color(a.color?a.color:16711680),n=a.opacity||1;if(d){var k=d.geometry.attributes.position.array;d.geometry.attributes.position.needsUpdate=!0;d.material.color=q;d.material.opacity=n}else{k=new Float32Array(3*c.length);var p=new Float32Array(3*c.length);d=new e.BufferGeometry;d.setAttribute("position",new e.BufferAttribute(k,3));d.setAttribute("normal",new e.BufferAttribute(p,3));q=new e.MeshBasicMaterial({color:q,opacity:n});d=new e.Mesh(d,q)}a.x1===a.x2&&console.warn("same tip X",a.x1,
a.x2);a.y1===a.y2&&console.warn("same tip Y",a.y1,a.y2);a.z1===a.z2&&(a.z2=a.z1+1E-4);q=0;for(n=-3;q<c.length;++q){var f=R[c[q]];k[3*q]=a.x1+f.x*(a.x2-a.x1);k[3*q+1]=a.y1+f.y*(a.y2-a.y1);k[3*q+2]=a.z1+f.z*(a.z2-a.z1);p&&(0===q%6&&(n+=3),p[3*q]=z[n],p[3*q+1]=z[n+1],p[3*q+2]=z[n+2])}this.tooltip_mesh=d;this.toplevel.add(d)}b&&this.render3D();b&&a.$painter&&"function"==typeof a.$painter.redrawProjection&&a.$painter.redrawProjection(a.ix-1,a.ix,a.iy-1,a.iy);b&&u&&u.getObject()&&u.provideUserTooltip({obj:u.getObject(),
name:u.getObject().fName,bin:a.bin,cont:a.value,binx:a.ix,biny:a.iy,binz:a.iz,grx:(a.x1+a.x2)/2,gry:(a.y1+a.y2)/2,grz:(a.z1+a.z2)/2})}};JSROOT.TFramePainter.prototype.set3DOptions=function(a){this.opt3d=a};JSROOT.TFramePainter.prototype.drawXYZ=function(a,c){c||(c={});var b=-this.size_x3d,d=this.size_x3d,z=-this.size_y3d,R=this.size_y3d,u=0,q=2*this.size_z3d,n=Math.round(.05*this.size_z3d),k=this.getPadPainter().getRootPad(!0),p=this.xmin,f=this.xmax,B=this.ymin,r=this.ymax,l=this.zmin,v=this.zmax,
w=!1,t=!1;this.size_z3d||(b=this.xmin,d=this.xmax,z=this.ymin,R=this.ymax,u=this.zmin,q=this.zmax,n=.05*(q-u));"zoom_xmin"in this&&"zoom_xmax"in this&&this.zoom_xmin!==this.zoom_xmax&&(p=this.zoom_xmin,f=this.zoom_xmax);"zoom_ymin"in this&&"zoom_ymax"in this&&this.zoom_ymin!==this.zoom_ymax&&(B=this.zoom_ymin,r=this.zoom_ymax,w=!0);"zoom_zmin"in this&&"zoom_zmax"in this&&this.zoom_zmin!==this.zoom_zmax&&(l=this.zoom_zmin,v=this.zoom_zmax,t=!0);c.use_y_for_z&&(this.zmin=this.ymin,this.zmax=this.ymax,
l=B,v=r,t=w,B=0,r=1);this.lego_zmin=l;this.lego_zmax=v;void 0===c.zmult||t||(v*=c.zmult);this.x_handle=new JSROOT.TAxisPainter(null,this.xaxis);this.x_handle.configureAxis("xaxis",this.xmin,this.xmax,p,f,!1,[b,d],{log:k?k.fLogx:0});this.x_handle.assignFrameMembers(this,"x");this.y_handle=new JSROOT.TAxisPainter(null,this.yaxis);this.y_handle.configureAxis("yaxis",this.ymin,this.ymax,B,r,!1,[z,R],{log:k&&!c.use_y_for_z?k.fLogy:0});this.y_handle.assignFrameMembers(this,"y");this.z_handle=new JSROOT.TAxisPainter(null,
this.zaxis);this.z_handle.configureAxis("zaxis",this.zmin,this.zmax,l,v,!1,[u,q],{log:k?k.fLogz:0});this.z_handle.assignFrameMembers(this,"z");this.setRootPadRange(k,!0);this.x_handle.debug=!0;var y=new e.MeshBasicMaterial({color:0});k=new e.LineBasicMaterial({color:0});var h=.5*n;f=[];var x=1;B=this.x_handle.createTicks(!1,!0);l=this.y_handle.createTicks(!1,!0);r=this.z_handle.createTicks(!1,!0);p=new e.Object3D;p.axis_draw=!0;a.add(p);a=[];var D=0;for(v=this.xaxis;B.next();){w=B.grpos;t=1===B.kind;
var A=this.x_handle.format(B.tick,2);B.last_major()?v&&v.fTitle||(A="x"):null===A&&(t=!1,A="");if(t&&A&&0<A.length){A=new e.TextGeometry(A,{font:JSROOT.threejs_font_helvetiker_regular,size:n,height:0,curveSegments:5});A.computeBoundingBox();var I=A.boundingBox.max.x-A.boundingBox.min.x,m=A.boundingBox.max.y-A.boundingBox.min.y;A.center=!0;D=Math.max(D,m);A.grx=w;f.push(A);B.last_major()||(m=B.next_major_grpos()-w,0<I&&(x=Math.min(x,.9*m/I)),this.x_handle.isCenteredLabels()&&(A.grx+=m/2))}a.push(w,
0,0,w,t?-h:.6*-h,0)}v&&v.fTitle&&(B=new e.TextGeometry(M.translateLaTeX(v.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,size:n,height:0,curveSegments:5}),B.computeBoundingBox(),B.center=v.TestBit(JSROOT.EAxisBits.kCenterTitle),B.gry=2,B.grx=(b+d)/2,f.push(B));this.get3dZoomCoord=function(a,b){a=a[b];var d=this["scale_"+b+"min"],c=this["scale_"+b+"max"];switch(b){case "x":a=(a+this.size_x3d)/2/this.size_x3d;break;case "y":a=(a+this.size_y3d)/2/this.size_y3d;break;case "z":a=a/2/this.size_z3d}return a=
this["log"+b]?Math.exp(Math.log(d)+a*(Math.log(c)-Math.log(d))):d+a*(c-d)};B=function(a,b,d){var c=new e.BufferGeometry;var f="z"===a?new Float32Array([0,0,0,4*h,0,2*b,4*h,0,0,0,0,0,0,0,2*b,4*h,0,2*b]):new Float32Array([-b,0,0,b,4*-h,0,b,0,0,-b,0,0,-b,4*-h,0,b,4*-h,0]);c.setAttribute("position",new e.BufferAttribute(f,3));c.computeVertexNormals();var k=new e.MeshBasicMaterial({transparent:!0,vertexColors:e.NoColors,side:e.DoubleSide,opacity:0});c=new e.Mesh(c,k);c.zoom=a;c.size_3d=b;c.use_y_for_z=
d;"y"==a&&c.rotateZ(Math.PI/2).rotateX(Math.PI);c.v1=new e.Vector3(f[0],f[1],f[2]);c.v2=new e.Vector3(f[6],f[7],f[8]);c.v3=new e.Vector3(f[3],f[4],f[5]);c.globalIntersect=function(a){if(this.v1&&this.v2&&this.v3){var b=new e.Plane;b.setFromCoplanarPoints(this.v1,this.v2,this.v3);b.applyMatrix4(this.matrixWorld);var c=a.ray.origin.clone();a=c.clone().addScaledVector(a.ray.direction,1E10);if(b=b.intersectLine(new e.Line3(c,a),new e.Vector3))return c=-this.size_3d,a=this.size_3d,"z"===this.zoom&&(c=
0,a=2*this.size_3d),b[this.zoom]<c?b[this.zoom]=c:b[this.zoom]>a&&(b[this.zoom]=a),b}};c.showSelection=function(a,b){var c=this.children?this.children[0]:null,d=this.zoom;if(!a||!b)return c&&(this.remove(c),g.disposeThreejsObject(c)),c;if(!this.geometry)return!1;if(c)var f=c.geometry;else f=this.geometry.clone(),c=f.getAttribute("position").array,"z"===d?c[6]=c[3]=c[15]=h:c[4]=c[16]=c[13]=-h,c=new e.Mesh(f,new e.MeshBasicMaterial({color:65280,side:e.DoubleSide})),this.add(c);c=f.getAttribute("position").array;
"z"==d?(c[2]=c[11]=c[8]=a[d],c[5]=c[17]=c[14]=b[d]):(c[0]=c[9]=c[12]=a[d],c[6]=c[3]=c[15]=b[d]);f.getAttribute("position").needsUpdate=!0;f.computeFaceNormals();return!0};return c};var J=new e.Object3D;J.position.set(0,z,u);J.rotation.x=.25*Math.PI;J.xyid=2;a=g.createLineSegments(a,k);J.add(a);f.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.grx-b/2:d-b;b=new e.Matrix4;b.set(x,0,0,c,0,x,0,(-D*x-1.5*h)*(a.gry||1),0,0,1,0,0,0,0,1);a=new e.Mesh(a,y);a.applyMatrix4(b);
J.add(a)});c.zoom&&J.add(B("x",this.size_x3d));p.add(J);J=new e.Object3D;J.position.set(0,R,u);J.rotation.x=.75*Math.PI;J.add(new e.LineSegments(a.geometry,k));f.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.grx+b/2:d;b=new e.Matrix4;b.set(-x,0,0,c,0,x,0,(-D*x-1.5*h)*(a.gry||1),0,0,-1,0,0,0,0,1);a=new e.Mesh(a,y);a.applyMatrix4(b);J.add(a)});J.xyid=4;c.zoom&&J.add(B("x",this.size_x3d));p.add(J);f=[];x=1;D=0;a=[];for(v=this.yaxis;l.next();)w=l.grpos,t=1===l.kind,A=
this.y_handle.format(l.tick,2),l.last_major()?v&&v.fTitle||(A="y"):null===A&&(t=!1,A=""),t&&(A=new e.TextGeometry(A,{font:JSROOT.threejs_font_helvetiker_regular,size:n,height:0,curveSegments:5}),A.computeBoundingBox(),I=A.boundingBox.max.x-A.boundingBox.min.x,m=A.boundingBox.max.y-A.boundingBox.min.y,A.center=!0,D=Math.max(D,m),A.gry=w,f.push(A),l.last_major()||(m=l.next_major_grpos()-w,0<I&&(x=Math.min(x,.9*m/I)),this.y_handle.isCenteredLabels()&&(A.gry+=m/2))),a.push(0,w,0,t?-h:.6*-h,w,0);v&&v.fTitle&&
(l=new e.TextGeometry(M.translateLaTeX(v.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,size:n,height:0,curveSegments:5}),l.computeBoundingBox(),l.center=v.TestBit(JSROOT.EAxisBits.kCenterTitle),l.grx=2,l.gry=(z+R)/2,f.push(l));if(!c.use_y_for_z){a=g.createLineSegments(a,k);var E=new e.Object3D;E.position.set(b,0,u);E.rotation.y=-.25*Math.PI;E.add(a);f.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry+b/2:R;b=new e.Matrix4;b.set(0,x,0,(-D*x-1.5*h)*(a.grx||1),
-x,0,0,c,0,0,1,0,0,0,0,1);a=new e.Mesh(a,y);a.applyMatrix4(b);E.add(a)});E.xyid=3;c.zoom&&E.add(B("y",this.size_y3d));p.add(E);E=new e.Object3D;E.position.set(d,0,u);E.rotation.y=-.75*Math.PI;E.add(new e.LineSegments(a.geometry,k));f.forEach(function(a){var b=a.boundingBox.max.x-a.boundingBox.min.x,c=a.center?a.gry-b/2:R-b;b=new e.Matrix4;b.set(0,x,0,(-D*x-1.5*h)*(a.grx||1),x,0,0,c,0,0,-1,0,0,0,0,1);a=new e.Mesh(a,y);a.applyMatrix4(b);E.add(a)});E.xyid=1;c.zoom&&E.add(B("y",this.size_y3d));p.add(E)}f=
[];x=1;a=[];A=w=t=null;l=this.zaxis;v=0;this.size_z3d&&(t=[],w=[]);for(;r.next();){I=r.grpos;m=1==r.kind;var H=this.z_handle.format(r.tick,2);null===H&&(m=!1,H="");if(m&&H){H=new e.TextGeometry(H,{font:JSROOT.threejs_font_helvetiker_regular,size:n,height:0,curveSegments:5});H.computeBoundingBox();var F=H.boundingBox.max.x-H.boundingBox.min.x,C=H.boundingBox.max.y-H.boundingBox.min.y;H.translate(-F,-C/2,0);H.grz=I;f.push(H);null!==A&&0<C&&(x=Math.min(x,.9*(I-A)/C));v=Math.max(v,F);A=I}t&&m&&t.push(b,
0,I,d,0,I);w&&m&&w.push(0,z,I,0,R,I);a.push(0,0,I,m?h:.6*h,0,I)}t&&0<t.length&&(r=new e.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),t=g.createLineSegments(t,r),t.position.set(0,R,0),t.grid=2,t.visible=!1,p.add(t),r=new e.LineSegments(t.geometry,r),r.position.set(0,z,0),r.grid=4,r.visible=!1,p.add(r));w&&0<w.length&&(r=new e.LineDashedMaterial({color:0,dashSize:2,gapSize:2}),w=g.createLineSegments(w,r),w.position.set(d,0,0),w.grid=3,w.visible=!1,p.add(w),r=new e.LineSegments(w.geometry,r),r.position.set(b,
0,0),r.grid=1,r.visible=!1,p.add(r));var G=[];a=g.createLineSegments(a,k);for(r={$jscomp$loop$prop$n$66:0};4>r.$jscomp$loop$prop$n$66;r={$jscomp$loop$prop$n$66:r.$jscomp$loop$prop$n$66},++r.$jscomp$loop$prop$n$66)G.push(new e.Object3D),f.forEach(function(a){return function(b){var c=new e.Matrix4;c.set(-x,0,0,2*h,0,0,1,0,0,x,0,b.grz);b=new e.Mesh(b,y);b.applyMatrix4(c);G[a.$jscomp$loop$prop$n$66].add(b)}}(r)),l&&l.fTitle&&(w=new e.TextGeometry(M.translateLaTeX(l.fTitle),{font:JSROOT.threejs_font_helvetiker_regular,
size:n,height:0,curveSegments:5}),w.computeBoundingBox(),t=w.boundingBox.max.x-w.boundingBox.min.x,A=l.TestBit(JSROOT.EAxisBits.kCenterTitle)?(q+u-t)/2:q-t,w.rotateZ(Math.PI/2),t=new e.Matrix4,t.set(-x,0,0,3*h+v,0,0,1,0,0,x,0,A),w=new e.Mesh(w,y),w.applyMatrix4(t),G[r.$jscomp$loop$prop$n$66].add(w)),G[r.$jscomp$loop$prop$n$66].add(0==r.$jscomp$loop$prop$n$66?a:new e.LineSegments(a.geometry,k)),c.zoom&&G[r.$jscomp$loop$prop$n$66].add(B("z",this.size_z3d,c.use_y_for_z)),G[r.$jscomp$loop$prop$n$66].zid=
r.$jscomp$loop$prop$n$66+2,p.add(G[r.$jscomp$loop$prop$n$66]);G[0].position.set(b,R,0);G[0].rotation.z=.75*Math.PI;G[1].position.set(d,R,0);G[1].rotation.z=.25*Math.PI;G[2].position.set(d,z,0);G[2].rotation.z=-.25*Math.PI;G[3].position.set(b,z,0);G[3].rotation.z=-.75*Math.PI;if(0!==this.size_z3d){c=g.createLineSegments([b,0,0,d,0,0],k,null,!0);for(n=0;2>n;++n)f=new e.LineSegments(c,k),f.position.set(0,z,0===n?u:q),f.xyboxid=2,f.bottom=0==n,p.add(f),f=new e.LineSegments(c,k),f.position.set(0,R,0===
n?u:q),f.xyboxid=4,f.bottom=0==n,p.add(f);z=g.createLineSegments([0,z,0,0,R,0],k,null,!0);for(c=0;2>c;++c)n=new e.LineSegments(z,k),n.position.set(b,0,0===c?u:q),n.xyboxid=3,n.bottom=0==c,p.add(n),n=new e.LineSegments(z,k),n.position.set(d,0,0===c?u:q),n.xyboxid=1,n.bottom=0==c,p.add(n);b=g.createLineSegments([0,0,u,0,0,q],k,null,!0);for(u=0;4>u;++u)q=new e.LineSegments(b,k),q.zboxid=G[u].zid,q.position.copy(G[u].position),p.add(q)}};JSROOT.THistPainter.prototype.draw3DBins=function(){var a=this;
if(this.draw_content){if(this.isTH2Poly()&&this.drawPolyLego)return this.drawPolyLego();if(2==this.getDimension()&&this.options.Contour&&this.drawContour3D)return this.drawContour3D(!0);if(2==this.getDimension()&&this.options.Surf&&this.drawSurf)return this.drawSurf();if(2==this.getDimension()&&this.options.Error&&this.drawError)return this.drawError();var c=g.Box3D.Vertices,b=g.Box3D.Indexes,d=g.Box3D.Normals,z=g.Box3D.Segments,R=[0,1,1,2,2,3,3,0],u=[new e.Vector3(0,0,0),new e.Vector3(0,1,0),new e.Vector3(1,
1,0),new e.Vector3(1,0,0)],q=this.getFramePainter(),n=q.z_handle.getScaleMin(),k=q.z_handle.getScaleMax(),p=this.prepareColorDraw({rounding:!1,use3d:!0,extra:1}),f=p.i1,B=p.i2,r=p.j1,l=p.j2,v=this.getHisto(),w=v?v.$baseh:null,t=11===this.options.Lego||13===this.options.Lego,y=65535>v.getBin(B,l);if(!(f>=B||r>=l)){var h,x,D,A,I,Z,J=function(b,c,d){I=v.getBinContent(b+1,c+1);A=w?w.getBinContent(b+1,c+1):!1!==a.options.BaseLine?a.options.BaseLine:a.options.Zero?n:0;I<A&&(b=A,A=I,I=b);if(A>=G||I<C)return!1;
Z=I===C||A>=I;return!Z||0<d?!0:w?!1:a.options.Zero||0<n?!0:a._show_empty_bins},E=[n,k],H=null;if(12===this.options.Lego||14===this.options.Lego)E=this.createContour(v.fContour?v.fContour.length:20,q.lego_zmin,q.lego_zmax).arr,H=this.getHistPalette();for(var F=0;F<E.length-1;++F){var C=E[F];var G=E[F+1];H&&F==E.length-2&&G<k&&(G=k);var K=0,L=0,N=D=0,M=q.grz(C),O=q.grz(G);for(h=f;h<B;++h)for(x=r;x<l;++x)if(J(h,x,F)){var T=!Z&&0<F;var W=!Z&&I>G&&F<E.length-2;D+=Z?12:b.length;T&&(D-=6);W&&(D-=6);t&&!Z&&
(D-=12,N+=12)}var aa=new Float32Array(3*D),X=new Float32Array(3*D),S=y?new Uint16Array(D/3):new Uint32Array(D/3);var Q=0===N?null:new Float32Array(3*N);var U=0===N?null:new Float32Array(3*N),P=0===N?null:y?new Uint16Array(N/3):new Uint32Array(N/3),V=0,ea=0,fa=T=void 0,ca=void 0;for(h=f;h<B;++h){D=p.grx[h]+p.xbar1*(p.grx[h+1]-p.grx[h]);var Y=p.grx[h]+p.xbar2*(p.grx[h+1]-p.grx[h]);for(x=r;x<l;++x)if(J(h,x,F)){T=!Z&&0<F;W=!Z&&I>G&&F<E.length-2;var ha=p.gry[x]+p.ybar1*(p.gry[x+1]-p.gry[x]);var ka=p.gry[x]+
p.ybar2*(p.gry[x+1]-p.gry[x]);K=A<=C?M:q.grz(A);L=I>G?O:q.grz(I);fa=ca=0;Z&&(ca+=12,fa+=24);var la=b.length,ma=v.getBin(h+1,x+1);for(T&&(la-=6);fa<la;)T=c[b[fa]],t&&12>fa?(Q[ea]=D+T.x*(Y-D),Q[ea+1]=ha+T.y*(ka-ha),Q[ea+2]=K+T.z*(L-K),U[ea]=d[ca],U[ea+1]=d[ca+1],U[ea+2]=d[ca+2],0===ea%9&&(P[ea/9]=ma),ea+=3):(aa[V]=D+T.x*(Y-D),aa[V+1]=ha+T.y*(ka-ha),aa[V+2]=K+T.z*(L-K),X[V]=d[ca],X[V+1]=d[ca+1],X[V+2]=d[ca+2],0===V%9&&(S[V/9]=ma),V+=3),++fa,0===fa%6&&(ca+=3,W&&fa===b.length-12&&(fa+=6,ca+=3))}}h=new e.BufferGeometry;
h.setAttribute("position",new e.BufferAttribute(aa,3));h.setAttribute("normal",new e.BufferAttribute(X,3));x=v.fFillColor;D=this.getColor(x);if(H)D=H.calcColor(F,E.length);else if(1===this.options.Lego||2>x)x=1,D="white";Y=new e.MeshBasicMaterial({color:D});h=new e.Mesh(h,Y);h.face_to_bins_index=S;h.painter=this;h.zmin=n;h.zmax=k;h.baseline=!1!==this.options.BaseLine?this.options.BaseLine:this.options.Zero?n:0;h.tip_color=3===x?16711680:65280;h.handle=p;h.tooltip=function(a){if(!Number.isInteger(a.faceIndex))return console.error("faceIndex not provided, three.js version "+
e.REVISION+", expected 127"),null;if(0>a.faceIndex||a.faceIndex>=this.face_to_bins_index.length)return null;var b=this.painter,c=this.handle,d=b.getFramePainter(),f=b.getHisto();a=b.get3DToolTip(this.face_to_bins_index[a.faceIndex]);a.x1=Math.max(-d.size_x3d,c.grx[a.ix-1]+c.xbar1*(c.grx[a.ix]-c.grx[a.ix-1]));a.x2=Math.min(d.size_x3d,c.grx[a.ix-1]+c.xbar2*(c.grx[a.ix]-c.grx[a.ix-1]));a.y1=Math.max(-d.size_y3d,c.gry[a.iy-1]+c.ybar1*(c.gry[a.iy]-c.gry[a.iy-1]));a.y2=Math.min(d.size_y3d,c.gry[a.iy-1]+
c.ybar2*(c.gry[a.iy]-c.gry[a.iy-1]));c=this.baseline;var k=a.value;f.$baseh&&(c=f.$baseh.getBinContent(a.ix,a.iy));k<c&&(f=c,c=k,k=f);a.z1=d.grz(Math.max(this.zmin,c));a.z2=d.grz(Math.min(this.zmax,k));a.color=this.tip_color;b.is_projection&&2==b.getDimension()&&(a.$painter=b);return a};q.toplevel.add(h);0<N&&(Y=new e.BufferGeometry,Y.setAttribute("position",new e.BufferAttribute(Q,3)),Y.setAttribute("normal",new e.BufferAttribute(U,3)),x=2>x?new e.Color(16711680):new e.Color(m.rgb(D).darker(.5).toString()),
x=new e.MeshBasicMaterial({color:x}),x=new e.Mesh(Y,x),x.face_to_bins_index=P,x.painter=this,x.handle=h.handle,x.tooltip=h.tooltip,x.zmin=h.zmin,x.zmax=h.zmax,x.baseline=h.baseline,x.tip_color=h.tip_color,q.toplevel.add(x))}if(!(12<this.options.Lego)){D=Y=0;G=k;C=n;for(h=f;h<B;++h)for(x=r;x<l;++x)J(h,x,0)&&(Y+=Z?u.length:c.length,D+=Z?R.length:z.length);(b=65520>=Y)||(Y=3*D);d=new Float32Array(3*Y);t=b?new Uint16Array(D):null;y=q.grz(n);E=q.grz(k);N=P=F=H=0;for(h=f;h<B;++h)for(D=p.grx[h]+p.xbar1*
(p.grx[h+1]-p.grx[h]),Y=p.grx[h]+p.xbar2*(p.grx[h+1]-p.grx[h]),x=r;x<l;++x)if(J(h,x,0))if(ha=p.gry[x]+p.ybar1*(p.gry[x+1]-p.gry[x]),ka=p.gry[x]+p.ybar2*(p.gry[x+1]-p.gry[x]),H=A<=n?y:q.grz(A),F=I>k?E:q.grz(I),U=Z?R:z,S=Z?u:c,b){for(f=0;f<U.length;++f)t[N++]=P/3+U[f];for(f=0;f<S.length;++f)Q=S[f],d[P]=D+Q.x*(Y-D),d[P+1]=ha+Q.y*(ka-ha),d[P+2]=H+Q.z*(F-H),P+=3}else for(f=0;f<U.length;++f)Q=S[U[f]],d[P]=D+Q.x*(Y-D),d[P+1]=ha+Q.y*(ka-ha),d[P+2]=H+Q.z*(F-H),P+=3;c=this.getColor(v.fLineColor);c=new e.LineBasicMaterial({color:new e.Color(c),
linewidth:v.fLineWidth});c=g.createLineSegments(d,c,b?t:null);q.toplevel.add(c)}}}};g.drawAxis3D=function(a,c){a=new JSROOT.ObjectPainter(a,c);"_main"in c||a.addToPadPrimitives();a.Draw3DAxis=function(){var a=this.getFramePainter();if(!a||!a._toplevel)return Promise.reject(Error("no 3D frame found for 3D axis drawing"));var c=(new e.Box3).setFromObject(a._toplevel);this.xmin=c.min.x;this.xmax=c.max.x;this.ymin=c.min.y;this.ymax=c.max.y;this.zmin=c.min.z;this.zmax=c.max.z;this.size_x3d=this.size_y3d=
this.size_z3d=0;this.drawXYZ=JSROOT.TFramePainter.prototype.drawXYZ;this.drawXYZ(a._toplevel);a.adjustCameraPosition();a.render3D();return Promise.resolve(this)};return a.Draw3DAxis()};JSROOT.TH1Painter.prototype.draw3D=function(a){var c=this;this.mode3d=!0;var b=this.getFramePainter(),d=this.isMainPainter(),e=this.getHisto();"resize"==a?d&&b.resize3D()&&b.render3D():(this.deleteAttr(),this.scanContent(!0),d&&(b.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale),b.setAxesRanges(e.fXaxis,
this.xmin,this.xmax,e.fYaxis,this.ymin,this.ymax,e.fZaxis,0,0),b.set3DOptions(this.options),b.drawXYZ(b.toplevel,{use_y_for_z:!0,zmult:1.1,zoom:JSROOT.settings.Zooming,ndim:1})),b.mode3d&&(this.draw3DBins(),b.render3D(),this.updateStatWebCanvas(),b.addKeysHandler()));return d?this.drawColorPalette(this.options.Zscale&&(12===this.options.Lego||14===this.options.Lego)).then(function(){return c.drawHistTitle()}):Promise.resolve(this)};JSROOT.TH2Painter.prototype.draw3D=function(a){var c=this;this.mode3d=
!0;var b=this.getFramePainter(),d=this.isMainPainter(),e=this.getHisto();if("resize"==a)d&&b.resize3D()&&b.render3D();else{a=this.getPadPainter().getRootPad(!0);var g=1.1;this.zmin=a&&a.fLogz?.3*this.gminposbin:this.gminbin;this.zmax=this.gmaxbin;-1111!==this.options.minimum&&(this.zmin=this.options.minimum);-1111!==this.options.maximum&&(this.zmax=this.options.maximum,g=1);a&&a.fLogz&&0>=this.zmin&&(this.zmin=1E-5*this.zmax);this.deleteAttr();d&&(b.create3DScene(this.options.Render3D,this.options.x3dscale,
this.options.y3dscale),b.setAxesRanges(e.fXaxis,this.xmin,this.xmax,e.fYaxis,this.ymin,this.ymax,e.fZaxis,this.zmin,this.zmax),b.set3DOptions(this.options),b.drawXYZ(b.toplevel,{zmult:g,zoom:JSROOT.settings.Zooming,ndim:2}));b.mode3d&&(this.draw3DBins(),b.render3D(),this.updateStatWebCanvas(),b.addKeysHandler())}return d?this.drawColorPalette(this.options.Zscale&&(12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf)).then(function(){return c.drawHistTitle()}):
Promise.resolve(this)};JSROOT.TH2Painter.prototype.drawContour3D=function(a){var c=this.getFramePainter(),b=this.prepareColorDraw({rounding:!1,use3d:!0,extra:100,middle:0}),d=this.getHisto(),e=this.getContourLevels(),R=this.getHistPalette(),u=2*c.size_z3d,q=[];this.buildContour(b,e,R,function(b,d,p,f,g,z){if(!(3>g-f)){if(a&&(u=c.grz(e[z]),0>u||u>2*c.size_z3d))return;for(b=f;b<g;++b)q.push(d[b],p[b],u),q.push(d[b+1],p[b+1],u)}});b=g.createLineSegments(q,g.create3DLineMaterial(this,d));c.toplevel.add(b)};
JSROOT.TH2Painter.prototype.drawSurf=function(){function a(a,b,c,d,e,f){if(w){var k=0>c?-1:c>2*q.size_z3d?1:0,h=0>f?-1:f>2*q.size_z3d?1:0;if(k!==h||0===k){if(!x)return++C;if(0!==k){var p=f-c;c=0>k?0:2*q.size_z3d;a=d-(d-a)/p*(f-c);b=e-(e-b)/p*(f-c)}0!==h&&(k=c-f,f=0>h?0:2*q.size_z3d,d=a-(a-d)/k*(c-f),e=b-(b-e)/k*(c-f));J[E]=a;J[E+1]=b;J[E+2]=c;E+=3;J[E]=d;J[E+1]=e;J[E+2]=f;E+=3}}}function c(a,b,c,d,e,f,k,h){L>=K.length&&console.log("more than 6 points???");c=(k-c)/(f-c);f=3;0!==N&&Math.abs(c)<Math.abs(N)&&
(K[L]=K[L-3],K[L+1]=K[L-2],K[L+2]=K[L-1],L-=3,f=6);K[L]=a+c*(d-a);K[L+1]=b+c*(e-b);K[L+2]=k;h&&F&&(O[ba]=K[L],O[ba+1]=K[L+1],O[ba+2]=K[L+2],ba+=3);L+=f;N=c}function b(a,b,c){b=8*((b-n.i1)*(n.j2-n.j1)+(c-n.j1));if(0<=G[b])return console.error("More than 8 vertexes for the bin");c=b+8+G[b];G[b]--;G[c]=a}function d(a){for(var b=n.i1;b<n.i2;++b)for(var c=n.j1;c<n.j2;++c){var d=8*((b-n.i1)*(n.j2-n.j1)+(c-n.j1));if(-1!==G[d]){var e=0<=G[d]?d:d+9+G[d];d+=8;for(var f=0,k=0,h=0,p=e;p<d;++p){var g=G[p];if(0>
g)return console.error("FAILURE in NORMALS RECALCULATIONS");f+=a[g];k+=a[g+1];h+=a[g+2]}f/=d-e;k/=d-e;for(h/=d-e;e<d;++e)p=G[e],a[p]=f,a[p+1]=k,a[p+2]=h}}}function z(a,d,e,f,h,g,n,t,q,u){for(var l=1;l<v.length;++l){var z=e<v[l-1]?-1:e>v[l]?1:0,r=g<v[l-1]?-1:g>v[l]?1:0,w=q<v[l-1]?-1:q>v[l]?1:0,B=z+r+w;if(3!==B){if(-3===B)break;if(x){if(L=ba=0,0===z&&(K[L]=a,K[L+1]=d,K[L+2]=e,L+=3),z!==r&&(N=0,(0>z||0>r)&&c(a,d,e,f,h,g,v[l-1]),(0<z||0<r)&&c(a,d,e,f,h,g,v[l],!0)),0===r&&(K[L]=f,K[L+1]=h,K[L+2]=g,L+=
3),r!==w&&(N=0,(0>r||0>w)&&c(f,h,g,n,t,q,v[l-1]),(0<r||0<w)&&c(f,h,g,n,t,q,v[l],!0)),0===w&&(K[L]=n,K[L+1]=t,K[L+2]=q,L+=3),w!==z&&(N=0,(0>w||0>z)&&c(n,t,q,a,d,e,v[l-1]),(0<w||0<z)&&c(n,t,q,a,d,e,v[l],!0)),0!==L)if(9>L)console.log("found less than 3 points",L/3);else{if(F&&6===ba){for(z=0;6>z;++z)F[M+z]=O[z];M+=6}z=A[l];r=m[l];y&&9===L&&(b(r,k,p),b(r+3,k+1,u?p+1:p),b(r+6,u?k:k+1,p+1));for(w=3;w<L-3;w+=3)z[r]=K[0],z[r+1]=K[1],z[r+2]=K[2],r+=3,z[r]=K[w],z[r+1]=K[w+1],z[r+2]=K[w+2],r+=3,z[r]=K[w+3],
z[r+1]=K[w+4],z[r+2]=K[w+5],r+=3;m[l]=r}}else B=Math.abs(r-z)+Math.abs(w-r)+Math.abs(z-w),0===z&&++B,0===r&&++B,0===w&&++B,1!==B&&2!==B||console.error("FOND npnts",B),2<B&&(void 0===D[l]&&(D[l]=0),D[l]+=B-2),!(0<z||0<r||0<w)||z===r&&r===w&&w===z||++H}}}var R=this,u=this.getHisto(),q=this.getFramePainter(),n=this.prepareColorDraw({rounding:!1,use3d:!0,extra:1,middle:.5}),k,p,f,B,r=q.z_handle.getScaleMin(),l=q.logz?function(a){return a<r?-.1:q.grz(a)}:q.grz;if(!(2>n.i2-n.i1||2>n.j2-n.j1)){var v=f=null,
w=!0,t=!1,y=!1,h=null;switch(this.options.Surf){case 11:f=this.getContourLevels();h=this.getHistPalette();break;case 12:case 15:case 17:f=this.getContourLevels();h=this.getHistPalette();w=!1;break;case 14:w=!1;y=!0;break;case 16:f=this.getContourLevels();t=!0;w=!1;break;default:f=q.z_handle.createTicks(!0),t=!0}if(f)for(v=new Float32Array(f.length),B=0;B<f.length;++B)v[B]=l(f[B]);else v=[0,2*q.size_z3d];var x,D=[],A=[],m=[],C=0,J=null,E=0,H=0,F=null,M=0,G=[],K=new Float32Array(18),L=0,N=0,O=new Float32Array(6),
ba=0;if(y)for(G=new Int32Array((n.i2-n.i1)*(n.j2-n.j1)*8),f=0;f<G.length;++f)G[f]=-1;for(x=0;2>x;++x){if(x){for(f=1;f<v.length;++f)D[f]&&(A[f]=new Float32Array(9*D[f]),m[f]=0);w&&0<C&&(J=new Float32Array(6*C));t&&0<H&&(F=new Float32Array(6*H))}for(k=n.i1;k<n.i2-1;++k){f=n.grx[k];var T=n.grx[k+1];for(p=n.j1;p<n.j2-1;++p){B=n.gry[p];var W=n.gry[p+1];var aa=l(u.getBinContent(k+1,p+1));var X=l(u.getBinContent(k+1,p+2));var S=l(u.getBinContent(k+2,p+1));var Q=l(u.getBinContent(k+2,p+2));z(f,B,aa,T,W,Q,
f,W,X,!0);z(f,B,aa,T,B,S,T,W,Q,!1);a(f,W,X,f,B,aa);a(f,B,aa,T,B,S);k===n.i2-2&&a(T,B,S,T,W,Q);p===n.j2-2&&a(f,W,X,T,W,Q)}}}for(l=1;l<v.length;++l)A[l]&&(m[l]!==9*D[l]&&console.error("SURF faces missmatch lvl",l,"faces",D[l],"index",m[l],"check",9*D[l]-m[l]),t=new e.BufferGeometry,t.setAttribute("position",new e.BufferAttribute(A[l],3)),t.computeVertexNormals(),y&&1===l&&d(t.getAttribute("normal").array),f=f=void 0,h?f=h.calcColor(l,v.length):(f=1<u.fFillColor?this.getColor(u.fFillColor):"white",14===
this.options.Surf&&2>u.fFillColor&&(f=this.getColor(48))),f=14===this.options.Surf?new e.MeshLambertMaterial({color:f,side:e.DoubleSide}):new e.MeshBasicMaterial({color:f,side:e.DoubleSide}),t=new e.Mesh(t,f),q.toplevel.add(t),t.painter=this);J&&(6*C!==E&&console.error("SURF lines mismmatch nsegm",C," lindx",E,"difference",6*C-E),h=this.getColor(u.fLineColor),h=new e.LineBasicMaterial({color:new e.Color(h),linewidth:u.fLineWidth}),h=g.createLineSegments(J,h),h.painter=this,q.toplevel.add(h));F&&(6*
H!==M&&console.error("SURF grid draw mismatch ngridsegm",H,"gindx",M,"diff",6*H-M),u=1===this.options.Surf?new e.LineDashedMaterial({color:0,dashSize:2,gapSize:2}):new e.LineBasicMaterial({color:new e.Color(this.getColor(u.fLineColor))}),u=g.createLineSegments(F,u),u.painter=this,q.toplevel.add(u));17===this.options.Surf&&this.drawContour3D();if(13===this.options.Surf){n=this.prepareColorDraw({rounding:!1,use3d:!0,extra:100,middle:0});u=this.getContourLevels();var U=this.getHistPalette(),P=-1,V=2*
q.size_z3d;this.buildContour(n,u,U,function(a,b,c,d,f){b[f]===b[d]&&c[f]===c[d]&&f--;if(!(3>f-d)){for(var k=[],h=d;h<=f;++h)h!==d&&b[h]===b[h-1]&&c[h]===c[h-1]||k.push(new e.Vector2(b[h],c[h]));if(!(3>k.length)&&(d=e.ShapeUtils.triangulateShape(k,[]))&&0!==d.length){if(0>P||P!==a)P=a,V+=1E-4*q.size_z3d;b=new Float32Array(9*d.length);c=new Float32Array(9*d.length);for(h=f=0;h<d.length;++h)for(var p=d[h],z=0;3>z;++z){var g=k[p[z]];b[f]=g.x;b[f+1]=g.y;b[f+2]=V;c[f]=0;c[f+1]=0;c[f+2]=1;f+=3}k=new e.BufferGeometry;
k.setAttribute("position",new e.BufferAttribute(b,3));k.setAttribute("normal",new e.BufferAttribute(c,3));a=U.getColor(a);a=new e.MeshBasicMaterial({color:a,side:e.DoubleSide,opacity:.5});a=new e.Mesh(k,a);a.painter=R;q.toplevel.add(a)}}})}}};JSROOT.TH2Painter.prototype.drawError=function(){for(var a=this.getFramePainter(),c=this.getHisto(),b=this.prepareColorDraw({rounding:!1,use3d:!0,extra:1}),d=a.z_handle.getScaleMin(),z=a.z_handle.getScaleMax(),m,u,q,n,k,p,f,B,r,l=0,v=null,w=null,t=0,y=0;2>y;++y){for(m=
b.i1;m<b.i2;++m)for(p=b.grx[m],f=b.grx[m+1],u=b.j1;u<b.j2;++u)if(n=c.getBinContent(m+1,u+1),!(n<d||n>z)){if(k=n===d)k=this.options.Zero||0<d?!1:!this._show_empty_bins;k||(0===y?l+=3:(q=c.getBin(m+1,u+1),k=c.getBinError(q),w[t/18]=q,q=b.gry[u],B=b.gry[u+1],r=a.grz(n-k<d?d:n-k),n=a.grz(n+k>z?z:n+k),v[t]=p,v[t+3]=f,v[t+1]=v[t+4]=(q+B)/2,v[t+2]=v[t+5]=(r+n)/2,t+=6,v[t]=v[t+3]=(p+f)/2,v[t+1]=q,v[t+4]=B,v[t+2]=v[t+5]=(r+n)/2,t+=6,v[t]=v[t+3]=(p+f)/2,v[t+1]=v[t+4]=(q+B)/2,v[t+2]=r,v[t+5]=n,t+=6))}if(0===
y){if(0===l)return;v=new Float32Array(6*l);w=new Int32Array(l/3)}}c=this.getColor(this.getObject().fLineColor);c=new e.LineBasicMaterial({color:new e.Color(c),linewidth:this.getObject().fLineWidth});v=g.createLineSegments(v,c);v.painter=this;v.intersect_index=w;v.zmin=d;v.zmax=z;v.tip_color=3===this.getObject().fLineColor?16711680:65280;v.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("segment index not provided, three.js version "+e.REVISION+", expected 127"),null;var b=Math.floor(a.index/
6);if(0>b||b>=this.intersect_index.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.intersect_index[b]);b.x1=Math.max(-d.size_x3d,d.grx(a.fXaxis.GetBinLowEdge(b.ix)));b.x2=Math.min(d.size_x3d,d.grx(a.fXaxis.GetBinLowEdge(b.ix+1)));b.y1=Math.max(-d.size_y3d,d.gry(a.fYaxis.GetBinLowEdge(b.iy)));b.y2=Math.min(d.size_y3d,d.gry(a.fYaxis.GetBinLowEdge(b.iy+1)));b.z1=d.grz(b.value-b.error<this.zmin?this.zmin:b.value-b.error);b.z2=d.grz(b.value+b.error>
this.zmax?this.zmax:b.value+b.error);b.color=this.tip_color;return b};a.toplevel.add(v)};JSROOT.TH2Painter.prototype.drawPolyLego=function(){var a=this.getHisto(),c=this.getFramePainter(),b=c.z_handle.getScaleMin(),d=c.z_handle.getScaleMax(),z,g=a.fBins.arr.length,u=c.grz(b);this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;var q=this.getContour(!0),n=this.getHistPalette();for(z=0;z<g;++z){var k=a.fBins.arr[z];if(!(k.fContent<b)){var p=q.getPaletteIndex(n,k.fContent);
if(null!==p&&!(k.fXmin>c.scale_xmax||k.fXmax<c.scale_xmin||k.fYmin>c.scale_ymax||k.fYmax<c.scale_ymin)){var f=c.grz(k.fContent>d?d:k.fContent);var B=[],r=[],l=1,v=k.fPoly,w=0;"TMultiGraph"==v._typename&&(l=k.fPoly.fGraphs.arr.length,v=null);for(var t=0;t<l;++t){if(!v||0<t)v=k.fPoly.fGraphs.arr[t];for(var y=v.fNpoints,h=v.fX,x=v.fY;2<y&&h[0]===h[y-1]&&x[0]===x[y-1];)--y;for(var m=void 0,A=void 0,I=0;2>I;++I){var C=void 0,J=void 0,E=void 0,H=void 0,F=c.size_x3d*c.size_z3d,M=0<I?0:F/1E6;m=[];A=null;
for(var G=0;G<y;++G)E=c.grx(h[G]),H=c.gry(x[G]),0<G&&(F=(E-C)*(E-C)+(H-J)*(H-J)),F>M&&(m.push(new e.Vector2(E,H)),C=E,J=H);try{2<m.length&&(A=e.ShapeUtils.triangulateShape(m,[]))}catch(K){A=null}if(A&&A.length>m.length-3)break}A&&A.length&&m&&(B.push(m),r.push(A),w+=2*A.length,f>u&&(w+=2*m.length))}k=new Float32Array(9*w);for(v=l=0;v<B.length;++v){w=B[v];t=r[v];for(y=0;2>y;++y)for(h=0;h<t.length;++h)A=t[h],x=w[A[0]],m=w[A[0===y?2:1]],A=w[A[0===y?1:2]],k[l]=x.x,k[l+1]=x.y,k[l+2]=y?f:u,l+=3,k[l]=m.x,
k[l+1]=m.y,k[l+2]=y?f:u,l+=3,k[l]=A.x,k[l+1]=A.y,k[l+2]=y?f:u,l+=3;if(f>u)for(t=0;t<w.length;++t)y=w[t],h=w[0<t?t-1:w.length-1],k[l]=y.x,k[l+1]=y.y,k[l+2]=u,l+=3,k[l]=h.x,k[l+1]=h.y,k[l+2]=u,l+=3,k[l]=h.x,k[l+1]=h.y,k[l+2]=f,l+=3,k[l]=y.x,k[l+1]=y.y,k[l+2]=u,l+=3,k[l]=h.x,k[l+1]=h.y,k[l+2]=f,l+=3,k[l]=y.x,k[l+1]=y.y,k[l+2]=f,l+=3}B=new e.BufferGeometry;B.setAttribute("position",new e.BufferAttribute(k,3));B.computeVertexNormals();p=this.fPalette.getColor(p);p=new e.MeshBasicMaterial({color:p});p=
new e.Mesh(B,p);c.toplevel.add(p);p.painter=this;p.bins_index=z;p.draw_z0=u;p.draw_z1=f;p.tip_color=65280;p.tooltip=function(){var a=this.painter,b=a.getFramePainter(),c=a.getObject().fBins.arr[this.bins_index];return{use_itself:!0,x1:b.grx(c.fXmin),x2:b.grx(c.fXmax),y1:b.gry(c.fYmin),y2:b.gry(c.fYmax),z1:this.draw_z0,z2:this.draw_z1,bin:this.bins_index,value:c.fContent,color:this.tip_color,lines:a.getPolyBinTooltips(this.bins_index)}}}}}};O.prototype=Object.create(JSROOT.THistPainter.prototype);
O.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy&&this.nbinsz)){a=this.getObject();this.extractAxesProperties(3);this.gminbin=this.gmaxbin=a.getBinContent(1,1,1);for(var c=0;c<this.nbinsx;++c)for(var b=0;b<this.nbinsy;++b)for(var d=0;d<this.nbinsz;++d){var e=a.getBinContent(c+1,b+1,d+1);e<this.gminbin?this.gminbin=e:e>this.gmaxbin&&(this.gmaxbin=e)}this.draw_content=0<this.gmaxbin}};O.prototype.countStat=function(){var a=this.getHisto(),c=a.fXaxis,b=a.fYaxis,d=a.fZaxis,e=0,g=0,
u=0,q=0,n=0,k=0,p=0,f=this.getSelectIndex("x","left"),m=this.getSelectIndex("x","right"),r=this.getSelectIndex("y","left"),l=this.getSelectIndex("y","right"),v=this.getSelectIndex("z","left"),w=this.getSelectIndex("z","right"),t=this.getFramePainter(),y={name:a.fName,entries:0,integral:0,meanx:0,meany:0,meanz:0,rmsx:0,rmsy:0,rmsz:0},h,x,D;for(h=0;h<this.nbinsx+2;++h){var A=c.GetBinCoord(h-.5);var I=h<f?0:h>m?2:1;for(x=0;x<this.nbinsy+2;++x){var C=b.GetBinCoord(x-.5);var J=x<r?0:x>l?2:1;for(D=0;D<
this.nbinsz+2;++D){var E=d.GetBinCoord(D-.5);var H=D<v?0:D>w?2:1;var F=a.getBinContent(h,x,D);y.entries+=F;1==I&&1==J&&1==H&&(e+=F,g+=A*F,u+=C*F,q+=E*F,n+=A*A*F,k+=C*C*F,p+=E*E*F)}}}0<a.fTsumw&&!t.isAxisZoomed("x")&&!t.isAxisZoomed("y")&&!t.isAxisZoomed("z")&&(e=a.fTsumw,g=a.fTsumwx,n=a.fTsumwx2,u=a.fTsumwy,k=a.fTsumwy2,q=a.fTsumwz,p=a.fTsumwz2);0<e&&(y.meanx=g/e,y.meany=u/e,y.meanz=q/e,y.rmsx=Math.sqrt(Math.abs(n/e-y.meanx*y.meanx)),y.rmsy=Math.sqrt(Math.abs(k/e-y.meany*y.meany)),y.rmsz=Math.sqrt(Math.abs(p/
e-y.meanz*y.meanz)));y.integral=e;1<a.fEntries&&(y.entries=a.fEntries);return y};O.prototype.fillStatistic=function(a,c,b){if(this.isIgnoreStatsFill())return!1;var d=this.countStat(),e=c%10,g=Math.floor(c/10)%10,u=Math.floor(c/100)%10,q=Math.floor(c/1E3)%10;c=Math.floor(c/1E6)%10;a.clearPave();0<e&&a.addText(d.name);0<g&&a.addText("Entries = "+a.format(d.entries,"entries"));0<u&&(a.addText("Mean x = "+a.format(d.meanx)),a.addText("Mean y = "+a.format(d.meany)),a.addText("Mean z = "+a.format(d.meanz)));
0<q&&(a.addText("Std Dev x = "+a.format(d.rmsx)),a.addText("Std Dev y = "+a.format(d.rmsy)),a.addText("Std Dev z = "+a.format(d.rmsz)));0<c&&a.addText("Integral = "+a.format(d.integral,"entries"));b&&a.fillFunctionStat(this.findFunction("TF3"),b);return!0};O.prototype.getBinTooltips=function(a,c,b){var d=[],e=this.getHisto();d.push(this.getObjectHint());d.push("x = "+this.getAxisBinTip("x",e.fXaxis,a)+"  xbin="+(a+1));d.push("y = "+this.getAxisBinTip("y",e.fYaxis,c)+"  ybin="+(c+1));d.push("z = "+
this.getAxisBinTip("z",e.fZaxis,b)+"  zbin="+(b+1));a=e.getBinContent(a+1,c+1,b+1);a===Math.round(a)?d.push("entries = "+a):d.push("entries = "+g.floatToString(a,JSROOT.gStyle.fStatFormat));return d};O.prototype.draw3DScatter=function(){var a=this,c=this.getObject(),b=this.getFramePainter(),d=this.getSelectIndex("x","left",.5),z=this.getSelectIndex("x","right",0),m=this.getSelectIndex("y","left",.5),u=this.getSelectIndex("y","right",0),q=this.getSelectIndex("z","left",.5),n=this.getSelectIndex("z",
"right",0),k,p,f;if(z<=d||u<=m||n<=q)return Promise.resolve(!0);var B=1E3<this.gmaxbin?1E3/this.gmaxbin:1,r=0,l=0,v=Math.max(0,this.gminbin);for(k=d;k<z;++k)for(p=m;p<u;++p)for(f=q;f<n;++f){var w=c.getBinContent(k+1,p+1,f+1);l+=w;w<=v||(r+=Math.round(w*B))}if(r>(b.webgl?1E5:3E4))return!1;JSROOT.seed(l);l=new g.PointsCreator(r,b.webgl,b.size_x3d/200);var t=new Int32Array(r);r=0;for(k=d;k<z;++k)for(p=m;p<u;++p)for(f=q;f<n;++f)if(w=c.getBinContent(k+1,p+1,f+1),!(w<=v))for(d=Math.round(w*B),w=0;w<d;++w){var y=
c.fXaxis.GetBinCoord(k+JSROOT.random()),h=c.fYaxis.GetBinCoord(p+JSROOT.random()),x=c.fZaxis.GetBinCoord(f+JSROOT.random());t[r++]=c.getBin(k+1,p+1,f+1);l.addPoint(b.grx(y),b.gry(h),b.grz(x))}return l.createPoints({color:this.getColor(c.fMarkerColor),promise:!0}).then(function(d){b.toplevel.add(d);d.bins=t;d.painter=a;d.tip_color=3===c.fMarkerColor?16711680:65280;d.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, three.js version "+e.REVISION+", expected 127"),
null;var b=Math.floor(a.index/this.nvertex);if(0>b||b>=this.bins.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.bins[b]);b.x1=d.grx(a.fXaxis.GetBinLowEdge(b.ix));b.x2=d.grx(a.fXaxis.GetBinLowEdge(b.ix+1));b.y1=d.gry(a.fYaxis.GetBinLowEdge(b.iy));b.y2=d.gry(a.fYaxis.GetBinLowEdge(b.iy+1));b.z1=d.grz(a.fZaxis.GetBinLowEdge(b.iz));b.z2=d.grz(a.fZaxis.GetBinLowEdge(b.iz+1));b.color=this.tip_color;b.opacity=.3;return b};return!0})};O.prototype.draw3DBins=
function(){this.draw_content||Promise.resolve(!1);if(!(this.options.Box||this.options.GLBox||this.options.GLColor||this.options.Lego)){var a=this.draw3DScatter();if(!1!==a)return a}a=this.getObject().fFillColor;var c=this.getColor(a),b=this.getFramePainter(),d=0,z=!1,m=!1,u=!1,q=1,n=!0,k=this.options.Box?this.options.BoxStyle:0,p=.5;!k&&this.options.Lego&&(k=1===this.options.Lego?10:this.options.Lego);if(11===this.options.GLBox||12===this.options.GLBox){p=.4;z=!0;12===this.options.GLBox&&(u=!0);d=
b.webgl?new e.SphereGeometry(.5,16,12):new e.SphereGeometry(.5,8,6);d.applyMatrix4((new e.Matrix4).makeRotationX(Math.PI/2));d.computeVertexNormals();k=d.getIndex().array;var f=d.getAttribute("position").array,B=d.getAttribute("normal").array;d=3*k.length;var r=new Float32Array(d);var l=new Float32Array(d);for(var v=0;v<k.length;++v){var w=3*k[v];r[3*v]=f[w];r[3*v+1]=f[w+1];r[3*v+2]=f[w+2];l[3*v]=B[w];l[3*v+1]=B[w+1];l[3*v+2]=B[w+2]}}else{f=g.Box3D.Indexes;B=g.Box3D.Normals;v=g.Box3D.Vertices;d=3*
f.length;r=new Float32Array(d);l=new Float32Array(d);w=0;for(var t=-3;w<f.length;++w){var y=v[f[w]];r[3*w]=y.x-.5;r[3*w+1]=y.y-.5;r[3*w+2]=y.z-.5;0===w%6&&(t+=3);l[3*w]=B[t];l[3*w+1]=B[t+1];l[3*w+2]=B[t+2]}m=!0;12===k?u=!0:13===k?(u=!0,m=!1):this.options.GLColor&&(u=!0,q=.5,m=n=!1,z=!0)}n&&(n=this.gminbin||this.gmaxbin?1/Math.max(Math.abs(this.gminbin),Math.abs(this.gmaxbin)):1);var h=this.getHisto(),x=this.getSelectIndex("x","left",.5),D=this.getSelectIndex("x","right",0),A=this.getSelectIndex("y",
"left",.5),C=this.getSelectIndex("y","right",0),M=this.getSelectIndex("z","left",.5),J=this.getSelectIndex("z","right",0);if(!(D<=x||C<=A||J<=M)){k=(b.grx(h.fXaxis.GetBinLowEdge(D+1))-b.grx(h.fXaxis.GetBinLowEdge(x+1)))/(D-x);f=(b.gry(h.fYaxis.GetBinLowEdge(C+1))-b.gry(h.fYaxis.GetBinLowEdge(A+1)))/(C-A);B=(b.grz(h.fZaxis.GetBinLowEdge(J+1))-b.grz(h.fZaxis.GetBinLowEdge(M+1)))/(J-M);var E=0,H,F,O;v=[];var G=0;w=[];var K=u?this.getContour():null,L=u?this.getHistPalette():null;for(H=x;H<D;++H)for(F=
A;F<C;++F)for(O=M;O<J;++O){var N=h.getBinContent(H+1,F+1,O+1);if(this.options.GLColor||!(0===N||N<this.gminbin)){var da=n?Math.pow(Math.abs(N*n),.3333):1;.001>da||(E++,u&&(t=K.getPaletteIndex(L,N),null!==t?(void 0===v[t]&&(v[t]=0,w[t]=G++),v[t]+=1):console.error("not found color for",N)))}}u||(v.push(E),G=1,w=[0]);var ba=Array(G);t=Array(G);y=Array(G);var T=Array(G),W=Array(G),aa=Array(G);G=Array(G);for(H=0;H<v.length;++H)v[H]&&(E=v[H],F=w[H],ba[F]=0,W[F]=0,m&&(W[F]=65520<E*d/3?2:1),t[F]=new Float32Array(E*
d),y[F]=new Float32Array(E*d),T[F]=new Int32Array(E),1===W[F]&&(aa[F]=new Uint16Array(E*g.Box3D.MeshSegments.length)),2===W[F]&&(G[F]=new Float32Array(E*g.Box3D.Segments.length*3)));for(H=x;H<D;++H)for(E=h.fXaxis.GetBinCenter(H+1),m=b.grx(E),F=A;F<C;++F)for(E=h.fYaxis.GetBinCenter(F+1),x=b.gry(E),O=M;O<J;++O)if(N=h.getBinContent(H+1,F+1,O+1),this.options.GLColor||!(0===N||N<this.gminbin))if(da=n?Math.pow(Math.abs(N*n),.3333):1,!(.001>da)){var X=0;if(u){E=K.getPaletteIndex(L,N);if(null===E)continue;
X=w[E]}E=ba[X];N=h.fZaxis.GetBinCenter(O+1);N=b.grz(N);T[X][E]=h.getBin(H+1,F+1,O+1);for(var S=E*d,Q=t[X],U=y[X],P=0;P<d;P+=3,S+=3)Q[S]=m+r[P]*k*da,Q[S+1]=x+r[P+1]*f*da,Q[S+2]=N+r[P+2]*B*da,U[S]=l[P],U[S+1]=l[P+1],U[S+2]=l[P+2];if(1===W[X]){Q=g.Box3D.MeshSegments;S=E*Q.length;U=Math.round(E*d/3);P=aa[X];for(var V=0;V<Q.length;++V)P[S+V]=U+Q[V]}if(2===W[X])for(Q=g.Box3D.Segments,U=G[X],S=E*Q.length*3,P=0;P<Q.length;++P,S+=3)V=g.Box3D.Vertices[Q[P]],U[S]=m+(V.x-.5)*k*da,U[S+1]=x+(V.y-.5)*f*da,U[S+2]=
N+(V.z-.5)*B*da;ba[X]=E+1}for(r=0;r<v.length;++r)v[r]&&(l=w[r],h=new e.BufferGeometry,h.setAttribute("position",new e.BufferAttribute(t[l],3)),h.setAttribute("normal",new e.BufferAttribute(y[l],3)),u&&(c=this.fPalette.getColor(r)),D=z?new e.MeshLambertMaterial({color:c,opacity:q,transparent:1>q}):new e.MeshBasicMaterial({color:c,opacity:q}),h=new e.Mesh(h,D),h.bins=T[l],h.bins_faces=d/9,h.painter=this,h.scalex=p*k,h.scaley=p*f,h.scalez=p*B,h.tip_color=3===a?16711680:65280,h.use_scale=n,h.tooltip=
function(a){if(!Number.isInteger(a.faceIndex))return console.error("intersect.faceIndex not provided, three.js version "+e.REVISION+", expected 127"),null;var b=Math.floor(a.faceIndex/this.bins_faces);if(0>b||b>=this.bins.length)return null;var c=this.painter;a=c.getHisto();var d=c.getFramePainter();b=c.get3DToolTip(this.bins[b]);c=d.grx(a.fXaxis.GetBinCoord(b.ix-.5));var f=d.gry(a.fYaxis.GetBinCoord(b.iy-.5));a=d.grz(a.fZaxis.GetBinCoord(b.iz-.5));d=this.use_scale?Math.pow(Math.abs(b.value*this.use_scale),
.3333):1;b.x1=c-this.scalex*d;b.x2=c+this.scalex*d;b.y1=f-this.scaley*d;b.y2=f+this.scaley*d;b.z1=a-this.scalez*d;b.z2=a+this.scalez*d;b.color=this.tip_color;return b},b.toplevel.add(h),0<W[l]&&(h=this.getColor(this.getObject().fLineColor),h=new e.LineBasicMaterial({color:h}),D=null,D=1===W[l]?g.createLineSegments(t[l],h,aa[l]):g.createLineSegments(G[l],h),b.toplevel.add(D)));return Promise.resolve(!0)}};O.prototype.redraw=function(a){var c=this,b=this.getFramePainter(),d=this.getHisto(),e=Promise.resolve(!0);
"resize"==a?b.resize3D()&&b.render3D():(b.create3DScene(this.options.Render3D,this.options.x3dscale,this.options.y3dscale),b.setAxesRanges(d.fXaxis,this.xmin,this.xmax,d.fYaxis,this.ymin,this.ymax,d.fZaxis,this.zmin,this.zmax),b.set3DOptions(this.options),b.drawXYZ(b.toplevel,{zoom:JSROOT.settings.Zooming,ndim:3}),e=this.draw3DBins().then(function(){b.render3D();c.updateStatWebCanvas();b.addKeysHandler()}));return e.then(function(){return c.drawHistTitle()})};O.prototype.fillToolbar=function(){var a=
this.getPadPainter();a&&(a.addPadButton("auto_zoom","Unzoom all axes","ToggleZoom","Ctrl *"),this.draw_content&&a.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a.showPadButtons())};O.prototype.canZoomInside=function(a,c,b){var d=this.getHisto();d&&(d=d["f"+a.toUpperCase()+"axis"]);return!d||1<d.FindBin(b,.5)-d.FindBin(c,0)};O.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left"),c=this.getSelectIndex("x","right"),b=this.getSelectIndex("y","left"),d=this.getSelectIndex("y",
"right"),e=this.getSelectIndex("z","left"),g=this.getSelectIndex("z","right"),u,q,n,k=this.getObject();if(a!==c&&b!==d&&e!==g){var p=k.getBinContent(a+1,b+1,e+1);for(u=a;u<c;++u)for(q=b;q<d;++q)for(n=e;n<g;++n)p=Math.min(p,k.getBinContent(u+1,q+1,n+1));if(!(0<p)){var f=c,m=a,r=d,l=b,v=g,w=e;for(u=a;u<c;++u)for(q=b;q<d;++q)for(n=e;n<g;++n)k.getBinContent(u+1,q+1,n+1)>p&&(u<f&&(f=u),u>=m&&(m=u+1),q<r&&(r=q),q>=l&&(l=q+1),n<v&&(v=n),n>=w&&(w=n+1));u=!1;f===m-1&&f>a+1&&m<c-1&&(f--,m++);r===l-1&&r>b+1&&
l<d-1&&(r--,l++);v===w-1&&v>e+1&&w<g-1&&(v--,w++);if((f>a||m<c)&&f<m-1){var t=k.fXaxis.GetBinLowEdge(f+1);var y=k.fXaxis.GetBinLowEdge(m+1);u=!0}if((r>b||l<d)&&r<l-1){var h=k.fYaxis.GetBinLowEdge(r+1);var x=k.fYaxis.GetBinLowEdge(l+1);u=!0}if((v>e||w<g)&&v<w-1){var D=k.fZaxis.GetBinLowEdge(v+1);var A=k.fZaxis.GetBinLowEdge(w+1);u=!0}u&&this.getFramePainter().zoom(t,y,h,x,D,A)}}};O.prototype.fillHistContextMenu=function(a){var c=this,b=g.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");
a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.interactiveRedraw(!0,"drawopt")})};g.drawHistogram3D=function(a,c,b){var d=new JSROOT.TH3Painter(a,c);return g.ensureTCanvas(d,"3d").then(function(){d.setAsMainPainter();d.decodeOptions(b);d.checkPadRange();d.scanContent();return d.redraw()}).then(function(){var b=d.createStat();if(b)return JSROOT.draw(a,b,"")}).then(function(){d.fillToolbar();return d})};ia.prototype=Object.create(JSROOT.ObjectPainter.prototype);
ia.prototype.decodeOptions=function(a){var c=new JSROOT.DrawOptions(a);this.options||(this.options={});var b=this.options;b.Color=c.check("COL");b.Line=c.check("LINE");b.Error=c.check("ERR")&&this.matchObjectType("TGraph2DErrors");b.Circles=c.check("P0");b.Markers=c.check("P");b.Markers||b.Error||b.Circles||b.Line||(b.Markers=!0);b.Markers||(b.Color=!1);this.storeDrawOpt(a)};ia.prototype.createHistogram=function(){for(var a=this.getObject(),c=a.fX[0],b=c,d=a.fY[0],e=d,g=a.fZ[0],u=g,q=0;q<a.fNpoints;++q){var n=
a.fX[q],k=a.fY[q],p=a.fZ[q],f=this.options.Error?a.fEX[q]:0,m=this.options.Error?a.fEY[q]:0,r=this.options.Error?a.fEZ[q]:0;c=Math.min(c,n-f);b=Math.max(b,n+f);d=Math.min(d,k-m);e=Math.max(e,k+m);g=Math.min(g,p-r);u=Math.max(u,p+r)}c>=b&&(b=c+1);d>=e&&(e=d+1);g>=u&&(u=g+1);q=.02*(b-c);k=.02*(e-d);f=.02*(u-g);a=c-q;q=b+q;n=d-k;k=e+k;p=g-f;f=u+f;0>a&&0<=c&&(a=.98*c);0<q&&0>=b&&(q=0);0>n&&0<=d&&(n=.98*d);0<k&&0>=e&&(k=0);0>p&&0<=g&&(p=.98*g);0<f&&0>=u&&(f=0);b=this.getObject();-1111!=b.fMinimum&&(p=
b.fMinimum);-1111!=b.fMaximum&&(f=b.fMaximum);c=JSROOT.createHistogram("TH2I",10,10);c.fName=b.fName+"_h";c.fTitle=b.fTitle;c.fXaxis.fXmin=a;c.fXaxis.fXmax=q;c.fYaxis.fXmin=n;c.fYaxis.fXmax=k;c.fZaxis.fXmin=p;c.fZaxis.fXmax=f;c.fMinimum=p;c.fMaximum=f;b=JSROOT.BIT(9);c.fBits|=b;return c};ia.prototype.graph2DTooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, three.js version "+e.REVISION+", expected 127"),null;var c=Math.floor(a.index/this.nvertex);
if(0>c||c>=this.index.length)return null;var b=function(a){return a*a};c=this.index[c];var d=this.painter,g=this.graph,m=d.grx(g.fX[c]),u=d.gry(g.fY[c]),q=d.grz(g.fZ[c]);if(this.check_next&&c+1<g.fX.length){a=a.point;var n=d.grx(g.fX[c+1]),k=d.gry(g.fY[c+1]),p=d.grz(g.fZ[c+1]);b(a.x-n)+b(a.y-k)+b(a.z-p)<b(a.x-m)+b(a.y-u)+b(a.z-q)&&(m=n,u=k,q=p,c++)}return{x1:m-this.scale0,x2:m+this.scale0,y1:u-this.scale0,y2:u+this.scale0,z1:q-this.scale0,z2:q+this.scale0,color:this.tip_color,lines:[this.tip_name,
"pnt: "+c,"x: "+d.axisAsText("x",g.fX[c]),"y: "+d.axisAsText("y",g.fY[c]),"z: "+d.axisAsText("z",g.fZ[c])]}};ia.prototype.redraw=function(){var a=this,c=this.getMainPainter(),b=this.getFramePainter(),d=this.getObject(),m=1;if(!(d&&c&&b&&b.mode3d))return Promise.resolve(this);var C=function(a,c){for(var e=0,f=0;f<d.fNpoints;++f)d.fX[f]<b.scale_xmin||d.fX[f]>b.scale_xmax||d.fY[f]<b.scale_ymin||d.fY[f]>b.scale_ymax||d.fZ[f]<a||d.fZ[f]>=c||++e;return e};if(0<JSROOT.settings.OptimizeDraw&&!b.webgl){var u=
C(b.scale_zmin,b.scale_zmax);5E4<u&&(m=Math.floor(u/5E4),2>=m&&(m=2))}var q=new JSROOT.TAttMarkerHandler(d);u=null;var n=[b.scale_zmin,b.scale_zmax],k=b.size_x3d/100*q.getFullSize();q=[];this.options.Circles&&(k=.06*b.size_x3d);b.usesvg&&(k*=.3);this.options.Color&&(n=c.getContourLevels(),u=c.getHistPalette());c={};for(var p=0;p<n.length-1;c={$jscomp$loop$prop$index$68:c.$jscomp$loop$prop$index$68},++p){var f=Math.max(n[p],b.scale_zmin),B=Math.min(n[p+1],b.scale_zmax);if(!(f>=B)){var r=Math.floor(C(f,
B)/m),l=null,v=0;c.$jscomp$loop$prop$index$68=new Int32Array(r);var w=0,t=null,y=null,h=0,x=0;if(this.options.Markers||this.options.Circles)l=new g.PointsCreator(r,b.webgl,k/3);this.options.Error&&(t=new Float32Array(18*r));this.options.Line&&(y=new Float32Array(6*(r-1)));for(r=0;r<d.fNpoints;++r)if(!(d.fX[r]<b.scale_xmin||d.fX[r]>b.scale_xmax||d.fY[r]<b.scale_ymin||d.fY[r]>b.scale_ymax||d.fZ[r]<f||d.fZ[r]>=B)){if(1<m&&(v=(v+1)%m,0!==v))continue;c.$jscomp$loop$prop$index$68[w++]=r;var D=b.grx(d.fX[r]),
A=b.gry(d.fY[r]),I=b.grz(d.fZ[r]);l&&l.addPoint(D,A,I);t&&(t[h]=b.grx(d.fX[r]-d.fEX[r]),t[h+1]=A,t[h+2]=I,t[h+3]=b.grx(d.fX[r]+d.fEX[r]),t[h+4]=A,t[h+5]=I,h+=6,t[h]=D,t[h+1]=b.gry(d.fY[r]-d.fEY[r]),t[h+2]=I,t[h+3]=D,t[h+4]=b.gry(d.fY[r]+d.fEY[r]),t[h+5]=I,h+=6,t[h]=D,t[h+1]=A,t[h+2]=b.grz(d.fZ[r]-d.fEZ[r]),t[h+3]=D,t[h+4]=A,t[h+5]=b.grz(d.fZ[r]+d.fEZ[r]),h+=6);y&&(6<=x&&(y[x]=y[x-3],y[x+1]=y[x-2],y[x+2]=y[x-1],x+=3),y[x]=D,y[x+1]=A,y[x+2]=I,x+=3)}y&&3<x&&y.length==x&&(f=this.getColor(this.getObject().fLineColor),
f=new e.LineBasicMaterial({color:new e.Color(f),linewidth:this.getObject().fLineWidth}),y=g.createLineSegments(y,f),b.toplevel.add(y),y.graph=d,y.index=c.$jscomp$loop$prop$index$68,y.painter=b,y.scale0=.7*k,y.tip_name=this.getObjectHint(),y.tip_color=3===d.fMarkerColor?16711680:65280,y.nvertex=2,y.check_next=!0,y.tooltip=this.graph2DTooltip);t&&(y=this.getColor(this.getObject().fLineColor),y=new e.LineBasicMaterial({color:new e.Color(y),linewidth:this.getObject().fLineWidth}),t=g.createLineSegments(t,
y),b.toplevel.add(t),t.graph=d,t.index=c.$jscomp$loop$prop$index$68,t.painter=b,t.scale0=.7*k,t.tip_name=this.getObjectHint(),t.tip_color=3===d.fMarkerColor?16711680:65280,t.nvertex=6,t.tooltip=this.graph2DTooltip);l&&(t="blue",this.options.Circles||(t=u?u.calcColor(p,n.length):this.getColor(d.fMarkerColor)),l=l.createPoints({color:t,style:this.options.Circles?4:d.fMarkerStyle,promise:!0}).then(function(c){return function(e){e.graph=d;e.painter=b;e.tip_color=3===d.fMarkerColor?16711680:65280;e.scale0=
.3*k;e.index=c.$jscomp$loop$prop$index$68;e.tip_name=a.getObjectHint();e.tooltip=a.graph2DTooltip;b.toplevel.add(e)}}(c)),q.push(l))}}return Promise.all(q).then(function(){b.render3D(100);return a})};g.drawGraph2D=function(a,c,b){var d=new JSROOT.TGraph2DPainter(a,c);d.decodeOptions(b);b=Promise.resolve(!0);d.getMainPainter()||(c.fHistogram||(c.fHistogram=d.createHistogram()),b=JSROOT.draw(a,c.fHistogram,"lego;axis"),d.ownhisto=!0);return b.then(function(){d.addToPadPrimitives();return d.redraw()})};
g.drawPolyMarker3D=function(){var a=this,c=this.getFramePainter(),b=this.getObject();if(!c||!c.mode3d||!b)return null;if(!c.toplevel){var d=this.getMainPainter();return d&&"function"==typeof d.drawExtras?d.drawExtras(b):null}d=1;for(var m=0,C=0;C<b.fP.length;C+=3)b.fP[C]<c.scale_xmin||b.fP[C]>c.scale_xmax||b.fP[C+1]<c.scale_ymin||b.fP[C+1]>c.scale_ymax||b.fP[C+2]<c.scale_zmin||b.fP[C+2]>c.scale_zmax||++m;0<JSROOT.settings.OptimizeDraw&&5E4<m&&(d=Math.floor(m/5E4),2>=d&&(d=2));m=Math.floor(m/d);for(var u=
new g.PointsCreator(m,c.webgl,c.size_x3d/100),q=new Int32Array(m),n=C=m=0;n<b.fP.length;n+=3)if(!(b.fP[n]<c.scale_xmin||b.fP[n]>c.scale_xmax||b.fP[n+1]<c.scale_ymin||b.fP[n+1]>c.scale_ymax||b.fP[n+2]<c.scale_zmin||b.fP[n+2]>c.scale_zmax)){if(1<d&&(m=(m+1)%d,0!==m))continue;q[C++]=n;u.addPoint(c.grx(b.fP[n]),c.gry(b.fP[n+1]),c.grz(b.fP[n+2]))}return u.createPoints({color:this.getColor(b.fMarkerColor),style:b.fMarkerStyle,promise:!0}).then(function(d){d.tip_color=3===b.fMarkerColor?16711680:65280;d.tip_name=
b.fName||"Poly3D";d.poly=b;d.painter=c;d.scale0=.7*u.scale;d.index=q;c.toplevel.add(d);d.tooltip=function(a){if(!Number.isInteger(a.index))return console.error("intersect.index not provided, three.js version "+e.REVISION+", expected 127"),null;a=Math.floor(a.index/this.nvertex);if(0>a||a>=this.index.length)return null;a=this.index[a];var b=this.painter,c=b.grx(this.poly.fP[a]),d=b.gry(this.poly.fP[a+1]),g=b.grz(this.poly.fP[a+2]);return{x1:c-this.scale0,x2:c+this.scale0,y1:d-this.scale0,y2:d+this.scale0,
z1:g-this.scale0,z2:g+this.scale0,color:this.tip_color,lines:[this.tip_name,"pnt: "+a/3,"x: "+b.axisAsText("x",this.poly.fP[a]),"y: "+b.axisAsText("y",this.poly.fP[a+1]),"z: "+b.axisAsText("z",this.poly.fP[a+2])]}};c.render3D(100);return a})};JSROOT.TH3Painter=O;JSROOT.TGraph2DPainter=ia;return JSROOT});
