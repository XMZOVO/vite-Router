import{e as Cl,R as Qs,V as Ae,f as rt,M as El,E as Pl,g as ws,h as Al,i as gs,j as _s,k as li,l as ys,B as Pe,m as _t,c as kl,a as vn,I as Ml,n as Sl,T as Vl,o as xs,p as Bl,S as zl,P as Tl,q as Ll,D as Nl,r as Rl,s as Cs,t as Es,u as ci,v as Il,b as Fl,w as Ps,W as Dl,x as Ol,y as ql,O as jl,d as Ul,L as Hl}from"./OrbitControls.97005c17.js";import{D as Gl,G as Wl,g as Kl}from"./index.999adf70.js";import{D as $l,l as Yl,C as Xl,B as Zl,p as Ql}from"./vendor.69ab715b.js";import{_ as Jl}from"./index.352a2ba4.js";class Et{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const i=this.elements;i[0]=e.x,i[4]=e.y,i[8]=e.z}getTrace(e){e===void 0&&(e=new m);const i=this.elements;return e.x=i[0],e.y=i[4],e.z=i[8],e}vmult(e,i){i===void 0&&(i=new m);const o=this.elements,r=e.x,a=e.y,c=e.z;return i.x=o[0]*r+o[1]*a+o[2]*c,i.y=o[3]*r+o[4]*a+o[5]*c,i.z=o[6]*r+o[7]*a+o[8]*c,i}smult(e){for(let i=0;i<this.elements.length;i++)this.elements[i]*=e}mmult(e,i){i===void 0&&(i=new Et);const o=this.elements,r=e.elements,a=i.elements,c=o[0],h=o[1],d=o[2],p=o[3],u=o[4],b=o[5],f=o[6],w=o[7],g=o[8],C=r[0],y=r[1],P=r[2],_=r[3],S=r[4],k=r[5],M=r[6],V=r[7],I=r[8];return a[0]=c*C+h*_+d*M,a[1]=c*y+h*S+d*V,a[2]=c*P+h*k+d*I,a[3]=p*C+u*_+b*M,a[4]=p*y+u*S+b*V,a[5]=p*P+u*k+b*I,a[6]=f*C+w*_+g*M,a[7]=f*y+w*S+g*V,a[8]=f*P+w*k+g*I,i}scale(e,i){i===void 0&&(i=new Et);const o=this.elements,r=i.elements;for(let a=0;a!==3;a++)r[3*a+0]=e.x*o[3*a+0],r[3*a+1]=e.y*o[3*a+1],r[3*a+2]=e.z*o[3*a+2];return i}solve(e,i){i===void 0&&(i=new m);const o=3,r=4,a=[];let c,h;for(c=0;c<o*r;c++)a.push(0);for(c=0;c<3;c++)for(h=0;h<3;h++)a[c+r*h]=this.elements[c+3*h];a[3+4*0]=e.x,a[3+4*1]=e.y,a[3+4*2]=e.z;let d=3;const p=d;let u;const b=4;let f;do{if(c=p-d,a[c+r*c]===0){for(h=c+1;h<p;h++)if(a[c+r*h]!==0){u=b;do f=b-u,a[f+r*c]+=a[f+r*h];while(--u);break}}if(a[c+r*c]!==0)for(h=c+1;h<p;h++){const w=a[c+r*h]/a[c+r*c];u=b;do f=b-u,a[f+r*h]=f<=c?0:a[f+r*h]-a[f+r*c]*w;while(--u)}}while(--d);if(i.z=a[2*r+3]/a[2*r+2],i.y=(a[1*r+3]-a[1*r+2]*i.z)/a[1*r+1],i.x=(a[0*r+3]-a[0*r+2]*i.z-a[0*r+1]*i.y)/a[0*r+0],isNaN(i.x)||isNaN(i.y)||isNaN(i.z)||i.x===1/0||i.y===1/0||i.z===1/0)throw`Could not solve equation! Got x=[${i.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return i}e(e,i,o){if(o===void 0)return this.elements[i+3*e];this.elements[i+3*e]=o}copy(e){for(let i=0;i<e.elements.length;i++)this.elements[i]=e.elements[i];return this}toString(){let e="";const i=",";for(let o=0;o<9;o++)e+=this.elements[o]+i;return e}reverse(e){e===void 0&&(e=new Et);const i=3,o=6,r=tc;let a,c;for(a=0;a<3;a++)for(c=0;c<3;c++)r[a+o*c]=this.elements[a+3*c];r[3+6*0]=1,r[3+6*1]=0,r[3+6*2]=0,r[4+6*0]=0,r[4+6*1]=1,r[4+6*2]=0,r[5+6*0]=0,r[5+6*1]=0,r[5+6*2]=1;let h=3;const d=h;let p;const u=o;let b;do{if(a=d-h,r[a+o*a]===0){for(c=a+1;c<d;c++)if(r[a+o*c]!==0){p=u;do b=u-p,r[b+o*a]+=r[b+o*c];while(--p);break}}if(r[a+o*a]!==0)for(c=a+1;c<d;c++){const f=r[a+o*c]/r[a+o*a];p=u;do b=u-p,r[b+o*c]=b<=a?0:r[b+o*c]-r[b+o*a]*f;while(--p)}}while(--h);a=2;do{c=a-1;do{const f=r[a+o*c]/r[a+o*a];p=o;do b=o-p,r[b+o*c]=r[b+o*c]-r[b+o*a]*f;while(--p)}while(c--)}while(--a);a=2;do{const f=1/r[a+o*a];p=o;do b=o-p,r[b+o*a]=r[b+o*a]*f;while(--p)}while(a--);a=2;do{c=2;do{if(b=r[i+c+o*a],isNaN(b)||b===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(a,c,b)}while(c--)}while(a--);return e}setRotationFromQuaternion(e){const i=e.x,o=e.y,r=e.z,a=e.w,c=i+i,h=o+o,d=r+r,p=i*c,u=i*h,b=i*d,f=o*h,w=o*d,g=r*d,C=a*c,y=a*h,P=a*d,_=this.elements;return _[3*0+0]=1-(f+g),_[3*0+1]=u-P,_[3*0+2]=b+y,_[3*1+0]=u+P,_[3*1+1]=1-(p+g),_[3*1+2]=w-C,_[3*2+0]=b-y,_[3*2+1]=w+C,_[3*2+2]=1-(p+f),this}transpose(e){e===void 0&&(e=new Et);const i=this.elements,o=e.elements;let r;return o[0]=i[0],o[4]=i[4],o[8]=i[8],r=i[1],o[1]=i[3],o[3]=r,r=i[2],o[2]=i[6],o[6]=r,r=i[5],o[5]=i[7],o[7]=r,e}}const tc=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class m{constructor(e,i,o){e===void 0&&(e=0),i===void 0&&(i=0),o===void 0&&(o=0),this.x=e,this.y=i,this.z=o}cross(e,i){i===void 0&&(i=new m);const o=e.x,r=e.y,a=e.z,c=this.x,h=this.y,d=this.z;return i.x=h*a-d*r,i.y=d*o-c*a,i.z=c*r-h*o,i}set(e,i,o){return this.x=e,this.y=i,this.z=o,this}setZero(){this.x=this.y=this.z=0}vadd(e,i){if(i)i.x=e.x+this.x,i.y=e.y+this.y,i.z=e.z+this.z;else return new m(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,i){if(i)i.x=this.x-e.x,i.y=this.y-e.y,i.z=this.z-e.z;else return new m(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Et([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,i=this.y,o=this.z,r=Math.sqrt(e*e+i*i+o*o);if(r>0){const a=1/r;this.x*=a,this.y*=a,this.z*=a}else this.x=0,this.y=0,this.z=0;return r}unit(e){e===void 0&&(e=new m);const i=this.x,o=this.y,r=this.z;let a=Math.sqrt(i*i+o*o+r*r);return a>0?(a=1/a,e.x=i*a,e.y=o*a,e.z=r*a):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,i=this.y,o=this.z;return Math.sqrt(e*e+i*i+o*o)}lengthSquared(){return this.dot(this)}distanceTo(e){const i=this.x,o=this.y,r=this.z,a=e.x,c=e.y,h=e.z;return Math.sqrt((a-i)*(a-i)+(c-o)*(c-o)+(h-r)*(h-r))}distanceSquared(e){const i=this.x,o=this.y,r=this.z,a=e.x,c=e.y,h=e.z;return(a-i)*(a-i)+(c-o)*(c-o)+(h-r)*(h-r)}scale(e,i){i===void 0&&(i=new m);const o=this.x,r=this.y,a=this.z;return i.x=e*o,i.y=e*r,i.z=e*a,i}vmul(e,i){return i===void 0&&(i=new m),i.x=e.x*this.x,i.y=e.y*this.y,i.z=e.z*this.z,i}addScaledVector(e,i,o){return o===void 0&&(o=new m),o.x=this.x+e*i.x,o.y=this.y+e*i.y,o.z=this.z+e*i.z,o}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new m),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,i){const o=this.length();if(o>0){const r=ec,a=1/o;r.set(this.x*a,this.y*a,this.z*a);const c=nc;Math.abs(r.x)<.9?(c.set(1,0,0),r.cross(c,e)):(c.set(0,1,0),r.cross(c,e)),r.cross(e,i)}else e.set(1,0,0),i.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,i,o){const r=this.x,a=this.y,c=this.z;o.x=r+(e.x-r)*i,o.y=a+(e.y-a)*i,o.z=c+(e.z-c)*i}almostEquals(e,i){return i===void 0&&(i=1e-6),!(Math.abs(this.x-e.x)>i||Math.abs(this.y-e.y)>i||Math.abs(this.z-e.z)>i)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,i){return this.negate(As),As.almostEquals(e,i)}clone(){return new m(this.x,this.y,this.z)}}m.ZERO=new m(0,0,0);m.UNIT_X=new m(1,0,0);m.UNIT_Y=new m(0,1,0);m.UNIT_Z=new m(0,0,1);const ec=new m,nc=new m,As=new m;class at{constructor(e){e===void 0&&(e={}),this.lowerBound=new m,this.upperBound=new m,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,i,o,r){const a=this.lowerBound,c=this.upperBound,h=o;a.copy(e[0]),h&&h.vmult(a,a),c.copy(a);for(let d=1;d<e.length;d++){let p=e[d];h&&(h.vmult(p,ks),p=ks),p.x>c.x&&(c.x=p.x),p.x<a.x&&(a.x=p.x),p.y>c.y&&(c.y=p.y),p.y<a.y&&(a.y=p.y),p.z>c.z&&(c.z=p.z),p.z<a.z&&(a.z=p.z)}return i&&(i.vadd(a,a),i.vadd(c,c)),r&&(a.x-=r,a.y-=r,a.z-=r,c.x+=r,c.y+=r,c.z+=r),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new at().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const i=this.lowerBound,o=this.upperBound,r=e.lowerBound,a=e.upperBound,c=r.x<=o.x&&o.x<=a.x||i.x<=a.x&&a.x<=o.x,h=r.y<=o.y&&o.y<=a.y||i.y<=a.y&&a.y<=o.y,d=r.z<=o.z&&o.z<=a.z||i.z<=a.z&&a.z<=o.z;return c&&h&&d}volume(){const e=this.lowerBound,i=this.upperBound;return(i.x-e.x)*(i.y-e.y)*(i.z-e.z)}contains(e){const i=this.lowerBound,o=this.upperBound,r=e.lowerBound,a=e.upperBound;return i.x<=r.x&&o.x>=a.x&&i.y<=r.y&&o.y>=a.y&&i.z<=r.z&&o.z>=a.z}getCorners(e,i,o,r,a,c,h,d){const p=this.lowerBound,u=this.upperBound;e.copy(p),i.set(u.x,p.y,p.z),o.set(u.x,u.y,p.z),r.set(p.x,u.y,u.z),a.set(u.x,p.y,u.z),c.set(p.x,u.y,p.z),h.set(p.x,p.y,u.z),d.copy(u)}toLocalFrame(e,i){const o=Ms,r=o[0],a=o[1],c=o[2],h=o[3],d=o[4],p=o[5],u=o[6],b=o[7];this.getCorners(r,a,c,h,d,p,u,b);for(let f=0;f!==8;f++){const w=o[f];e.pointToLocal(w,w)}return i.setFromPoints(o)}toWorldFrame(e,i){const o=Ms,r=o[0],a=o[1],c=o[2],h=o[3],d=o[4],p=o[5],u=o[6],b=o[7];this.getCorners(r,a,c,h,d,p,u,b);for(let f=0;f!==8;f++){const w=o[f];e.pointToWorld(w,w)}return i.setFromPoints(o)}overlapsRay(e){const{direction:i,from:o}=e,r=1/i.x,a=1/i.y,c=1/i.z,h=(this.lowerBound.x-o.x)*r,d=(this.upperBound.x-o.x)*r,p=(this.lowerBound.y-o.y)*a,u=(this.upperBound.y-o.y)*a,b=(this.lowerBound.z-o.z)*c,f=(this.upperBound.z-o.z)*c,w=Math.max(Math.max(Math.min(h,d),Math.min(p,u)),Math.min(b,f)),g=Math.min(Math.min(Math.max(h,d),Math.max(p,u)),Math.max(b,f));return!(g<0||w>g)}}const ks=new m,Ms=[new m,new m,new m,new m,new m,new m,new m,new m];class Ss{constructor(){this.matrix=[]}get(e,i){let{index:o}=e,{index:r}=i;if(r>o){const a=r;r=o,o=a}return this.matrix[(o*(o+1)>>1)+r-1]}set(e,i,o){let{index:r}=e,{index:a}=i;if(a>r){const c=a;a=r,r=c}this.matrix[(r*(r+1)>>1)+a-1]=o?1:0}reset(){for(let e=0,i=this.matrix.length;e!==i;e++)this.matrix[e]=0}setNumObjects(e){this.matrix.length=e*(e-1)>>1}}class Js{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const o=this._listeners;return o[e]===void 0&&(o[e]=[]),o[e].includes(i)||o[e].push(i),this}hasEventListener(e,i){if(this._listeners===void 0)return!1;const o=this._listeners;return!!(o[e]!==void 0&&o[e].includes(i))}hasAnyEventListener(e){return this._listeners===void 0?!1:this._listeners[e]!==void 0}removeEventListener(e,i){if(this._listeners===void 0)return this;const o=this._listeners;if(o[e]===void 0)return this;const r=o[e].indexOf(i);return r!==-1&&o[e].splice(r,1),this}dispatchEvent(e){if(this._listeners===void 0)return this;const o=this._listeners[e.type];if(o!==void 0){e.target=this;for(let r=0,a=o.length;r<a;r++)o[r].call(this,e)}return this}}class lt{constructor(e,i,o,r){e===void 0&&(e=0),i===void 0&&(i=0),o===void 0&&(o=0),r===void 0&&(r=1),this.x=e,this.y=i,this.z=o,this.w=r}set(e,i,o,r){return this.x=e,this.y=i,this.z=o,this.w=r,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,i){const o=Math.sin(i*.5);return this.x=e.x*o,this.y=e.y*o,this.z=e.z*o,this.w=Math.cos(i*.5),this}toAxisAngle(e){e===void 0&&(e=new m),this.normalize();const i=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/o,e.y=this.y/o,e.z=this.z/o),[e,i]}setFromVectors(e,i){if(e.isAntiparallelTo(i)){const o=ic,r=sc;e.tangents(o,r),this.setFromAxisAngle(o,Math.PI)}else{const o=e.cross(i);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(e.length()**2*i.length()**2)+e.dot(i),this.normalize()}return this}mult(e,i){i===void 0&&(i=new lt);const o=this.x,r=this.y,a=this.z,c=this.w,h=e.x,d=e.y,p=e.z,u=e.w;return i.x=o*u+c*h+r*p-a*d,i.y=r*u+c*d+a*h-o*p,i.z=a*u+c*p+o*d-r*h,i.w=c*u-o*h-r*d-a*p,i}inverse(e){e===void 0&&(e=new lt);const i=this.x,o=this.y,r=this.z,a=this.w;this.conjugate(e);const c=1/(i*i+o*o+r*r+a*a);return e.x*=c,e.y*=c,e.z*=c,e.w*=c,e}conjugate(e){return e===void 0&&(e=new lt),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,i){i===void 0&&(i=new m);const o=e.x,r=e.y,a=e.z,c=this.x,h=this.y,d=this.z,p=this.w,u=p*o+h*a-d*r,b=p*r+d*o-c*a,f=p*a+c*r-h*o,w=-c*o-h*r-d*a;return i.x=u*p+w*-c+b*-d-f*-h,i.y=b*p+w*-h+f*-c-u*-d,i.z=f*p+w*-d+u*-h-b*-c,i}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,i){i===void 0&&(i="YZX");let o,r,a;const c=this.x,h=this.y,d=this.z,p=this.w;switch(i){case"YZX":const u=c*h+d*p;if(u>.499&&(o=2*Math.atan2(c,p),r=Math.PI/2,a=0),u<-.499&&(o=-2*Math.atan2(c,p),r=-Math.PI/2,a=0),o===void 0){const b=c*c,f=h*h,w=d*d;o=Math.atan2(2*h*p-2*c*d,1-2*f-2*w),r=Math.asin(2*u),a=Math.atan2(2*c*p-2*h*d,1-2*b-2*w)}break;default:throw new Error(`Euler order ${i} not supported yet.`)}e.y=o,e.z=r,e.x=a}setFromEuler(e,i,o,r){r===void 0&&(r="XYZ");const a=Math.cos(e/2),c=Math.cos(i/2),h=Math.cos(o/2),d=Math.sin(e/2),p=Math.sin(i/2),u=Math.sin(o/2);return r==="XYZ"?(this.x=d*c*h+a*p*u,this.y=a*p*h-d*c*u,this.z=a*c*u+d*p*h,this.w=a*c*h-d*p*u):r==="YXZ"?(this.x=d*c*h+a*p*u,this.y=a*p*h-d*c*u,this.z=a*c*u-d*p*h,this.w=a*c*h+d*p*u):r==="ZXY"?(this.x=d*c*h-a*p*u,this.y=a*p*h+d*c*u,this.z=a*c*u+d*p*h,this.w=a*c*h-d*p*u):r==="ZYX"?(this.x=d*c*h-a*p*u,this.y=a*p*h+d*c*u,this.z=a*c*u-d*p*h,this.w=a*c*h+d*p*u):r==="YZX"?(this.x=d*c*h+a*p*u,this.y=a*p*h+d*c*u,this.z=a*c*u-d*p*h,this.w=a*c*h-d*p*u):r==="XZY"&&(this.x=d*c*h-a*p*u,this.y=a*p*h-d*c*u,this.z=a*c*u+d*p*h,this.w=a*c*h+d*p*u),this}clone(){return new lt(this.x,this.y,this.z,this.w)}slerp(e,i,o){o===void 0&&(o=new lt);const r=this.x,a=this.y,c=this.z,h=this.w;let d=e.x,p=e.y,u=e.z,b=e.w,f,w,g,C,y;return w=r*d+a*p+c*u+h*b,w<0&&(w=-w,d=-d,p=-p,u=-u,b=-b),1-w>1e-6?(f=Math.acos(w),g=Math.sin(f),C=Math.sin((1-i)*f)/g,y=Math.sin(i*f)/g):(C=1-i,y=i),o.x=C*r+y*d,o.y=C*a+y*p,o.z=C*c+y*u,o.w=C*h+y*b,o}integrate(e,i,o,r){r===void 0&&(r=new lt);const a=e.x*o.x,c=e.y*o.y,h=e.z*o.z,d=this.x,p=this.y,u=this.z,b=this.w,f=i*.5;return r.x+=f*(a*b+c*u-h*p),r.y+=f*(c*b+h*d-a*u),r.z+=f*(h*b+a*p-c*d),r.w+=f*(-a*d-c*p-h*u),r}}const ic=new m,sc=new m,oc={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class O{constructor(e){e===void 0&&(e={}),this.id=O.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,i){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,i,o,r){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}O.idCounter=0;O.types=oc;class tt{constructor(e){e===void 0&&(e={}),this.position=new m,this.quaternion=new lt,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,i){return tt.pointToLocalFrame(this.position,this.quaternion,e,i)}pointToWorld(e,i){return tt.pointToWorldFrame(this.position,this.quaternion,e,i)}vectorToWorldFrame(e,i){return i===void 0&&(i=new m),this.quaternion.vmult(e,i),i}static pointToLocalFrame(e,i,o,r){return r===void 0&&(r=new m),o.vsub(e,r),i.conjugate(Vs),Vs.vmult(r,r),r}static pointToWorldFrame(e,i,o,r){return r===void 0&&(r=new m),i.vmult(o,r),r.vadd(e,r),r}static vectorToWorldFrame(e,i,o){return o===void 0&&(o=new m),e.vmult(i,o),o}static vectorToLocalFrame(e,i,o,r){return r===void 0&&(r=new m),i.w*=-1,i.vmult(o,r),i.w*=-1,r}}const Vs=new lt;class Ot extends O{constructor(e){e===void 0&&(e={});const{vertices:i=[],faces:o=[],normals:r=[],axes:a,boundingSphereRadius:c}=e;super({type:O.types.CONVEXPOLYHEDRON});this.vertices=i,this.faces=o,this.faceNormals=r,this.faceNormals.length===0&&this.computeNormals(),c?this.boundingSphereRadius=c:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=a?a.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const e=this.faces,i=this.vertices,o=this.uniqueEdges;o.length=0;const r=new m;for(let a=0;a!==e.length;a++){const c=e[a],h=c.length;for(let d=0;d!==h;d++){const p=(d+1)%h;i[c[d]].vsub(i[c[p]],r),r.normalize();let u=!1;for(let b=0;b!==o.length;b++)if(o[b].almostEquals(r)||o[b].almostEquals(r)){u=!0;break}u||o.push(r.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let e=0;e<this.faces.length;e++){for(let r=0;r<this.faces[e].length;r++)if(!this.vertices[this.faces[e][r]])throw new Error(`Vertex ${this.faces[e][r]} not found!`);const i=this.faceNormals[e]||new m;this.getFaceNormal(e,i),i.negate(i),this.faceNormals[e]=i;const o=this.vertices[this.faces[e][0]];if(i.dot(o)<0){console.error(`.faceNormals[${e}] = Vec3(${i.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let r=0;r<this.faces[e].length;r++)console.warn(`.vertices[${this.faces[e][r]}] = Vec3(${this.vertices[this.faces[e][r]].toString()})`)}}}getFaceNormal(e,i){const o=this.faces[e],r=this.vertices[o[0]],a=this.vertices[o[1]],c=this.vertices[o[2]];Ot.computeNormal(r,a,c,i)}static computeNormal(e,i,o,r){const a=new m,c=new m;i.vsub(e,c),o.vsub(i,a),a.cross(c,r),r.isZero()||r.normalize()}clipAgainstHull(e,i,o,r,a,c,h,d,p){const u=new m;let b=-1,f=-Number.MAX_VALUE;for(let g=0;g<o.faces.length;g++){u.copy(o.faceNormals[g]),a.vmult(u,u);const C=u.dot(c);C>f&&(f=C,b=g)}const w=[];for(let g=0;g<o.faces[b].length;g++){const C=o.vertices[o.faces[b][g]],y=new m;y.copy(C),a.vmult(y,y),r.vadd(y,y),w.push(y)}b>=0&&this.clipFaceAgainstHull(c,e,i,w,h,d,p)}findSeparatingAxis(e,i,o,r,a,c,h,d){const p=new m,u=new m,b=new m,f=new m,w=new m,g=new m;let C=Number.MAX_VALUE;const y=this;if(y.uniqueAxes)for(let P=0;P!==y.uniqueAxes.length;P++){o.vmult(y.uniqueAxes[P],p);const _=y.testSepAxis(p,e,i,o,r,a);if(_===!1)return!1;_<C&&(C=_,c.copy(p))}else{const P=h?h.length:y.faces.length;for(let _=0;_<P;_++){const S=h?h[_]:_;p.copy(y.faceNormals[S]),o.vmult(p,p);const k=y.testSepAxis(p,e,i,o,r,a);if(k===!1)return!1;k<C&&(C=k,c.copy(p))}}if(e.uniqueAxes)for(let P=0;P!==e.uniqueAxes.length;P++){a.vmult(e.uniqueAxes[P],u);const _=y.testSepAxis(u,e,i,o,r,a);if(_===!1)return!1;_<C&&(C=_,c.copy(u))}else{const P=d?d.length:e.faces.length;for(let _=0;_<P;_++){const S=d?d[_]:_;u.copy(e.faceNormals[S]),a.vmult(u,u);const k=y.testSepAxis(u,e,i,o,r,a);if(k===!1)return!1;k<C&&(C=k,c.copy(u))}}for(let P=0;P!==y.uniqueEdges.length;P++){o.vmult(y.uniqueEdges[P],f);for(let _=0;_!==e.uniqueEdges.length;_++)if(a.vmult(e.uniqueEdges[_],w),f.cross(w,g),!g.almostZero()){g.normalize();const S=y.testSepAxis(g,e,i,o,r,a);if(S===!1)return!1;S<C&&(C=S,c.copy(g))}}return r.vsub(i,b),b.dot(c)>0&&c.negate(c),!0}testSepAxis(e,i,o,r,a,c){const h=this;Ot.project(h,e,o,r,hi),Ot.project(i,e,a,c,di);const d=hi[0],p=hi[1],u=di[0],b=di[1];if(d<b||u<p)return!1;const f=d-b,w=u-p;return f<w?f:w}calculateLocalInertia(e,i){const o=new m,r=new m;this.computeLocalAABB(r,o);const a=o.x-r.x,c=o.y-r.y,h=o.z-r.z;i.x=1/12*e*(2*c*2*c+2*h*2*h),i.y=1/12*e*(2*a*2*a+2*h*2*h),i.z=1/12*e*(2*c*2*c+2*a*2*a)}getPlaneConstantOfFace(e){const i=this.faces[e],o=this.faceNormals[e],r=this.vertices[i[0]];return-o.dot(r)}clipFaceAgainstHull(e,i,o,r,a,c,h){const d=new m,p=new m,u=new m,b=new m,f=new m,w=new m,g=new m,C=new m,y=this,P=[],_=r,S=P;let k=-1,M=Number.MAX_VALUE;for(let N=0;N<y.faces.length;N++){d.copy(y.faceNormals[N]),o.vmult(d,d);const z=d.dot(e);z<M&&(M=z,k=N)}if(k<0)return;const V=y.faces[k];V.connectedFaces=[];for(let N=0;N<y.faces.length;N++)for(let z=0;z<y.faces[N].length;z++)V.indexOf(y.faces[N][z])!==-1&&N!==k&&V.connectedFaces.indexOf(N)===-1&&V.connectedFaces.push(N);const I=V.length;for(let N=0;N<I;N++){const z=y.vertices[V[N]],q=y.vertices[V[(N+1)%I]];z.vsub(q,p),u.copy(p),o.vmult(u,u),i.vadd(u,u),b.copy(this.faceNormals[k]),o.vmult(b,b),i.vadd(b,b),u.cross(b,f),f.negate(f),w.copy(z),o.vmult(w,w),i.vadd(w,w);const B=V.connectedFaces[N];g.copy(this.faceNormals[B]);const R=this.getPlaneConstantOfFace(B);C.copy(g),o.vmult(C,C);const T=R-C.dot(i);for(this.clipFaceAgainstPlane(_,S,C,T);_.length;)_.shift();for(;S.length;)_.push(S.shift())}g.copy(this.faceNormals[k]);const F=this.getPlaneConstantOfFace(k);C.copy(g),o.vmult(C,C);const H=F-C.dot(i);for(let N=0;N<_.length;N++){let z=C.dot(_[N])+H;if(z<=a&&(console.log(`clamped: depth=${z} to minDist=${a}`),z=a),z<=c){const q=_[N];if(z<=1e-6){const B={point:q,normal:C,depth:z};h.push(B)}}}}clipFaceAgainstPlane(e,i,o,r){let a,c;const h=e.length;if(h<2)return i;let d=e[e.length-1],p=e[0];a=o.dot(d)+r;for(let u=0;u<h;u++){if(p=e[u],c=o.dot(p)+r,a<0)if(c<0){const b=new m;b.copy(p),i.push(b)}else{const b=new m;d.lerp(p,a/(a-c),b),i.push(b)}else if(c<0){const b=new m;d.lerp(p,a/(a-c),b),i.push(b),i.push(p)}d=p,a=c}return i}computeWorldVertices(e,i){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new m);const o=this.vertices,r=this.worldVertices;for(let a=0;a!==this.vertices.length;a++)i.vmult(o[a],r[a]),e.vadd(r[a],r[a]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(e,i){const o=this.vertices;e.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let r=0;r<this.vertices.length;r++){const a=o[r];a.x<e.x?e.x=a.x:a.x>i.x&&(i.x=a.x),a.y<e.y?e.y=a.y:a.y>i.y&&(i.y=a.y),a.z<e.z?e.z=a.z:a.z>i.z&&(i.z=a.z)}}computeWorldFaceNormals(e){const i=this.faceNormals.length;for(;this.worldFaceNormals.length<i;)this.worldFaceNormals.push(new m);const o=this.faceNormals,r=this.worldFaceNormals;for(let a=0;a!==i;a++)e.vmult(o[a],r[a]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let e=0;const i=this.vertices;for(let o=0;o!==i.length;o++){const r=i[o].lengthSquared();r>e&&(e=r)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,o,r){const a=this.vertices;let c,h,d,p,u,b,f=new m;for(let w=0;w<a.length;w++){f.copy(a[w]),i.vmult(f,f),e.vadd(f,f);const g=f;(c===void 0||g.x<c)&&(c=g.x),(p===void 0||g.x>p)&&(p=g.x),(h===void 0||g.y<h)&&(h=g.y),(u===void 0||g.y>u)&&(u=g.y),(d===void 0||g.z<d)&&(d=g.z),(b===void 0||g.z>b)&&(b=g.z)}o.set(c,h,d),r.set(p,u,b)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(e){e===void 0&&(e=new m);const i=this.vertices;for(let o=0;o<i.length;o++)e.vadd(i[o],e);return e.scale(1/i.length,e),e}transformAllPoints(e,i){const o=this.vertices.length,r=this.vertices;if(i){for(let a=0;a<o;a++){const c=r[a];i.vmult(c,c)}for(let a=0;a<this.faceNormals.length;a++){const c=this.faceNormals[a];i.vmult(c,c)}}if(e)for(let a=0;a<o;a++){const c=r[a];c.vadd(e,c)}}pointIsInside(e){const i=this.vertices,o=this.faces,r=this.faceNormals,a=new m;this.getAveragePointLocal(a);for(let c=0;c<this.faces.length;c++){let h=r[c];const d=i[o[c][0]],p=new m;e.vsub(d,p);const u=h.dot(p),b=new m;a.vsub(d,b);const f=h.dot(b);if(u<0&&f>0||u>0&&f<0)return!1}return-1}static project(e,i,o,r,a){const c=e.vertices.length,h=ac;let d=0,p=0;const u=lc,b=e.vertices;u.setZero(),tt.vectorToLocalFrame(o,r,i,h),tt.pointToLocalFrame(o,r,u,u);const f=u.dot(h);p=d=b[0].dot(h);for(let w=1;w<c;w++){const g=b[w].dot(h);g>d&&(d=g),g<p&&(p=g)}if(p-=f,d-=f,p>d){const w=p;p=d,d=w}a[0]=d,a[1]=p}}const hi=[],di=[],rc=new m,ac=new m,lc=new m;class ke extends O{constructor(e){super({type:O.types.BOX});this.halfExtents=e,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const e=this.halfExtents.x,i=this.halfExtents.y,o=this.halfExtents.z,r=m,a=[new r(-e,-i,-o),new r(e,-i,-o),new r(e,i,-o),new r(-e,i,-o),new r(-e,-i,o),new r(e,-i,o),new r(e,i,o),new r(-e,i,o)],c=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],h=[new r(0,0,1),new r(0,1,0),new r(1,0,0)],d=new Ot({vertices:a,faces:c,axes:h});this.convexPolyhedronRepresentation=d,d.material=this.material}calculateLocalInertia(e,i){return i===void 0&&(i=new m),ke.calculateInertia(this.halfExtents,e,i),i}static calculateInertia(e,i,o){const r=e;o.x=1/12*i*(2*r.y*2*r.y+2*r.z*2*r.z),o.y=1/12*i*(2*r.x*2*r.x+2*r.z*2*r.z),o.z=1/12*i*(2*r.y*2*r.y+2*r.x*2*r.x)}getSideNormals(e,i){const o=e,r=this.halfExtents;if(o[0].set(r.x,0,0),o[1].set(0,r.y,0),o[2].set(0,0,r.z),o[3].set(-r.x,0,0),o[4].set(0,-r.y,0),o[5].set(0,0,-r.z),i!==void 0)for(let a=0;a!==o.length;a++)i.vmult(o[a],o[a]);return o}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(e,i,o){const r=this.halfExtents,a=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]];for(let c=0;c<a.length;c++)Yt.set(a[c][0],a[c][1],a[c][2]),i.vmult(Yt,Yt),e.vadd(Yt,Yt),o(Yt.x,Yt.y,Yt.z)}calculateWorldAABB(e,i,o,r){const a=this.halfExtents;Mt[0].set(a.x,a.y,a.z),Mt[1].set(-a.x,a.y,a.z),Mt[2].set(-a.x,-a.y,a.z),Mt[3].set(-a.x,-a.y,-a.z),Mt[4].set(a.x,-a.y,-a.z),Mt[5].set(a.x,a.y,-a.z),Mt[6].set(-a.x,a.y,-a.z),Mt[7].set(a.x,-a.y,a.z);const c=Mt[0];i.vmult(c,c),e.vadd(c,c),r.copy(c),o.copy(c);for(let h=1;h<8;h++){const d=Mt[h];i.vmult(d,d),e.vadd(d,d);const p=d.x,u=d.y,b=d.z;p>r.x&&(r.x=p),u>r.y&&(r.y=u),b>r.z&&(r.z=b),p<o.x&&(o.x=p),u<o.y&&(o.y=u),b<o.z&&(o.z=b)}}}const Yt=new m,Mt=[new m,new m,new m,new m,new m,new m,new m,new m],bi={DYNAMIC:1,STATIC:2,KINEMATIC:4},wi={AWAKE:0,SLEEPY:1,SLEEPING:2};class U extends Js{constructor(e){e===void 0&&(e={});super();this.id=U.idCounter++,this.index=-1,this.world=null,this.vlambda=new m,this.collisionFilterGroup=typeof e.collisionFilterGroup=="number"?e.collisionFilterGroup:1,this.collisionFilterMask=typeof e.collisionFilterMask=="number"?e.collisionFilterMask:-1,this.collisionResponse=typeof e.collisionResponse=="boolean"?e.collisionResponse:!0,this.position=new m,this.previousPosition=new m,this.interpolatedPosition=new m,this.initPosition=new m,e.position&&(this.position.copy(e.position),this.previousPosition.copy(e.position),this.interpolatedPosition.copy(e.position),this.initPosition.copy(e.position)),this.velocity=new m,e.velocity&&this.velocity.copy(e.velocity),this.initVelocity=new m,this.force=new m;const i=typeof e.mass=="number"?e.mass:0;this.mass=i,this.invMass=i>0?1/i:0,this.material=e.material||null,this.linearDamping=typeof e.linearDamping=="number"?e.linearDamping:.01,this.type=i<=0?U.STATIC:U.DYNAMIC,typeof e.type==typeof U.STATIC&&(this.type=e.type),this.allowSleep=typeof e.allowSleep!="undefined"?e.allowSleep:!0,this.sleepState=U.AWAKE,this.sleepSpeedLimit=typeof e.sleepSpeedLimit!="undefined"?e.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof e.sleepTimeLimit!="undefined"?e.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new m,this.quaternion=new lt,this.initQuaternion=new lt,this.previousQuaternion=new lt,this.interpolatedQuaternion=new lt,e.quaternion&&(this.quaternion.copy(e.quaternion),this.initQuaternion.copy(e.quaternion),this.previousQuaternion.copy(e.quaternion),this.interpolatedQuaternion.copy(e.quaternion)),this.angularVelocity=new m,e.angularVelocity&&this.angularVelocity.copy(e.angularVelocity),this.initAngularVelocity=new m,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new m,this.invInertia=new m,this.invInertiaWorld=new Et,this.invMassSolve=0,this.invInertiaSolve=new m,this.invInertiaWorldSolve=new Et,this.fixedRotation=typeof e.fixedRotation!="undefined"?e.fixedRotation:!1,this.angularDamping=typeof e.angularDamping!="undefined"?e.angularDamping:.01,this.linearFactor=new m(1,1,1),e.linearFactor&&this.linearFactor.copy(e.linearFactor),this.angularFactor=new m(1,1,1),e.angularFactor&&this.angularFactor.copy(e.angularFactor),this.aabb=new at,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new m,this.isTrigger=Boolean(e.isTrigger),e.shape&&this.addShape(e.shape),this.updateMassProperties()}wakeUp(){const e=this.sleepState;this.sleepState=U.AWAKE,this.wakeUpAfterNarrowphase=!1,e===U.SLEEPING&&this.dispatchEvent(U.wakeupEvent)}sleep(){this.sleepState=U.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(e){if(this.allowSleep){const i=this.sleepState,o=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),r=this.sleepSpeedLimit**2;i===U.AWAKE&&o<r?(this.sleepState=U.SLEEPY,this.timeLastSleepy=e,this.dispatchEvent(U.sleepyEvent)):i===U.SLEEPY&&o>r?this.wakeUp():i===U.SLEEPY&&e-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(U.sleepEvent))}}updateSolveMassProperties(){this.sleepState===U.SLEEPING||this.type===U.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(e,i){return i===void 0&&(i=new m),e.vsub(this.position,i),this.quaternion.conjugate().vmult(i,i),i}vectorToLocalFrame(e,i){return i===void 0&&(i=new m),this.quaternion.conjugate().vmult(e,i),i}pointToWorldFrame(e,i){return i===void 0&&(i=new m),this.quaternion.vmult(e,i),i.vadd(this.position,i),i}vectorToWorldFrame(e,i){return i===void 0&&(i=new m),this.quaternion.vmult(e,i),i}addShape(e,i,o){const r=new m,a=new lt;return i&&r.copy(i),o&&a.copy(o),this.shapes.push(e),this.shapeOffsets.push(r),this.shapeOrientations.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=this,this}removeShape(e){const i=this.shapes.indexOf(e);return i===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(i,1),this.shapeOffsets.splice(i,1),this.shapeOrientations.splice(i,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,e.body=null,this)}updateBoundingRadius(){const e=this.shapes,i=this.shapeOffsets,o=e.length;let r=0;for(let a=0;a!==o;a++){const c=e[a];c.updateBoundingSphereRadius();const h=i[a].length(),d=c.boundingSphereRadius;h+d>r&&(r=h+d)}this.boundingRadius=r}updateAABB(){const e=this.shapes,i=this.shapeOffsets,o=this.shapeOrientations,r=e.length,a=cc,c=hc,h=this.quaternion,d=this.aabb,p=dc;for(let u=0;u!==r;u++){const b=e[u];h.vmult(i[u],a),a.vadd(this.position,a),h.mult(o[u],c),b.calculateWorldAABB(a,c,p.lowerBound,p.upperBound),u===0?d.copy(p):d.extend(p)}this.aabbNeedsUpdate=!1}updateInertiaWorld(e){const i=this.invInertia;if(!(i.x===i.y&&i.y===i.z&&!e)){const o=pc,r=uc;o.setRotationFromQuaternion(this.quaternion),o.transpose(r),o.scale(i,o),o.mmult(r,this.invInertiaWorld)}}applyForce(e,i){if(i===void 0&&(i=new m),this.type!==U.DYNAMIC)return;this.sleepState===U.SLEEPING&&this.wakeUp();const o=mc;i.cross(e,o),this.force.vadd(e,this.force),this.torque.vadd(o,this.torque)}applyLocalForce(e,i){if(i===void 0&&(i=new m),this.type!==U.DYNAMIC)return;const o=fc,r=bc;this.vectorToWorldFrame(e,o),this.vectorToWorldFrame(i,r),this.applyForce(o,r)}applyTorque(e){this.type===U.DYNAMIC&&(this.sleepState===U.SLEEPING&&this.wakeUp(),this.torque.vadd(e,this.torque))}applyImpulse(e,i){if(i===void 0&&(i=new m),this.type!==U.DYNAMIC)return;this.sleepState===U.SLEEPING&&this.wakeUp();const o=i,r=wc;r.copy(e),r.scale(this.invMass,r),this.velocity.vadd(r,this.velocity);const a=gc;o.cross(e,a),this.invInertiaWorld.vmult(a,a),this.angularVelocity.vadd(a,this.angularVelocity)}applyLocalImpulse(e,i){if(i===void 0&&(i=new m),this.type!==U.DYNAMIC)return;const o=_c,r=yc;this.vectorToWorldFrame(e,o),this.vectorToWorldFrame(i,r),this.applyImpulse(o,r)}updateMassProperties(){const e=xc;this.invMass=this.mass>0?1/this.mass:0;const i=this.inertia,o=this.fixedRotation;this.updateAABB(),e.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),ke.calculateInertia(e,this.mass,i),this.invInertia.set(i.x>0&&!o?1/i.x:0,i.y>0&&!o?1/i.y:0,i.z>0&&!o?1/i.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(e,i){const o=new m;return e.vsub(this.position,o),this.angularVelocity.cross(o,i),this.velocity.vadd(i,i),i}integrate(e,i,o){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===U.DYNAMIC||this.type===U.KINEMATIC)||this.sleepState===U.SLEEPING)return;const r=this.velocity,a=this.angularVelocity,c=this.position,h=this.force,d=this.torque,p=this.quaternion,u=this.invMass,b=this.invInertiaWorld,f=this.linearFactor,w=u*e;r.x+=h.x*w*f.x,r.y+=h.y*w*f.y,r.z+=h.z*w*f.z;const g=b.elements,C=this.angularFactor,y=d.x*C.x,P=d.y*C.y,_=d.z*C.z;a.x+=e*(g[0]*y+g[1]*P+g[2]*_),a.y+=e*(g[3]*y+g[4]*P+g[5]*_),a.z+=e*(g[6]*y+g[7]*P+g[8]*_),c.x+=r.x*e,c.y+=r.y*e,c.z+=r.z*e,p.integrate(this.angularVelocity,e,this.angularFactor,p),i&&(o?p.normalizeFast():p.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}U.idCounter=0;U.COLLIDE_EVENT_NAME="collide";U.DYNAMIC=bi.DYNAMIC;U.STATIC=bi.STATIC;U.KINEMATIC=bi.KINEMATIC;U.AWAKE=wi.AWAKE;U.SLEEPY=wi.SLEEPY;U.SLEEPING=wi.SLEEPING;U.wakeupEvent={type:"wakeup"};U.sleepyEvent={type:"sleepy"};U.sleepEvent={type:"sleep"};const cc=new m,hc=new lt,dc=new at,pc=new Et,uc=new Et,vc=new Et,mc=new m,fc=new m,bc=new m,wc=new m,gc=new m,_c=new m,yc=new m,xc=new m;class Cc{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(e,i,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(e,i){return!((e.collisionFilterGroup&i.collisionFilterMask)===0||(i.collisionFilterGroup&e.collisionFilterMask)===0||((e.type&U.STATIC)!==0||e.sleepState===U.SLEEPING)&&((i.type&U.STATIC)!==0||i.sleepState===U.SLEEPING))}intersectionTest(e,i,o,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(e,i,o,r):this.doBoundingSphereBroadphase(e,i,o,r)}doBoundingSphereBroadphase(e,i,o,r){const a=Ec;i.position.vsub(e.position,a);const c=(e.boundingRadius+i.boundingRadius)**2;a.lengthSquared()<c&&(o.push(e),r.push(i))}doBoundingBoxBroadphase(e,i,o,r){e.aabbNeedsUpdate&&e.updateAABB(),i.aabbNeedsUpdate&&i.updateAABB(),e.aabb.overlaps(i.aabb)&&(o.push(e),r.push(i))}makePairsUnique(e,i){const o=Pc,r=Ac,a=kc,c=e.length;for(let h=0;h!==c;h++)r[h]=e[h],a[h]=i[h];e.length=0,i.length=0;for(let h=0;h!==c;h++){const d=r[h].id,p=a[h].id,u=d<p?`${d},${p}`:`${p},${d}`;o[u]=h,o.keys.push(u)}for(let h=0;h!==o.keys.length;h++){const d=o.keys.pop(),p=o[d];e.push(r[p]),i.push(a[p]),delete o[d]}}setWorld(e){}static boundingSphereCheck(e,i){const o=new m;e.position.vsub(i.position,o);const r=e.shapes[0],a=i.shapes[0];return Math.pow(r.boundingSphereRadius+a.boundingSphereRadius,2)>o.lengthSquared()}aabbQuery(e,i,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Ec=new m;new m;new lt;new m;const Pc={keys:[]},Ac=[],kc=[];new m;new m;new m;class Mc extends Cc{constructor(){super()}collisionPairs(e,i,o){const r=e.bodies,a=r.length;let c,h;for(let d=0;d!==a;d++)for(let p=0;p!==d;p++)c=r[d],h=r[p],!!this.needBroadphaseCollision(c,h)&&this.intersectionTest(c,h,i,o)}aabbQuery(e,i,o){o===void 0&&(o=[]);for(let r=0;r<e.bodies.length;r++){const a=e.bodies[r];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(i)&&o.push(a)}return o}}class xn{constructor(){this.rayFromWorld=new m,this.rayToWorld=new m,this.hitNormalWorld=new m,this.hitPointWorld=new m,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,i,o,r,a,c,h){this.rayFromWorld.copy(e),this.rayToWorld.copy(i),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(r),this.shape=a,this.body=c,this.distance=h}}let to,eo,no,io,so,oo,ro;const gi={CLOSEST:1,ANY:2,ALL:4};to=O.types.SPHERE;eo=O.types.PLANE;no=O.types.BOX;io=O.types.CYLINDER;so=O.types.CONVEXPOLYHEDRON;oo=O.types.HEIGHTFIELD;ro=O.types.TRIMESH;class ct{get[to](){return this._intersectSphere}get[eo](){return this._intersectPlane}get[no](){return this._intersectBox}get[io](){return this._intersectConvex}get[so](){return this._intersectConvex}get[oo](){return this._intersectHeightfield}get[ro](){return this._intersectTrimesh}constructor(e,i){e===void 0&&(e=new m),i===void 0&&(i=new m),this.from=e.clone(),this.to=i.clone(),this.direction=new m,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ct.ANY,this.result=new xn,this.hasHit=!1,this.callback=o=>{}}intersectWorld(e,i){return this.mode=i.mode||ct.ANY,this.result=i.result||new xn,this.skipBackfaces=!!i.skipBackfaces,this.collisionFilterMask=typeof i.collisionFilterMask!="undefined"?i.collisionFilterMask:-1,this.collisionFilterGroup=typeof i.collisionFilterGroup!="undefined"?i.collisionFilterGroup:-1,this.checkCollisionResponse=typeof i.checkCollisionResponse!="undefined"?i.checkCollisionResponse:!0,i.from&&this.from.copy(i.from),i.to&&this.to.copy(i.to),this.callback=i.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Bs),pi.length=0,e.broadphase.aabbQuery(e,Bs,pi),this.intersectBodies(pi),this.hasHit}intersectBody(e,i){i&&(this.result=i,this.updateDirection());const o=this.checkCollisionResponse;if(o&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const r=Sc,a=Vc;for(let c=0,h=e.shapes.length;c<h;c++){const d=e.shapes[c];if(!(o&&!d.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[c],a),e.quaternion.vmult(e.shapeOffsets[c],r),r.vadd(e.position,r),this.intersectShape(d,a,r,e),this.result.shouldStop))break}}intersectBodies(e,i){i&&(this.result=i,this.updateDirection());for(let o=0,r=e.length;!this.result.shouldStop&&o<r;o++)this.intersectBody(e[o])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,i,o,r){const a=this.from;if(Hc(a,this.direction,o)>e.boundingSphereRadius)return;const h=this[e.type];h&&h.call(this,e,i,o,r,e)}_intersectBox(e,i,o,r,a){return this._intersectConvex(e.convexPolyhedronRepresentation,i,o,r,a)}_intersectPlane(e,i,o,r,a){const c=this.from,h=this.to,d=this.direction,p=new m(0,0,1);i.vmult(p,p);const u=new m;c.vsub(o,u);const b=u.dot(p);h.vsub(o,u);const f=u.dot(p);if(b*f>0||c.distanceTo(h)<b)return;const w=p.dot(d);if(Math.abs(w)<this.precision)return;const g=new m,C=new m,y=new m;c.vsub(o,g);const P=-p.dot(g)/w;d.scale(P,C),c.vadd(C,y),this.reportIntersection(p,y,a,r,-1)}getAABB(e){const{lowerBound:i,upperBound:o}=e,r=this.to,a=this.from;i.x=Math.min(r.x,a.x),i.y=Math.min(r.y,a.y),i.z=Math.min(r.z,a.z),o.x=Math.max(r.x,a.x),o.y=Math.max(r.y,a.y),o.z=Math.max(r.z,a.z)}_intersectHeightfield(e,i,o,r,a){e.data,e.elementSize;const c=Bc;c.from.copy(this.from),c.to.copy(this.to),tt.pointToLocalFrame(o,i,c.from,c.from),tt.pointToLocalFrame(o,i,c.to,c.to),c.updateDirection();const h=zc;let d,p,u,b;d=p=0,u=b=e.data.length-1;const f=new at;c.getAABB(f),e.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,h,!0),d=Math.max(d,h[0]),p=Math.max(p,h[1]),e.getIndexOfPosition(f.upperBound.x,f.upperBound.y,h,!0),u=Math.min(u,h[0]+1),b=Math.min(b,h[1]+1);for(let w=d;w<u;w++)for(let g=p;g<b;g++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(w,g,f),!!f.overlapsRay(c)){if(e.getConvexTrianglePillar(w,g,!1),tt.pointToWorldFrame(o,i,e.pillarOffset,mn),this._intersectConvex(e.pillarConvex,i,mn,r,a,zs),this.result.shouldStop)return;e.getConvexTrianglePillar(w,g,!0),tt.pointToWorldFrame(o,i,e.pillarOffset,mn),this._intersectConvex(e.pillarConvex,i,mn,r,a,zs)}}}_intersectSphere(e,i,o,r,a){const c=this.from,h=this.to,d=e.radius,p=(h.x-c.x)**2+(h.y-c.y)**2+(h.z-c.z)**2,u=2*((h.x-c.x)*(c.x-o.x)+(h.y-c.y)*(c.y-o.y)+(h.z-c.z)*(c.z-o.z)),b=(c.x-o.x)**2+(c.y-o.y)**2+(c.z-o.z)**2-d**2,f=u**2-4*p*b,w=Tc,g=Lc;if(!(f<0))if(f===0)c.lerp(h,f,w),w.vsub(o,g),g.normalize(),this.reportIntersection(g,w,a,r,-1);else{const C=(-u-Math.sqrt(f))/(2*p),y=(-u+Math.sqrt(f))/(2*p);if(C>=0&&C<=1&&(c.lerp(h,C,w),w.vsub(o,g),g.normalize(),this.reportIntersection(g,w,a,r,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(c.lerp(h,y,w),w.vsub(o,g),g.normalize(),this.reportIntersection(g,w,a,r,-1))}}_intersectConvex(e,i,o,r,a,c){const h=Nc,d=Ts,p=c&&c.faceList||null,u=e.faces,b=e.vertices,f=e.faceNormals,w=this.direction,g=this.from,C=this.to,y=g.distanceTo(C),P=p?p.length:u.length,_=this.result;for(let S=0;!_.shouldStop&&S<P;S++){const k=p?p[S]:S,M=u[k],V=f[k],I=i,F=o;d.copy(b[M[0]]),I.vmult(d,d),d.vadd(F,d),d.vsub(g,d),I.vmult(V,h);const H=w.dot(h);if(Math.abs(H)<this.precision)continue;const N=h.dot(d)/H;if(!(N<0)){w.scale(N,mt),mt.vadd(g,mt),Ct.copy(b[M[0]]),I.vmult(Ct,Ct),F.vadd(Ct,Ct);for(let z=1;!_.shouldStop&&z<M.length-1;z++){St.copy(b[M[z]]),Vt.copy(b[M[z+1]]),I.vmult(St,St),I.vmult(Vt,Vt),F.vadd(St,St),F.vadd(Vt,Vt);const q=mt.distanceTo(g);!(ct.pointInTriangle(mt,Ct,St,Vt)||ct.pointInTriangle(mt,St,Ct,Vt))||q>y||this.reportIntersection(h,mt,a,r,k)}}}}_intersectTrimesh(e,i,o,r,a,c){const h=Rc,d=jc,p=Uc,u=Ts,b=Ic,f=Fc,w=Dc,g=qc,C=Oc,y=e.indices;e.vertices;const P=this.from,_=this.to,S=this.direction;p.position.copy(o),p.quaternion.copy(i),tt.vectorToLocalFrame(o,i,S,b),tt.pointToLocalFrame(o,i,P,f),tt.pointToLocalFrame(o,i,_,w),w.x*=e.scale.x,w.y*=e.scale.y,w.z*=e.scale.z,f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,w.vsub(f,b),b.normalize();const k=f.distanceSquared(w);e.tree.rayQuery(this,p,d);for(let M=0,V=d.length;!this.result.shouldStop&&M!==V;M++){const I=d[M];e.getNormal(I,h),e.getVertex(y[I*3],Ct),Ct.vsub(f,u);const F=b.dot(h),H=h.dot(u)/F;if(H<0)continue;b.scale(H,mt),mt.vadd(f,mt),e.getVertex(y[I*3+1],St),e.getVertex(y[I*3+2],Vt);const N=mt.distanceSquared(f);!(ct.pointInTriangle(mt,St,Ct,Vt)||ct.pointInTriangle(mt,Ct,St,Vt))||N>k||(tt.vectorToWorldFrame(i,h,C),tt.pointToWorldFrame(o,i,mt,g),this.reportIntersection(C,g,a,r,I))}d.length=0}reportIntersection(e,i,o,r,a){const c=this.from,h=this.to,d=c.distanceTo(i),p=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(p.hitFaceIndex=typeof a!="undefined"?a:-1,this.mode){case ct.ALL:this.hasHit=!0,p.set(c,h,e,i,o,r,d),p.hasHit=!0,this.callback(p);break;case ct.CLOSEST:(d<p.distance||!p.hasHit)&&(this.hasHit=!0,p.hasHit=!0,p.set(c,h,e,i,o,r,d));break;case ct.ANY:this.hasHit=!0,p.hasHit=!0,p.set(c,h,e,i,o,r,d),p.shouldStop=!0;break}}static pointInTriangle(e,i,o,r){r.vsub(i,ce),o.vsub(i,We),e.vsub(i,ui);const a=ce.dot(ce),c=ce.dot(We),h=ce.dot(ui),d=We.dot(We),p=We.dot(ui);let u,b;return(u=d*h-c*p)>=0&&(b=a*p-c*h)>=0&&u+b<a*d-c*c}}ct.CLOSEST=gi.CLOSEST;ct.ANY=gi.ANY;ct.ALL=gi.ALL;const Bs=new at,pi=[],We=new m,ui=new m,Sc=new m,Vc=new lt,mt=new m,Ct=new m,St=new m,Vt=new m;new m;new xn;const zs={faceList:[0]},mn=new m,Bc=new ct,zc=[],Tc=new m,Lc=new m,Nc=new m;new m;new m;const Ts=new m,Rc=new m,Ic=new m,Fc=new m,Dc=new m,Oc=new m,qc=new m;new at;const jc=[],Uc=new tt,ce=new m,fn=new m;function Hc(L,e,i){i.vsub(L,ce);const o=ce.dot(e);return e.scale(o,fn),fn.vadd(L,fn),i.distanceTo(fn)}class ao{static defaults(e,i){e===void 0&&(e={});for(let o in i)o in e||(e[o]=i[o]);return e}}class Ls{constructor(){this.spatial=new m,this.rotational=new m}multiplyElement(e){return e.spatial.dot(this.spatial)+e.rotational.dot(this.rotational)}multiplyVectors(e,i){return e.dot(this.spatial)+i.dot(this.rotational)}}class Xe{constructor(e,i,o,r){o===void 0&&(o=-1e6),r===void 0&&(r=1e6),this.id=Xe.idCounter++,this.minForce=o,this.maxForce=r,this.bi=e,this.bj=i,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new Ls,this.jacobianElementB=new Ls,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(e,i,o){const r=i,a=e,c=o;this.a=4/(c*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(c*c*a*(1+4*r))}computeB(e,i,o){const r=this.computeGW(),a=this.computeGq(),c=this.computeGiMf();return-a*e-r*i-c*o}computeGq(){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,r=this.bj,a=o.position,c=r.position;return e.spatial.dot(a)+i.spatial.dot(c)}computeGW(){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,r=this.bj,a=o.velocity,c=r.velocity,h=o.angularVelocity,d=r.angularVelocity;return e.multiplyVectors(a,h)+i.multiplyVectors(c,d)}computeGWlambda(){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,r=this.bj,a=o.vlambda,c=r.vlambda,h=o.wlambda,d=r.wlambda;return e.multiplyVectors(a,h)+i.multiplyVectors(c,d)}computeGiMf(){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,r=this.bj,a=o.force,c=o.torque,h=r.force,d=r.torque,p=o.invMassSolve,u=r.invMassSolve;return a.scale(p,Ns),h.scale(u,Rs),o.invInertiaWorldSolve.vmult(c,Is),r.invInertiaWorldSolve.vmult(d,Fs),e.multiplyVectors(Ns,Is)+i.multiplyVectors(Rs,Fs)}computeGiMGt(){const e=this.jacobianElementA,i=this.jacobianElementB,o=this.bi,r=this.bj,a=o.invMassSolve,c=r.invMassSolve,h=o.invInertiaWorldSolve,d=r.invInertiaWorldSolve;let p=a+c;return h.vmult(e.rotational,bn),p+=bn.dot(e.rotational),d.vmult(i.rotational,bn),p+=bn.dot(i.rotational),p}addToWlambda(e){const i=this.jacobianElementA,o=this.jacobianElementB,r=this.bi,a=this.bj,c=Gc;r.vlambda.addScaledVector(r.invMassSolve*e,i.spatial,r.vlambda),a.vlambda.addScaledVector(a.invMassSolve*e,o.spatial,a.vlambda),r.invInertiaWorldSolve.vmult(i.rotational,c),r.wlambda.addScaledVector(e,c,r.wlambda),a.invInertiaWorldSolve.vmult(o.rotational,c),a.wlambda.addScaledVector(e,c,a.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}Xe.idCounter=0;const Ns=new m,Rs=new m,Is=new m,Fs=new m,bn=new m,Gc=new m;class Wc extends Xe{constructor(e,i,o){o===void 0&&(o=1e6);super(e,i,0,o);this.restitution=0,this.ri=new m,this.rj=new m,this.ni=new m}computeB(e){const i=this.a,o=this.b,r=this.bi,a=this.bj,c=this.ri,h=this.rj,d=Kc,p=$c,u=r.velocity,b=r.angularVelocity;r.force,r.torque;const f=a.velocity,w=a.angularVelocity;a.force,a.torque;const g=Yc,C=this.jacobianElementA,y=this.jacobianElementB,P=this.ni;c.cross(P,d),h.cross(P,p),P.negate(C.spatial),d.negate(C.rotational),y.spatial.copy(P),y.rotational.copy(p),g.copy(a.position),g.vadd(h,g),g.vsub(r.position,g),g.vsub(c,g);const _=P.dot(g),S=this.restitution+1,k=S*f.dot(P)-S*u.dot(P)+w.dot(p)-b.dot(d),M=this.computeGiMf();return-_*i-k*o-e*M}getImpactVelocityAlongNormal(){const e=Xc,i=Zc,o=Qc,r=Jc,a=th;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(o,e),this.bj.getVelocityAtWorldPoint(r,i),e.vsub(i,a),this.ni.dot(a)}}const Kc=new m,$c=new m,Yc=new m,Xc=new m,Zc=new m,Qc=new m,Jc=new m,th=new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;class Ds extends Xe{constructor(e,i,o){super(e,i,-o,o);this.ri=new m,this.rj=new m,this.t=new m}computeB(e){this.a;const i=this.b;this.bi,this.bj;const o=this.ri,r=this.rj,a=eh,c=nh,h=this.t;o.cross(h,a),r.cross(h,c);const d=this.jacobianElementA,p=this.jacobianElementB;h.negate(d.spatial),a.negate(d.rotational),p.spatial.copy(h),p.rotational.copy(c);const u=this.computeGW(),b=this.computeGiMf();return-u*i-e*b}}const eh=new m,nh=new m;class Ze{constructor(e,i,o){o=ao.defaults(o,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Ze.idCounter++,this.materials=[e,i],this.friction=o.friction,this.restitution=o.restitution,this.contactEquationStiffness=o.contactEquationStiffness,this.contactEquationRelaxation=o.contactEquationRelaxation,this.frictionEquationStiffness=o.frictionEquationStiffness,this.frictionEquationRelaxation=o.frictionEquationRelaxation}}Ze.idCounter=0;class Qe{constructor(e){e===void 0&&(e={});let i="";typeof e=="string"&&(i=e,e={}),this.name=i,this.id=Qe.idCounter++,this.friction=typeof e.friction!="undefined"?e.friction:-1,this.restitution=typeof e.restitution!="undefined"?e.restitution:-1}}Qe.idCounter=0;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new ct;new m;new m;new m;new m(1,0,0),new m(0,1,0),new m(0,0,1);new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;new m;class ih extends O{constructor(e){super({type:O.types.SPHERE});if(this.radius=e!==void 0?e:1,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}calculateLocalInertia(e,i){i===void 0&&(i=new m);const o=2*e*this.radius*this.radius/5;return i.x=o,i.y=o,i.z=o,i}volume(){return 4*Math.PI*Math.pow(this.radius,3)/3}updateBoundingSphereRadius(){this.boundingSphereRadius=this.radius}calculateWorldAABB(e,i,o,r){const a=this.radius,c=["x","y","z"];for(let h=0;h<c.length;h++){const d=c[h];o[d]=e[d]-a,r[d]=e[d]+a}}}new m;new m;new m;new m;new m;new m;new m;new m;new m;class lo extends Ot{constructor(e,i,o,r){if(e===void 0&&(e=1),i===void 0&&(i=1),o===void 0&&(o=1),r===void 0&&(r=8),e<0)throw new Error("The cylinder radiusTop cannot be negative.");if(i<0)throw new Error("The cylinder radiusBottom cannot be negative.");const a=r,c=[],h=[],d=[],p=[],u=[],b=Math.cos,f=Math.sin;c.push(new m(-i*f(0),-o*.5,i*b(0))),p.push(0),c.push(new m(-e*f(0),o*.5,e*b(0))),u.push(1);for(let g=0;g<a;g++){const C=2*Math.PI/a*(g+1),y=2*Math.PI/a*(g+.5);g<a-1?(c.push(new m(-i*f(C),-o*.5,i*b(C))),p.push(2*g+2),c.push(new m(-e*f(C),o*.5,e*b(C))),u.push(2*g+3),d.push([2*g,2*g+1,2*g+3,2*g+2])):d.push([2*g,2*g+1,1,0]),(a%2===1||g<a/2)&&h.push(new m(-f(y),0,b(y)))}d.push(p),h.push(new m(0,1,0));const w=[];for(let g=0;g<u.length;g++)w.push(u[u.length-g-1]);d.push(w);super({vertices:c,faces:d,axes:h});this.type=O.types.CYLINDER,this.radiusTop=e,this.radiusBottom=i,this.height=o,this.numSegments=r}}class co extends O{constructor(){super({type:O.types.PLANE});this.worldNormal=new m,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(e){const i=this.worldNormal;i.set(0,0,1),e.vmult(i,i),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(e,i){return i===void 0&&(i=new m),i}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,i,o,r){Nt.set(0,0,1),i.vmult(Nt,Nt);const a=Number.MAX_VALUE;o.set(-a,-a,-a),r.set(a,a,a),Nt.x===1?r.x=e.x:Nt.x===-1&&(o.x=e.x),Nt.y===1?r.y=e.y:Nt.y===-1&&(o.y=e.y),Nt.z===1?r.z=e.z:Nt.z===-1&&(o.z=e.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Nt=new m;class sh extends O{constructor(e,i){i===void 0&&(i={}),i=ao.defaults(i,{maxValue:null,minValue:null,elementSize:1});super({type:O.types.HEIGHTFIELD});this.data=e,this.maxValue=i.maxValue,this.minValue=i.minValue,this.elementSize=i.elementSize,i.minValue===null&&this.updateMinValue(),i.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,this.pillarConvex=new Ot,this.pillarOffset=new m,this.updateBoundingSphereRadius(),this._cachedPillars={}}update(){this._cachedPillars={}}updateMinValue(){const e=this.data;let i=e[0][0];for(let o=0;o!==e.length;o++)for(let r=0;r!==e[o].length;r++){const a=e[o][r];a<i&&(i=a)}this.minValue=i}updateMaxValue(){const e=this.data;let i=e[0][0];for(let o=0;o!==e.length;o++)for(let r=0;r!==e[o].length;r++){const a=e[o][r];a>i&&(i=a)}this.maxValue=i}setHeightValueAtIndex(e,i,o){const r=this.data;r[e][i]=o,this.clearCachedConvexTrianglePillar(e,i,!1),e>0&&(this.clearCachedConvexTrianglePillar(e-1,i,!0),this.clearCachedConvexTrianglePillar(e-1,i,!1)),i>0&&(this.clearCachedConvexTrianglePillar(e,i-1,!0),this.clearCachedConvexTrianglePillar(e,i-1,!1)),i>0&&e>0&&this.clearCachedConvexTrianglePillar(e-1,i-1,!0)}getRectMinMax(e,i,o,r,a){a===void 0&&(a=[]);const c=this.data;let h=this.minValue;for(let d=e;d<=o;d++)for(let p=i;p<=r;p++){const u=c[d][p];u>h&&(h=u)}a[0]=this.minValue,a[1]=h}getIndexOfPosition(e,i,o,r){const a=this.elementSize,c=this.data;let h=Math.floor(e/a),d=Math.floor(i/a);return o[0]=h,o[1]=d,r&&(h<0&&(h=0),d<0&&(d=0),h>=c.length-1&&(h=c.length-1),d>=c[0].length-1&&(d=c[0].length-1)),!(h<0||d<0||h>=c.length-1||d>=c[0].length-1)}getTriangleAt(e,i,o,r,a,c){const h=Os;this.getIndexOfPosition(e,i,h,o);let d=h[0],p=h[1];const u=this.data;o&&(d=Math.min(u.length-2,Math.max(0,d)),p=Math.min(u[0].length-2,Math.max(0,p)));const b=this.elementSize,f=(e/b-d)**2+(i/b-p)**2,w=(e/b-(d+1))**2+(i/b-(p+1))**2,g=f>w;return this.getTriangle(d,p,g,r,a,c),g}getNormalAt(e,i,o,r){const a=lh,c=ch,h=hh,d=dh,p=ph;this.getTriangleAt(e,i,o,a,c,h),c.vsub(a,d),h.vsub(a,p),d.cross(p,r),r.normalize()}getAabbAtIndex(e,i,o){let{lowerBound:r,upperBound:a}=o;const c=this.data,h=this.elementSize;r.set(e*h,i*h,c[e][i]),a.set((e+1)*h,(i+1)*h,c[e+1][i+1])}getHeightAt(e,i,o){const r=this.data,a=oh,c=rh,h=ah,d=Os;this.getIndexOfPosition(e,i,d,o);let p=d[0],u=d[1];o&&(p=Math.min(r.length-2,Math.max(0,p)),u=Math.min(r[0].length-2,Math.max(0,u)));const b=this.getTriangleAt(e,i,o,a,c,h);uh(e,i,a.x,a.y,c.x,c.y,h.x,h.y,qs);const f=qs;return b?r[p+1][u+1]*f.x+r[p][u+1]*f.y+r[p+1][u]*f.z:r[p][u]*f.x+r[p+1][u]*f.y+r[p][u+1]*f.z}getCacheConvexTrianglePillarKey(e,i,o){return`${e}_${i}_${o?1:0}`}getCachedConvexTrianglePillar(e,i,o){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,i,o)]}setCachedConvexTrianglePillar(e,i,o,r,a){this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,i,o)]={convex:r,offset:a}}clearCachedConvexTrianglePillar(e,i,o){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(e,i,o)]}getTriangle(e,i,o,r,a,c){const h=this.data,d=this.elementSize;o?(r.set((e+1)*d,(i+1)*d,h[e+1][i+1]),a.set(e*d,(i+1)*d,h[e][i+1]),c.set((e+1)*d,i*d,h[e+1][i])):(r.set(e*d,i*d,h[e][i]),a.set((e+1)*d,i*d,h[e+1][i]),c.set(e*d,(i+1)*d,h[e][i+1]))}getConvexTrianglePillar(e,i,o){let r=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){const b=this.getCachedConvexTrianglePillar(e,i,o);if(b){this.pillarConvex=b.convex,this.pillarOffset=b.offset;return}r=new Ot,a=new m,this.pillarConvex=r,this.pillarOffset=a}const c=this.data,h=this.elementSize,d=r.faces;r.vertices.length=6;for(let b=0;b<6;b++)r.vertices[b]||(r.vertices[b]=new m);d.length=5;for(let b=0;b<5;b++)d[b]||(d[b]=[]);const p=r.vertices,u=(Math.min(c[e][i],c[e+1][i],c[e][i+1],c[e+1][i+1])-this.minValue)/2+this.minValue;o?(a.set((e+.75)*h,(i+.75)*h,u),p[0].set(.25*h,.25*h,c[e+1][i+1]-u),p[1].set(-.75*h,.25*h,c[e][i+1]-u),p[2].set(.25*h,-.75*h,c[e+1][i]-u),p[3].set(.25*h,.25*h,-Math.abs(u)-1),p[4].set(-.75*h,.25*h,-Math.abs(u)-1),p[5].set(.25*h,-.75*h,-Math.abs(u)-1),d[0][0]=0,d[0][1]=1,d[0][2]=2,d[1][0]=5,d[1][1]=4,d[1][2]=3,d[2][0]=2,d[2][1]=5,d[2][2]=3,d[2][3]=0,d[3][0]=3,d[3][1]=4,d[3][2]=1,d[3][3]=0,d[4][0]=1,d[4][1]=4,d[4][2]=5,d[4][3]=2):(a.set((e+.25)*h,(i+.25)*h,u),p[0].set(-.25*h,-.25*h,c[e][i]-u),p[1].set(.75*h,-.25*h,c[e+1][i]-u),p[2].set(-.25*h,.75*h,c[e][i+1]-u),p[3].set(-.25*h,-.25*h,-Math.abs(u)-1),p[4].set(.75*h,-.25*h,-Math.abs(u)-1),p[5].set(-.25*h,.75*h,-Math.abs(u)-1),d[0][0]=0,d[0][1]=1,d[0][2]=2,d[1][0]=5,d[1][1]=4,d[1][2]=3,d[2][0]=0,d[2][1]=2,d[2][2]=5,d[2][3]=3,d[3][0]=1,d[3][1]=0,d[3][2]=3,d[3][3]=4,d[4][0]=4,d[4][1]=5,d[4][2]=2,d[4][3]=1),r.computeNormals(),r.computeEdges(),r.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(e,i,o,r,a)}calculateLocalInertia(e,i){return i===void 0&&(i=new m),i.set(0,0,0),i}volume(){return Number.MAX_VALUE}calculateWorldAABB(e,i,o,r){o.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}updateBoundingSphereRadius(){const e=this.data,i=this.elementSize;this.boundingSphereRadius=new m(e.length*i,e[0].length*i,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()}setHeightsFromImage(e,i){const{x:o,z:r,y:a}=i,c=document.createElement("canvas");c.width=e.width,c.height=e.height;const h=c.getContext("2d");h.drawImage(e,0,0);const d=h.getImageData(0,0,e.width,e.height),p=this.data;p.length=0,this.elementSize=Math.abs(o)/d.width;for(let u=0;u<d.height;u++){const b=[];for(let f=0;f<d.width;f++){const w=d.data[(u*d.height+f)*4],g=d.data[(u*d.height+f)*4+1],C=d.data[(u*d.height+f)*4+2],y=(w+g+C)/4/255*r;o<0?b.push(y):b.unshift(y)}a<0?p.unshift(b):p.push(b)}this.updateMaxValue(),this.updateMinValue(),this.update()}}const Os=[],qs=new m,oh=new m,rh=new m,ah=new m,lh=new m,ch=new m,hh=new m,dh=new m,ph=new m;function uh(L,e,i,o,r,a,c,h,d){d.x=((a-h)*(L-c)+(c-r)*(e-h))/((a-h)*(i-c)+(c-r)*(o-h)),d.y=((h-o)*(L-c)+(i-c)*(e-h))/((a-h)*(i-c)+(c-r)*(o-h)),d.z=1-d.x-d.y}class Bt{constructor(e){e===void 0&&(e={}),this.root=e.root||null,this.aabb=e.aabb?e.aabb.clone():new at,this.data=[],this.children=[]}reset(){this.children.length=this.data.length=0}insert(e,i,o){o===void 0&&(o=0);const r=this.data;if(!this.aabb.contains(e))return!1;const a=this.children,c=this.maxDepth||this.root.maxDepth;if(o<c){let h=!1;a.length||(this.subdivide(),h=!0);for(let d=0;d!==8;d++)if(a[d].insert(e,i,o+1))return!0;h&&(a.length=0)}return r.push(i),!0}subdivide(){const e=this.aabb,i=e.lowerBound,o=e.upperBound,r=this.children;r.push(new Bt({aabb:new at({lowerBound:new m(0,0,0)})}),new Bt({aabb:new at({lowerBound:new m(1,0,0)})}),new Bt({aabb:new at({lowerBound:new m(1,1,0)})}),new Bt({aabb:new at({lowerBound:new m(1,1,1)})}),new Bt({aabb:new at({lowerBound:new m(0,1,1)})}),new Bt({aabb:new at({lowerBound:new m(0,0,1)})}),new Bt({aabb:new at({lowerBound:new m(1,0,1)})}),new Bt({aabb:new at({lowerBound:new m(0,1,0)})})),o.vsub(i,re),re.scale(.5,re);const a=this.root||this;for(let c=0;c!==8;c++){const h=r[c];h.root=a;const d=h.aabb.lowerBound;d.x*=re.x,d.y*=re.y,d.z*=re.z,d.vadd(i,d),d.vadd(re,h.aabb.upperBound)}}aabbQuery(e,i){this.data,this.children;const o=[this];for(;o.length;){const r=o.pop();r.aabb.overlaps(e)&&Array.prototype.push.apply(i,r.data),Array.prototype.push.apply(o,r.children)}return i}rayQuery(e,i,o){return e.getAABB(wn),wn.toLocalFrame(i,wn),this.aabbQuery(wn,o),o}removeEmptyNodes(){for(let e=this.children.length-1;e>=0;e--)this.children[e].removeEmptyNodes(),!this.children[e].children.length&&!this.children[e].data.length&&this.children.splice(e,1)}}class vh extends Bt{constructor(e,i){i===void 0&&(i={});super({root:null,aabb:e});this.maxDepth=typeof i.maxDepth!="undefined"?i.maxDepth:8}}const re=new m,wn=new at;class Cn extends O{constructor(e,i){super({type:O.types.TRIMESH});this.vertices=new Float32Array(e),this.indices=new Int16Array(i),this.normals=new Float32Array(i.length),this.aabb=new at,this.edges=null,this.scale=new m(1,1,1),this.tree=new vh,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}updateTree(){const e=this.tree;e.reset(),e.aabb.copy(this.aabb);const i=this.scale;e.aabb.lowerBound.x*=1/i.x,e.aabb.lowerBound.y*=1/i.y,e.aabb.lowerBound.z*=1/i.z,e.aabb.upperBound.x*=1/i.x,e.aabb.upperBound.y*=1/i.y,e.aabb.upperBound.z*=1/i.z;const o=new at,r=new m,a=new m,c=new m,h=[r,a,c];for(let d=0;d<this.indices.length/3;d++){const p=d*3;this._getUnscaledVertex(this.indices[p],r),this._getUnscaledVertex(this.indices[p+1],a),this._getUnscaledVertex(this.indices[p+2],c),o.setFromPoints(h),e.insert(o,d)}e.removeEmptyNodes()}getTrianglesInAABB(e,i){gn.copy(e);const o=this.scale,r=o.x,a=o.y,c=o.z,h=gn.lowerBound,d=gn.upperBound;return h.x/=r,h.y/=a,h.z/=c,d.x/=r,d.y/=a,d.z/=c,this.tree.aabbQuery(gn,i)}setScale(e){const i=this.scale.x===this.scale.y&&this.scale.y===this.scale.z,o=e.x===e.y&&e.y===e.z;i&&o||this.updateNormals(),this.scale.copy(e),this.updateAABB(),this.updateBoundingSphereRadius()}updateNormals(){const e=mh,i=this.normals;for(let o=0;o<this.indices.length/3;o++){const r=o*3,a=this.indices[r],c=this.indices[r+1],h=this.indices[r+2];this.getVertex(a,Hs),this.getVertex(c,Gs),this.getVertex(h,Ws),Cn.computeNormal(Gs,Hs,Ws,e),i[r]=e.x,i[r+1]=e.y,i[r+2]=e.z}}updateEdges(){const e={},i=(r,a)=>{const c=r<a?`${r}_${a}`:`${a}_${r}`;e[c]=!0};for(let r=0;r<this.indices.length/3;r++){const a=r*3,c=this.indices[a],h=this.indices[a+1],d=this.indices[a+2];i(c,h),i(h,d),i(d,c)}const o=Object.keys(e);this.edges=new Int16Array(o.length*2);for(let r=0;r<o.length;r++){const a=o[r].split("_");this.edges[2*r]=parseInt(a[0],10),this.edges[2*r+1]=parseInt(a[1],10)}}getEdgeVertex(e,i,o){const r=this.edges[e*2+(i?1:0)];this.getVertex(r,o)}getEdgeVector(e,i){const o=fh,r=bh;this.getEdgeVertex(e,0,o),this.getEdgeVertex(e,1,r),r.vsub(o,i)}static computeNormal(e,i,o,r){i.vsub(e,Us),o.vsub(i,js),js.cross(Us,r),r.isZero()||r.normalize()}getVertex(e,i){const o=this.scale;return this._getUnscaledVertex(e,i),i.x*=o.x,i.y*=o.y,i.z*=o.z,i}_getUnscaledVertex(e,i){const o=e*3,r=this.vertices;return i.set(r[o],r[o+1],r[o+2])}getWorldVertex(e,i,o,r){return this.getVertex(e,r),tt.pointToWorldFrame(i,o,r,r),r}getTriangleVertices(e,i,o,r){const a=e*3;this.getVertex(this.indices[a],i),this.getVertex(this.indices[a+1],o),this.getVertex(this.indices[a+2],r)}getNormal(e,i){const o=e*3;return i.set(this.normals[o],this.normals[o+1],this.normals[o+2])}calculateLocalInertia(e,i){this.computeLocalAABB(ae);const o=ae.upperBound.x-ae.lowerBound.x,r=ae.upperBound.y-ae.lowerBound.y,a=ae.upperBound.z-ae.lowerBound.z;return i.set(1/12*e*(2*r*2*r+2*a*2*a),1/12*e*(2*o*2*o+2*a*2*a),1/12*e*(2*r*2*r+2*o*2*o))}computeLocalAABB(e){const i=e.lowerBound,o=e.upperBound,r=this.vertices.length;this.vertices;const a=wh;this.getVertex(0,a),i.copy(a),o.copy(a);for(let c=0;c!==r;c++)this.getVertex(c,a),a.x<i.x?i.x=a.x:a.x>o.x&&(o.x=a.x),a.y<i.y?i.y=a.y:a.y>o.y&&(o.y=a.y),a.z<i.z?i.z=a.z:a.z>o.z&&(o.z=a.z)}updateAABB(){this.computeLocalAABB(this.aabb)}updateBoundingSphereRadius(){let e=0;const i=this.vertices,o=new m;for(let r=0,a=i.length/3;r!==a;r++){this.getVertex(r,o);const c=o.lengthSquared();c>e&&(e=c)}this.boundingSphereRadius=Math.sqrt(e)}calculateWorldAABB(e,i,o,r){const a=gh,c=_h;a.position=e,a.quaternion=i,this.aabb.toWorldFrame(a,c),o.copy(c.lowerBound),r.copy(c.upperBound)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}static createTorus(e,i,o,r,a){e===void 0&&(e=1),i===void 0&&(i=.5),o===void 0&&(o=8),r===void 0&&(r=6),a===void 0&&(a=Math.PI*2);const c=[],h=[];for(let d=0;d<=o;d++)for(let p=0;p<=r;p++){const u=p/r*a,b=d/o*Math.PI*2,f=(e+i*Math.cos(b))*Math.cos(u),w=(e+i*Math.cos(b))*Math.sin(u),g=i*Math.sin(b);c.push(f,w,g)}for(let d=1;d<=o;d++)for(let p=1;p<=r;p++){const u=(r+1)*d+p-1,b=(r+1)*(d-1)+p-1,f=(r+1)*(d-1)+p,w=(r+1)*d+p;h.push(u,b,w),h.push(b,f,w)}return new Cn(c,h)}}const mh=new m,gn=new at,fh=new m,bh=new m,js=new m,Us=new m,Hs=new m,Gs=new m,Ws=new m,ae=new at,wh=new m,gh=new tt,_h=new at;class yh{constructor(){this.equations=[]}solve(e,i){return 0}addEquation(e){e.enabled&&!e.bi.isTrigger&&!e.bj.isTrigger&&this.equations.push(e)}removeEquation(e){const i=this.equations,o=i.indexOf(e);o!==-1&&i.splice(o,1)}removeAllEquations(){this.equations.length=0}}class xh extends yh{constructor(){super();this.iterations=10,this.tolerance=1e-7}solve(e,i){let o=0;const r=this.iterations,a=this.tolerance*this.tolerance,c=this.equations,h=c.length,d=i.bodies,p=d.length,u=e;let b,f,w,g,C,y;if(h!==0)for(let k=0;k!==p;k++)d[k].updateSolveMassProperties();const P=Eh,_=Ph,S=Ch;P.length=h,_.length=h,S.length=h;for(let k=0;k!==h;k++){const M=c[k];S[k]=0,_[k]=M.computeB(u),P[k]=1/M.computeC()}if(h!==0){for(let V=0;V!==p;V++){const I=d[V],F=I.vlambda,H=I.wlambda;F.set(0,0,0),H.set(0,0,0)}for(o=0;o!==r;o++){g=0;for(let V=0;V!==h;V++){const I=c[V];b=_[V],f=P[V],y=S[V],C=I.computeGWlambda(),w=f*(b-C-I.eps*y),y+w<I.minForce?w=I.minForce-y:y+w>I.maxForce&&(w=I.maxForce-y),S[V]+=w,g+=w>0?w:-w,I.addToWlambda(w)}if(g*g<a)break}for(let V=0;V!==p;V++){const I=d[V],F=I.velocity,H=I.angularVelocity;I.vlambda.vmul(I.linearFactor,I.vlambda),F.vadd(I.vlambda,F),I.wlambda.vmul(I.angularFactor,I.wlambda),H.vadd(I.wlambda,H)}let k=c.length;const M=1/u;for(;k--;)c[k].multiplier=S[k]*M}return o}}const Ch=[],Eh=[],Ph=[];class Ah{constructor(){this.objects=[],this.type=Object}release(){const e=arguments.length;for(let i=0;i!==e;i++)this.objects.push(i<0||arguments.length<=i?void 0:arguments[i]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(e){const i=this.objects;for(;i.length>e;)i.pop();for(;i.length<e;)i.push(this.constructObject());return this}}class kh extends Ah{constructor(){super(...arguments);this.type=m}constructObject(){return new m}}const st={sphereSphere:O.types.SPHERE,spherePlane:O.types.SPHERE|O.types.PLANE,boxBox:O.types.BOX|O.types.BOX,sphereBox:O.types.SPHERE|O.types.BOX,planeBox:O.types.PLANE|O.types.BOX,convexConvex:O.types.CONVEXPOLYHEDRON,sphereConvex:O.types.SPHERE|O.types.CONVEXPOLYHEDRON,planeConvex:O.types.PLANE|O.types.CONVEXPOLYHEDRON,boxConvex:O.types.BOX|O.types.CONVEXPOLYHEDRON,sphereHeightfield:O.types.SPHERE|O.types.HEIGHTFIELD,boxHeightfield:O.types.BOX|O.types.HEIGHTFIELD,convexHeightfield:O.types.CONVEXPOLYHEDRON|O.types.HEIGHTFIELD,sphereParticle:O.types.PARTICLE|O.types.SPHERE,planeParticle:O.types.PLANE|O.types.PARTICLE,boxParticle:O.types.BOX|O.types.PARTICLE,convexParticle:O.types.PARTICLE|O.types.CONVEXPOLYHEDRON,cylinderCylinder:O.types.CYLINDER,sphereCylinder:O.types.SPHERE|O.types.CYLINDER,planeCylinder:O.types.PLANE|O.types.CYLINDER,boxCylinder:O.types.BOX|O.types.CYLINDER,convexCylinder:O.types.CONVEXPOLYHEDRON|O.types.CYLINDER,heightfieldCylinder:O.types.HEIGHTFIELD|O.types.CYLINDER,particleCylinder:O.types.PARTICLE|O.types.CYLINDER,sphereTrimesh:O.types.SPHERE|O.types.TRIMESH,planeTrimesh:O.types.PLANE|O.types.TRIMESH};class Mh{get[st.sphereSphere](){return this.sphereSphere}get[st.spherePlane](){return this.spherePlane}get[st.boxBox](){return this.boxBox}get[st.sphereBox](){return this.sphereBox}get[st.planeBox](){return this.planeBox}get[st.convexConvex](){return this.convexConvex}get[st.sphereConvex](){return this.sphereConvex}get[st.planeConvex](){return this.planeConvex}get[st.boxConvex](){return this.boxConvex}get[st.sphereHeightfield](){return this.sphereHeightfield}get[st.boxHeightfield](){return this.boxHeightfield}get[st.convexHeightfield](){return this.convexHeightfield}get[st.sphereParticle](){return this.sphereParticle}get[st.planeParticle](){return this.planeParticle}get[st.boxParticle](){return this.boxParticle}get[st.convexParticle](){return this.convexParticle}get[st.cylinderCylinder](){return this.convexConvex}get[st.sphereCylinder](){return this.sphereConvex}get[st.planeCylinder](){return this.planeConvex}get[st.boxCylinder](){return this.boxConvex}get[st.convexCylinder](){return this.convexConvex}get[st.heightfieldCylinder](){return this.heightfieldCylinder}get[st.particleCylinder](){return this.particleCylinder}get[st.sphereTrimesh](){return this.sphereTrimesh}get[st.planeTrimesh](){return this.planeTrimesh}constructor(e){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new kh,this.world=e,this.currentContactMaterial=e.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(e,i,o,r,a,c){let h;this.contactPointPool.length?(h=this.contactPointPool.pop(),h.bi=e,h.bj=i):h=new Wc(e,i),h.enabled=e.collisionResponse&&i.collisionResponse&&o.collisionResponse&&r.collisionResponse;const d=this.currentContactMaterial;h.restitution=d.restitution,h.setSpookParams(d.contactEquationStiffness,d.contactEquationRelaxation,this.world.dt);const p=o.material||e.material,u=r.material||i.material;return p&&u&&p.restitution>=0&&u.restitution>=0&&(h.restitution=p.restitution*u.restitution),h.si=a||o,h.sj=c||r,h}createFrictionEquationsFromContact(e,i){const o=e.bi,r=e.bj,a=e.si,c=e.sj,h=this.world,d=this.currentContactMaterial;let p=d.friction;const u=a.material||o.material,b=c.material||r.material;if(u&&b&&u.friction>=0&&b.friction>=0&&(p=u.friction*b.friction),p>0){const f=p*h.gravity.length();let w=o.invMass+r.invMass;w>0&&(w=1/w);const g=this.frictionEquationPool,C=g.length?g.pop():new Ds(o,r,f*w),y=g.length?g.pop():new Ds(o,r,f*w);return C.bi=y.bi=o,C.bj=y.bj=r,C.minForce=y.minForce=-f*w,C.maxForce=y.maxForce=f*w,C.ri.copy(e.ri),C.rj.copy(e.rj),y.ri.copy(e.ri),y.rj.copy(e.rj),e.ni.tangents(C.t,y.t),C.setSpookParams(d.frictionEquationStiffness,d.frictionEquationRelaxation,h.dt),y.setSpookParams(d.frictionEquationStiffness,d.frictionEquationRelaxation,h.dt),C.enabled=y.enabled=e.enabled,i.push(C,y),!0}return!1}createFrictionFromAverage(e){let i=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(i,this.frictionResult)||e===1)return;const o=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];le.setZero(),Ce.setZero(),Ee.setZero();const a=i.bi;i.bj;for(let h=0;h!==e;h++)i=this.result[this.result.length-1-h],i.bi!==a?(le.vadd(i.ni,le),Ce.vadd(i.ri,Ce),Ee.vadd(i.rj,Ee)):(le.vsub(i.ni,le),Ce.vadd(i.rj,Ce),Ee.vadd(i.ri,Ee));const c=1/e;Ce.scale(c,o.ri),Ee.scale(c,o.rj),r.ri.copy(o.ri),r.rj.copy(o.rj),le.normalize(),le.tangents(o.t,r.t)}getContacts(e,i,o,r,a,c,h){this.contactPointPool=a,this.frictionEquationPool=h,this.result=r,this.frictionResult=c;const d=Bh,p=zh,u=Sh,b=Vh;for(let f=0,w=e.length;f!==w;f++){const g=e[f],C=i[f];let y=null;g.material&&C.material&&(y=o.getContactMaterial(g.material,C.material)||null);const P=g.type&U.KINEMATIC&&C.type&U.STATIC||g.type&U.STATIC&&C.type&U.KINEMATIC||g.type&U.KINEMATIC&&C.type&U.KINEMATIC;for(let _=0;_<g.shapes.length;_++){g.quaternion.mult(g.shapeOrientations[_],d),g.quaternion.vmult(g.shapeOffsets[_],u),u.vadd(g.position,u);const S=g.shapes[_];for(let k=0;k<C.shapes.length;k++){C.quaternion.mult(C.shapeOrientations[k],p),C.quaternion.vmult(C.shapeOffsets[k],b),b.vadd(C.position,b);const M=C.shapes[k];if(!(S.collisionFilterMask&M.collisionFilterGroup&&M.collisionFilterMask&S.collisionFilterGroup)||u.distanceTo(b)>S.boundingSphereRadius+M.boundingSphereRadius)continue;let V=null;S.material&&M.material&&(V=o.getContactMaterial(S.material,M.material)||null),this.currentContactMaterial=V||y||o.defaultContactMaterial;const I=S.type|M.type,F=this[I];if(F){let H=!1;S.type<M.type?H=F.call(this,S,M,u,b,d,p,g,C,S,M,P):H=F.call(this,M,S,b,u,p,d,C,g,S,M,P),H&&P&&(o.shapeOverlapKeeper.set(S.id,M.id),o.bodyOverlapKeeper.set(g.id,C.id))}}}}}sphereSphere(e,i,o,r,a,c,h,d,p,u,b){if(b)return o.distanceSquared(r)<(e.radius+i.radius)**2;const f=this.createContactEquation(h,d,e,i,p,u);r.vsub(o,f.ni),f.ni.normalize(),f.ri.copy(f.ni),f.rj.copy(f.ni),f.ri.scale(e.radius,f.ri),f.rj.scale(-i.radius,f.rj),f.ri.vadd(o,f.ri),f.ri.vsub(h.position,f.ri),f.rj.vadd(r,f.rj),f.rj.vsub(d.position,f.rj),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}spherePlane(e,i,o,r,a,c,h,d,p,u,b){const f=this.createContactEquation(h,d,e,i,p,u);if(f.ni.set(0,0,1),c.vmult(f.ni,f.ni),f.ni.negate(f.ni),f.ni.normalize(),f.ni.scale(e.radius,f.ri),o.vsub(r,_n),f.ni.scale(f.ni.dot(_n),Ks),_n.vsub(Ks,f.rj),-_n.dot(f.ni)<=e.radius){if(b)return!0;const w=f.ri,g=f.rj;w.vadd(o,w),w.vsub(h.position,w),g.vadd(r,g),g.vsub(d.position,g),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}}boxBox(e,i,o,r,a,c,h,d,p,u,b){return e.convexPolyhedronRepresentation.material=e.material,i.convexPolyhedronRepresentation.material=i.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i.convexPolyhedronRepresentation,o,r,a,c,h,d,e,i,b)}sphereBox(e,i,o,r,a,c,h,d,p,u,b){const f=this.v3pool,w=sd;o.vsub(r,yn),i.getSideNormals(w,c);const g=e.radius;let C=!1;const y=rd,P=ad,_=ld;let S=null,k=0,M=0,V=0,I=null;for(let A=0,X=w.length;A!==X&&C===!1;A++){const W=ed;W.copy(w[A]);const $=W.length();W.normalize();const Y=yn.dot(W);if(Y<$+g&&Y>0){const nt=nd,j=id;nt.copy(w[(A+1)%3]),j.copy(w[(A+2)%3]);const Q=nt.length(),Pt=j.length();nt.normalize(),j.normalize();const zt=yn.dot(nt),Xt=yn.dot(j);if(zt<Q&&zt>-Q&&Xt<Pt&&Xt>-Pt){const Zt=Math.abs(Y-$-g);if((I===null||Zt<I)&&(I=Zt,M=zt,V=Xt,S=$,y.copy(W),P.copy(nt),_.copy(j),k++,b))return!0}}}if(k){C=!0;const A=this.createContactEquation(h,d,e,i,p,u);y.scale(-g,A.ri),A.ni.copy(y),A.ni.negate(A.ni),y.scale(S,y),P.scale(M,P),y.vadd(P,y),_.scale(V,_),y.vadd(_,A.rj),A.ri.vadd(o,A.ri),A.ri.vsub(h.position,A.ri),A.rj.vadd(r,A.rj),A.rj.vsub(d.position,A.rj),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}let F=f.get();const H=od;for(let A=0;A!==2&&!C;A++)for(let X=0;X!==2&&!C;X++)for(let W=0;W!==2&&!C;W++)if(F.set(0,0,0),A?F.vadd(w[0],F):F.vsub(w[0],F),X?F.vadd(w[1],F):F.vsub(w[1],F),W?F.vadd(w[2],F):F.vsub(w[2],F),r.vadd(F,H),H.vsub(o,H),H.lengthSquared()<g*g){if(b)return!0;C=!0;const $=this.createContactEquation(h,d,e,i,p,u);$.ri.copy(H),$.ri.normalize(),$.ni.copy($.ri),$.ri.scale(g,$.ri),$.rj.copy(F),$.ri.vadd(o,$.ri),$.ri.vsub(h.position,$.ri),$.rj.vadd(r,$.rj),$.rj.vsub(d.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}f.release(F),F=null;const N=f.get(),z=f.get(),q=f.get(),B=f.get(),R=f.get(),T=w.length;for(let A=0;A!==T&&!C;A++)for(let X=0;X!==T&&!C;X++)if(A%3!==X%3){w[X].cross(w[A],N),N.normalize(),w[A].vadd(w[X],z),q.copy(o),q.vsub(z,q),q.vsub(r,q);const W=q.dot(N);N.scale(W,B);let $=0;for(;$===A%3||$===X%3;)$++;R.copy(o),R.vsub(B,R),R.vsub(z,R),R.vsub(r,R);const Y=Math.abs(W),nt=R.length();if(Y<w[$].length()&&nt<g){if(b)return!0;C=!0;const j=this.createContactEquation(h,d,e,i,p,u);z.vadd(B,j.rj),j.rj.copy(j.rj),R.negate(j.ni),j.ni.normalize(),j.ri.copy(j.rj),j.ri.vadd(r,j.ri),j.ri.vsub(o,j.ri),j.ri.normalize(),j.ri.scale(g,j.ri),j.ri.vadd(o,j.ri),j.ri.vsub(h.position,j.ri),j.rj.vadd(r,j.rj),j.rj.vsub(d.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}f.release(N,z,q,B,R)}planeBox(e,i,o,r,a,c,h,d,p,u,b){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,i.convexPolyhedronRepresentation.id=i.id,this.planeConvex(e,i.convexPolyhedronRepresentation,o,r,a,c,h,d,e,i,b)}convexConvex(e,i,o,r,a,c,h,d,p,u,b,f,w){const g=Cd;if(!(o.distanceTo(r)>e.boundingSphereRadius+i.boundingSphereRadius)&&e.findSeparatingAxis(i,o,a,r,c,g,f,w)){const C=[],y=Ed;e.clipAgainstHull(o,a,i,r,c,g,-100,100,C);let P=0;for(let _=0;_!==C.length;_++){if(b)return!0;const S=this.createContactEquation(h,d,e,i,p,u),k=S.ri,M=S.rj;g.negate(S.ni),C[_].normal.negate(y),y.scale(C[_].depth,y),C[_].point.vadd(y,k),M.copy(C[_].point),k.vsub(o,k),M.vsub(r,M),k.vadd(o,k),k.vsub(h.position,k),M.vadd(r,M),M.vsub(d.position,M),this.result.push(S),P++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(S,this.frictionResult)}this.enableFrictionReduction&&P&&this.createFrictionFromAverage(P)}}sphereConvex(e,i,o,r,a,c,h,d,p,u,b){const f=this.v3pool;o.vsub(r,cd);const w=i.faceNormals,g=i.faces,C=i.vertices,y=e.radius;let P=!1;for(let _=0;_!==C.length;_++){const S=C[_],k=ud;c.vmult(S,k),r.vadd(k,k);const M=pd;if(k.vsub(o,M),M.lengthSquared()<y*y){if(b)return!0;P=!0;const V=this.createContactEquation(h,d,e,i,p,u);V.ri.copy(M),V.ri.normalize(),V.ni.copy(V.ri),V.ri.scale(y,V.ri),k.vsub(r,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(h.position,V.ri),V.rj.vadd(r,V.rj),V.rj.vsub(d.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult);return}}for(let _=0,S=g.length;_!==S&&P===!1;_++){const k=w[_],M=g[_],V=vd;c.vmult(k,V);const I=md;c.vmult(C[M[0]],I),I.vadd(r,I);const F=fd;V.scale(-y,F),o.vadd(F,F);const H=bd;F.vsub(I,H);const N=H.dot(V),z=wd;if(o.vsub(I,z),N<0&&z.dot(V)>0){const q=[];for(let B=0,R=M.length;B!==R;B++){const T=f.get();c.vmult(C[M[B]],T),r.vadd(T,T),q.push(T)}if(td(q,V,o)){if(b)return!0;P=!0;const B=this.createContactEquation(h,d,e,i,p,u);V.scale(-y,B.ri),V.negate(B.ni);const R=f.get();V.scale(-N,R);const T=f.get();V.scale(-y,T),o.vsub(r,B.rj),B.rj.vadd(T,B.rj),B.rj.vadd(R,B.rj),B.rj.vadd(r,B.rj),B.rj.vsub(d.position,B.rj),B.ri.vadd(o,B.ri),B.ri.vsub(h.position,B.ri),f.release(R),f.release(T),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);for(let A=0,X=q.length;A!==X;A++)f.release(q[A]);return}else for(let B=0;B!==M.length;B++){const R=f.get(),T=f.get();c.vmult(C[M[(B+1)%M.length]],R),c.vmult(C[M[(B+2)%M.length]],T),r.vadd(R,R),r.vadd(T,T);const A=hd;T.vsub(R,A);const X=dd;A.unit(X);const W=f.get(),$=f.get();o.vsub(R,$);const Y=$.dot(X);X.scale(Y,W),W.vadd(R,W);const nt=f.get();if(W.vsub(o,nt),Y>0&&Y*Y<A.lengthSquared()&&nt.lengthSquared()<y*y){if(b)return!0;const j=this.createContactEquation(h,d,e,i,p,u);W.vsub(r,j.rj),W.vsub(o,j.ni),j.ni.normalize(),j.ni.scale(y,j.ri),j.rj.vadd(r,j.rj),j.rj.vsub(d.position,j.rj),j.ri.vadd(o,j.ri),j.ri.vsub(h.position,j.ri),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult);for(let Q=0,Pt=q.length;Q!==Pt;Q++)f.release(q[Q]);f.release(R),f.release(T),f.release(W),f.release(nt),f.release($);return}f.release(R),f.release(T),f.release(W),f.release(nt),f.release($)}for(let B=0,R=q.length;B!==R;B++)f.release(q[B])}}}planeConvex(e,i,o,r,a,c,h,d,p,u,b){const f=gd,w=_d;w.set(0,0,1),a.vmult(w,w);let g=0;const C=yd;for(let y=0;y!==i.vertices.length;y++)if(f.copy(i.vertices[y]),c.vmult(f,f),r.vadd(f,f),f.vsub(o,C),w.dot(C)<=0){if(b)return!0;const _=this.createContactEquation(h,d,e,i,p,u),S=xd;w.scale(w.dot(C),S),f.vsub(S,S),S.vsub(o,_.ri),_.ni.copy(w),f.vsub(r,_.rj),_.ri.vadd(o,_.ri),_.ri.vsub(h.position,_.ri),_.rj.vadd(r,_.rj),_.rj.vsub(d.position,_.rj),this.result.push(_),g++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}boxConvex(e,i,o,r,a,c,h,d,p,u,b){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(e.convexPolyhedronRepresentation,i,o,r,a,c,h,d,e,i,b)}sphereHeightfield(e,i,o,r,a,c,h,d,p,u,b){const f=i.data,w=e.radius,g=i.elementSize,C=Rd,y=Nd;tt.pointToLocalFrame(r,c,o,y);let P=Math.floor((y.x-w)/g)-1,_=Math.ceil((y.x+w)/g)+1,S=Math.floor((y.y-w)/g)-1,k=Math.ceil((y.y+w)/g)+1;if(_<0||k<0||P>f.length||S>f[0].length)return;P<0&&(P=0),_<0&&(_=0),S<0&&(S=0),k<0&&(k=0),P>=f.length&&(P=f.length-1),_>=f.length&&(_=f.length-1),k>=f[0].length&&(k=f[0].length-1),S>=f[0].length&&(S=f[0].length-1);const M=[];i.getRectMinMax(P,S,_,k,M);const V=M[0],I=M[1];if(y.z-w>I||y.z+w<V)return;const F=this.result;for(let H=P;H<_;H++)for(let N=S;N<k;N++){const z=F.length;let q=!1;if(i.getConvexTrianglePillar(H,N,!1),tt.pointToWorldFrame(r,c,i.pillarOffset,C),o.distanceTo(C)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(q=this.sphereConvex(e,i.pillarConvex,o,C,a,c,h,d,e,i,b)),b&&q||(i.getConvexTrianglePillar(H,N,!0),tt.pointToWorldFrame(r,c,i.pillarOffset,C),o.distanceTo(C)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(q=this.sphereConvex(e,i.pillarConvex,o,C,a,c,h,d,e,i,b)),b&&q))return!0;if(F.length-z>2)return}}boxHeightfield(e,i,o,r,a,c,h,d,p,u,b){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexHeightfield(e.convexPolyhedronRepresentation,i,o,r,a,c,h,d,e,i,b)}convexHeightfield(e,i,o,r,a,c,h,d,p,u,b){const f=i.data,w=i.elementSize,g=e.boundingSphereRadius,C=Td,y=Ld,P=zd;tt.pointToLocalFrame(r,c,o,P);let _=Math.floor((P.x-g)/w)-1,S=Math.ceil((P.x+g)/w)+1,k=Math.floor((P.y-g)/w)-1,M=Math.ceil((P.y+g)/w)+1;if(S<0||M<0||_>f.length||k>f[0].length)return;_<0&&(_=0),S<0&&(S=0),k<0&&(k=0),M<0&&(M=0),_>=f.length&&(_=f.length-1),S>=f.length&&(S=f.length-1),M>=f[0].length&&(M=f[0].length-1),k>=f[0].length&&(k=f[0].length-1);const V=[];i.getRectMinMax(_,k,S,M,V);const I=V[0],F=V[1];if(!(P.z-g>F||P.z+g<I))for(let H=_;H<S;H++)for(let N=k;N<M;N++){let z=!1;if(i.getConvexTrianglePillar(H,N,!1),tt.pointToWorldFrame(r,c,i.pillarOffset,C),o.distanceTo(C)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(z=this.convexConvex(e,i.pillarConvex,o,C,a,c,h,d,null,null,b,y,null)),b&&z||(i.getConvexTrianglePillar(H,N,!0),tt.pointToWorldFrame(r,c,i.pillarOffset,C),o.distanceTo(C)<i.pillarConvex.boundingSphereRadius+e.boundingSphereRadius&&(z=this.convexConvex(e,i.pillarConvex,o,C,a,c,h,d,null,null,b,y,null)),b&&z))return!0}}sphereParticle(e,i,o,r,a,c,h,d,p,u,b){const f=Md;if(f.set(0,0,1),r.vsub(o,f),f.lengthSquared()<=e.radius*e.radius){if(b)return!0;const g=this.createContactEquation(d,h,i,e,p,u);f.normalize(),g.rj.copy(f),g.rj.scale(e.radius,g.rj),g.ni.copy(f),g.ni.negate(g.ni),g.ri.set(0,0,0),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}planeParticle(e,i,o,r,a,c,h,d,p,u,b){const f=Pd;f.set(0,0,1),h.quaternion.vmult(f,f);const w=Ad;if(r.vsub(h.position,w),f.dot(w)<=0){if(b)return!0;const C=this.createContactEquation(d,h,i,e,p,u);C.ni.copy(f),C.ni.negate(C.ni),C.ri.set(0,0,0);const y=kd;f.scale(f.dot(r),y),r.vsub(y,y),C.rj.copy(y),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}}boxParticle(e,i,o,r,a,c,h,d,p,u,b){return e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexParticle(e.convexPolyhedronRepresentation,i,o,r,a,c,h,d,e,i,b)}convexParticle(e,i,o,r,a,c,h,d,p,u,b){let f=-1;const w=Vd,g=Bd;let C=null;const y=Sd;if(y.copy(r),y.vsub(o,y),a.conjugate($s),$s.vmult(y,y),e.pointIsInside(y)){e.worldVerticesNeedsUpdate&&e.computeWorldVertices(o,a),e.worldFaceNormalsNeedsUpdate&&e.computeWorldFaceNormals(a);for(let P=0,_=e.faces.length;P!==_;P++){const S=[e.worldVertices[e.faces[P][0]]],k=e.worldFaceNormals[P];r.vsub(S[0],Ys);const M=-k.dot(Ys);if(C===null||Math.abs(M)<Math.abs(C)){if(b)return!0;C=M,f=P,w.copy(k)}}if(f!==-1){const P=this.createContactEquation(d,h,i,e,p,u);w.scale(C,g),g.vadd(r,g),g.vsub(o,g),P.rj.copy(g),w.negate(P.ni),P.ri.set(0,0,0);const _=P.ri,S=P.rj;_.vadd(r,_),_.vsub(d.position,_),S.vadd(o,S),S.vsub(h.position,S),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(e,i,o,r,a,c,h,d,p,u,b){return this.convexHeightfield(i,e,r,o,c,a,d,h,p,u,b)}particleCylinder(e,i,o,r,a,c,h,d,p,u,b){return this.convexParticle(i,e,r,o,c,a,d,h,p,u,b)}sphereTrimesh(e,i,o,r,a,c,h,d,p,u,b){const f=Oh,w=qh,g=jh,C=Uh,y=Hh,P=Gh,_=Yh,S=Dh,k=Ih,M=Xh;tt.pointToLocalFrame(r,c,o,y);const V=e.radius;_.lowerBound.set(y.x-V,y.y-V,y.z-V),_.upperBound.set(y.x+V,y.y+V,y.z+V),i.getTrianglesInAABB(_,M);const I=Fh,F=e.radius*e.radius;for(let B=0;B<M.length;B++)for(let R=0;R<3;R++)if(i.getVertex(i.indices[M[B]*3+R],I),I.vsub(y,k),k.lengthSquared()<=F){if(S.copy(I),tt.pointToWorldFrame(r,c,S,I),I.vsub(o,k),b)return!0;let T=this.createContactEquation(h,d,e,i,p,u);T.ni.copy(k),T.ni.normalize(),T.ri.copy(T.ni),T.ri.scale(e.radius,T.ri),T.ri.vadd(o,T.ri),T.ri.vsub(h.position,T.ri),T.rj.copy(I),T.rj.vsub(d.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}for(let B=0;B<M.length;B++)for(let R=0;R<3;R++){i.getVertex(i.indices[M[B]*3+R],f),i.getVertex(i.indices[M[B]*3+(R+1)%3],w),w.vsub(f,g),y.vsub(w,P);const T=P.dot(g);y.vsub(f,P);let A=P.dot(g);if(A>0&&T<0&&(y.vsub(f,P),C.copy(g),C.normalize(),A=P.dot(C),C.scale(A,P),P.vadd(f,P),P.distanceTo(y)<e.radius)){if(b)return!0;const W=this.createContactEquation(h,d,e,i,p,u);P.vsub(y,W.ni),W.ni.normalize(),W.ni.scale(e.radius,W.ri),W.ri.vadd(o,W.ri),W.ri.vsub(h.position,W.ri),tt.pointToWorldFrame(r,c,P,P),P.vsub(d.position,W.rj),tt.vectorToWorldFrame(c,W.ni,W.ni),tt.vectorToWorldFrame(c,W.ri,W.ri),this.result.push(W),this.createFrictionEquationsFromContact(W,this.frictionResult)}}const H=Wh,N=Kh,z=$h,q=Rh;for(let B=0,R=M.length;B!==R;B++){i.getTriangleVertices(M[B],H,N,z),i.getNormal(M[B],q),y.vsub(H,P);let T=P.dot(q);if(q.scale(T,P),y.vsub(P,P),T=P.distanceTo(y),ct.pointInTriangle(P,H,N,z)&&T<e.radius){if(b)return!0;let A=this.createContactEquation(h,d,e,i,p,u);P.vsub(y,A.ni),A.ni.normalize(),A.ni.scale(e.radius,A.ri),A.ri.vadd(o,A.ri),A.ri.vsub(h.position,A.ri),tt.pointToWorldFrame(r,c,P,P),P.vsub(d.position,A.rj),tt.vectorToWorldFrame(c,A.ni,A.ni),tt.vectorToWorldFrame(c,A.ri,A.ri),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}}M.length=0}planeTrimesh(e,i,o,r,a,c,h,d,p,u,b){const f=new m,w=Th;w.set(0,0,1),a.vmult(w,w);for(let g=0;g<i.vertices.length/3;g++){i.getVertex(g,f);const C=new m;C.copy(f),tt.pointToWorldFrame(r,c,C,f);const y=Lh;if(f.vsub(o,y),w.dot(y)<=0){if(b)return!0;const _=this.createContactEquation(h,d,e,i,p,u);_.ni.copy(w);const S=Nh;w.scale(y.dot(w),S),f.vsub(S,S),_.ri.copy(S),_.ri.vsub(h.position,_.ri),_.rj.copy(f),_.rj.vsub(d.position,_.rj),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}}}const le=new m,Ce=new m,Ee=new m,Sh=new m,Vh=new m,Bh=new lt,zh=new lt,Th=new m,Lh=new m,Nh=new m,Rh=new m,Ih=new m;new m;const Fh=new m,Dh=new m,Oh=new m,qh=new m,jh=new m,Uh=new m,Hh=new m,Gh=new m,Wh=new m,Kh=new m,$h=new m,Yh=new at,Xh=[],_n=new m,Ks=new m,Zh=new m,Qh=new m,Jh=new m;function td(L,e,i){let o=null;const r=L.length;for(let a=0;a!==r;a++){const c=L[a],h=Zh;L[(a+1)%r].vsub(c,h);const d=Qh;h.cross(e,d);const p=Jh;i.vsub(c,p);const u=d.dot(p);if(o===null||u>0&&o===!0||u<=0&&o===!1){o===null&&(o=u>0);continue}else return!1}return!0}const yn=new m,ed=new m,nd=new m,id=new m,sd=[new m,new m,new m,new m,new m,new m],od=new m,rd=new m,ad=new m,ld=new m,cd=new m,hd=new m,dd=new m,pd=new m,ud=new m,vd=new m,md=new m,fd=new m,bd=new m,wd=new m;new m;new m;const gd=new m,_d=new m,yd=new m,xd=new m,Cd=new m,Ed=new m,Pd=new m,Ad=new m,kd=new m,Md=new m,$s=new lt,Sd=new m;new m;const Vd=new m,Ys=new m,Bd=new m,zd=new m,Td=new m,Ld=[0],Nd=new m,Rd=new m;class Xs{constructor(){this.current=[],this.previous=[]}getKey(e,i){if(i<e){const o=i;i=e,e=o}return e<<16|i}set(e,i){const o=this.getKey(e,i),r=this.current;let a=0;for(;o>r[a];)a++;if(o!==r[a]){for(let c=r.length-1;c>=a;c--)r[c+1]=r[c];r[a]=o}}tick(){const e=this.current;this.current=this.previous,this.previous=e,this.current.length=0}getDiff(e,i){const o=this.current,r=this.previous,a=o.length,c=r.length;let h=0;for(let d=0;d<a;d++){let p=!1;const u=o[d];for(;u>r[h];)h++;p=u===r[h],p||Zs(e,u)}h=0;for(let d=0;d<c;d++){let p=!1;const u=r[d];for(;u>o[h];)h++;p=o[h]===u,p||Zs(i,u)}}}function Zs(L,e){L.push((e&4294901760)>>16,e&65535)}const vi=(L,e)=>L<e?`${L}-${e}`:`${e}-${L}`;class Id{constructor(){this.data={keys:[]}}get(e,i){const o=vi(e,i);return this.data[o]}set(e,i,o){const r=vi(e,i);this.get(e,i)||this.data.keys.push(r),this.data[r]=o}delete(e,i){const o=vi(e,i),r=this.data.keys.indexOf(o);r!==-1&&this.data.keys.splice(r,1),delete this.data[o]}reset(){const e=this.data,i=e.keys;for(;i.length>0;){const o=i.pop();delete e[o]}}}class Fd extends Js{constructor(e){e===void 0&&(e={});super();this.dt=-1,this.allowSleep=!!e.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=e.quatNormalizeSkip!==void 0?e.quatNormalizeSkip:0,this.quatNormalizeFast=e.quatNormalizeFast!==void 0?e.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new m,e.gravity&&this.gravity.copy(e.gravity),this.broadphase=e.broadphase!==void 0?e.broadphase:new Mc,this.bodies=[],this.hasActiveBodies=!1,this.solver=e.solver!==void 0?e.solver:new xh,this.constraints=[],this.narrowphase=new Mh(this),this.collisionMatrix=new Ss,this.collisionMatrixPrevious=new Ss,this.bodyOverlapKeeper=new Xs,this.shapeOverlapKeeper=new Xs,this.contactmaterials=[],this.contactMaterialTable=new Id,this.defaultMaterial=new Qe("default"),this.defaultContactMaterial=new Ze(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(e,i){return this.contactMaterialTable.get(e.id,i.id)}collisionMatrixTick(){const e=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=e,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(e){this.constraints.push(e)}removeConstraint(e){const i=this.constraints.indexOf(e);i!==-1&&this.constraints.splice(i,1)}rayTest(e,i,o){o instanceof xn?this.raycastClosest(e,i,{skipBackfaces:!0},o):this.raycastAll(e,i,{skipBackfaces:!0},o)}raycastAll(e,i,o,r){return o===void 0&&(o={}),o.mode=ct.ALL,o.from=e,o.to=i,o.callback=r,mi.intersectWorld(this,o)}raycastAny(e,i,o,r){return o===void 0&&(o={}),o.mode=ct.ANY,o.from=e,o.to=i,o.result=r,mi.intersectWorld(this,o)}raycastClosest(e,i,o,r){return o===void 0&&(o={}),o.mode=ct.CLOSEST,o.from=e,o.to=i,o.result=r,mi.intersectWorld(this,o)}addBody(e){this.bodies.includes(e)||(e.index=this.bodies.length,this.bodies.push(e),e.world=this,e.initPosition.copy(e.position),e.initVelocity.copy(e.velocity),e.timeLastSleepy=this.time,e instanceof U&&(e.initAngularVelocity.copy(e.angularVelocity),e.initQuaternion.copy(e.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=e,this.idToBodyMap[e.id]=e,this.dispatchEvent(this.addBodyEvent))}removeBody(e){e.world=null;const i=this.bodies.length-1,o=this.bodies,r=o.indexOf(e);if(r!==-1){o.splice(r,1);for(let a=0;a!==o.length;a++)o[a].index=a;this.collisionMatrix.setNumObjects(i),this.removeBodyEvent.body=e,delete this.idToBodyMap[e.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(e){return this.idToBodyMap[e]}getShapeById(e){const i=this.bodies;for(let o=0;o<i.length;o++){const r=i[o].shapes;for(let a=0;a<r.length;a++){const c=r[a];if(c.id===e)return c}}return null}addContactMaterial(e){this.contactmaterials.push(e),this.contactMaterialTable.set(e.materials[0].id,e.materials[1].id,e)}removeContactMaterial(e){const i=this.contactmaterials.indexOf(e);i!==-1&&(this.contactmaterials.splice(i,1),this.contactMaterialTable.delete(e.materials[0].id,e.materials[1].id))}fixedStep(e,i){e===void 0&&(e=1/60),i===void 0&&(i=10);const o=ht.now()/1e3;if(!this.lastCallTime)this.step(e,void 0,i);else{const r=o-this.lastCallTime;this.step(e,r,i)}this.lastCallTime=o}step(e,i,o){if(o===void 0&&(o=10),i===void 0)this.internalStep(e),this.time+=e;else{this.accumulator+=i;const r=ht.now();let a=0;for(;this.accumulator>=e&&a<o&&(this.internalStep(e),this.accumulator-=e,a++,!(ht.now()-r>e*1e3)););this.accumulator=this.accumulator%e;const c=this.accumulator/e;for(let h=0;h!==this.bodies.length;h++){const d=this.bodies[h];d.previousPosition.lerp(d.position,c,d.interpolatedPosition),d.previousQuaternion.slerp(d.quaternion,c,d.interpolatedQuaternion),d.previousQuaternion.normalize()}this.time+=i}}internalStep(e){this.dt=e;const i=this.contacts,o=Ud,r=Hd,a=this.bodies.length,c=this.bodies,h=this.solver,d=this.gravity,p=this.doProfiling,u=this.profile,b=U.DYNAMIC;let f=-1/0;const w=this.constraints,g=jd;d.length();const C=d.x,y=d.y,P=d.z;let _=0;for(p&&(f=ht.now()),_=0;_!==a;_++){const B=c[_];if(B.type===b){const R=B.force,T=B.mass;R.x+=T*C,R.y+=T*y,R.z+=T*P}}for(let B=0,R=this.subsystems.length;B!==R;B++)this.subsystems[B].update();p&&(f=ht.now()),o.length=0,r.length=0,this.broadphase.collisionPairs(this,o,r),p&&(u.broadphase=ht.now()-f);let S=w.length;for(_=0;_!==S;_++){const B=w[_];if(!B.collideConnected)for(let R=o.length-1;R>=0;R-=1)(B.bodyA===o[R]&&B.bodyB===r[R]||B.bodyB===o[R]&&B.bodyA===r[R])&&(o.splice(R,1),r.splice(R,1))}this.collisionMatrixTick(),p&&(f=ht.now());const k=qd,M=i.length;for(_=0;_!==M;_++)k.push(i[_]);i.length=0;const V=this.frictionEquations.length;for(_=0;_!==V;_++)g.push(this.frictionEquations[_]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(o,r,this,i,k,this.frictionEquations,g),p&&(u.narrowphase=ht.now()-f),p&&(f=ht.now()),_=0;_<this.frictionEquations.length;_++)h.addEquation(this.frictionEquations[_]);const I=i.length;for(let B=0;B!==I;B++){const R=i[B],T=R.bi,A=R.bj,X=R.si,W=R.sj;let $;if(T.material&&A.material?$=this.getContactMaterial(T.material,A.material)||this.defaultContactMaterial:$=this.defaultContactMaterial,$.friction,T.material&&A.material&&(T.material.friction>=0&&A.material.friction>=0&&T.material.friction*A.material.friction,T.material.restitution>=0&&A.material.restitution>=0&&(R.restitution=T.material.restitution*A.material.restitution)),h.addEquation(R),T.allowSleep&&T.type===U.DYNAMIC&&T.sleepState===U.SLEEPING&&A.sleepState===U.AWAKE&&A.type!==U.STATIC){const Y=A.velocity.lengthSquared()+A.angularVelocity.lengthSquared(),nt=A.sleepSpeedLimit**2;Y>=nt*2&&(T.wakeUpAfterNarrowphase=!0)}if(A.allowSleep&&A.type===U.DYNAMIC&&A.sleepState===U.SLEEPING&&T.sleepState===U.AWAKE&&T.type!==U.STATIC){const Y=T.velocity.lengthSquared()+T.angularVelocity.lengthSquared(),nt=T.sleepSpeedLimit**2;Y>=nt*2&&(A.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(T,A,!0),this.collisionMatrixPrevious.get(T,A)||(Ke.body=A,Ke.contact=R,T.dispatchEvent(Ke),Ke.body=T,A.dispatchEvent(Ke)),this.bodyOverlapKeeper.set(T.id,A.id),this.shapeOverlapKeeper.set(X.id,W.id)}for(this.emitContactEvents(),p&&(u.makeContactConstraints=ht.now()-f,f=ht.now()),_=0;_!==a;_++){const B=c[_];B.wakeUpAfterNarrowphase&&(B.wakeUp(),B.wakeUpAfterNarrowphase=!1)}for(S=w.length,_=0;_!==S;_++){const B=w[_];B.update();for(let R=0,T=B.equations.length;R!==T;R++){const A=B.equations[R];h.addEquation(A)}}h.solve(e,this),p&&(u.solve=ht.now()-f),h.removeAllEquations();const F=Math.pow;for(_=0;_!==a;_++){const B=c[_];if(B.type&b){const R=F(1-B.linearDamping,e),T=B.velocity;T.scale(R,T);const A=B.angularVelocity;if(A){const X=F(1-B.angularDamping,e);A.scale(X,A)}}}this.dispatchEvent(Od),p&&(f=ht.now());const N=this.stepnumber%(this.quatNormalizeSkip+1)===0,z=this.quatNormalizeFast;for(_=0;_!==a;_++)c[_].integrate(e,N,z);this.clearForces(),this.broadphase.dirty=!0,p&&(u.integrate=ht.now()-f),this.stepnumber+=1,this.dispatchEvent(Dd);let q=!0;if(this.allowSleep)for(q=!1,_=0;_!==a;_++){const B=c[_];B.sleepTick(this.time),B.sleepState!==U.SLEEPING&&(q=!0)}this.hasActiveBodies=q}emitContactEvents(){const e=this.hasAnyEventListener("beginContact"),i=this.hasAnyEventListener("endContact");if((e||i)&&this.bodyOverlapKeeper.getDiff(Rt,It),e){for(let a=0,c=Rt.length;a<c;a+=2)$e.bodyA=this.getBodyById(Rt[a]),$e.bodyB=this.getBodyById(Rt[a+1]),this.dispatchEvent($e);$e.bodyA=$e.bodyB=null}if(i){for(let a=0,c=It.length;a<c;a+=2)Ye.bodyA=this.getBodyById(It[a]),Ye.bodyB=this.getBodyById(It[a+1]),this.dispatchEvent(Ye);Ye.bodyA=Ye.bodyB=null}Rt.length=It.length=0;const o=this.hasAnyEventListener("beginShapeContact"),r=this.hasAnyEventListener("endShapeContact");if((o||r)&&this.shapeOverlapKeeper.getDiff(Rt,It),o){for(let a=0,c=Rt.length;a<c;a+=2){const h=this.getShapeById(Rt[a]),d=this.getShapeById(Rt[a+1]);Ft.shapeA=h,Ft.shapeB=d,h&&(Ft.bodyA=h.body),d&&(Ft.bodyB=d.body),this.dispatchEvent(Ft)}Ft.bodyA=Ft.bodyB=Ft.shapeA=Ft.shapeB=null}if(r){for(let a=0,c=It.length;a<c;a+=2){const h=this.getShapeById(It[a]),d=this.getShapeById(It[a+1]);Dt.shapeA=h,Dt.shapeB=d,h&&(Dt.bodyA=h.body),d&&(Dt.bodyB=d.body),this.dispatchEvent(Dt)}Dt.bodyA=Dt.bodyB=Dt.shapeA=Dt.shapeB=null}}clearForces(){const e=this.bodies,i=e.length;for(let o=0;o!==i;o++){const r=e[o];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}}}new at;const mi=new ct,ht=globalThis.performance||{};if(!ht.now){let L=Date.now();ht.timing&&ht.timing.navigationStart&&(L=ht.timing.navigationStart),ht.now=()=>Date.now()-L}new m;const Dd={type:"postStep"},Od={type:"preStep"},Ke={type:U.COLLIDE_EVENT_NAME,body:null,contact:null},qd=[],jd=[],Ud=[],Hd=[],Rt=[],It=[],$e={type:"beginContact",bodyA:null,bodyB:null},Ye={type:"endContact",bodyA:null,bodyB:null},Ft={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Dt={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var fi={exports:{}};/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */(function(L,e){(function(i,o){o(e)})($l,function(i){class o{constructor(t){const[n,l]=t.split("-"),v=n.split(".");this.major=parseInt(v[0],10),this.minor=parseInt(v[1],10),this.patch=parseInt(v[2],10),this.prerelease=l!=null?l:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class r{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class a{constructor(t){this.target=t}}class c extends a{constructor(t,n,l,v){super(t);this.value=n,this.presetKey=l,this.last=v!=null?v:!0}}class h extends a{constructor(t,n,l){super(t);this.value=n,this.presetKey=l}}class d extends a{constructor(t,n){super(t);this.expanded=n}}function p(s){return s}function u(s){return s==null}function b(s,t){if(s.length!==t.length)return!1;for(let n=0;n<s.length;n++)if(s[n]!==t[n])return!1;return!0}const f={alreadydisposed:()=>"View has been already disposed",invalidparams:s=>`Invalid parameters for '${s.name}'`,nomatchingcontroller:s=>`No matching controller for '${s.key}'`,nomatchingview:s=>`No matching view for '${JSON.stringify(s.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:s=>`Property '${s.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class w{constructor(t){var n;this.message=(n=f[t.type](t.context))!==null&&n!==void 0?n:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new w({type:"alreadydisposed"})}static notBindable(){return new w({type:"notbindable"})}static propertyNotFound(t){return new w({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new w({type:"shouldneverhappen"})}}class g{constructor(t,n,l){this.obj_=t,this.key_=n,this.presetKey_=l!=null?l:n}static isBindable(t){return!(t===null||typeof t!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,n){const l=this.read();if(!g.isBindable(l))throw w.notBindable();if(!(t in l))throw w.propertyNotFound(t);l[t]=n}}class C extends r{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,n){const l=n.bind(this);return this.controller_.valueController.emitter.on(t,()=>{l(new a(this))}),this}}class y{constructor(){this.observers_={}}on(t,n){let l=this.observers_[t];return l||(l=this.observers_[t]=[]),l.push({handler:n}),this}off(t,n){const l=this.observers_[t];return l&&(this.observers_[t]=l.filter(v=>v.handler!==n)),this}emit(t,n){const l=this.observers_[t];!l||l.forEach(v=>{v.handler(n)})}}const P="tp";function _(s){return(n,l)=>[P,"-",s,"v",n?`_${n}`:"",l?`-${l}`:""].join("")}function S(s,t){return n=>t(s(n))}function k(s){return s.rawValue}function M(s,t){s.emitter.on("change",S(k,t)),t(s.rawValue)}function V(s,t,n){M(s.value(t),n)}function I(s,t,n){n?s.classList.add(t):s.classList.remove(t)}function F(s,t){return n=>{I(s,t,n)}}function H(s,t){M(s,n=>{t.textContent=n!=null?n:""})}const N=_("btn");class z{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(N()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("button");l.classList.add(N("b")),n.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const v=t.createElement("div");v.classList.add(N("t")),H(n.props.value("title"),v),this.buttonElement.appendChild(v)}}class q{constructor(t,n){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new z(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class B{constructor(t,n){var l;this.constraint_=n==null?void 0:n.constraint,this.equals_=(l=n==null?void 0:n.equals)!==null&&l!==void 0?l:(v,x)=>v===x,this.emitter=new y,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,n){const l=n!=null?n:{forceEmit:!1,last:!0},v=this.constraint_?this.constraint_.constrain(t):t;!!this.equals_(this.rawValue_,v)&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=v,this.emitter.emit("change",{options:l,rawValue:v,sender:this}))}}class R{constructor(t){this.emitter=new y,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,n){const l=n!=null?n:{forceEmit:!1,last:!0};this.value_===t&&!l.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:l,rawValue:this.value_,sender:this}))}}function T(s,t){const n=t==null?void 0:t.constraint,l=t==null?void 0:t.equals;return!n&&!l?new R(s):new B(s,t)}class A{constructor(t){this.emitter=new y,this.valMap_=t;for(const n in this.valMap_)this.valMap_[n].emitter.on("change",()=>{this.emitter.emit("change",{key:n,sender:this})})}static createCore(t){return Object.keys(t).reduce((l,v)=>Object.assign(l,{[v]:T(t[v])}),{})}static fromObject(t){const n=this.createCore(t);return new A(n)}get(t){return this.valMap_[t].rawValue}set(t,n){this.valMap_[t].rawValue=n}value(t){return this.valMap_[t]}}function X(s,t){const l=Object.keys(t).reduce((v,x)=>{if(v===void 0)return;const D=t[x](s[x]);return D.succeeded?Object.assign(Object.assign({},v),{[x]:D.value}):void 0},{});return l}function W(s,t){return s.reduce((n,l)=>{if(n===void 0)return;const v=t(l);if(!(!v.succeeded||v.value===void 0))return[...n,v.value]},[])}function $(s){return s===null?!1:typeof s=="object"}function Y(s){return t=>n=>{if(!t&&n===void 0)return{succeeded:!1,value:void 0};if(t&&n===void 0)return{succeeded:!0,value:void 0};const l=s(n);return l!==void 0?{succeeded:!0,value:l}:{succeeded:!1,value:void 0}}}function nt(s){return{custom:t=>Y(t)(s),boolean:Y(t=>typeof t=="boolean"?t:void 0)(s),number:Y(t=>typeof t=="number"?t:void 0)(s),string:Y(t=>typeof t=="string"?t:void 0)(s),function:Y(t=>typeof t=="function"?t:void 0)(s),constant:t=>Y(n=>n===t?t:void 0)(s),raw:Y(t=>t)(s),object:t=>Y(n=>{if(!!$(n))return X(n,t)})(s),array:t=>Y(n=>{if(!!Array.isArray(n))return W(n,t)})(s)}}const j={optional:nt(!0),required:nt(!1)};function Q(s,t){const n=j.required.object(t)(s);return n.succeeded?n.value:void 0}function Pt(s){return s&&s.parentElement&&s.parentElement.removeChild(s),null}function zt(){return["veryfirst","first","last","verylast"]}const Xt=_(""),Zt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class dt{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const n=this.view.element;this.blade.value("positions").emitter.on("change",()=>{zt().forEach(l=>{n.classList.remove(Xt(void 0,Zt[l]))}),this.blade.get("positions").forEach(l=>{n.classList.add(Xt(void 0,Zt[l]))})}),this.viewProps.handleDispose(()=>{Pt(n)})}get parent(){return this.parent_}}const bt="http://www.w3.org/2000/svg";function he(s){s.offsetHeight}function de(s,t){const n=s.style.transition;s.style.transition="none",t(),s.style.transition=n}function pt(s){return s.ontouchstart!==void 0}function Pn(){return new Function("return this")()}function Qt(){return Pn().document}function yt(s){const t=s.ownerDocument.defaultView;return t&&"document"in t?s.getContext("2d"):null}const An={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function pe(s,t){const n=s.createElementNS(bt,"svg");return n.innerHTML=An[t],n}function Jt(s,t,n){s.insertBefore(t,s.children[n])}function xt(s){s.parentElement&&s.parentElement.removeChild(s)}function _i(s){for(;s.children.length>0;)s.removeChild(s.children[0])}function ho(s){for(;s.childNodes.length>0;)s.removeChild(s.childNodes[0])}function yi(s){return s.relatedTarget?s.relatedTarget:"explicitOriginalTarget"in s?s.explicitOriginalTarget:null}const Me=_("lbl");function po(s,t){const n=s.createDocumentFragment();return t.split(`
`).map(v=>s.createTextNode(v)).forEach((v,x)=>{x>0&&n.appendChild(s.createElement("br")),n.appendChild(v)}),n}class xi{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Me()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("div");l.classList.add(Me("l")),V(n.props,"label",x=>{u(x)?this.element.classList.add(Me(void 0,"nol")):(this.element.classList.remove(Me(void 0,"nol")),ho(l),l.appendChild(po(t,x)))}),this.element.appendChild(l),this.labelElement=l;const v=t.createElement("div");v.classList.add(Me("v")),this.element.appendChild(v),this.valueElement=v}}class Je extends dt{constructor(t,n){const l=n.valueController.viewProps;super(Object.assign(Object.assign({},n),{view:new xi(t,{props:n.props,viewProps:l}),viewProps:l}));this.props=n.props,this.valueController=n.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const uo={id:"button",type:"blade",accept(s){const t=j,n=Q(s,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return n?{params:n}:null},controller(s){return new Je(s.document,{blade:s.blade,props:A.fromObject({label:s.params.label}),valueController:new q(s.document,{props:A.fromObject({title:s.params.title}),viewProps:s.viewProps})})},api(s){return!(s.controller instanceof Je)||!(s.controller.valueController instanceof q)?null:new C(s.controller)}};class ue extends dt{constructor(t){super(t);this.value=t.value}}function Se(){return new A({positions:T([],{equals:b})})}class Ve extends A{constructor(t){super(t)}static create(t){const n={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},l=A.createCore(n);return new Ve(l)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!u(t)?`${t}px`:"auto"}bindExpandedClass(t,n){const l=()=>{this.styleExpanded?t.classList.add(n):t.classList.remove(n)};V(this,"expanded",l),V(this,"temporaryExpanded",l)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function vo(s,t){let n=0;return de(t,()=>{s.set("expandedHeight",null),s.set("temporaryExpanded",!0),he(t),n=t.clientHeight,s.set("temporaryExpanded",null),he(t)}),n}function Ci(s,t){t.style.height=s.styleHeight}function kn(s,t){s.value("expanded").emitter.on("beforechange",()=>{s.set("completed",!1),u(s.get("expandedHeight"))&&s.set("expandedHeight",vo(s,t)),s.set("shouldFixHeight",!0),he(t)}),s.emitter.on("change",()=>{Ci(s,t)}),Ci(s,t),t.addEventListener("transitionend",n=>{n.propertyName==="height"&&s.cleanUpTransition()})}class Mn extends r{constructor(t,n){super(t);this.rackApi_=n}}function mo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function fo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function bo(s,t){const n=t||{};return s.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function wo(s,t){return s.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class Sn{constructor(t){this.emitter=new y,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const n of this.allItems())if(t(n))return n;return null}includes(t){return this.cache_.has(t)}add(t,n){if(this.includes(t))throw w.shouldNeverHappen();const l=n!==void 0?n:this.items_.length;this.items_.splice(l,0,t),this.cache_.add(t);const v=this.extract_(t);v&&(v.emitter.on("add",this.onSubListAdd_),v.emitter.on("remove",this.onSubListRemove_),v.allItems().forEach(x=>{this.cache_.add(x)})),this.emitter.emit("add",{index:l,item:t,root:this,target:this})}remove(t){const n=this.items_.indexOf(t);if(n<0)return;this.items_.splice(n,1),this.cache_.delete(t);const l=this.extract_(t);l&&(l.emitter.off("add",this.onSubListAdd_),l.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:n,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class Vn extends r{constructor(t){super(t);this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const n=t.sender.target.read();this.emitter_.emit("change",{event:new c(this,n,this.controller_.binding.target.presetKey,t.options.last)})}}class At extends Je{constructor(t,n){super(t,n);this.binding=n.binding}}class Bn extends r{constructor(t){super(t);this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const n=t.sender.target.read();this.emitter_.emit("update",{event:new h(this,n,this.controller_.binding.target.presetKey)})}}class qt extends Je{constructor(t,n){super(t,n);this.binding=n.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function go(s){return s instanceof tn?s.apiSet_:s instanceof Mn?s.rackApi_.apiSet_:null}function Be(s,t){const n=s.find(l=>l.controller_===t);if(!n)throw w.shouldNeverHappen();return n}function Ei(s,t,n){if(!g.isBindable(s))throw w.notBindable();return new g(s,t,n)}class tn extends r{constructor(t,n){super(t);this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new y,this.apiSet_=new Sn(go),this.pool_=n;const l=this.controller_.rack;l.emitter.on("add",this.onRackAdd_),l.emitter.on("remove",this.onRackRemove_),l.emitter.on("inputchange",this.onRackInputChange_),l.emitter.on("monitorupdate",this.onRackMonitorUpdate_),l.children.forEach(v=>{this.setUpApi_(v)})}get children(){return this.controller_.rack.children.map(t=>Be(this.apiSet_,t))}addInput(t,n,l){const v=l||{},x=this.controller_.view.element.ownerDocument,E=this.pool_.createInput(x,Ei(t,n,v.presetKey),v),D=new Vn(E);return this.add(D,v.index)}addMonitor(t,n,l){const v=l||{},x=this.controller_.view.element.ownerDocument,E=this.pool_.createMonitor(x,Ei(t,n),v),D=new Bn(E);return this.add(D,v.index)}addFolder(t){return fo(this,t)}addButton(t){return mo(this,t)}addSeparator(t){return bo(this,t)}addTab(t){return wo(this,t)}add(t,n){this.controller_.rack.add(t.controller_,n);const l=this.apiSet_.find(v=>v.controller_===t.controller_);return l&&this.apiSet_.remove(l),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const n=this.controller_.view.element.ownerDocument,l=this.pool_.createBlade(n,t),v=this.pool_.createBladeApi(l);return this.add(v,t.index)}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}setUpApi_(t){this.apiSet_.find(l=>l.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const n=Be(this.apiSet_,t.bladeController);this.apiSet_.remove(n)}}onRackInputChange_(t){const n=t.bladeController;if(n instanceof At){const l=Be(this.apiSet_,n),v=n.binding;this.emitter_.emit("change",{event:new c(l,v.target.read(),v.target.presetKey,t.options.last)})}else if(n instanceof ue){const l=Be(this.apiSet_,n);this.emitter_.emit("change",{event:new c(l,n.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof qt))throw w.shouldNeverHappen();const n=Be(this.apiSet_,t.bladeController),l=t.bladeController.binding;this.emitter_.emit("update",{event:new h(n,l.target.read(),l.target.presetKey)})}}class zn extends Mn{constructor(t,n){super(t,new tn(t.rackController,n));this.emitter_=new y,this.controller_.foldable.value("expanded").emitter.on("change",l=>{this.emitter_.emit("fold",{event:new d(this,l.sender.rawValue)})}),this.rackApi_.on("change",l=>{this.emitter_.emit("change",{event:l})}),this.rackApi_.on("update",l=>{this.emitter_.emit("update",{event:l})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,n,l){return this.rackApi_.addInput(t,n,l)}addMonitor(t,n,l){return this.rackApi_.addMonitor(t,n,l)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,n){return this.rackApi_.add(t,n)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}}class Tn extends dt{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps});this.rackController=t.rackController}}class _o{constructor(t,n){const l=_(n.viewName);this.element=t.createElement("div"),this.element.classList.add(l()),n.viewProps.bindClassModifiers(this.element)}}function yo(s,t){for(let n=0;n<s.length;n++){const l=s[n];if(l instanceof At&&l.binding===t)return l}return null}function xo(s,t){for(let n=0;n<s.length;n++){const l=s[n];if(l instanceof qt&&l.binding===t)return l}return null}function Co(s,t){for(let n=0;n<s.length;n++){const l=s[n];if(l instanceof ue&&l.value===t)return l}return null}function Ln(s){return s instanceof ze?s.rack:s instanceof Tn?s.rackController.rack:null}function Eo(s){const t=Ln(s);return t?t.bcSet_:null}class Po{constructor(t){var n;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new y,this.blade_=t!=null?t:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Sn(Eo),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,n){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,n)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(n=>n instanceof t)}onSetAdd_(t){this.updatePositions_();const n=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:n,sender:this}),!n)return;const l=t.item;if(l.viewProps.emitter.on("change",this.onChildViewPropsChange_),l.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),l.viewProps.handleDispose(this.onChildDispose_),l instanceof At)l.binding.emitter.on("change",this.onChildInputChange_);else if(l instanceof qt)l.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(l instanceof ue)l.value.emitter.on("change",this.onChildValueChange_);else{const v=Ln(l);if(v){const x=v.emitter;x.on("layout",this.onDescendantLayout_),x.on("inputchange",this.onDescendantInputChange_),x.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const n=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:n,sender:this}),!n)return;const l=t.item;if(l instanceof At)l.binding.emitter.off("change",this.onChildInputChange_);else if(l instanceof qt)l.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(l instanceof ue)l.value.emitter.off("change",this.onChildValueChange_);else{const v=Ln(l);if(v){const x=v.emitter;x.off("layout",this.onDescendantLayout_),x.off("inputchange",this.onDescendantInputChange_),x.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(v=>!v.viewProps.get("hidden")),n=t[0],l=t[t.length-1];this.bcSet_.items.forEach(v=>{const x=[];v===n&&(x.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&x.push("veryfirst")),v===l&&(x.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&x.push("verylast")),v.blade.set("positions",x)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(n=>n.viewProps.get("disposed")).forEach(n=>{this.bcSet_.remove(n)})}onChildInputChange_(t){const n=yo(this.find(At),t.sender);if(!n)throw w.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:n,options:t.options,sender:this})}onChildMonitorUpdate_(t){const n=xo(this.find(qt),t.sender);if(!n)throw w.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:n,sender:this})}onChildValueChange_(t){const n=Co(this.find(ue),t.sender);if(!n)throw w.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:n,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class ze extends dt{constructor(t,n){super(Object.assign(Object.assign({},n),{view:new _o(t,{viewName:"brk",viewProps:n.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const l=new Po(n.root?void 0:n.blade);l.emitter.on("add",this.onRackAdd_),l.emitter.on("remove",this.onRackRemove_),this.rack=l,this.viewProps.handleDispose(()=>{for(let v=this.rack.children.length-1;v>=0;v--)this.rack.children[v].viewProps.set("disposed",!0)})}onRackAdd_(t){!t.isRoot||Jt(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){!t.isRoot||xt(t.bladeController.view.element)}}const Pi=_("cnt");class Ao{constructor(t,n){this.className_=_(n.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Pi()),n.viewProps.bindClassModifiers(this.element),this.foldable_=n.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),V(this.foldable_,"completed",F(this.element,this.className_(void 0,"cpl")));const l=t.createElement("button");l.classList.add(this.className_("b")),V(n.props,"title",D=>{u(D)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),n.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const v=t.createElement("div");v.classList.add(this.className_("t")),H(n.props.value("title"),v),this.buttonElement.appendChild(v),this.titleElement=v;const x=t.createElement("div");x.classList.add(this.className_("m")),this.buttonElement.appendChild(x);const E=n.containerElement;E.classList.add(this.className_("c")),this.element.appendChild(E),this.containerElement=E}}class Nn extends Tn{constructor(t,n){var l;const v=Ve.create((l=n.expanded)!==null&&l!==void 0?l:!0),x=new ze(t,{blade:n.blade,root:n.root,viewProps:n.viewProps});super(Object.assign(Object.assign({},n),{rackController:x,view:new Ao(t,{containerElement:x.view.element,foldable:v,props:n.props,viewName:n.root?"rot":void 0,viewProps:n.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this),this.props=n.props,this.foldable=v,kn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ko={id:"folder",type:"blade",accept(s){const t=j,n=Q(s,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return n?{params:n}:null},controller(s){return new Nn(s.document,{blade:s.blade,expanded:s.params.expanded,props:A.fromObject({title:s.params.title}),viewProps:s.viewProps})},api(s){return s.controller instanceof Nn?new zn(s.controller,s.pool):null}};class ve extends ue{constructor(t,n){const l=n.valueController.viewProps;super(Object.assign(Object.assign({},n),{value:n.valueController.value,view:new xi(t,{props:n.props,viewProps:l}),viewProps:l}));this.props=n.props,this.valueController=n.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Ai extends r{}const ki=_("spr");class Mo{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(ki()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("hr");l.classList.add(ki("r")),this.element.appendChild(l)}}class Mi extends dt{constructor(t,n){super(Object.assign(Object.assign({},n),{view:new Mo(t,{viewProps:n.viewProps})}))}}const So={id:"separator",type:"blade",accept(s){const n=Q(s,{view:j.required.constant("separator")});return n?{params:n}:null},controller(s){return new Mi(s.document,{blade:s.blade,viewProps:s.viewProps})},api(s){return s.controller instanceof Mi?new Ai(s.controller):null}},Vo=_("");function Si(s,t){return F(s,Vo(void 0,t))}class jt extends A{constructor(t){super(t)}static create(t){var n,l;const v=t!=null?t:{},x={disabled:(n=v.disabled)!==null&&n!==void 0?n:!1,disposed:!1,hidden:(l=v.hidden)!==null&&l!==void 0?l:!1},E=A.createCore(x);return new jt(E)}bindClassModifiers(t){V(this,"disabled",Si(t,"disabled")),V(this,"hidden",Si(t,"hidden"))}bindDisabled(t){V(this,"disabled",n=>{t.disabled=n})}bindTabIndex(t){V(this,"disabled",n=>{t.tabIndex=n?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",n=>{n&&t()})}}const Te=_("tbi");class Bo{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Te()),n.viewProps.bindClassModifiers(this.element),V(n.props,"selected",x=>{x?this.element.classList.add(Te(void 0,"sel")):this.element.classList.remove(Te(void 0,"sel"))});const l=t.createElement("button");l.classList.add(Te("b")),n.viewProps.bindDisabled(l),this.element.appendChild(l),this.buttonElement=l;const v=t.createElement("div");v.classList.add(Te("t")),H(n.props.value("title"),v),this.buttonElement.appendChild(v),this.titleElement=v}}class zo{constructor(t,n){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=n.props,this.viewProps=n.viewProps,this.view=new Bo(t,{props:n.props,viewProps:n.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Vi{constructor(t,n){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new zo(t,{props:n.itemProps,viewProps:jt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new ze(t,{blade:Se(),viewProps:jt.create()}),this.props=n.props,V(this.props,"selected",l=>{this.itemController.props.set("selected",l),this.contentController.viewProps.set("hidden",!l)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Bi{constructor(t,n){this.controller_=t,this.rackApi_=n}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,n){this.rackApi_.add(t,n)}remove(t){this.rackApi_.remove(t)}addInput(t,n,l){return this.rackApi_.addInput(t,n,l)}addMonitor(t,n,l){return this.rackApi_.addMonitor(t,n,l)}addBlade(t){return this.rackApi_.addBlade(t)}}class zi extends Mn{constructor(t,n){super(t,new tn(t.rackController,n));this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new y,this.pageApiMap_=new Map,this.rackApi_.on("change",l=>{this.emitter_.emit("change",{event:l})}),this.rackApi_.on("update",l=>{this.emitter_.emit("update",{event:l})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(l=>{this.setUpPageApi_(l)})}get pages(){return this.controller_.pageSet.items.map(t=>{const n=this.pageApiMap_.get(t);if(!n)throw w.shouldNeverHappen();return n})}addPage(t){const n=this.controller_.view.element.ownerDocument,l=new Vi(n,{itemProps:A.fromObject({selected:!1,title:t.title}),props:A.fromObject({selected:!1})});this.controller_.add(l,t.index);const v=this.pageApiMap_.get(l);if(!v)throw w.shouldNeverHappen();return v}removePage(t){this.controller_.remove(t)}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}setUpPageApi_(t){const n=this.rackApi_.apiSet_.find(v=>v.controller_===t.contentController);if(!n)throw w.shouldNeverHappen();const l=new Bi(t,n);this.pageApiMap_.set(t,l)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw w.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const en=_("tab");class To{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(en(),Pi()),n.viewProps.bindClassModifiers(this.element),M(n.empty,F(this.element,en(void 0,"nop")));const l=t.createElement("div");l.classList.add(en("i")),this.element.appendChild(l),this.itemsElement=l;const v=n.contentsElement;v.classList.add(en("c")),this.element.appendChild(v),this.contentsElement=v}}class Ti extends Tn{constructor(t,n){const l=new ze(t,{blade:n.blade,viewProps:n.viewProps}),v=T(!0);super({blade:n.blade,rackController:l,view:new To(t,{contentsElement:l.view.element,empty:v,viewProps:n.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Sn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=v,this.applyPages_()}get pageSet(){return this.pageSet_}add(t,n){this.pageSet_.add(t,n!=null?n:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(t){const n=t.item;Jt(this.view.itemsElement,n.itemController.view.element,t.index),this.rackController.rack.add(n.contentController,t.index),n.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const n=t.item;xt(n.itemController.view.element),this.rackController.rack.remove(n.contentController),n.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const t=this.pageSet_.items.findIndex(n=>n.props.get("selected"));t<0?this.pageSet_.items.forEach((n,l)=>{n.props.set("selected",l===0)}):this.pageSet_.items.forEach((n,l)=>{n.props.set("selected",l===t)})}onPageSelectedChange_(t){if(t.rawValue){const n=this.pageSet_.items.findIndex(l=>l.props.value("selected")===t.sender);this.pageSet_.items.forEach((l,v)=>{l.props.set("selected",v===n)})}else this.keepSelection_()}}const Li={id:"tab",type:"blade",accept(s){const t=j,n=Q(s,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!n||n.pages.length===0?null:{params:n}},controller(s){const t=new Ti(s.document,{blade:s.blade,viewProps:s.viewProps});return s.params.pages.forEach(n=>{const l=new Vi(s.document,{itemProps:A.fromObject({selected:!1,title:n.title}),props:A.fromObject({selected:!1})});t.add(l)}),t},api(s){return s.controller instanceof Ti?new zi(s.controller,s.pool):null}};function Lo(s,t){const n=s.accept(t.params);if(!n)return null;const l=j.optional.boolean(t.params.disabled).value,v=j.optional.boolean(t.params.hidden).value;return s.controller({blade:Se(),document:t.document,params:Object.assign(Object.assign({},n.params),{disabled:l,hidden:v}),viewProps:jt.create({disabled:l,hidden:v})})}class No{constructor(){this.disabled=!1,this.emitter=new y}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Ro{constructor(t,n){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new y,this.interval_=n,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class te{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((n,l)=>l.constrain(n),t)}}function kt(s,t){if(s instanceof t)return s;if(s instanceof te){const n=s.constraints.reduce((l,v)=>l||(v instanceof t?v:null),null);if(n)return n}return null}class Le{constructor(t){this.options=t}constrain(t){const n=this.options;return n.length===0||n.filter(v=>v.value===t).length>0?t:n[0].value}}class ft{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let n=t;return u(this.minValue)||(n=Math.max(n,this.minValue)),u(this.maxValue)||(n=Math.min(n,this.maxValue)),n}}class ee{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const Rn=_("lst");class Io{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.props_=n.props,this.element=t.createElement("div"),this.element.classList.add(Rn()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("select");l.classList.add(Rn("s")),V(this.props_,"options",x=>{_i(l),x.forEach((E,D)=>{const G=t.createElement("option");G.dataset.index=String(D),G.textContent=E.text,G.value=String(E.value),l.appendChild(G)})}),n.viewProps.bindDisabled(l),this.element.appendChild(l),this.selectElement=l;const v=t.createElement("div");v.classList.add(Rn("m")),v.appendChild(pe(t,"dropdown")),this.element.appendChild(v),n.value.emitter.on("change",this.onValueChange_),this.value_=n.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ne{constructor(t,n){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new Io(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const l=t.currentTarget.selectedOptions.item(0);if(!l)return;const v=Number(l.dataset.index);this.value.rawValue=this.props.get("options")[v].value}}const Ni=_("pop");class Fo{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Ni()),n.viewProps.bindClassModifiers(this.element),M(n.shows,F(this.element,Ni(void 0,"v")))}}class Ri{constructor(t,n){this.shows=T(!1),this.viewProps=n.viewProps,this.view=new Fo(t,{shows:this.shows,viewProps:this.viewProps})}}const Ii=_("txt");class Do{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Ii()),n.viewProps.bindClassModifiers(this.element),this.props_=n.props,this.props_.emitter.on("change",this.onChange_);const l=t.createElement("input");l.classList.add(Ii("i")),l.type="text",n.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,n.value.emitter.on("change",this.onChange_),this.value_=n.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class nn{constructor(t,n){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.view=new Do(t,{props:n.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const l=t.currentTarget.value,v=this.parser_(l);u(v)||(this.value.rawValue=v),this.view.refresh()}}function Oo(s){return String(s)}function Fi(s){return s==="false"?!1:!!s}function Di(s){return Oo(s)}class qo{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const jo={"**":(s,t)=>Math.pow(s,t),"*":(s,t)=>s*t,"/":(s,t)=>s/t,"%":(s,t)=>s%t,"+":(s,t)=>s+t,"-":(s,t)=>s-t,"<<":(s,t)=>s<<t,">>":(s,t)=>s>>t,">>>":(s,t)=>s>>>t,"&":(s,t)=>s&t,"^":(s,t)=>s^t,"|":(s,t)=>s|t};class Uo{constructor(t,n,l){this.left=n,this.operator=t,this.right=l}evaluate(){const t=jo[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ho={"+":s=>s,"-":s=>-s,"~":s=>~s};class Go{constructor(t,n){this.operator=t,this.expression=n}evaluate(){const t=Ho[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function In(s){return(t,n)=>{for(let l=0;l<s.length;l++){const v=s[l](t,n);if(v!=="")return v}return""}}function Re(s,t){var n;const l=s.substr(t).match(/^\s+/);return(n=l&&l[0])!==null&&n!==void 0?n:""}function Wo(s,t){const n=s.substr(t,1);return n.match(/^[1-9]$/)?n:""}function Ie(s,t){var n;const l=s.substr(t).match(/^[0-9]+/);return(n=l&&l[0])!==null&&n!==void 0?n:""}function Ko(s,t){const n=Ie(s,t);if(n!=="")return n;const l=s.substr(t,1);if(t+=1,l!=="-"&&l!=="+")return"";const v=Ie(s,t);return v===""?"":l+v}function Fn(s,t){const n=s.substr(t,1);if(t+=1,n.toLowerCase()!=="e")return"";const l=Ko(s,t);return l===""?"":n+l}function Oi(s,t){const n=s.substr(t,1);if(n==="0")return n;const l=Wo(s,t);return t+=l.length,l===""?"":l+Ie(s,t)}function $o(s,t){const n=Oi(s,t);if(t+=n.length,n==="")return"";const l=s.substr(t,1);if(t+=l.length,l!==".")return"";const v=Ie(s,t);return t+=v.length,n+l+v+Fn(s,t)}function Yo(s,t){const n=s.substr(t,1);if(t+=n.length,n!==".")return"";const l=Ie(s,t);return t+=l.length,l===""?"":n+l+Fn(s,t)}function Xo(s,t){const n=Oi(s,t);return t+=n.length,n===""?"":n+Fn(s,t)}const Zo=In([$o,Yo,Xo]);function Qo(s,t){var n;const l=s.substr(t).match(/^[01]+/);return(n=l&&l[0])!==null&&n!==void 0?n:""}function Jo(s,t){const n=s.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0b")return"";const l=Qo(s,t);return l===""?"":n+l}function tr(s,t){var n;const l=s.substr(t).match(/^[0-7]+/);return(n=l&&l[0])!==null&&n!==void 0?n:""}function er(s,t){const n=s.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0o")return"";const l=tr(s,t);return l===""?"":n+l}function nr(s,t){var n;const l=s.substr(t).match(/^[0-9a-f]+/i);return(n=l&&l[0])!==null&&n!==void 0?n:""}function ir(s,t){const n=s.substr(t,2);if(t+=n.length,n.toLowerCase()!=="0x")return"";const l=nr(s,t);return l===""?"":n+l}const sr=In([Jo,er,ir]),or=In([sr,Zo]);function rr(s,t){const n=or(s,t);return t+=n.length,n===""?null:{evaluable:new qo(n),cursor:t}}function ar(s,t){const n=s.substr(t,1);if(t+=n.length,n!=="(")return null;const l=ji(s,t);if(!l)return null;t=l.cursor,t+=Re(s,t).length;const v=s.substr(t,1);return t+=v.length,v!==")"?null:{evaluable:l.evaluable,cursor:t}}function lr(s,t){return rr(s,t)||ar(s,t)}function qi(s,t){const n=lr(s,t);if(n)return n;const l=s.substr(t,1);if(t+=l.length,l!=="+"&&l!=="-"&&l!=="~")return null;const v=qi(s,t);return v?(t=v.cursor,{cursor:t,evaluable:new Go(l,v.evaluable)}):null}function cr(s,t,n){n+=Re(t,n).length;const l=s.filter(v=>t.startsWith(v,n))[0];return l?(n+=l.length,n+=Re(t,n).length,{cursor:n,operator:l}):null}function hr(s,t){return(n,l)=>{const v=s(n,l);if(!v)return null;l=v.cursor;let x=v.evaluable;for(;;){const E=cr(t,n,l);if(!E)break;l=E.cursor;const D=s(n,l);if(!D)return null;l=D.cursor,x=new Uo(E.operator,x,D.evaluable)}return x?{cursor:l,evaluable:x}:null}}const dr=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((s,t)=>hr(s,t),qi);function ji(s,t){return t+=Re(s,t).length,dr(s,t)}function pr(s){const t=ji(s,0);return!t||t.cursor+Re(s,t.cursor).length!==s.length?null:t.evaluable}function Tt(s){var t;const n=pr(s);return(t=n==null?void 0:n.evaluate())!==null&&t!==void 0?t:null}function Ui(s){if(typeof s=="number")return s;if(typeof s=="string"){const t=Tt(s);if(!u(t))return t}return 0}function ur(s){return String(s)}function ut(s){return t=>t.toFixed(Math.max(Math.min(s,20),0))}const vr=ut(0);function sn(s){return vr(s)+"%"}function Hi(s){return String(s)}function Dn(s){return s}function Gi(s,t){for(;s.length<t;)s.push(void 0)}function mr(s){const t=[];return Gi(t,s),T(t)}function fr(s){const t=s.indexOf(void 0);return t<0?s:s.slice(0,t)}function br(s,t){const n=[...fr(s),t];return n.length>s.length?n.splice(0,n.length-s.length):Gi(n,s.length),n}function Fe({primary:s,secondary:t,forward:n,backward:l}){let v=!1;function x(E){v||(v=!0,E(),v=!1)}s.emitter.on("change",E=>{x(()=>{t.setRawValue(n(s,t),E.options)})}),t.emitter.on("change",E=>{x(()=>{s.setRawValue(l(s,t),E.options)}),x(()=>{t.setRawValue(n(s,t),E.options)})}),x(()=>{t.setRawValue(n(s,t),{forceEmit:!1,last:!0})})}function vt(s,t){const n=s*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function De(s){return{altKey:s.altKey,downKey:s.key==="ArrowDown",shiftKey:s.shiftKey,upKey:s.key==="ArrowUp"}}function Lt(s){return{altKey:s.altKey,downKey:s.key==="ArrowLeft",shiftKey:s.shiftKey,upKey:s.key==="ArrowRight"}}function wr(s){return s==="ArrowUp"||s==="ArrowDown"}function Wi(s){return wr(s)||s==="ArrowLeft"||s==="ArrowRight"}function On(s,t){const n=t.ownerDocument.defaultView,l=t.getBoundingClientRect();return{x:s.pageX-((n&&n.scrollX||0)+l.left),y:s.pageY-((n&&n.scrollY||0)+l.top)}}class ne{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new y,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const n=this.elem_.getBoundingClientRect();return{bounds:{width:n.width,height:n.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var n;t.preventDefault(),(n=t.currentTarget)===null||n===void 0||n.focus();const l=this.elem_.ownerDocument;l.addEventListener("mousemove",this.onDocumentMouseMove_),l.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(On(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(On(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const n=this.elem_.ownerDocument;n.removeEventListener("mousemove",this.onDocumentMouseMove_),n.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(On(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const n=t.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-l.left,y:n.clientY-l.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=n}onTouchMove_(t){const n=t.targetTouches.item(0),l=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-l.left,y:n.clientY-l.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=n}onTouchEnd_(t){var n;const l=(n=t.targetTouches.item(0))!==null&&n!==void 0?n:this.lastTouch_,v=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(l?{x:l.clientX-v.left,y:l.clientY-v.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function ot(s,t,n,l,v){const x=(s-t)/(n-t);return l+x*(v-l)}function Ki(s){return String(s.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function it(s,t,n){return Math.min(Math.max(s,t),n)}function qn(s,t){return(s%t+t)%t}const wt=_("txt");class gr{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(wt(),wt(void 0,"num")),n.arrayPosition&&this.element.classList.add(wt(void 0,n.arrayPosition)),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("input");l.classList.add(wt("i")),l.type="text",n.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=n.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(wt()),this.inputElement.classList.add(wt("i"));const v=t.createElement("div");v.classList.add(wt("k")),this.element.appendChild(v),this.knobElement=v;const x=t.createElementNS(bt,"svg");x.classList.add(wt("g")),this.knobElement.appendChild(x);const E=t.createElementNS(bt,"path");E.classList.add(wt("gb")),x.appendChild(E),this.guideBodyElem_=E;const D=t.createElementNS(bt,"path");D.classList.add(wt("gh")),x.appendChild(D),this.guideHeadElem_=D;const G=t.createElement("div");G.classList.add(_("tt")()),this.knobElement.appendChild(G),this.tooltipElem_=G,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(wt(void 0,"drg"));return}this.element.classList.add(wt(void 0,"drg"));const n=t.rawValue/this.props_.get("draggingScale"),l=n+(n>0?-1:n<0?1:0),v=it(-l,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${l+v},0 L${l},4 L${l+v},8`,`M ${n},-1 L${n},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${n},4`);const x=this.props_.get("formatter");this.tooltipElem_.textContent=x(this.value.rawValue),this.tooltipElem_.style.left=`${n}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Oe{constructor(t,n){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.parser_=n.parser,this.props=n.props,this.value=n.value,this.viewProps=n.viewProps,this.dragging_=T(null),this.view=new gr(t,{arrayPosition:n.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const l=new ne(this.view.knobElement);l.emitter.on("down",this.onPointerDown_),l.emitter.on("move",this.onPointerMove_),l.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const l=t.currentTarget.value,v=this.parser_(l);u(v)||(this.value.rawValue=v),this.view.refresh()}onInputKeyDown_(t){const n=vt(this.baseStep_,De(t));n!==0&&this.value.setRawValue(this.value.rawValue+n,{forceEmit:!1,last:!1})}onInputKeyUp_(t){vt(this.baseStep_,De(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const n=t.point.x-t.bounds.width/2;return this.originRawValue_+n*this.props.get("draggingScale")}onPointerMove_(t){const n=this.computeDraggingValue_(t.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const n=this.computeDraggingValue_(t.data);n!==null&&(this.value.setRawValue(n,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const jn=_("sld");class _r{constructor(t,n){this.onChange_=this.onChange_.bind(this),this.props_=n.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(jn()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("div");l.classList.add(jn("t")),n.viewProps.bindTabIndex(l),this.element.appendChild(l),this.trackElement=l;const v=t.createElement("div");v.classList.add(jn("k")),this.trackElement.appendChild(v),this.knobElement=v,n.value.emitter.on("change",this.onChange_),this.value=n.value,this.update_()}update_(){const t=it(ot(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class yr{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=n.baseStep,this.value=n.value,this.viewProps=n.viewProps,this.props=n.props,this.view=new _r(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ne(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){!t.point||this.value.setRawValue(ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),n)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=vt(this.baseStep_,Lt(t));n!==0&&this.value.setRawValue(this.value.rawValue+n,{forceEmit:!1,last:!1})}onKeyUp_(t){vt(this.baseStep_,Lt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Un=_("sldtxt");class xr{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(Un());const l=t.createElement("div");l.classList.add(Un("s")),this.sliderView_=n.sliderView,l.appendChild(this.sliderView_.element),this.element.appendChild(l);const v=t.createElement("div");v.classList.add(Un("t")),this.textView_=n.textView,v.appendChild(this.textView_.element),this.element.appendChild(v)}}class Hn{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.sliderC_=new yr(t,{baseStep:n.baseStep,props:n.sliderProps,value:n.value,viewProps:this.viewProps}),this.textC_=new Oe(t,{baseStep:n.baseStep,parser:n.parser,props:n.textProps,value:n.value,viewProps:n.viewProps}),this.view=new xr(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function qe(s,t){s.write(t)}function on(s){const t=j;if(Array.isArray(s))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(s).value;if(typeof s=="object")return t.required.raw(s).value}function $i(s){if(s==="inline"||s==="popup")return s}function Ut(s){const t=j;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(s).value}function Yi(s){if(Array.isArray(s))return s;const t=[];return Object.keys(s).forEach(n=>{t.push({text:n,value:s[n]})}),t}function Gn(s){return u(s)?null:new Le(Yi(s))}function Wn(s){const t=s?kt(s,Le):null;return t?t.options:null}function Cr(s){const t=s?kt(s,ee):null;return t?t.step:null}function rn(s,t){const n=s&&kt(s,ee);return n?Ki(n.step):Math.max(Ki(t),2)}function me(s){const t=Cr(s);return t!=null?t:1}function fe(s,t){var n;const l=s&&kt(s,ee),v=Math.abs((n=l==null?void 0:l.step)!==null&&n!==void 0?n:t);return v===0?.1:Math.pow(10,Math.floor(Math.log10(v))-1)}const an=_("ckb");class Er{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(an()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("label");l.classList.add(an("l")),this.element.appendChild(l);const v=t.createElement("input");v.classList.add(an("i")),v.type="checkbox",l.appendChild(v),this.inputElement=v,n.viewProps.bindDisabled(this.inputElement);const x=t.createElement("div");x.classList.add(an("w")),l.appendChild(x);const E=pe(t,"check");x.appendChild(E),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Pr{constructor(t,n){this.onInputChange_=this.onInputChange_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Er(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const n=t.currentTarget;this.value.rawValue=n.checked}}function Ar(s){const t=[],n=Gn(s.options);return n&&t.push(n),new te(t)}const kr={id:"input-bool",type:"input",accept:(s,t)=>{if(typeof s!="boolean")return null;const l=Q(t,{options:j.optional.custom(on)});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Fi,constraint:s=>Ar(s.params),writer:s=>qe},controller:s=>{var t;const n=s.document,l=s.value,v=s.constraint;return v&&kt(v,Le)?new Ne(n,{props:A.fromObject({options:(t=Wn(v))!==null&&t!==void 0?t:[]}),value:l,viewProps:s.viewProps}):new Pr(n,{value:l,viewProps:s.viewProps})}},ie=_("col");class Mr{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(ie()),n.foldable.bindExpandedClass(this.element,ie(void 0,"expanded")),V(n.foldable,"completed",F(this.element,ie(void 0,"cpl")));const l=t.createElement("div");l.classList.add(ie("h")),this.element.appendChild(l);const v=t.createElement("div");v.classList.add(ie("s")),l.appendChild(v),this.swatchElement=v;const x=t.createElement("div");if(x.classList.add(ie("t")),l.appendChild(x),this.textElement=x,n.pickerLayout==="inline"){const E=t.createElement("div");E.classList.add(ie("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}function Sr(s,t,n){const l=it(s/255,0,1),v=it(t/255,0,1),x=it(n/255,0,1),E=Math.max(l,v,x),D=Math.min(l,v,x),G=E-D;let K=0,J=0;const et=(D+E)/2;return G!==0&&(J=G/(1-Math.abs(E+D-1)),l===E?K=(v-x)/G:v===E?K=2+(x-l)/G:K=4+(l-v)/G,K=K/6+(K<0?1:0)),[K*360,J*100,et*100]}function Vr(s,t,n){const l=(s%360+360)%360,v=it(t/100,0,1),x=it(n/100,0,1),E=(1-Math.abs(2*x-1))*v,D=E*(1-Math.abs(l/60%2-1)),G=x-E/2;let K,J,et;return l>=0&&l<60?[K,J,et]=[E,D,0]:l>=60&&l<120?[K,J,et]=[D,E,0]:l>=120&&l<180?[K,J,et]=[0,E,D]:l>=180&&l<240?[K,J,et]=[0,D,E]:l>=240&&l<300?[K,J,et]=[D,0,E]:[K,J,et]=[E,0,D],[(K+G)*255,(J+G)*255,(et+G)*255]}function Br(s,t,n){const l=it(s/255,0,1),v=it(t/255,0,1),x=it(n/255,0,1),E=Math.max(l,v,x),D=Math.min(l,v,x),G=E-D;let K;G===0?K=0:E===l?K=60*(((v-x)/G%6+6)%6):E===v?K=60*((x-l)/G+2):K=60*((l-v)/G+4);const J=E===0?0:G/E,et=E;return[K,J*100,et*100]}function Xi(s,t,n){const l=qn(s,360),v=it(t/100,0,1),x=it(n/100,0,1),E=x*v,D=E*(1-Math.abs(l/60%2-1)),G=x-E;let K,J,et;return l>=0&&l<60?[K,J,et]=[E,D,0]:l>=60&&l<120?[K,J,et]=[D,E,0]:l>=120&&l<180?[K,J,et]=[0,E,D]:l>=180&&l<240?[K,J,et]=[0,D,E]:l>=240&&l<300?[K,J,et]=[D,0,E]:[K,J,et]=[E,0,D],[(K+G)*255,(J+G)*255,(et+G)*255]}function zr(s,t,n){const l=n+t*(100-Math.abs(2*n-100))/200;return[s,l!==0?t*(100-Math.abs(2*n-100))/l:0,n+t*(100-Math.abs(2*n-100))/(2*100)]}function Tr(s,t,n){const l=100-Math.abs(n*(200-t)/100-100);return[s,l!==0?t*n/l:0,n*(200-t)/(2*100)]}function be(s){return[s[0],s[1],s[2]]}function Zi(s,t){return[s[0],s[1],s[2],t]}const Lr={hsl:{hsl:(s,t,n)=>[s,t,n],hsv:zr,rgb:Vr},hsv:{hsl:Tr,hsv:(s,t,n)=>[s,t,n],rgb:Xi},rgb:{hsl:Sr,hsv:Br,rgb:(s,t,n)=>[s,t,n]}};function Nr(s,t,n){return Lr[t][n](...s)}const Rr={hsl:s=>{var t;return[qn(s[0],360),it(s[1],0,100),it(s[2],0,100),it((t=s[3])!==null&&t!==void 0?t:1,0,1)]},hsv:s=>{var t;return[qn(s[0],360),it(s[1],0,100),it(s[2],0,100),it((t=s[3])!==null&&t!==void 0?t:1,0,1)]},rgb:s=>{var t;return[it(s[0],0,255),it(s[1],0,255),it(s[2],0,255),it((t=s[3])!==null&&t!==void 0?t:1,0,1)]}};function ln(s,t){return typeof s!="object"||u(s)?!1:t in s&&typeof s[t]=="number"}class Z{constructor(t,n){this.mode_=n,this.comps_=Rr[n](t)}static black(){return new Z([0,0,0],"rgb")}static fromObject(t){const n="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new Z(n,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return ln(t,"r")&&ln(t,"g")&&ln(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&ln(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,n){if(t.mode_!==n.mode_)return!1;const l=t.comps_,v=n.comps_;for(let x=0;x<l.length;x++)if(l[x]!==v[x])return!1;return!0}get mode(){return this.mode_}getComponents(t){return Zi(Nr(be(this.comps_),this.mode_,t||this.mode_),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Ht=_("colp");class Ir{constructor(t,n){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Ht());const l=t.createElement("div");l.classList.add(Ht("hsv"));const v=t.createElement("div");v.classList.add(Ht("sv")),this.svPaletteView_=n.svPaletteView,v.appendChild(this.svPaletteView_.element),l.appendChild(v);const x=t.createElement("div");x.classList.add(Ht("h")),this.hPaletteView_=n.hPaletteView,x.appendChild(this.hPaletteView_.element),l.appendChild(x),this.element.appendChild(l);const E=t.createElement("div");if(E.classList.add(Ht("rgb")),this.textView_=n.textView,E.appendChild(this.textView_.element),this.element.appendChild(E),n.alphaViews){this.alphaViews_={palette:n.alphaViews.palette,text:n.alphaViews.text};const D=t.createElement("div");D.classList.add(Ht("a"));const G=t.createElement("div");G.classList.add(Ht("ap")),G.appendChild(this.alphaViews_.palette.element),D.appendChild(G);const K=t.createElement("div");K.classList.add(Ht("at")),K.appendChild(this.alphaViews_.text.element),D.appendChild(K),this.element.appendChild(D)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(n=>n.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Kn(s){const t=j;return Q(s,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom($i)})}function se(s){return s?.1:1}function gt(s,t){const n=s.match(/^(.+)%$/);return Math.min(n?parseFloat(n[1])*.01*t:parseFloat(s),t)}const Fr={deg:s=>s,grad:s=>s*360/400,rad:s=>s*360/(2*Math.PI),turn:s=>s*360};function Qi(s){const t=s.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(s);const n=parseFloat(t[1]),l=t[2];return Fr[l](n)}const $n={"func.rgb":s=>{const t=s.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[gt(t[1],255),gt(t[2],255),gt(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new Z(n,"rgb")},"func.rgba":s=>{const t=s.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[gt(t[1],255),gt(t[2],255),gt(t[3],255),gt(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new Z(n,"rgb")},"func.hsl":s=>{const t=s.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Qi(t[1]),gt(t[2],100),gt(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new Z(n,"hsl")},"func.hsla":s=>{const t=s.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const n=[Qi(t[1]),gt(t[2],100),gt(t[3],100),gt(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new Z(n,"hsl")},"hex.rgb":s=>{const t=s.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const n=s.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new Z([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":s=>{const t=s.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),ot(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const n=s.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new Z([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),ot(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function cn(s){return Object.keys($n).reduce((n,l)=>n||($n[l](s)?l:null),null)}const hn=s=>{const t=cn(s);return t?$n[t](s):null};function Dr(s){return s==="func.hsla"||s==="func.rgba"||s==="hex.rgba"}function Or(s){if(typeof s=="string"){const t=hn(s);if(t)return t}return Z.black()}function Ji(s){const t=it(Math.floor(s),0,255).toString(16);return t.length===1?`0${t}`:t}function Yn(s,t="#"){const n=be(s.getComponents("rgb")).map(Ji).join("");return`${t}${n}`}function dn(s,t="#"){const n=s.getComponents("rgb"),l=[n[0],n[1],n[2],n[3]*255].map(Ji).join("");return`${t}${l}`}function ts(s){const t=ut(0);return`rgb(${be(s.getComponents("rgb")).map(l=>t(l)).join(", ")})`}function pn(s){const t=ut(2),n=ut(0);return`rgba(${s.getComponents("rgb").map((v,x)=>(x===3?t:n)(v)).join(", ")})`}function qr(s){const t=[ut(0),sn,sn];return`hsl(${be(s.getComponents("hsl")).map((l,v)=>t[v](l)).join(", ")})`}function jr(s){const t=[ut(0),sn,sn,ut(2)];return`hsla(${s.getComponents("hsl").map((l,v)=>t[v](l)).join(", ")})`}const Ur={"func.hsl":qr,"func.hsla":jr,"func.rgb":ts,"func.rgba":pn,"hex.rgb":Yn,"hex.rgba":dn};function es(s){return Ur[s]}const je=_("apl");class Hr{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(je()),n.viewProps.bindTabIndex(this.element);const l=t.createElement("div");l.classList.add(je("b")),this.element.appendChild(l);const v=t.createElement("div");v.classList.add(je("c")),l.appendChild(v),this.colorElem_=v;const x=t.createElement("div");x.classList.add(je("m")),this.element.appendChild(x),this.markerElem_=x;const E=t.createElement("div");E.classList.add(je("p")),this.markerElem_.appendChild(E),this.previewElem_=E,this.update_()}update_(){const t=this.value.rawValue,n=t.getComponents("rgb"),l=new Z([n[0],n[1],n[2],0],"rgb"),v=new Z([n[0],n[1],n[2],255],"rgb"),x=["to right",pn(l),pn(v)];this.colorElem_.style.background=`linear-gradient(${x.join(",")})`,this.previewElem_.style.backgroundColor=pn(t);const E=ot(n[3],0,1,0,100);this.markerElem_.style.left=`${E}%`}onValueChange_(){this.update_()}}class Gr{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Hr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ne(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const l=t.point.x/t.bounds.width,v=this.value.rawValue,[x,E,D]=v.getComponents("hsv");this.value.setRawValue(new Z([x,E,D,l],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=vt(se(!0),Lt(t));if(n===0)return;const l=this.value.rawValue,[v,x,E,D]=l.getComponents("hsv");this.value.setRawValue(new Z([v,x,E,D+n],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){vt(se(!0),Lt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const we=_("coltxt");function Wr(s){const t=s.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(n.reduce((l,v)=>{const x=s.createElement("option");return x.textContent=v.text,x.value=v.value,l.appendChild(x),l},s.createDocumentFragment())),t}class Kr{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(we());const l=t.createElement("div");l.classList.add(we("m")),this.modeElem_=Wr(t),this.modeElem_.classList.add(we("ms")),l.appendChild(this.modeSelectElement);const v=t.createElement("div");v.classList.add(we("mm")),v.appendChild(pe(t,"dropdown")),l.appendChild(v),this.element.appendChild(l);const x=t.createElement("div");x.classList.add(we("w")),this.element.appendChild(x),this.textsElem_=x,this.textViews_=n.textViews,this.applyTextViews_(),M(n.colorMode,E=>{this.modeElem_.value=E})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){_i(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(n=>{const l=t.createElement("div");l.classList.add(we("c")),l.appendChild(n.element),this.textsElem_.appendChild(l)})}}const $r=ut(0),Yr={rgb:()=>new ft({min:0,max:255}),hsl:s=>s===0?new ft({min:0,max:360}):new ft({min:0,max:100}),hsv:s=>s===0?new ft({min:0,max:360}):new ft({min:0,max:100})};function Xn(s,t,n){return new Oe(s,{arrayPosition:n===0?"fst":n===3-1?"lst":"mid",baseStep:se(!1),parser:t.parser,props:A.fromObject({draggingScale:1,formatter:$r}),value:T(0,{constraint:Yr[t.colorMode](n)}),viewProps:t.viewProps})}class Xr{constructor(t,n){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=n.parser,this.value=n.value,this.viewProps=n.viewProps,this.colorMode=T(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Kr(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const n={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},l=[Xn(t,n,0),Xn(t,n,1),Xn(t,n,2)];return l.forEach((v,x)=>{Fe({primary:this.value,secondary:v.value,forward:E=>E.rawValue.getComponents(this.colorMode.rawValue)[x],backward:(E,D)=>{const G=this.colorMode.rawValue,K=E.rawValue.getComponents(G);return K[x]=D.rawValue,new Z(Zi(be(K),K[3]),G)}})}),l}onModeSelectChange_(t){const n=t.currentTarget;this.colorMode.rawValue=n.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Zn=_("hpl");class Zr{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Zn()),n.viewProps.bindTabIndex(this.element);const l=t.createElement("div");l.classList.add(Zn("c")),this.element.appendChild(l);const v=t.createElement("div");v.classList.add(Zn("m")),this.element.appendChild(v),this.markerElem_=v,this.update_()}update_(){const t=this.value.rawValue,[n]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=ts(new Z([n,100,100],"hsv"));const l=ot(n,0,360,0,100);this.markerElem_.style.left=`${l}%`}onValueChange_(){this.update_()}}class Qr{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Zr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ne(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const l=ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),v=this.value.rawValue,[,x,E,D]=v.getComponents("hsv");this.value.setRawValue(new Z([l,x,E,D],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const n=vt(se(!1),Lt(t));if(n===0)return;const l=this.value.rawValue,[v,x,E,D]=l.getComponents("hsv");this.value.setRawValue(new Z([v+n,x,E,D],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){vt(se(!1),Lt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Qn=_("svp"),ns=64;class Jr{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),this.value=n.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Qn()),n.viewProps.bindTabIndex(this.element);const l=t.createElement("canvas");l.height=ns,l.width=ns,l.classList.add(Qn("c")),this.element.appendChild(l),this.canvasElement=l;const v=t.createElement("div");v.classList.add(Qn("m")),this.element.appendChild(v),this.markerElem_=v,this.update_()}update_(){const t=yt(this.canvasElement);if(!t)return;const l=this.value.rawValue.getComponents("hsv"),v=this.canvasElement.width,x=this.canvasElement.height,E=t.getImageData(0,0,v,x),D=E.data;for(let J=0;J<x;J++)for(let et=0;et<v;et++){const oe=ot(et,0,v,0,100),He=ot(J,0,x,100,0),Ge=Xi(l[0],oe,He),xe=(J*v+et)*4;D[xe]=Ge[0],D[xe+1]=Ge[1],D[xe+2]=Ge[2],D[xe+3]=255}t.putImageData(E,0,0);const G=ot(l[1],0,100,0,100);this.markerElem_.style.left=`${G}%`;const K=ot(l[2],0,100,100,0);this.markerElem_.style.top=`${K}%`}onValueChange_(){this.update_()}}class ta{constructor(t,n){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.view=new Jr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ne(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const l=ot(t.point.x,0,t.bounds.width,0,100),v=ot(t.point.y,0,t.bounds.height,100,0),[x,,,E]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Z([x,l,v,E],"hsv"),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Wi(t.key)&&t.preventDefault();const[n,l,v,x]=this.value.rawValue.getComponents("hsv"),E=se(!1),D=vt(E,Lt(t)),G=vt(E,De(t));D===0&&G===0||this.value.setRawValue(new Z([n,l+D,v+G,x],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const n=se(!1),l=vt(n,Lt(t)),v=vt(n,De(t));l===0&&v===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ea{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.hPaletteC_=new Qr(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new ta(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=n.supportsAlpha?{palette:new Gr(t,{value:this.value,viewProps:this.viewProps}),text:new Oe(t,{parser:Tt,baseStep:.1,props:A.fromObject({draggingScale:.01,formatter:ut(2)}),value:T(0,{constraint:new ft({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Fe({primary:this.value,secondary:this.alphaIcs_.text.value,forward:l=>l.rawValue.getComponents()[3],backward:(l,v)=>{const x=l.rawValue.getComponents();return x[3]=v.rawValue,new Z(x,l.rawValue.mode)}}),this.textC_=new Xr(t,{parser:Tt,value:this.value,viewProps:this.viewProps}),this.view=new Ir(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:n.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Jn=_("colsw");class na{constructor(t,n){this.onValueChange_=this.onValueChange_.bind(this),n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.element=t.createElement("div"),this.element.classList.add(Jn()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("div");l.classList.add(Jn("sw")),this.element.appendChild(l),this.swatchElem_=l;const v=t.createElement("button");v.classList.add(Jn("b")),n.viewProps.bindDisabled(v),this.element.appendChild(v),this.buttonElement=v,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=dn(t)}onValueChange_(){this.update_()}}class ia{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new na(t,{value:this.value,viewProps:this.viewProps})}}class ti{constructor(t,n){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Ve.create(n.expanded),this.swatchC_=new ia(t,{value:this.value,viewProps:this.viewProps});const l=this.swatchC_.view.buttonElement;l.addEventListener("blur",this.onButtonBlur_),l.addEventListener("click",this.onButtonClick_),this.textC_=new nn(t,{parser:n.parser,props:A.fromObject({formatter:n.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Mr(t,{foldable:this.foldable_,pickerLayout:n.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=n.pickerLayout==="popup"?new Ri(t,{viewProps:this.viewProps}):null;const v=new ea(t,{supportsAlpha:n.supportsAlpha,value:this.value,viewProps:this.viewProps});v.view.allFocusableElements.forEach(x=>{x.addEventListener("blur",this.onPopupChildBlur_),x.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=v,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(v.view.element),Fe({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:x=>x.rawValue,backward:(x,E)=>E.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),kn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const n=this.view.element,l=t.relatedTarget;(!l||!n.contains(l))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const n=this.popC_.view.element,l=yi(t);l&&n.contains(l)||l&&l===this.swatchC_.view.buttonElement&&!pt(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function sa(s){return Z.isColorObject(s)?Z.fromObject(s):Z.black()}function oa(s){return be(s.getComponents("rgb")).reduce((t,n)=>t<<8|Math.floor(n)&255,0)}function ra(s){return s.getComponents("rgb").reduce((t,n,l)=>{const v=Math.floor(l===3?n*255:n)&255;return t<<8|v},0)>>>0}function aa(s){return new Z([s>>16&255,s>>8&255,s&255],"rgb")}function la(s){return new Z([s>>24&255,s>>16&255,s>>8&255,ot(s&255,0,255,0,1)],"rgb")}function ca(s){return typeof s!="number"?Z.black():aa(s)}function ha(s){return typeof s!="number"?Z.black():la(s)}function da(s){const t=es(s);return(n,l)=>{qe(n,t(l))}}function pa(s){const t=s?ra:oa;return(n,l)=>{qe(n,t(l))}}function ua(s,t){const n=t.toRgbaObject();s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b),s.writeProperty("a",n.a)}function va(s,t){const n=t.toRgbaObject();s.writeProperty("r",n.r),s.writeProperty("g",n.g),s.writeProperty("b",n.b)}function ma(s){return s?ua:va}function ei(s){return"alpha"in s&&s.alpha===!0}function fa(s){return s?t=>dn(t,"0x"):t=>Yn(t,"0x")}const ba={id:"input-color-number",type:"input",accept:(s,t)=>{if(typeof s!="number"||!("view"in t)||t.view!=="color")return null;const n=Kn(t);return n?{initialValue:s,params:n}:null},binding:{reader:s=>ei(s.params)?ha:ca,equals:Z.equals,writer:s=>pa(ei(s.params))},controller:s=>{const t=ei(s.params),n="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0;return new ti(s.document,{expanded:n!=null?n:!1,formatter:fa(t),parser:hn,pickerLayout:l!=null?l:"popup",supportsAlpha:t,value:s.value,viewProps:s.viewProps})}};function wa(s){return Z.isRgbaColorObject(s)}const ga={id:"input-color-object",type:"input",accept:(s,t)=>{if(!Z.isColorObject(s))return null;const n=Kn(t);return n?{initialValue:s,params:n}:null},binding:{reader:s=>sa,equals:Z.equals,writer:s=>ma(wa(s.initialValue))},controller:s=>{const t=Z.isRgbaColorObject(s.initialValue),n="expanded"in s.params?s.params.expanded:void 0,l="picker"in s.params?s.params.picker:void 0,v=t?dn:Yn;return new ti(s.document,{expanded:n!=null?n:!1,formatter:v,parser:hn,pickerLayout:l!=null?l:"popup",supportsAlpha:t,value:s.value,viewProps:s.viewProps})}},_a={id:"input-color-string",type:"input",accept:(s,t)=>{if(typeof s!="string"||"view"in t&&t.view==="text"||!cn(s))return null;const l=Kn(t);return l?{initialValue:s,params:l}:null},binding:{reader:s=>Or,equals:Z.equals,writer:s=>{const t=cn(s.initialValue);if(!t)throw w.shouldNeverHappen();return da(t)}},controller:s=>{const t=cn(s.initialValue);if(!t)throw w.shouldNeverHappen();const n=es(t),l="expanded"in s.params?s.params.expanded:void 0,v="picker"in s.params?s.params.picker:void 0;return new ti(s.document,{expanded:l!=null?l:!1,formatter:n,parser:hn,pickerLayout:v!=null?v:"popup",supportsAlpha:Dr(t),value:s.value,viewProps:s.viewProps})}};class Gt{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const n=this.asm_.toComponents(t).map((l,v)=>{var x,E;return(E=(x=this.components[v])===null||x===void 0?void 0:x.constrain(l))!==null&&E!==void 0?E:l});return this.asm_.fromComponents(n)}}const is=_("pndtxt");class ya{constructor(t,n){this.textViews=n.textViews,this.element=t.createElement("div"),this.element.classList.add(is()),this.textViews.forEach(l=>{const v=t.createElement("div");v.classList.add(is("a")),v.appendChild(l.element),this.element.appendChild(v)})}}function xa(s,t,n){return new Oe(s,{arrayPosition:n===0?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:T(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}class ni{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.acs_=n.axes.map((l,v)=>xa(t,n,v)),this.acs_.forEach((l,v)=>{Fe({primary:this.value,secondary:l.value,forward:x=>n.assembly.toComponents(x.rawValue)[v],backward:(x,E)=>{const D=n.assembly.toComponents(x.rawValue);return D[v]=E.rawValue,n.assembly.fromComponents(D)}})}),this.view=new ya(t,{textViews:this.acs_.map(l=>l.view)})}}function Ca(s){return"step"in s&&!u(s.step)?new ee(s.step):null}function Ea(s){return"max"in s&&!u(s.max)||"min"in s&&!u(s.min)?new ft({max:s.max,min:s.min}):null}function Pa(s){const t=[],n=Ca(s);n&&t.push(n);const l=Ea(s);l&&t.push(l);const v=Gn(s.options);return v&&t.push(v),new te(t)}function Aa(s){const t=s?kt(s,ft):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function ka(s){const[t,n]=Aa(s);return[t!=null?t:0,n!=null?n:100]}const Ma={id:"input-number",type:"input",accept:(s,t)=>{if(typeof s!="number")return null;const n=j,l=Q(t,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(on),step:n.optional.number});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Ui,constraint:s=>Pa(s.params),writer:s=>qe},controller:s=>{var t,n;const l=s.value,v=s.constraint;if(v&&kt(v,Le))return new Ne(s.document,{props:A.fromObject({options:(t=Wn(v))!==null&&t!==void 0?t:[]}),value:l,viewProps:s.viewProps});const x=(n="format"in s.params?s.params.format:void 0)!==null&&n!==void 0?n:ut(rn(v,l.rawValue));if(v&&kt(v,ft)){const[E,D]=ka(v);return new Hn(s.document,{baseStep:me(v),parser:Tt,sliderProps:A.fromObject({maxValue:D,minValue:E}),textProps:A.fromObject({draggingScale:fe(v,l.rawValue),formatter:x}),value:l,viewProps:s.viewProps})}return new Oe(s.document,{baseStep:me(v),parser:Tt,props:A.fromObject({draggingScale:fe(v,l.rawValue),formatter:x}),value:l,viewProps:s.viewProps})}};class Wt{constructor(t=0,n=0){this.x=t,this.y=n}getComponents(){return[this.x,this.y]}static isObject(t){if(u(t))return!1;const n=t.x,l=t.y;return!(typeof n!="number"||typeof l!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y}toObject(){return{x:this.x,y:this.y}}}const ss={toComponents:s=>s.getComponents(),fromComponents:s=>new Wt(...s)},ge=_("p2d");class Sa{constructor(t,n){this.element=t.createElement("div"),this.element.classList.add(ge()),n.viewProps.bindClassModifiers(this.element),M(n.expanded,F(this.element,ge(void 0,"expanded")));const l=t.createElement("div");l.classList.add(ge("h")),this.element.appendChild(l);const v=t.createElement("button");v.classList.add(ge("b")),v.appendChild(pe(t,"p2dpad")),n.viewProps.bindDisabled(v),l.appendChild(v),this.buttonElement=v;const x=t.createElement("div");if(x.classList.add(ge("t")),l.appendChild(x),this.textElement=x,n.pickerLayout==="inline"){const E=t.createElement("div");E.classList.add(ge("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}const Kt=_("p2dp");class Va{constructor(t,n){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=n.invertsY,this.maxValue_=n.maxValue,this.element=t.createElement("div"),this.element.classList.add(Kt()),n.layout==="popup"&&this.element.classList.add(Kt(void 0,"p"));const l=t.createElement("div");l.classList.add(Kt("p")),n.viewProps.bindTabIndex(l),this.element.appendChild(l),this.padElement=l;const v=t.createElementNS(bt,"svg");v.classList.add(Kt("g")),this.padElement.appendChild(v),this.svgElem_=v;const x=t.createElementNS(bt,"line");x.classList.add(Kt("ax")),x.setAttributeNS(null,"x1","0"),x.setAttributeNS(null,"y1","50%"),x.setAttributeNS(null,"x2","100%"),x.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(x);const E=t.createElementNS(bt,"line");E.classList.add(Kt("ax")),E.setAttributeNS(null,"x1","50%"),E.setAttributeNS(null,"y1","0"),E.setAttributeNS(null,"x2","50%"),E.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(E);const D=t.createElementNS(bt,"line");D.classList.add(Kt("l")),D.setAttributeNS(null,"x1","50%"),D.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(D),this.lineElem_=D;const G=t.createElement("div");G.classList.add(Kt("m")),this.padElement.appendChild(G),this.markerElem_=G,n.value.emitter.on("change",this.onValueChange_),this.value=n.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,n]=this.value.rawValue.getComponents(),l=this.maxValue_,v=ot(t,-l,+l,0,100),x=ot(n,-l,+l,0,100),E=this.invertsY_?100-x:x;this.lineElem_.setAttributeNS(null,"x2",`${v}%`),this.lineElem_.setAttributeNS(null,"y2",`${E}%`),this.markerElem_.style.left=`${v}%`,this.markerElem_.style.top=`${E}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function os(s,t,n){return[vt(t[0],Lt(s)),vt(t[1],De(s))*(n?1:-1)]}class Ba{constructor(t,n){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.baseSteps_=n.baseSteps,this.maxValue_=n.maxValue,this.invertsY_=n.invertsY,this.view=new Va(t,{invertsY:this.invertsY_,layout:n.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ne(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,n){if(!t.point)return;const l=this.maxValue_,v=ot(t.point.x,0,t.bounds.width,-l,+l),x=ot(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-l,+l);this.value.setRawValue(new Wt(v,x),n)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Wi(t.key)&&t.preventDefault();const[n,l]=os(t,this.baseSteps_,this.invertsY_);n===0&&l===0||this.value.setRawValue(new Wt(this.value.rawValue.x+n,this.value.rawValue.y+l),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[n,l]=os(t,this.baseSteps_,this.invertsY_);n===0&&l===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class za{constructor(t,n){var l,v;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.foldable_=Ve.create(n.expanded),this.popC_=n.pickerLayout==="popup"?new Ri(t,{viewProps:this.viewProps}):null;const x=new Ba(t,{baseSteps:[n.axes[0].baseStep,n.axes[1].baseStep],invertsY:n.invertsY,layout:n.pickerLayout,maxValue:n.maxValue,value:this.value,viewProps:this.viewProps});x.view.allFocusableElements.forEach(E=>{E.addEventListener("blur",this.onPopupChildBlur_),E.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.textC_=new ni(t,{assembly:ss,axes:n.axes,parser:n.parser,value:this.value,viewProps:this.viewProps}),this.view=new Sa(t,{expanded:this.foldable_.value("expanded"),pickerLayout:n.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(l=this.view.buttonElement)===null||l===void 0||l.addEventListener("blur",this.onPadButtonBlur_),(v=this.view.buttonElement)===null||v===void 0||v.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Fe({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:E=>E.rawValue,backward:(E,D)=>D.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),kn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const n=this.view.element,l=t.relatedTarget;(!l||!n.contains(l))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const n=this.popC_.view.element,l=yi(t);l&&n.contains(l)||l&&l===this.view.buttonElement&&!pt(n.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function Ta(s){return Wt.isObject(s)?new Wt(s.x,s.y):new Wt}function La(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y)}function rs(s){if(!s)return;const t=[];return u(s.step)||t.push(new ee(s.step)),(!u(s.max)||!u(s.min))&&t.push(new ft({max:s.max,min:s.min})),new te(t)}function Na(s){return new Gt({assembly:ss,components:[rs("x"in s?s.x:void 0),rs("y"in s?s.y:void 0)]})}function as(s,t){const n=s&&kt(s,ft);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));const l=me(s);return Math.max(Math.abs(l)*10,Math.abs(t)*10)}function Ra(s,t){const n=t instanceof Gt?t.components[0]:void 0,l=t instanceof Gt?t.components[1]:void 0,v=as(n,s.x),x=as(l,s.y);return Math.max(v,x)}function ls(s,t){return{baseStep:me(t),constraint:t,textProps:A.fromObject({draggingScale:fe(t,s),formatter:ut(rn(t,s))})}}function Ia(s){if(!("y"in s))return!1;const t=s.y;return t&&"inverted"in t?!!t.inverted:!1}const Fa={id:"input-point2d",type:"input",accept:(s,t)=>{if(!Wt.isObject(s))return null;const n=j,l=Q(t,{expanded:n.optional.boolean,picker:n.optional.custom($i),x:n.optional.custom(Ut),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Ta,constraint:s=>Na(s.params),equals:Wt.equals,writer:s=>La},controller:s=>{const t=s.document,n=s.value,l=s.constraint;if(!(l instanceof Gt))throw w.shouldNeverHappen();const v="expanded"in s.params?s.params.expanded:void 0,x="picker"in s.params?s.params.picker:void 0;return new za(t,{axes:[ls(n.rawValue.x,l.components[0]),ls(n.rawValue.y,l.components[1])],expanded:v!=null?v:!1,invertsY:Ia(s.params),maxValue:Ra(n.rawValue,l),parser:Tt,pickerLayout:x!=null?x:"popup",value:n,viewProps:s.viewProps})}};class _e{constructor(t=0,n=0,l=0){this.x=t,this.y=n,this.z=l}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(u(t))return!1;const n=t.x,l=t.y,v=t.z;return!(typeof n!="number"||typeof l!="number"||typeof v!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y&&t.z===n.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const cs={toComponents:s=>s.getComponents(),fromComponents:s=>new _e(...s)};function Da(s){return _e.isObject(s)?new _e(s.x,s.y,s.z):new _e}function Oa(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z)}function ii(s){if(!s)return;const t=[];return u(s.step)||t.push(new ee(s.step)),(!u(s.max)||!u(s.min))&&t.push(new ft({max:s.max,min:s.min})),new te(t)}function qa(s){return new Gt({assembly:cs,components:[ii("x"in s?s.x:void 0),ii("y"in s?s.y:void 0),ii("z"in s?s.z:void 0)]})}function si(s,t){return{baseStep:me(t),constraint:t,textProps:A.fromObject({draggingScale:fe(t,s),formatter:ut(rn(t,s))})}}const ja={id:"input-point3d",type:"input",accept:(s,t)=>{if(!_e.isObject(s))return null;const n=j,l=Q(t,{x:n.optional.custom(Ut),y:n.optional.custom(Ut),z:n.optional.custom(Ut)});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Da,constraint:s=>qa(s.params),equals:_e.equals,writer:s=>Oa},controller:s=>{const t=s.value,n=s.constraint;if(!(n instanceof Gt))throw w.shouldNeverHappen();return new ni(s.document,{assembly:cs,axes:[si(t.rawValue.x,n.components[0]),si(t.rawValue.y,n.components[1]),si(t.rawValue.z,n.components[2])],parser:Tt,value:t,viewProps:s.viewProps})}};class ye{constructor(t=0,n=0,l=0,v=0){this.x=t,this.y=n,this.z=l,this.w=v}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(u(t))return!1;const n=t.x,l=t.y,v=t.z,x=t.w;return!(typeof n!="number"||typeof l!="number"||typeof v!="number"||typeof x!="number")}static equals(t,n){return t.x===n.x&&t.y===n.y&&t.z===n.z&&t.w===n.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const hs={toComponents:s=>s.getComponents(),fromComponents:s=>new ye(...s)};function Ua(s){return ye.isObject(s)?new ye(s.x,s.y,s.z,s.w):new ye}function Ha(s,t){s.writeProperty("x",t.x),s.writeProperty("y",t.y),s.writeProperty("z",t.z),s.writeProperty("w",t.w)}function un(s){if(!s)return;const t=[];return u(s.step)||t.push(new ee(s.step)),(!u(s.max)||!u(s.min))&&t.push(new ft({max:s.max,min:s.min})),new te(t)}function Ga(s){return new Gt({assembly:hs,components:[un("x"in s?s.x:void 0),un("y"in s?s.y:void 0),un("z"in s?s.z:void 0),un("w"in s?s.w:void 0)]})}function Wa(s,t){return{baseStep:me(t),constraint:t,textProps:A.fromObject({draggingScale:fe(t,s),formatter:ut(rn(t,s))})}}const Ka={id:"input-point4d",type:"input",accept:(s,t)=>{if(!ye.isObject(s))return null;const n=j,l=Q(t,{x:n.optional.custom(Ut),y:n.optional.custom(Ut),z:n.optional.custom(Ut),w:n.optional.custom(Ut)});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Ua,constraint:s=>Ga(s.params),equals:ye.equals,writer:s=>Ha},controller:s=>{const t=s.value,n=s.constraint;if(!(n instanceof Gt))throw w.shouldNeverHappen();return new ni(s.document,{assembly:hs,axes:t.rawValue.getComponents().map((l,v)=>Wa(l,n.components[v])),parser:Tt,value:t,viewProps:s.viewProps})}};function $a(s){const t=[],n=Gn(s.options);return n&&t.push(n),new te(t)}const Ya={id:"input-string",type:"input",accept:(s,t)=>{if(typeof s!="string")return null;const l=Q(t,{options:j.optional.custom(on)});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Hi,constraint:s=>$a(s.params),writer:s=>qe},controller:s=>{var t;const n=s.document,l=s.value,v=s.constraint;return v&&kt(v,Le)?new Ne(n,{props:A.fromObject({options:(t=Wn(v))!==null&&t!==void 0?t:[]}),value:l,viewProps:s.viewProps}):new nn(n,{parser:x=>x,props:A.fromObject({formatter:Dn}),value:l,viewProps:s.viewProps})}},Ue={monitor:{defaultInterval:200,defaultLineCount:3}},ds=_("mll");class Xa{constructor(t,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=t.createElement("div"),this.element.classList.add(ds()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("textarea");l.classList.add(ds("i")),l.style.height=`calc(var(--bld-us) * ${n.lineCount})`,l.readOnly=!0,n.viewProps.bindDisabled(l),this.element.appendChild(l),this.textareaElem_=l,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const t=this.textareaElem_,n=t.scrollTop===t.scrollHeight-t.clientHeight,l=[];this.value.rawValue.forEach(v=>{v!==void 0&&l.push(this.formatter_(v))}),t.textContent=l.join(`
`),n&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class oi{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new Xa(t,{formatter:n.formatter,lineCount:n.lineCount,value:this.value,viewProps:this.viewProps})}}const ps=_("sgl");class Za{constructor(t,n){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=n.formatter,this.element=t.createElement("div"),this.element.classList.add(ps()),n.viewProps.bindClassModifiers(this.element);const l=t.createElement("input");l.classList.add(ps("i")),l.readOnly=!0,l.type="text",n.viewProps.bindDisabled(l),this.element.appendChild(l),this.inputElement=l,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}update_(){const t=this.value.rawValue,n=t[t.length-1];this.inputElement.value=n!==void 0?this.formatter_(n):""}onValueUpdate_(){this.update_()}}class ri{constructor(t,n){this.value=n.value,this.viewProps=n.viewProps,this.view=new Za(t,{formatter:n.formatter,value:this.value,viewProps:this.viewProps})}}const Qa={id:"monitor-bool",type:"monitor",accept:(s,t)=>{if(typeof s!="boolean")return null;const l=Q(t,{lineCount:j.optional.number});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Fi},controller:s=>{var t;return s.value.rawValue.length===1?new ri(s.document,{formatter:Di,value:s.value,viewProps:s.viewProps}):new oi(s.document,{formatter:Di,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Ue.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}};class Ja{constructor(){this.emitter=new y,this.index_=-1}get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}const $t=_("grl");class tl{constructor(t,n){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add($t()),n.viewProps.bindClassModifiers(this.element),this.formatter_=n.formatter,this.minValue_=n.minValue,this.maxValue_=n.maxValue,this.cursor_=n.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const l=t.createElementNS(bt,"svg");l.classList.add($t("g")),l.style.height=`calc(var(--bld-us) * ${n.lineCount})`,this.element.appendChild(l),this.svgElem_=l;const v=t.createElementNS(bt,"polyline");this.svgElem_.appendChild(v),this.lineElem_=v;const x=t.createElement("div");x.classList.add($t("t"),_("tt")()),this.element.appendChild(x),this.tooltipElem_=x,n.value.emitter.on("change",this.onValueUpdate_),this.value=n.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),n=this.value.rawValue.length-1,l=this.minValue_,v=this.maxValue_,x=[];this.value.rawValue.forEach((J,et)=>{if(J===void 0)return;const oe=ot(et,0,n,0,t.width),He=ot(J,l,v,t.height,0);x.push([oe,He].join(","))}),this.lineElem_.setAttributeNS(null,"points",x.join(" "));const E=this.tooltipElem_,D=this.value.rawValue[this.cursor_.index];if(D===void 0){E.classList.remove($t("t","a"));return}const G=ot(this.cursor_.index,0,n,0,t.width),K=ot(D,l,v,t.height,0);E.style.left=`${G}px`,E.style.top=`${K}px`,E.textContent=`${this.formatter_(D)}`,E.classList.contains($t("t","a"))||(E.classList.add($t("t","a"),$t("t","in")),he(E),E.classList.remove($t("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class el{constructor(t,n){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=n.value,this.viewProps=n.viewProps,this.cursor_=new Ja,this.view=new tl(t,{cursor:this.cursor_,formatter:n.formatter,lineCount:n.lineCount,maxValue:n.maxValue,minValue:n.minValue,value:this.value,viewProps:this.viewProps}),!pt(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const l=new ne(this.view.element);l.emitter.on("down",this.onGraphPointerDown_),l.emitter.on("move",this.onGraphPointerMove_),l.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const n=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(ot(t.offsetX,0,n.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(ot(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function ai(s){return"format"in s&&!u(s.format)?s.format:ut(2)}function nl(s){var t;return s.value.rawValue.length===1?new ri(s.document,{formatter:ai(s.params),value:s.value,viewProps:s.viewProps}):new oi(s.document,{formatter:ai(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Ue.monitor.defaultLineCount,value:s.value,viewProps:s.viewProps})}function il(s){var t,n,l;return new el(s.document,{formatter:ai(s.params),lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Ue.monitor.defaultLineCount,maxValue:(n="max"in s.params?s.params.max:null)!==null&&n!==void 0?n:100,minValue:(l="min"in s.params?s.params.min:null)!==null&&l!==void 0?l:0,value:s.value,viewProps:s.viewProps})}function us(s){return"view"in s&&s.view==="graph"}const sl={id:"monitor-number",type:"monitor",accept:(s,t)=>{if(typeof s!="number")return null;const n=j,l=Q(t,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return l?{initialValue:s,params:l}:null},binding:{defaultBufferSize:s=>us(s)?64:1,reader:s=>Ui},controller:s=>us(s.params)?il(s):nl(s)},ol={id:"monitor-string",type:"monitor",accept:(s,t)=>{if(typeof s!="string")return null;const n=j,l=Q(t,{lineCount:n.optional.number,multiline:n.optional.boolean});return l?{initialValue:s,params:l}:null},binding:{reader:s=>Hi},controller:s=>{var t;const n=s.value;return n.rawValue.length>1||"multiline"in s.params&&s.params.multiline?new oi(s.document,{formatter:Dn,lineCount:(t=s.params.lineCount)!==null&&t!==void 0?t:Ue.monitor.defaultLineCount,value:n,viewProps:s.viewProps}):new ri(s.document,{formatter:Dn,value:n,viewProps:s.viewProps})}};class rl{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new y,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function al(s,t){const n=s.accept(t.target.read(),t.params);if(u(n))return null;const l=j,v={target:t.target,initialValue:n.initialValue,params:n.params},x=s.binding.reader(v),E=s.binding.constraint?s.binding.constraint(v):void 0,D=T(x(n.initialValue),{constraint:E,equals:s.binding.equals}),G=new rl({reader:x,target:t.target,value:D,writer:s.binding.writer(v)}),K=l.optional.boolean(t.params.disabled).value,J=l.optional.boolean(t.params.hidden).value,et=s.controller({constraint:E,document:t.document,initialValue:n.initialValue,params:n.params,value:G.value,viewProps:jt.create({disabled:K,hidden:J})}),oe=l.optional.string(t.params.label).value;return new At(t.document,{binding:G,blade:Se(),props:A.fromObject({label:oe||t.target.key}),valueController:et})}class ll{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new y,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const n=this.value.rawValue,l=this.reader_(t);this.value.rawValue=br(n,l),this.emitter.emit("update",{rawValue:l,sender:this})}onTick_(t){this.read()}}function cl(s,t){return t===0?new No:new Ro(s,t!=null?t:Ue.monitor.defaultInterval)}function hl(s,t){var n,l,v;const x=j,E=s.accept(t.target.read(),t.params);if(u(E))return null;const D={target:t.target,initialValue:E.initialValue,params:E.params},G=s.binding.reader(D),K=(l=(n=x.optional.number(t.params.bufferSize).value)!==null&&n!==void 0?n:s.binding.defaultBufferSize&&s.binding.defaultBufferSize(E.params))!==null&&l!==void 0?l:1,J=x.optional.number(t.params.interval).value,et=new ll({reader:G,target:t.target,ticker:cl(t.document,J),value:mr(K)}),oe=x.optional.boolean(t.params.disabled).value,He=x.optional.boolean(t.params.hidden).value,Ge=s.controller({document:t.document,params:E.params,value:et.value,viewProps:jt.create({disabled:oe,hidden:He})}),xe=(v=x.optional.string(t.params.label).value)!==null&&v!==void 0?v:t.target.key;return new qt(t.document,{binding:et,blade:Se(),props:A.fromObject({label:xe}),valueController:Ge})}class dl{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,n,l){const v=n.read();if(u(v))throw new w({context:{key:n.key},type:"nomatchingcontroller"});const x=this.pluginsMap_.inputs.reduce((E,D)=>E||al(D,{document:t,target:n,params:l}),null);if(x)return x;throw new w({context:{key:n.key},type:"nomatchingcontroller"})}createMonitor(t,n,l){const v=this.pluginsMap_.monitors.reduce((x,E)=>x||hl(E,{document:t,params:l,target:n}),null);if(v)return v;throw new w({context:{key:n.key},type:"nomatchingcontroller"})}createBlade(t,n){const l=this.pluginsMap_.blades.reduce((v,x)=>v||Lo(x,{document:t,params:n}),null);if(!l)throw new w({type:"nomatchingview",context:{params:n}});return l}createBladeApi(t){if(t instanceof At)return new Vn(t);if(t instanceof qt)return new Bn(t);if(t instanceof ze)return new tn(t,this);const n=this.pluginsMap_.blades.reduce((l,v)=>l||v.api({controller:t,pool:this}),null);if(!n)throw w.shouldNeverHappen();return n}}function pl(){const s=new dl;return[Fa,ja,Ka,Ya,Ma,_a,ga,ba,kr,Qa,ol,sl,uo,ko,So,Li].forEach(t=>{s.register(t)}),s}class vs extends r{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new c(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}}class ms extends r{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new c(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}}class fs extends r{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",n=>{this.emitter_.emit("change",{event:new c(this,n.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,n){const l=n.bind(this);return this.emitter_.on(t,v=>{l(v.event)}),this}}const ul=function(){return{id:"list",type:"blade",accept(s){const t=j,n=Q(s,{options:t.required.custom(on),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return n?{params:n}:null},controller(s){const t=new Ne(s.document,{props:A.fromObject({options:Yi(s.params.options)}),value:T(s.params.value),viewProps:s.viewProps});return new ve(s.document,{blade:s.blade,props:A.fromObject({label:s.params.label}),valueController:t})},api(s){return!(s.controller instanceof ve)||!(s.controller.valueController instanceof Ne)?null:new vs(s.controller)}}}();function vl(s){return s.reduce((t,n)=>Object.assign(t,{[n.presetKey]:n.read()}),{})}function ml(s,t){s.forEach(n=>{const l=t[n.presetKey];l!==void 0&&n.write(l)})}class fl extends zn{constructor(t,n){super(t,n)}get element(){return this.controller_.view.element}importPreset(t){const n=this.controller_.rackController.rack.find(At).map(l=>l.binding.target);ml(n,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(At).map(n=>n.binding.target);return vl(t)}refresh(){this.controller_.rackController.rack.find(At).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(qt).forEach(t=>{t.binding.read()})}}class bl extends Nn{constructor(t,n){super(t,{expanded:n.expanded,blade:n.blade,props:n.props,root:!0,viewProps:n.viewProps})}}const wl={id:"slider",type:"blade",accept(s){const t=j,n=Q(s,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return n?{params:n}:null},controller(s){var t,n;const l=(t=s.params.value)!==null&&t!==void 0?t:0,v=new Hn(s.document,{baseStep:1,parser:Tt,sliderProps:A.fromObject({maxValue:s.params.max,minValue:s.params.min}),textProps:A.fromObject({draggingScale:fe(void 0,l),formatter:(n=s.params.format)!==null&&n!==void 0?n:ur}),value:T(l),viewProps:s.viewProps});return new ve(s.document,{blade:s.blade,props:A.fromObject({label:s.params.label}),valueController:v})},api(s){return!(s.controller instanceof ve)||!(s.controller.valueController instanceof Hn)?null:new ms(s.controller)}},gl=function(){return{id:"text",type:"blade",accept(s){const t=j,n=Q(s,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return n?{params:n}:null},controller(s){var t;const n=new nn(s.document,{parser:s.params.parse,props:A.fromObject({formatter:(t=s.params.format)!==null&&t!==void 0?t:l=>String(l)}),value:T(s.params.value),viewProps:s.viewProps});return new ve(s.document,{blade:s.blade,props:A.fromObject({label:s.params.label}),valueController:n})},api(s){return!(s.controller instanceof ve)||!(s.controller.valueController instanceof nn)?null:new fs(s.controller)}}}();function _l(s){const t=s.createElement("div");return t.classList.add(_("dfw")()),s.body&&s.body.appendChild(t),t}function bs(s,t,n){if(s.querySelector(`style[data-tp-style=${t}]`))return;const l=s.createElement("style");l.dataset.tpStyle=t,l.textContent=n,s.head.appendChild(l)}class yl extends fl{constructor(t){var n;const l=t||{},v=(n=l.document)!==null&&n!==void 0?n:Qt(),x=pl(),E=new bl(v,{expanded:l.expanded,blade:Se(),props:A.fromObject({title:l.title}),viewProps:jt.create()});super(E,x);this.pool_=x,this.containerElem_=l.container||_l(v),this.containerElem_.appendChild(this.element),this.doc_=v,this.usesDefaultWrapper_=!l.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw w.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw w.alreadyDisposed();if(this.usesDefaultWrapper_){const n=t.parentElement;n&&n.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(l=>{this.pool_.register(l),this.embedPluginStyle_(l)})}embedPluginStyle_(t){t.css&&bs(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){bs(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[wl,ul,Li,gl]})}}const xl=new o("3.0.8");i.BladeApi=r,i.ButtonApi=C,i.FolderApi=zn,i.InputBindingApi=Vn,i.ListApi=vs,i.MonitorBindingApi=Bn,i.Pane=yl,i.SeparatorApi=Ai,i.SliderApi=ms,i.TabApi=zi,i.TabPageApi=Bi,i.TextApi=fs,i.TpChangeEvent=c,i.VERSION=xl,Object.defineProperty(i,"__esModule",{value:!0})})})(fi,fi.exports);var En=function(L,e,i){var o=new Cl,r=new Qs,a=new Ae,c=new rt,h=new rt,d=new rt,p=new El,u=[],b=null,f=null,w=this;function g(){i.addEventListener("pointermove",_,!1),i.addEventListener("pointerdown",k,!1),i.addEventListener("pointerup",V,!1),i.addEventListener("pointerleave",V,!1),i.addEventListener("touchmove",F,!1),i.addEventListener("touchstart",H,!1),i.addEventListener("touchend",N,!1)}function C(){i.removeEventListener("pointermove",_,!1),i.removeEventListener("pointerdown",k,!1),i.removeEventListener("pointerup",V,!1),i.removeEventListener("pointerleave",V,!1),i.removeEventListener("touchmove",F,!1),i.removeEventListener("touchstart",H,!1),i.removeEventListener("touchend",N,!1),i.style.cursor=""}function y(){C()}function P(){return L}function _(z){switch(z.preventDefault(),z.pointerType){case"mouse":case"pen":S(z);break}}function S(z){var q=i.getBoundingClientRect();if(a.x=(z.clientX-q.left)/q.width*2-1,a.y=-((z.clientY-q.top)/q.height)*2+1,r.setFromCamera(a,e),b&&w.enabled){r.ray.intersectPlane(o,h)&&b.position.copy(h.sub(c).applyMatrix4(p)),w.dispatchEvent({type:"drag",object:b});return}if(u.length=0,r.setFromCamera(a,e),r.intersectObjects(L,!0,u),u.length>0){var B=u[0].object;o.setFromNormalAndCoplanarPoint(e.getWorldDirection(o.normal),d.setFromMatrixPosition(B.matrixWorld)),f!==B&&(w.dispatchEvent({type:"hoveron",object:B}),i.style.cursor="pointer",f=B)}else f!==null&&(w.dispatchEvent({type:"hoveroff",object:f}),i.style.cursor="auto",f=null)}function k(z){switch(z.preventDefault(),z.pointerType){case"mouse":case"pen":M(z);break}}function M(z){z.preventDefault(),u.length=0,r.setFromCamera(a,e),r.intersectObjects(L,!0,u),u.length>0&&(b=w.transformGroup===!0?L[0]:u[0].object,r.ray.intersectPlane(o,h)&&(p.copy(b.parent.matrixWorld).invert(),c.copy(h).sub(d.setFromMatrixPosition(b.matrixWorld))),i.style.cursor="move",w.dispatchEvent({type:"dragstart",object:b}))}function V(z){switch(z.preventDefault(),z.pointerType){case"mouse":case"pen":I(z);break}}function I(z){z.preventDefault(),b&&(w.dispatchEvent({type:"dragend",object:b}),b=null),i.style.cursor=f?"pointer":"auto"}function F(z){z.preventDefault(),z=z.changedTouches[0];var q=i.getBoundingClientRect();if(a.x=(z.clientX-q.left)/q.width*2-1,a.y=-((z.clientY-q.top)/q.height)*2+1,r.setFromCamera(a,e),b&&w.enabled){r.ray.intersectPlane(o,h)&&b.position.copy(h.sub(c).applyMatrix4(p)),w.dispatchEvent({type:"drag",object:b});return}}function H(z){z.preventDefault(),z=z.changedTouches[0];var q=i.getBoundingClientRect();a.x=(z.clientX-q.left)/q.width*2-1,a.y=-((z.clientY-q.top)/q.height)*2+1,u.length=0,r.setFromCamera(a,e),r.intersectObjects(L,!0,u),u.length>0&&(b=w.transformGroup===!0?L[0]:u[0].object,o.setFromNormalAndCoplanarPoint(e.getWorldDirection(o.normal),d.setFromMatrixPosition(b.matrixWorld)),r.ray.intersectPlane(o,h)&&(p.copy(b.parent.matrixWorld).invert(),c.copy(h).sub(d.setFromMatrixPosition(b.matrixWorld))),i.style.cursor="move",w.dispatchEvent({type:"dragstart",object:b}))}function N(z){z.preventDefault(),b&&(w.dispatchEvent({type:"dragend",object:b}),b=null),i.style.cursor="auto"}g(),this.enabled=!0,this.transformGroup=!1,this.activate=g,this.deactivate=C,this.dispose=y,this.getObjects=P};En.prototype=Object.create(Pl.prototype);En.prototype.constructor=En;class Gd{constructor(e,i,o){this._particleMaterial=new ws,this.tmpVec0=new m,this.tmpVec1=new m,this.tmpVec2=new m,this.tmpQuat0=new lt,this.scene=e,this.world=i,this._meshes=[],this._material=new Al({color:65280,wireframe:!0}),this._particleMaterial=new ws({color:16711680,size:10,sizeAttenuation:!1,depthTest:!1}),this._sphereGeometry=new gs(1),this._boxGeometry=new _s(1,1,1),this._cylinderGeometry=new li(1,1,2,8),this._planeGeometry=new ys(10,10,10,10),this._particleGeometry=new Pe,this._particleGeometry.setFromPoints([new rt(0,0,0)])}update(){const e=this.world.bodies,i=this._meshes,o=this.tmpVec0,r=this.tmpQuat0;let a=0;for(let c=0;c!==e.length;c++){const h=e[c];for(let d=0;d!==h.shapes.length;d++){const p=h.shapes[d];this._updateMesh(a,h,p);const u=i[a];u&&(h.quaternion.vmult(h.shapeOffsets[d],o),h.position.vadd(o,o),h.quaternion.mult(h.shapeOrientations[d],r),u.position.x=o.x,u.position.y=o.y,u.position.z=o.z,u.quaternion.x=r.x,u.quaternion.y=r.y,u.quaternion.z=r.z,u.quaternion.w=r.w),a++}}for(let c=a;c<i.length;c++){const h=i[c];h&&this.scene.remove(h)}i.length=a}_updateMesh(e,i,o){let r=this._meshes[e];this._typeMatch(r,o)||(r&&this.scene.remove(r),r=this._meshes[e]=this._createMesh(o)),this._scaleMesh(r,o)}_typeMatch(e,i){if(!e)return!1;const o=e.geometry;return o instanceof gs&&i instanceof ih||o instanceof _s&&i instanceof ke||o instanceof li&&i instanceof lo||o instanceof ys&&i instanceof co||i instanceof Ot||o.id===i.id&&i instanceof Cn||o.id===i.id&&i instanceof sh}_createMesh(e){let i,o,r,a,c;const h=this._material;let d=[];switch(e.type){case O.types.SPHERE:i=new _t(this._sphereGeometry,h);break;case O.types.BOX:i=new _t(this._boxGeometry,h);break;case O.types.CYLINDER:o=new li(e.radiusTop,e.radiusBottom,e.height,e.numSegments),i=new _t(o,h);break;case O.types.PLANE:i=new _t(this._planeGeometry,h);break;case O.types.PARTICLE:i=new kl(this._particleGeometry,this._particleMaterial);break;case O.types.CONVEXPOLYHEDRON:o=new Pe,e.id=o.id,d=[];for(let u=0;u<e.vertices.length;u+=1){const b=e.vertices[u];d.push(new rt(b.x,b.y,b.z))}o.setFromPoints(d);const p=[];for(let u=0;u<e.faces.length;u++){const b=e.faces[u],f=b[0];for(let w=1;w<b.length-1;w++){const g=b[w],C=b[w+1];p.push(f,g,C)}}o.setIndex(p),i=new _t(o,h);break;case O.types.TRIMESH:o=new Pe,e.id=o.id,d=[];for(let u=0;u<e.vertices.length;u+=3)d.push(new rt(e.vertices[u],e.vertices[u+1],e.vertices[u+2]));o.setFromPoints(d),i=new _t(o,h);break;case O.types.HEIGHTFIELD:o=new Pe,r=this.tmpVec0,a=this.tmpVec1,c=this.tmpVec2;for(let u=0;u<e.data.length-1;u++)for(let b=0;b<e.data[u].length-1;b++)for(let f=0;f<2;f++)e.getConvexTrianglePillar(u,b,f===0),r.copy(e.pillarConvex.vertices[0]),a.copy(e.pillarConvex.vertices[1]),c.copy(e.pillarConvex.vertices[2]),r.vadd(e.pillarOffset,r),a.vadd(e.pillarOffset,a),c.vadd(e.pillarOffset,c),d.push(new rt(r.x,r.y,r.z),new rt(a.x,a.y,a.z),new rt(c.x,c.y,c.z));o.setFromPoints(d),i=new _t(o,h),e.id=o.id;break;default:i=new _t;break}return i&&i.geometry&&this.scene.add(i),i}_scaleMesh(e,i){let o,r,a;switch(i.type){case O.types.SPHERE:o=i.radius,e.scale.set(o,o,o);break;case O.types.BOX:r=i.halfExtents,e.scale.copy(new rt(r.x,r.y,r.z)),e.scale.multiplyScalar(2);break;case O.types.CONVEXPOLYHEDRON:e.scale.set(1,1,1);break;case O.types.TRIMESH:a=i.scale,e.scale.copy(new rt(a.x,a.y,a.z));break;case O.types.HEIGHTFIELD:e.scale.set(1,1,1);break}}}var Wd={computeTangents:function(L){var e=L.index,i=L.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var o=e.array,r=i.position.array,a=i.normal.array,c=i.uv.array,h=r.length/3;i.tangent===void 0&&L.setAttribute("tangent",new vn(new Float32Array(4*h),4));for(var d=i.tangent.array,p=[],u=[],b=0;b<h;b++)p[b]=new rt,u[b]=new rt;var f=new rt,w=new rt,g=new rt,C=new Ae,y=new Ae,P=new Ae,_=new rt,S=new rt;function k(Y,nt,j){f.fromArray(r,Y*3),w.fromArray(r,nt*3),g.fromArray(r,j*3),C.fromArray(c,Y*2),y.fromArray(c,nt*2),P.fromArray(c,j*2),w.sub(f),g.sub(f),y.sub(C),P.sub(C);var Q=1/(y.x*P.y-P.x*y.y);!isFinite(Q)||(_.copy(w).multiplyScalar(P.y).addScaledVector(g,-y.y).multiplyScalar(Q),S.copy(g).multiplyScalar(y.x).addScaledVector(w,-P.x).multiplyScalar(Q),p[Y].add(_),p[nt].add(_),p[j].add(_),u[Y].add(S),u[nt].add(S),u[j].add(S))}var M=L.groups;M.length===0&&(M=[{start:0,count:o.length}]);for(var b=0,V=M.length;b<V;++b)for(var I=M[b],F=I.start,H=I.count,N=F,z=F+H;N<z;N+=3)k(o[N+0],o[N+1],o[N+2]);var q=new rt,B=new rt,R=new rt,T=new rt,A,X,W;function $(Y){R.fromArray(a,Y*3),T.copy(R),X=p[Y],q.copy(X),q.sub(R.multiplyScalar(R.dot(X))).normalize(),B.crossVectors(T,X),W=B.dot(u[Y]),A=W<0?-1:1,d[Y*4]=q.x,d[Y*4+1]=q.y,d[Y*4+2]=q.z,d[Y*4+3]=A}for(var b=0,V=M.length;b<V;++b)for(var I=M[b],F=I.start,H=I.count,N=F,z=F+H;N<z;N+=3)$(o[N+0]),$(o[N+1]),$(o[N+2])},mergeBufferGeometries:function(L,e){for(var i=L[0].index!==null,o=new Set(Object.keys(L[0].attributes)),r=new Set(Object.keys(L[0].morphAttributes)),a={},c={},h=L[0].morphTargetsRelative,d=new Pe,p=0,u=0;u<L.length;++u){var b=L[u],f=0;if(i!==(b.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var w in b.attributes){if(!o.has(w))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+w+'" attribute exists among all geometries, or in none of them.'),null;a[w]===void 0&&(a[w]=[]),a[w].push(b.attributes[w]),f++}if(f!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(h!==b.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var w in b.morphAttributes){if(!r.has(w))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;c[w]===void 0&&(c[w]=[]),c[w].push(b.morphAttributes[w])}if(d.userData.mergedUserData=d.userData.mergedUserData||[],d.userData.mergedUserData.push(b.userData),e){var g;if(i)g=b.index.count;else if(b.attributes.position!==void 0)g=b.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;d.addGroup(p,g,u),p+=g}}if(i){for(var C=0,y=[],u=0;u<L.length;++u){for(var P=L[u].index,_=0;_<P.count;++_)y.push(P.getX(_)+C);C+=L[u].attributes.position.count}d.setIndex(y)}for(var w in a){var S=this.mergeBufferAttributes(a[w]);if(!S)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+w+" attribute."),null;d.setAttribute(w,S)}for(var w in c){var k=c[w][0].length;if(k===0)break;d.morphAttributes=d.morphAttributes||{},d.morphAttributes[w]=[];for(var u=0;u<k;++u){for(var M=[],_=0;_<c[w].length;++_)M.push(c[w][_][u]);var V=this.mergeBufferAttributes(M);if(!V)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+w+" morphAttribute."),null;d.morphAttributes[w].push(V)}}return d},mergeBufferAttributes:function(L){for(var e,i,o,r=0,a=0;a<L.length;++a){var c=L[a];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=c.itemSize),i!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(o===void 0&&(o=c.normalized),o!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;r+=c.array.length}for(var h=new e(r),d=0,a=0;a<L.length;++a)h.set(L[a].array,d),d+=L[a].array.length;return new vn(h,i,o)},interleaveAttributes:function(L){for(var e,i=0,o=0,r=0,a=L.length;r<a;++r){var c=L[r];if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;i+=c.array.length,o+=c.itemSize}for(var h=new Ml(new e(i),o),d=0,p=[],u=["getX","getY","getZ","getW"],b=["setX","setY","setZ","setW"],f=0,a=L.length;f<a;f++){var c=L[f],w=c.itemSize,g=c.count,C=new Sl(h,w,d,c.normalized);p.push(C),d+=w;for(var y=0;y<g;y++)for(var P=0;P<w;P++)C[b[P]](y,c[u[P]](y))}return p},estimateBytesUsed:function(L){var e=0;for(var i in L.attributes){var o=L.getAttribute(i);e+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}var r=L.getIndex();return e+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,e},mergeVertices:function(L,e=1e-4){e=Math.max(e,Number.EPSILON);for(var i={},o=L.getIndex(),r=L.getAttribute("position"),a=o?o.count:r.count,c=0,h=Object.keys(L.attributes),d={},p={},u=[],b=["getX","getY","getZ","getW"],f=0,w=h.length;f<w;f++){var g=h[f];d[g]=[];var C=L.morphAttributes[g];C&&(p[g]=new Array(C.length).fill().map(()=>[]))}for(var y=Math.log10(1/e),P=Math.pow(10,y),f=0;f<a;f++){for(var _=o?o.getX(f):f,S="",k=0,w=h.length;k<w;k++)for(var g=h[k],M=L.getAttribute(g),V=M.itemSize,I=0;I<V;I++)S+=`${~~(M[b[I]](_)*P)},`;if(S in i)u.push(i[S]);else{for(var k=0,w=h.length;k<w;k++)for(var g=h[k],M=L.getAttribute(g),C=L.morphAttributes[g],V=M.itemSize,F=d[g],H=p[g],I=0;I<V;I++){var N=b[I];if(F.push(M[N](_)),C)for(var z=0,q=C.length;z<q;z++)H[z].push(C[z][N](_))}i[S]=c,u.push(c),c++}}const B=L.clone();for(var f=0,w=h.length;f<w;f++){var g=h[f],R=L.getAttribute(g),T=new R.array.constructor(d[g]),M=new vn(T,R.itemSize,R.normalized);if(B.setAttribute(g,M),g in p)for(var k=0;k<p[g].length;k++){var A=L.morphAttributes[g][k],T=new A.array.constructor(p[g][k]),X=new vn(T,A.itemSize,A.normalized);B.morphAttributes[g][k]=X}}return B.setIndex(u),B},toTrianglesDrawMode:function(L,e){if(e===Vl)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),L;if(e===xs||e===Bl){var i=L.getIndex();if(i===null){var o=[],r=L.getAttribute("position");if(r!==void 0){for(var a=0;a<r.count;a++)o.push(a);L.setIndex(o),i=L.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),L}var c=i.count-2,h=[];if(e===xs)for(var a=1;a<=c;a++)h.push(i.getX(0)),h.push(i.getX(a)),h.push(i.getX(a+1));else for(var a=0;a<c;a++)a%2===0?(h.push(i.getX(a)),h.push(i.getX(a+1)),h.push(i.getX(a+2))):(h.push(i.getX(a+2)),h.push(i.getX(a+1)),h.push(i.getX(a)));h.length/3!==c&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var d=L.clone();return d.setIndex(h),d.clearGroups(),d}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),L}};const Kd=Ql('<div id="progressDiv" class="w-full bg-gray-200 h-2 mb-6 absolute top-1/2" data-v-3a7c6f52><div id="progress" class="transition-all duration-200 ease-in-out bg-main-active h-2 w-{{progressRatio}}" data-v-3a7c6f52></div></div><div class="point point-0" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>1</div><div class="text select-none" data-v-3a7c6f52>This is creation of Roy</div></div><div class="point point-1" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>2</div><div class="text select-none" data-v-3a7c6f52>Switch</div></div><div class="point point-2" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>3</div><div class="text select-none" data-v-3a7c6f52>Light Switch</div></div><div class="point point-3" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>4</div><div class="text select-none" data-v-3a7c6f52>Power</div></div><div class="point point-4" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>5</div><div class="text select-none" data-v-3a7c6f52>Elden Ring</div></div><div class="point point-5" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>6</div><div class="text select-none" data-v-3a7c6f52>USB</div></div><div class="point point-6" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>7</div><div class="text select-none" data-v-3a7c6f52>This is creation of Roy</div></div><div class="point point-7" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>8</div><div class="text select-none" data-v-3a7c6f52>This is creation of Roy</div></div><div class="point point-8" data-v-3a7c6f52><div class="label select-none" data-v-3a7c6f52>9</div><div class="text select-none" data-v-3a7c6f52>This is creation of Roy</div></div>',10),$d={setup(L){let e,i,o,r,a,c,h=Yl(0),d,p,u=0,b=!1,f=-1;new Qs,new Ae,new Ae;const w=new Ul,g=[],C=[],y=new fi.exports.Pane;let P;e={},Xl(()=>{k(),S(),window.addEventListener("resize",()=>{_.width=window.innerWidth,_.height=window.innerHeight,i.aspect=_.width/_.height,i.updateProjectionMatrix(),o.setSize(_.width,_.height),o.setPixelRatio(Math.min(window.devicePixelRatio,2))}),P=new Gd(c,d),V()});const _={width:window.innerWidth,height:window.innerHeight};function S(){const F=document.querySelector("#progress"),H=document.querySelector("#progressDiv");c=new zl,i=new Tl(75,_.width/_.height,.1,100),i.position.set(.7043043492115377,14.388569228135337,9.239105833036682),i.quaternion.set(-.27029782041898764,-.0006752835476387169,-.00018958467553528339,.9627765038296925),i.rotation.set(-.5474052811931926,-.0011978059034376911,-.0007301112729914485),c.add(i);const N=new Ll(4210752);N.intensity=3,c.add(N);const z=20,q=new Nl("#ffffff",3);q.position.set(0,34,-21),q.castShadow=!0,q.shadow.camera.far=50,q.shadow.mapSize.set(1024,1024),q.shadow.camera.top=z,q.shadow.camera.bottom=-z,q.shadow.camera.left=-z,q.shadow.camera.right=z,q.show=200,c.add(q),y.addInput(q,"intensity",{min:0,max:100,step:.001}),y.addInput(q.position,"x",{min:-100,max:100,step:.001}),y.addInput(q.position,"y",{min:-100,max:100,step:.001}),y.addInput(q.position,"z",{min:-100,max:100,step:.001});const B=new Hl(()=>{window.setTimeout(()=>{Kl.to(nt.uniforms.uAlpha,{duration:1,value:0}),H.style.visibility="hidden"},500)},(Q,Pt,zt)=>{h.value=Pt/zt*100,F.style.width=`${h.value}%`}),R=new Gl;R.setDecoderPath("/draco/");const T=new Wl(B);T.setDRACOLoader(R);const X=new Rl(B).load(["/textures/environmentMaps/0/px.jpg","/textures/environmentMaps/0/nx.jpg","/textures/environmentMaps/0/py.jpg","/textures/environmentMaps/0/ny.jpg","/textures/environmentMaps/0/pz.jpg","/textures/environmentMaps/0/nz.jpg"]);Promise.all([T.loadAsync("models/DSPEC_jr/DSPEC_jr.gltf"),T.loadAsync("models/Detector_model/Detector.gltf"),T.loadAsync("models/PortalGun/portalGun.gltf"),T.loadAsync("models/modern_coffee_table_01_2k_2.blend/modern_coffee_table_01_2k.gltf")]).then(Q=>{const[Pt,zt,Xt,Zt]=Q;let dt;Pt.scene.traverse(function(xt){xt.name==="DSPEC_jr"&&(dt=I(xt.children),dt.geometry.center())}),dt.scale.set(.7,.7,.7),dt.position.set(0,8.28,0),dt.userData.i=0;const bt=new Cs().setFromObject(dt),he=new ke(bt.getSize().divide(new rt(2,2,2))),de=new U({mass:1,material:p});de.addShape(he),de.position.copy(dt.position),d.addBody(de),c.add(dt),g.push(de),C.push(dt);let pt;zt.scene.traverse(function(xt){xt.name==="Detector"&&(pt=I(xt.children),pt.geometry.center())}),pt.userData.i=1,pt.position.set(5,8.28,0),pt.rotation.z=-Math.PI/2,pt.rotation.y=-Math.PI/2;const Pn=new lo(.57,.57,3.55,20),Qt=new U({mass:20,material:p});Qt.addShape(Pn),Qt.position.copy(pt.position),Qt.quaternion.copy(pt.quaternion),d.addBody(Qt),c.add(pt),g.push(Qt),C.push(pt);let yt;Zt.scene.traverse(function(xt){xt.name==="modern_coffee_table_01"&&(yt=xt,yt.geometry.center())}),yt.userData.i=-1,yt.scale.set(20,20,20),yt.position.set(0,3.9,0);let An=new Cs().setFromObject(yt);const pe=new ke(An.getSize().divide(new rt(2,2,2))),Jt=new U({mass:20,material:p});Jt.addShape(pe),Jt.position.copy(yt.position),d.addBody(Jt),c.add(yt),g.push(Jt),C.push(yt),M(),b=!0});const W=new _t(new Es(50,50),new ci({color:"#777777",metalness:.3,roughness:.4,envMap:X}));W.receiveShadow=!0,W.rotation.x=-Math.PI*.5,c.add(W);const $=new Il(20);c.add($);const Y=new Es(2,2,1,1),nt=new Fl({wireframe:!0,transparent:!0,uniforms:{uAlpha:{value:1}},vertexShader:`

    void main(){
        gl_Position = vec4(position, 1.0);
        
    }`,fragmentShader:`
    uniform float uAlpha;

    void main(){
        gl_FragColor = vec4(0.0, 0.0, 0.0, uAlpha);
    }`}),j=new _t(Y,nt);c.add(j),X.encoding=Ps,c.background=X,c.environment=X,o=new Dl({antialias:!0}),o.setSize(_.width,_.height),o.setPixelRatio(window.devicePixelRatio),o.physicallyCorrectLights=!0,o.outputEncoding=Ps,o.toneMapping=Ol,o.toneMappingExposure=3,o.shadowMap.enabled=!0,o.shadowMap.type=ql,document.body.appendChild(o.domElement),r=new jl(i,o.domElement),r.enableDamping=!0,a=new En(C,i,o.domElement),a.addEventListener("dragstart",function(Q){f=Q.object.userData.i,console.log(f),f!==-1&&(r.enabled=!1)}),a.addEventListener("dragend",function(Q){f=-1,r.enabled=!0}),a.addEventListener("drag",function(Q){})}function k(){d=new Fd,d.gravity.set(0,-9.8,0),d.allowSleep=!0,p=new Qe("physics");const F=new Ze(p,p,{friction:10,restitution:0});d.addContactMaterial(F);const H=new co,N=new U({mass:0,material:p});N.addShape(H),N.quaternion.setFromEuler(-Math.PI/2,0,0),d.addBody(N)}e.envMapIntensity=10,y.addInput(e,"envMapIntensity",{min:0,max:10,step:.01}).on("change",M);function M(){c.traverse(F=>{F instanceof _t&&F.material instanceof ci&&(F.material.envMapIntensity=e.envMapIntensity,F.material.needsUpdate=!0,F.castShadow=!0,F.receiveShadow=!0)})}Zl(()=>{});const V=()=>{const F=w.getElapsedTime(),H=F-u;u=F,d.step(1/60,H,3),b&&C.forEach((N,z)=>{z===f?(g[z].position.copy(N.position),g[z].quaternion.copy(N.quaternion),g[z].velocity.set(0,0,0),g[z].angularVelocity.set(0,0,0)):(N.position.copy(g[z].position),N.quaternion.copy(g[z].quaternion))}),r.update(),P.update(),o.render(c,i),window.requestAnimationFrame(V)};function I(F){var H=[],N=[],z=new Pe,q,B;return F.forEach(function(R,T){R.updateMatrix(),N.push(R.geometry),q=new ci(R.material),H.push(q)}),z=Wd.mergeBufferGeometries(N,!0),z.groupsNeedUpdate=!0,B=new _t(z,H),B}return(F,H)=>Kd}};var Jd=Jl($d,[["__scopeId","data-v-3a7c6f52"]]);export{Jd as default};
