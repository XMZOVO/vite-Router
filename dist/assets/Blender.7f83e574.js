import{e as nl,R as Ns,V as be,f as ht,M as il,E as sl,a as an,B as Ts,I as ol,g as rl,T as al,h as hs,i as ll,S as cl,P as hl,j as dl,D as pl,k as ul,l as ds,m as ln,n as ps,o as Qn,b as vl,s as us,W as ml,p as fl,q as bl,O as wl,d as gl,L as _l}from"./OrbitControls.3c74ff74.js";import{D as yl,G as xl,g as Cl}from"./index.62bb5d1d.js";import{D as El,l as Pl,C as kl,B as Sl,p as Al}from"./vendor.69ab715b.js";import{_ as Ml}from"./index.852da41d.js";class yt{constructor(i){i===void 0&&(i=[0,0,0,0,0,0,0,0,0]),this.elements=i}identity(){const i=this.elements;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1}setZero(){const i=this.elements;i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0}setTrace(i){const s=this.elements;s[0]=i.x,s[4]=i.y,s[8]=i.z}getTrace(i){i===void 0&&(i=new u);const s=this.elements;return i.x=s[0],i.y=s[4],i.z=s[8],i}vmult(i,s){s===void 0&&(s=new u);const o=this.elements,a=i.x,l=i.y,c=i.z;return s.x=o[0]*a+o[1]*l+o[2]*c,s.y=o[3]*a+o[4]*l+o[5]*c,s.z=o[6]*a+o[7]*l+o[8]*c,s}smult(i){for(let s=0;s<this.elements.length;s++)this.elements[s]*=i}mmult(i,s){s===void 0&&(s=new yt);const o=this.elements,a=i.elements,l=s.elements,c=o[0],h=o[1],p=o[2],v=o[3],m=o[4],w=o[5],f=o[6],b=o[7],g=o[8],C=a[0],y=a[1],E=a[2],_=a[3],M=a[4],S=a[5],A=a[6],V=a[7],N=a[8];return l[0]=c*C+h*_+p*A,l[1]=c*y+h*M+p*V,l[2]=c*E+h*S+p*N,l[3]=v*C+m*_+w*A,l[4]=v*y+m*M+w*V,l[5]=v*E+m*S+w*N,l[6]=f*C+b*_+g*A,l[7]=f*y+b*M+g*V,l[8]=f*E+b*S+g*N,s}scale(i,s){s===void 0&&(s=new yt);const o=this.elements,a=s.elements;for(let l=0;l!==3;l++)a[3*l+0]=i.x*o[3*l+0],a[3*l+1]=i.y*o[3*l+1],a[3*l+2]=i.z*o[3*l+2];return s}solve(i,s){s===void 0&&(s=new u);const o=3,a=4,l=[];let c,h;for(c=0;c<o*a;c++)l.push(0);for(c=0;c<3;c++)for(h=0;h<3;h++)l[c+a*h]=this.elements[c+3*h];l[3+4*0]=i.x,l[3+4*1]=i.y,l[3+4*2]=i.z;let p=3;const v=p;let m;const w=4;let f;do{if(c=v-p,l[c+a*c]===0){for(h=c+1;h<v;h++)if(l[c+a*h]!==0){m=w;do f=w-m,l[f+a*c]+=l[f+a*h];while(--m);break}}if(l[c+a*c]!==0)for(h=c+1;h<v;h++){const b=l[c+a*h]/l[c+a*c];m=w;do f=w-m,l[f+a*h]=f<=c?0:l[f+a*h]-l[f+a*c]*b;while(--m)}}while(--p);if(s.z=l[2*a+3]/l[2*a+2],s.y=(l[1*a+3]-l[1*a+2]*s.z)/l[1*a+1],s.x=(l[0*a+3]-l[0*a+2]*s.z-l[0*a+1]*s.y)/l[0*a+0],isNaN(s.x)||isNaN(s.y)||isNaN(s.z)||s.x===1/0||s.y===1/0||s.z===1/0)throw`Could not solve equation! Got x=[${s.toString()}], b=[${i.toString()}], A=[${this.toString()}]`;return s}e(i,s,o){if(o===void 0)return this.elements[s+3*i];this.elements[s+3*i]=o}copy(i){for(let s=0;s<i.elements.length;s++)this.elements[s]=i.elements[s];return this}toString(){let i="";const s=",";for(let o=0;o<9;o++)i+=this.elements[o]+s;return i}reverse(i){i===void 0&&(i=new yt);const s=3,o=6,a=Vl;let l,c;for(l=0;l<3;l++)for(c=0;c<3;c++)a[l+o*c]=this.elements[l+3*c];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let h=3;const p=h;let v;const m=o;let w;do{if(l=p-h,a[l+o*l]===0){for(c=l+1;c<p;c++)if(a[l+o*c]!==0){v=m;do w=m-v,a[w+o*l]+=a[w+o*c];while(--v);break}}if(a[l+o*l]!==0)for(c=l+1;c<p;c++){const f=a[l+o*c]/a[l+o*l];v=m;do w=m-v,a[w+o*c]=w<=l?0:a[w+o*c]-a[w+o*l]*f;while(--v)}}while(--h);l=2;do{c=l-1;do{const f=a[l+o*c]/a[l+o*l];v=o;do w=o-v,a[w+o*c]=a[w+o*c]-a[w+o*l]*f;while(--v)}while(c--)}while(--l);l=2;do{const f=1/a[l+o*l];v=o;do w=o-v,a[w+o*l]=a[w+o*l]*f;while(--v)}while(l--);l=2;do{c=2;do{if(w=a[s+c+o*l],isNaN(w)||w===1/0)throw`Could not reverse! A=[${this.toString()}]`;i.e(l,c,w)}while(c--)}while(l--);return i}setRotationFromQuaternion(i){const s=i.x,o=i.y,a=i.z,l=i.w,c=s+s,h=o+o,p=a+a,v=s*c,m=s*h,w=s*p,f=o*h,b=o*p,g=a*p,C=l*c,y=l*h,E=l*p,_=this.elements;return _[3*0+0]=1-(f+g),_[3*0+1]=m-E,_[3*0+2]=w+y,_[3*1+0]=m+E,_[3*1+1]=1-(v+g),_[3*1+2]=b-C,_[3*2+0]=w-y,_[3*2+1]=b+C,_[3*2+2]=1-(v+f),this}transpose(i){i===void 0&&(i=new yt);const s=this.elements,o=i.elements;let a;return o[0]=s[0],o[4]=s[4],o[8]=s[8],a=s[1],o[1]=s[3],o[3]=a,a=s[2],o[2]=s[6],o[6]=a,a=s[5],o[5]=s[7],o[7]=a,i}}const Vl=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class u{constructor(i,s,o){i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),this.x=i,this.y=s,this.z=o}cross(i,s){s===void 0&&(s=new u);const o=i.x,a=i.y,l=i.z,c=this.x,h=this.y,p=this.z;return s.x=h*l-p*a,s.y=p*o-c*l,s.z=c*a-h*o,s}set(i,s,o){return this.x=i,this.y=s,this.z=o,this}setZero(){this.x=this.y=this.z=0}vadd(i,s){if(s)s.x=i.x+this.x,s.y=i.y+this.y,s.z=i.z+this.z;else return new u(this.x+i.x,this.y+i.y,this.z+i.z)}vsub(i,s){if(s)s.x=this.x-i.x,s.y=this.y-i.y,s.z=this.z-i.z;else return new u(this.x-i.x,this.y-i.y,this.z-i.z)}crossmat(){return new yt([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const i=this.x,s=this.y,o=this.z,a=Math.sqrt(i*i+s*s+o*o);if(a>0){const l=1/a;this.x*=l,this.y*=l,this.z*=l}else this.x=0,this.y=0,this.z=0;return a}unit(i){i===void 0&&(i=new u);const s=this.x,o=this.y,a=this.z;let l=Math.sqrt(s*s+o*o+a*a);return l>0?(l=1/l,i.x=s*l,i.y=o*l,i.z=a*l):(i.x=1,i.y=0,i.z=0),i}length(){const i=this.x,s=this.y,o=this.z;return Math.sqrt(i*i+s*s+o*o)}lengthSquared(){return this.dot(this)}distanceTo(i){const s=this.x,o=this.y,a=this.z,l=i.x,c=i.y,h=i.z;return Math.sqrt((l-s)*(l-s)+(c-o)*(c-o)+(h-a)*(h-a))}distanceSquared(i){const s=this.x,o=this.y,a=this.z,l=i.x,c=i.y,h=i.z;return(l-s)*(l-s)+(c-o)*(c-o)+(h-a)*(h-a)}scale(i,s){s===void 0&&(s=new u);const o=this.x,a=this.y,l=this.z;return s.x=i*o,s.y=i*a,s.z=i*l,s}vmul(i,s){return s===void 0&&(s=new u),s.x=i.x*this.x,s.y=i.y*this.y,s.z=i.z*this.z,s}addScaledVector(i,s,o){return o===void 0&&(o=new u),o.x=this.x+i*s.x,o.y=this.y+i*s.y,o.z=this.z+i*s.z,o}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(i){return i===void 0&&(i=new u),i.x=-this.x,i.y=-this.y,i.z=-this.z,i}tangents(i,s){const o=this.length();if(o>0){const a=Bl,l=1/o;a.set(this.x*l,this.y*l,this.z*l);const c=Ll;Math.abs(a.x)<.9?(c.set(1,0,0),a.cross(c,i)):(c.set(0,1,0),a.cross(c,i)),a.cross(i,s)}else i.set(1,0,0),s.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}lerp(i,s,o){const a=this.x,l=this.y,c=this.z;o.x=a+(i.x-a)*s,o.y=l+(i.y-l)*s,o.z=c+(i.z-c)*s}almostEquals(i,s){return s===void 0&&(s=1e-6),!(Math.abs(this.x-i.x)>s||Math.abs(this.y-i.y)>s||Math.abs(this.z-i.z)>s)}almostZero(i){return i===void 0&&(i=1e-6),!(Math.abs(this.x)>i||Math.abs(this.y)>i||Math.abs(this.z)>i)}isAntiparallelTo(i,s){return this.negate(vs),vs.almostEquals(i,s)}clone(){return new u(this.x,this.y,this.z)}}u.ZERO=new u(0,0,0);u.UNIT_X=new u(1,0,0);u.UNIT_Y=new u(0,1,0);u.UNIT_Z=new u(0,0,1);const Bl=new u,Ll=new u,vs=new u;class bt{constructor(i){i===void 0&&(i={}),this.lowerBound=new u,this.upperBound=new u,i.lowerBound&&this.lowerBound.copy(i.lowerBound),i.upperBound&&this.upperBound.copy(i.upperBound)}setFromPoints(i,s,o,a){const l=this.lowerBound,c=this.upperBound,h=o;l.copy(i[0]),h&&h.vmult(l,l),c.copy(l);for(let p=1;p<i.length;p++){let v=i[p];h&&(h.vmult(v,ms),v=ms),v.x>c.x&&(c.x=v.x),v.x<l.x&&(l.x=v.x),v.y>c.y&&(c.y=v.y),v.y<l.y&&(l.y=v.y),v.z>c.z&&(c.z=v.z),v.z<l.z&&(l.z=v.z)}return s&&(s.vadd(l,l),s.vadd(c,c)),a&&(l.x-=a,l.y-=a,l.z-=a,c.x+=a,c.y+=a,c.z+=a),this}copy(i){return this.lowerBound.copy(i.lowerBound),this.upperBound.copy(i.upperBound),this}clone(){return new bt().copy(this)}extend(i){this.lowerBound.x=Math.min(this.lowerBound.x,i.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,i.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,i.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,i.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,i.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,i.upperBound.z)}overlaps(i){const s=this.lowerBound,o=this.upperBound,a=i.lowerBound,l=i.upperBound,c=a.x<=o.x&&o.x<=l.x||s.x<=l.x&&l.x<=o.x,h=a.y<=o.y&&o.y<=l.y||s.y<=l.y&&l.y<=o.y,p=a.z<=o.z&&o.z<=l.z||s.z<=l.z&&l.z<=o.z;return c&&h&&p}volume(){const i=this.lowerBound,s=this.upperBound;return(s.x-i.x)*(s.y-i.y)*(s.z-i.z)}contains(i){const s=this.lowerBound,o=this.upperBound,a=i.lowerBound,l=i.upperBound;return s.x<=a.x&&o.x>=l.x&&s.y<=a.y&&o.y>=l.y&&s.z<=a.z&&o.z>=l.z}getCorners(i,s,o,a,l,c,h,p){const v=this.lowerBound,m=this.upperBound;i.copy(v),s.set(m.x,v.y,v.z),o.set(m.x,m.y,v.z),a.set(v.x,m.y,m.z),l.set(m.x,v.y,m.z),c.set(v.x,m.y,v.z),h.set(v.x,v.y,m.z),p.copy(m)}toLocalFrame(i,s){const o=fs,a=o[0],l=o[1],c=o[2],h=o[3],p=o[4],v=o[5],m=o[6],w=o[7];this.getCorners(a,l,c,h,p,v,m,w);for(let f=0;f!==8;f++){const b=o[f];i.pointToLocal(b,b)}return s.setFromPoints(o)}toWorldFrame(i,s){const o=fs,a=o[0],l=o[1],c=o[2],h=o[3],p=o[4],v=o[5],m=o[6],w=o[7];this.getCorners(a,l,c,h,p,v,m,w);for(let f=0;f!==8;f++){const b=o[f];i.pointToWorld(b,b)}return s.setFromPoints(o)}overlapsRay(i){const{direction:s,from:o}=i,a=1/s.x,l=1/s.y,c=1/s.z,h=(this.lowerBound.x-o.x)*a,p=(this.upperBound.x-o.x)*a,v=(this.lowerBound.y-o.y)*l,m=(this.upperBound.y-o.y)*l,w=(this.lowerBound.z-o.z)*c,f=(this.upperBound.z-o.z)*c,b=Math.max(Math.max(Math.min(h,p),Math.min(v,m)),Math.min(w,f)),g=Math.min(Math.min(Math.max(h,p),Math.max(v,m)),Math.max(w,f));return!(g<0||b>g)}}const ms=new u,fs=[new u,new u,new u,new u,new u,new u,new u,new u];class bs{constructor(){this.matrix=[]}get(i,s){let{index:o}=i,{index:a}=s;if(a>o){const l=a;a=o,o=l}return this.matrix[(o*(o+1)>>1)+a-1]}set(i,s,o){let{index:a}=i,{index:l}=s;if(l>a){const c=l;l=a,a=c}this.matrix[(a*(a+1)>>1)+l-1]=o?1:0}reset(){for(let i=0,s=this.matrix.length;i!==s;i++)this.matrix[i]=0}setNumObjects(i){this.matrix.length=i*(i-1)>>1}}class zs{addEventListener(i,s){this._listeners===void 0&&(this._listeners={});const o=this._listeners;return o[i]===void 0&&(o[i]=[]),o[i].includes(s)||o[i].push(s),this}hasEventListener(i,s){if(this._listeners===void 0)return!1;const o=this._listeners;return!!(o[i]!==void 0&&o[i].includes(s))}hasAnyEventListener(i){return this._listeners===void 0?!1:this._listeners[i]!==void 0}removeEventListener(i,s){if(this._listeners===void 0)return this;const o=this._listeners;if(o[i]===void 0)return this;const a=o[i].indexOf(s);return a!==-1&&o[i].splice(a,1),this}dispatchEvent(i){if(this._listeners===void 0)return this;const o=this._listeners[i.type];if(o!==void 0){i.target=this;for(let a=0,l=o.length;a<l;a++)o[a].call(this,i)}return this}}class lt{constructor(i,s,o,a){i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),a===void 0&&(a=1),this.x=i,this.y=s,this.z=o,this.w=a}set(i,s,o,a){return this.x=i,this.y=s,this.z=o,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(i,s){const o=Math.sin(s*.5);return this.x=i.x*o,this.y=i.y*o,this.z=i.z*o,this.w=Math.cos(s*.5),this}toAxisAngle(i){i===void 0&&(i=new u),this.normalize();const s=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(i.x=this.x,i.y=this.y,i.z=this.z):(i.x=this.x/o,i.y=this.y/o,i.z=this.z/o),[i,s]}setFromVectors(i,s){if(i.isAntiparallelTo(s)){const o=Nl,a=Tl;i.tangents(o,a),this.setFromAxisAngle(o,Math.PI)}else{const o=i.cross(s);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(i.length()**2*s.length()**2)+i.dot(s),this.normalize()}return this}mult(i,s){s===void 0&&(s=new lt);const o=this.x,a=this.y,l=this.z,c=this.w,h=i.x,p=i.y,v=i.z,m=i.w;return s.x=o*m+c*h+a*v-l*p,s.y=a*m+c*p+l*h-o*v,s.z=l*m+c*v+o*p-a*h,s.w=c*m-o*h-a*p-l*v,s}inverse(i){i===void 0&&(i=new lt);const s=this.x,o=this.y,a=this.z,l=this.w;this.conjugate(i);const c=1/(s*s+o*o+a*a+l*l);return i.x*=c,i.y*=c,i.z*=c,i.w*=c,i}conjugate(i){return i===void 0&&(i=new lt),i.x=-this.x,i.y=-this.y,i.z=-this.z,i.w=this.w,i}normalize(){let i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return i===0?(this.x=0,this.y=0,this.z=0,this.w=0):(i=1/i,this.x*=i,this.y*=i,this.z*=i,this.w*=i),this}normalizeFast(){const i=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return i===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=i,this.y*=i,this.z*=i,this.w*=i),this}vmult(i,s){s===void 0&&(s=new u);const o=i.x,a=i.y,l=i.z,c=this.x,h=this.y,p=this.z,v=this.w,m=v*o+h*l-p*a,w=v*a+p*o-c*l,f=v*l+c*a-h*o,b=-c*o-h*a-p*l;return s.x=m*v+b*-c+w*-p-f*-h,s.y=w*v+b*-h+f*-c-m*-p,s.z=f*v+b*-p+m*-h-w*-c,s}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w,this}toEuler(i,s){s===void 0&&(s="YZX");let o,a,l;const c=this.x,h=this.y,p=this.z,v=this.w;switch(s){case"YZX":const m=c*h+p*v;if(m>.499&&(o=2*Math.atan2(c,v),a=Math.PI/2,l=0),m<-.499&&(o=-2*Math.atan2(c,v),a=-Math.PI/2,l=0),o===void 0){const w=c*c,f=h*h,b=p*p;o=Math.atan2(2*h*v-2*c*p,1-2*f-2*b),a=Math.asin(2*m),l=Math.atan2(2*c*v-2*h*p,1-2*w-2*b)}break;default:throw new Error(`Euler order ${s} not supported yet.`)}i.y=o,i.z=a,i.x=l}setFromEuler(i,s,o,a){a===void 0&&(a="XYZ");const l=Math.cos(i/2),c=Math.cos(s/2),h=Math.cos(o/2),p=Math.sin(i/2),v=Math.sin(s/2),m=Math.sin(o/2);return a==="XYZ"?(this.x=p*c*h+l*v*m,this.y=l*v*h-p*c*m,this.z=l*c*m+p*v*h,this.w=l*c*h-p*v*m):a==="YXZ"?(this.x=p*c*h+l*v*m,this.y=l*v*h-p*c*m,this.z=l*c*m-p*v*h,this.w=l*c*h+p*v*m):a==="ZXY"?(this.x=p*c*h-l*v*m,this.y=l*v*h+p*c*m,this.z=l*c*m+p*v*h,this.w=l*c*h-p*v*m):a==="ZYX"?(this.x=p*c*h-l*v*m,this.y=l*v*h+p*c*m,this.z=l*c*m-p*v*h,this.w=l*c*h+p*v*m):a==="YZX"?(this.x=p*c*h+l*v*m,this.y=l*v*h+p*c*m,this.z=l*c*m-p*v*h,this.w=l*c*h-p*v*m):a==="XZY"&&(this.x=p*c*h-l*v*m,this.y=l*v*h-p*c*m,this.z=l*c*m+p*v*h,this.w=l*c*h+p*v*m),this}clone(){return new lt(this.x,this.y,this.z,this.w)}slerp(i,s,o){o===void 0&&(o=new lt);const a=this.x,l=this.y,c=this.z,h=this.w;let p=i.x,v=i.y,m=i.z,w=i.w,f,b,g,C,y;return b=a*p+l*v+c*m+h*w,b<0&&(b=-b,p=-p,v=-v,m=-m,w=-w),1-b>1e-6?(f=Math.acos(b),g=Math.sin(f),C=Math.sin((1-s)*f)/g,y=Math.sin(s*f)/g):(C=1-s,y=s),o.x=C*a+y*p,o.y=C*l+y*v,o.z=C*c+y*m,o.w=C*h+y*w,o}integrate(i,s,o,a){a===void 0&&(a=new lt);const l=i.x*o.x,c=i.y*o.y,h=i.z*o.z,p=this.x,v=this.y,m=this.z,w=this.w,f=s*.5;return a.x+=f*(l*w+c*m-h*v),a.y+=f*(c*w+h*p-l*m),a.z+=f*(h*w+l*v-c*p),a.w+=f*(-l*p-c*v-h*m),a}}const Nl=new u,Tl=new u,zl={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class H{constructor(i){i===void 0&&(i={}),this.id=H.idCounter++,this.type=i.type||0,this.boundingSphereRadius=0,this.collisionResponse=i.collisionResponse?i.collisionResponse:!0,this.collisionFilterGroup=i.collisionFilterGroup!==void 0?i.collisionFilterGroup:1,this.collisionFilterMask=i.collisionFilterMask!==void 0?i.collisionFilterMask:-1,this.material=i.material?i.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(i,s){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(i,s,o,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}H.idCounter=0;H.types=zl;class nt{constructor(i){i===void 0&&(i={}),this.position=new u,this.quaternion=new lt,i.position&&this.position.copy(i.position),i.quaternion&&this.quaternion.copy(i.quaternion)}pointToLocal(i,s){return nt.pointToLocalFrame(this.position,this.quaternion,i,s)}pointToWorld(i,s){return nt.pointToWorldFrame(this.position,this.quaternion,i,s)}vectorToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s}static pointToLocalFrame(i,s,o,a){return a===void 0&&(a=new u),o.vsub(i,a),s.conjugate(ws),ws.vmult(a,a),a}static pointToWorldFrame(i,s,o,a){return a===void 0&&(a=new u),s.vmult(o,a),a.vadd(i,a),a}static vectorToWorldFrame(i,s,o){return o===void 0&&(o=new u),i.vmult(s,o),o}static vectorToLocalFrame(i,s,o,a){return a===void 0&&(a=new u),s.w*=-1,s.vmult(o,a),s.w*=-1,a}}const ws=new lt;class we extends H{constructor(i){i===void 0&&(i={});const{vertices:s=[],faces:o=[],normals:a=[],axes:l,boundingSphereRadius:c}=i;super({type:H.types.CONVEXPOLYHEDRON});this.vertices=s,this.faces=o,this.faceNormals=a,this.faceNormals.length===0&&this.computeNormals(),c?this.boundingSphereRadius=c:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=l?l.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const i=this.faces,s=this.vertices,o=this.uniqueEdges;o.length=0;const a=new u;for(let l=0;l!==i.length;l++){const c=i[l],h=c.length;for(let p=0;p!==h;p++){const v=(p+1)%h;s[c[p]].vsub(s[c[v]],a),a.normalize();let m=!1;for(let w=0;w!==o.length;w++)if(o[w].almostEquals(a)||o[w].almostEquals(a)){m=!0;break}m||o.push(a.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let i=0;i<this.faces.length;i++){for(let a=0;a<this.faces[i].length;a++)if(!this.vertices[this.faces[i][a]])throw new Error(`Vertex ${this.faces[i][a]} not found!`);const s=this.faceNormals[i]||new u;this.getFaceNormal(i,s),s.negate(s),this.faceNormals[i]=s;const o=this.vertices[this.faces[i][0]];if(s.dot(o)<0){console.error(`.faceNormals[${i}] = Vec3(${s.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let a=0;a<this.faces[i].length;a++)console.warn(`.vertices[${this.faces[i][a]}] = Vec3(${this.vertices[this.faces[i][a]].toString()})`)}}}getFaceNormal(i,s){const o=this.faces[i],a=this.vertices[o[0]],l=this.vertices[o[1]],c=this.vertices[o[2]];we.computeNormal(a,l,c,s)}static computeNormal(i,s,o,a){const l=new u,c=new u;s.vsub(i,c),o.vsub(s,l),l.cross(c,a),a.isZero()||a.normalize()}clipAgainstHull(i,s,o,a,l,c,h,p,v){const m=new u;let w=-1,f=-Number.MAX_VALUE;for(let g=0;g<o.faces.length;g++){m.copy(o.faceNormals[g]),l.vmult(m,m);const C=m.dot(c);C>f&&(f=C,w=g)}const b=[];for(let g=0;g<o.faces[w].length;g++){const C=o.vertices[o.faces[w][g]],y=new u;y.copy(C),l.vmult(y,y),a.vadd(y,y),b.push(y)}w>=0&&this.clipFaceAgainstHull(c,i,s,b,h,p,v)}findSeparatingAxis(i,s,o,a,l,c,h,p){const v=new u,m=new u,w=new u,f=new u,b=new u,g=new u;let C=Number.MAX_VALUE;const y=this;if(y.uniqueAxes)for(let E=0;E!==y.uniqueAxes.length;E++){o.vmult(y.uniqueAxes[E],v);const _=y.testSepAxis(v,i,s,o,a,l);if(_===!1)return!1;_<C&&(C=_,c.copy(v))}else{const E=h?h.length:y.faces.length;for(let _=0;_<E;_++){const M=h?h[_]:_;v.copy(y.faceNormals[M]),o.vmult(v,v);const S=y.testSepAxis(v,i,s,o,a,l);if(S===!1)return!1;S<C&&(C=S,c.copy(v))}}if(i.uniqueAxes)for(let E=0;E!==i.uniqueAxes.length;E++){l.vmult(i.uniqueAxes[E],m);const _=y.testSepAxis(m,i,s,o,a,l);if(_===!1)return!1;_<C&&(C=_,c.copy(m))}else{const E=p?p.length:i.faces.length;for(let _=0;_<E;_++){const M=p?p[_]:_;m.copy(i.faceNormals[M]),l.vmult(m,m);const S=y.testSepAxis(m,i,s,o,a,l);if(S===!1)return!1;S<C&&(C=S,c.copy(m))}}for(let E=0;E!==y.uniqueEdges.length;E++){o.vmult(y.uniqueEdges[E],f);for(let _=0;_!==i.uniqueEdges.length;_++)if(l.vmult(i.uniqueEdges[_],b),f.cross(b,g),!g.almostZero()){g.normalize();const M=y.testSepAxis(g,i,s,o,a,l);if(M===!1)return!1;M<C&&(C=M,c.copy(g))}}return a.vsub(s,w),w.dot(c)>0&&c.negate(c),!0}testSepAxis(i,s,o,a,l,c){const h=this;we.project(h,i,o,a,ti),we.project(s,i,l,c,ei);const p=ti[0],v=ti[1],m=ei[0],w=ei[1];if(p<w||m<v)return!1;const f=p-w,b=m-v;return f<b?f:b}calculateLocalInertia(i,s){const o=new u,a=new u;this.computeLocalAABB(a,o);const l=o.x-a.x,c=o.y-a.y,h=o.z-a.z;s.x=1/12*i*(2*c*2*c+2*h*2*h),s.y=1/12*i*(2*l*2*l+2*h*2*h),s.z=1/12*i*(2*c*2*c+2*l*2*l)}getPlaneConstantOfFace(i){const s=this.faces[i],o=this.faceNormals[i],a=this.vertices[s[0]];return-o.dot(a)}clipFaceAgainstHull(i,s,o,a,l,c,h){const p=new u,v=new u,m=new u,w=new u,f=new u,b=new u,g=new u,C=new u,y=this,E=[],_=a,M=E;let S=-1,A=Number.MAX_VALUE;for(let R=0;R<y.faces.length;R++){p.copy(y.faceNormals[R]),o.vmult(p,p);const L=p.dot(i);L<A&&(A=L,S=R)}if(S<0)return;const V=y.faces[S];V.connectedFaces=[];for(let R=0;R<y.faces.length;R++)for(let L=0;L<y.faces[R].length;L++)V.indexOf(y.faces[R][L])!==-1&&R!==S&&V.connectedFaces.indexOf(R)===-1&&V.connectedFaces.push(R);const N=V.length;for(let R=0;R<N;R++){const L=y.vertices[V[R]],j=y.vertices[V[(R+1)%N]];L.vsub(j,v),m.copy(v),o.vmult(m,m),s.vadd(m,m),w.copy(this.faceNormals[S]),o.vmult(w,w),s.vadd(w,w),m.cross(w,f),f.negate(f),b.copy(L),o.vmult(b,b),s.vadd(b,b);const B=V.connectedFaces[R];g.copy(this.faceNormals[B]);const I=this.getPlaneConstantOfFace(B);C.copy(g),o.vmult(C,C);const T=I-C.dot(s);for(this.clipFaceAgainstPlane(_,M,C,T);_.length;)_.shift();for(;M.length;)_.push(M.shift())}g.copy(this.faceNormals[S]);const O=this.getPlaneConstantOfFace(S);C.copy(g),o.vmult(C,C);const q=O-C.dot(s);for(let R=0;R<_.length;R++){let L=C.dot(_[R])+q;if(L<=l&&(console.log(`clamped: depth=${L} to minDist=${l}`),L=l),L<=c){const j=_[R];if(L<=1e-6){const B={point:j,normal:C,depth:L};h.push(B)}}}}clipFaceAgainstPlane(i,s,o,a){let l,c;const h=i.length;if(h<2)return s;let p=i[i.length-1],v=i[0];l=o.dot(p)+a;for(let m=0;m<h;m++){if(v=i[m],c=o.dot(v)+a,l<0)if(c<0){const w=new u;w.copy(v),s.push(w)}else{const w=new u;p.lerp(v,l/(l-c),w),s.push(w)}else if(c<0){const w=new u;p.lerp(v,l/(l-c),w),s.push(w),s.push(v)}p=v,l=c}return s}computeWorldVertices(i,s){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new u);const o=this.vertices,a=this.worldVertices;for(let l=0;l!==this.vertices.length;l++)s.vmult(o[l],a[l]),i.vadd(a[l],a[l]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(i,s){const o=this.vertices;i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let a=0;a<this.vertices.length;a++){const l=o[a];l.x<i.x?i.x=l.x:l.x>s.x&&(s.x=l.x),l.y<i.y?i.y=l.y:l.y>s.y&&(s.y=l.y),l.z<i.z?i.z=l.z:l.z>s.z&&(s.z=l.z)}}computeWorldFaceNormals(i){const s=this.faceNormals.length;for(;this.worldFaceNormals.length<s;)this.worldFaceNormals.push(new u);const o=this.faceNormals,a=this.worldFaceNormals;for(let l=0;l!==s;l++)i.vmult(o[l],a[l]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let i=0;const s=this.vertices;for(let o=0;o!==s.length;o++){const a=s[o].lengthSquared();a>i&&(i=a)}this.boundingSphereRadius=Math.sqrt(i)}calculateWorldAABB(i,s,o,a){const l=this.vertices;let c,h,p,v,m,w,f=new u;for(let b=0;b<l.length;b++){f.copy(l[b]),s.vmult(f,f),i.vadd(f,f);const g=f;(c===void 0||g.x<c)&&(c=g.x),(v===void 0||g.x>v)&&(v=g.x),(h===void 0||g.y<h)&&(h=g.y),(m===void 0||g.y>m)&&(m=g.y),(p===void 0||g.z<p)&&(p=g.z),(w===void 0||g.z>w)&&(w=g.z)}o.set(c,h,p),a.set(v,m,w)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(i){i===void 0&&(i=new u);const s=this.vertices;for(let o=0;o<s.length;o++)i.vadd(s[o],i);return i.scale(1/s.length,i),i}transformAllPoints(i,s){const o=this.vertices.length,a=this.vertices;if(s){for(let l=0;l<o;l++){const c=a[l];s.vmult(c,c)}for(let l=0;l<this.faceNormals.length;l++){const c=this.faceNormals[l];s.vmult(c,c)}}if(i)for(let l=0;l<o;l++){const c=a[l];c.vadd(i,c)}}pointIsInside(i){const s=this.vertices,o=this.faces,a=this.faceNormals,l=new u;this.getAveragePointLocal(l);for(let c=0;c<this.faces.length;c++){let h=a[c];const p=s[o[c][0]],v=new u;i.vsub(p,v);const m=h.dot(v),w=new u;l.vsub(p,w);const f=h.dot(w);if(m<0&&f>0||m>0&&f<0)return!1}return-1}static project(i,s,o,a,l){const c=i.vertices.length,h=Rl;let p=0,v=0;const m=Il,w=i.vertices;m.setZero(),nt.vectorToLocalFrame(o,a,s,h),nt.pointToLocalFrame(o,a,m,m);const f=m.dot(h);v=p=w[0].dot(h);for(let b=1;b<c;b++){const g=w[b].dot(h);g>p&&(p=g),g<v&&(v=g)}if(v-=f,p-=f,v>p){const b=v;v=p,p=b}l[0]=p,l[1]=v}}const ti=[],ei=[];new u;const Rl=new u,Il=new u;class qe extends H{constructor(i){super({type:H.types.BOX});this.halfExtents=i,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const i=this.halfExtents.x,s=this.halfExtents.y,o=this.halfExtents.z,a=u,l=[new a(-i,-s,-o),new a(i,-s,-o),new a(i,s,-o),new a(-i,s,-o),new a(-i,-s,o),new a(i,-s,o),new a(i,s,o),new a(-i,s,o)],c=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],h=[new a(0,0,1),new a(0,1,0),new a(1,0,0)],p=new we({vertices:l,faces:c,axes:h});this.convexPolyhedronRepresentation=p,p.material=this.material}calculateLocalInertia(i,s){return s===void 0&&(s=new u),qe.calculateInertia(this.halfExtents,i,s),s}static calculateInertia(i,s,o){const a=i;o.x=1/12*s*(2*a.y*2*a.y+2*a.z*2*a.z),o.y=1/12*s*(2*a.x*2*a.x+2*a.z*2*a.z),o.z=1/12*s*(2*a.y*2*a.y+2*a.x*2*a.x)}getSideNormals(i,s){const o=i,a=this.halfExtents;if(o[0].set(a.x,0,0),o[1].set(0,a.y,0),o[2].set(0,0,a.z),o[3].set(-a.x,0,0),o[4].set(0,-a.y,0),o[5].set(0,0,-a.z),s!==void 0)for(let l=0;l!==o.length;l++)s.vmult(o[l],o[l]);return o}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(i,s,o){const a=this.halfExtents,l=[[a.x,a.y,a.z],[-a.x,a.y,a.z],[-a.x,-a.y,a.z],[-a.x,-a.y,-a.z],[a.x,-a.y,-a.z],[a.x,a.y,-a.z],[-a.x,a.y,-a.z],[a.x,-a.y,a.z]];for(let c=0;c<l.length;c++)Kt.set(l[c][0],l[c][1],l[c][2]),s.vmult(Kt,Kt),i.vadd(Kt,Kt),o(Kt.x,Kt.y,Kt.z)}calculateWorldAABB(i,s,o,a){const l=this.halfExtents;kt[0].set(l.x,l.y,l.z),kt[1].set(-l.x,l.y,l.z),kt[2].set(-l.x,-l.y,l.z),kt[3].set(-l.x,-l.y,-l.z),kt[4].set(l.x,-l.y,-l.z),kt[5].set(l.x,l.y,-l.z),kt[6].set(-l.x,l.y,-l.z),kt[7].set(l.x,-l.y,l.z);const c=kt[0];s.vmult(c,c),i.vadd(c,c),a.copy(c),o.copy(c);for(let h=1;h<8;h++){const p=kt[h];s.vmult(p,p),i.vadd(p,p);const v=p.x,m=p.y,w=p.z;v>a.x&&(a.x=v),m>a.y&&(a.y=m),w>a.z&&(a.z=w),v<o.x&&(o.x=v),m<o.y&&(o.y=m),w<o.z&&(o.z=w)}}}const Kt=new u,kt=[new u,new u,new u,new u,new u,new u,new u,new u],ai={DYNAMIC:1,STATIC:2,KINEMATIC:4},li={AWAKE:0,SLEEPY:1,SLEEPING:2};class U extends zs{constructor(i){i===void 0&&(i={});super();this.id=U.idCounter++,this.index=-1,this.world=null,this.vlambda=new u,this.collisionFilterGroup=typeof i.collisionFilterGroup=="number"?i.collisionFilterGroup:1,this.collisionFilterMask=typeof i.collisionFilterMask=="number"?i.collisionFilterMask:-1,this.collisionResponse=typeof i.collisionResponse=="boolean"?i.collisionResponse:!0,this.position=new u,this.previousPosition=new u,this.interpolatedPosition=new u,this.initPosition=new u,i.position&&(this.position.copy(i.position),this.previousPosition.copy(i.position),this.interpolatedPosition.copy(i.position),this.initPosition.copy(i.position)),this.velocity=new u,i.velocity&&this.velocity.copy(i.velocity),this.initVelocity=new u,this.force=new u;const s=typeof i.mass=="number"?i.mass:0;this.mass=s,this.invMass=s>0?1/s:0,this.material=i.material||null,this.linearDamping=typeof i.linearDamping=="number"?i.linearDamping:.01,this.type=s<=0?U.STATIC:U.DYNAMIC,typeof i.type==typeof U.STATIC&&(this.type=i.type),this.allowSleep=typeof i.allowSleep!="undefined"?i.allowSleep:!0,this.sleepState=U.AWAKE,this.sleepSpeedLimit=typeof i.sleepSpeedLimit!="undefined"?i.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof i.sleepTimeLimit!="undefined"?i.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new u,this.quaternion=new lt,this.initQuaternion=new lt,this.previousQuaternion=new lt,this.interpolatedQuaternion=new lt,i.quaternion&&(this.quaternion.copy(i.quaternion),this.initQuaternion.copy(i.quaternion),this.previousQuaternion.copy(i.quaternion),this.interpolatedQuaternion.copy(i.quaternion)),this.angularVelocity=new u,i.angularVelocity&&this.angularVelocity.copy(i.angularVelocity),this.initAngularVelocity=new u,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new u,this.invInertia=new u,this.invInertiaWorld=new yt,this.invMassSolve=0,this.invInertiaSolve=new u,this.invInertiaWorldSolve=new yt,this.fixedRotation=typeof i.fixedRotation!="undefined"?i.fixedRotation:!1,this.angularDamping=typeof i.angularDamping!="undefined"?i.angularDamping:.01,this.linearFactor=new u(1,1,1),i.linearFactor&&this.linearFactor.copy(i.linearFactor),this.angularFactor=new u(1,1,1),i.angularFactor&&this.angularFactor.copy(i.angularFactor),this.aabb=new bt,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new u,this.isTrigger=Boolean(i.isTrigger),i.shape&&this.addShape(i.shape),this.updateMassProperties()}wakeUp(){const i=this.sleepState;this.sleepState=U.AWAKE,this.wakeUpAfterNarrowphase=!1,i===U.SLEEPING&&this.dispatchEvent(U.wakeupEvent)}sleep(){this.sleepState=U.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(i){if(this.allowSleep){const s=this.sleepState,o=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),a=this.sleepSpeedLimit**2;s===U.AWAKE&&o<a?(this.sleepState=U.SLEEPY,this.timeLastSleepy=i,this.dispatchEvent(U.sleepyEvent)):s===U.SLEEPY&&o>a?this.wakeUp():s===U.SLEEPY&&i-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(U.sleepEvent))}}updateSolveMassProperties(){this.sleepState===U.SLEEPING||this.type===U.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(i,s){return s===void 0&&(s=new u),i.vsub(this.position,s),this.quaternion.conjugate().vmult(s,s),s}vectorToLocalFrame(i,s){return s===void 0&&(s=new u),this.quaternion.conjugate().vmult(i,s),s}pointToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s.vadd(this.position,s),s}vectorToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s}addShape(i,s,o){const a=new u,l=new lt;return s&&a.copy(s),o&&l.copy(o),this.shapes.push(i),this.shapeOffsets.push(a),this.shapeOrientations.push(l),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,i.body=this,this}removeShape(i){const s=this.shapes.indexOf(i);return s===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(s,1),this.shapeOffsets.splice(s,1),this.shapeOrientations.splice(s,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,i.body=null,this)}updateBoundingRadius(){const i=this.shapes,s=this.shapeOffsets,o=i.length;let a=0;for(let l=0;l!==o;l++){const c=i[l];c.updateBoundingSphereRadius();const h=s[l].length(),p=c.boundingSphereRadius;h+p>a&&(a=h+p)}this.boundingRadius=a}updateAABB(){const i=this.shapes,s=this.shapeOffsets,o=this.shapeOrientations,a=i.length,l=Fl,c=Dl,h=this.quaternion,p=this.aabb,v=Ol;for(let m=0;m!==a;m++){const w=i[m];h.vmult(s[m],l),l.vadd(this.position,l),h.mult(o[m],c),w.calculateWorldAABB(l,c,v.lowerBound,v.upperBound),m===0?p.copy(v):p.extend(v)}this.aabbNeedsUpdate=!1}updateInertiaWorld(i){const s=this.invInertia;if(!(s.x===s.y&&s.y===s.z&&!i)){const o=ql,a=jl;o.setRotationFromQuaternion(this.quaternion),o.transpose(a),o.scale(s,o),o.mmult(a,this.invInertiaWorld)}}applyForce(i,s){if(s===void 0&&(s=new u),this.type!==U.DYNAMIC)return;this.sleepState===U.SLEEPING&&this.wakeUp();const o=Hl;s.cross(i,o),this.force.vadd(i,this.force),this.torque.vadd(o,this.torque)}applyLocalForce(i,s){if(s===void 0&&(s=new u),this.type!==U.DYNAMIC)return;const o=Gl,a=Kl;this.vectorToWorldFrame(i,o),this.vectorToWorldFrame(s,a),this.applyForce(o,a)}applyTorque(i){this.type===U.DYNAMIC&&(this.sleepState===U.SLEEPING&&this.wakeUp(),this.torque.vadd(i,this.torque))}applyImpulse(i,s){if(s===void 0&&(s=new u),this.type!==U.DYNAMIC)return;this.sleepState===U.SLEEPING&&this.wakeUp();const o=s,a=Wl;a.copy(i),a.scale(this.invMass,a),this.velocity.vadd(a,this.velocity);const l=$l;o.cross(i,l),this.invInertiaWorld.vmult(l,l),this.angularVelocity.vadd(l,this.angularVelocity)}applyLocalImpulse(i,s){if(s===void 0&&(s=new u),this.type!==U.DYNAMIC)return;const o=Yl,a=Xl;this.vectorToWorldFrame(i,o),this.vectorToWorldFrame(s,a),this.applyImpulse(o,a)}updateMassProperties(){const i=Zl;this.invMass=this.mass>0?1/this.mass:0;const s=this.inertia,o=this.fixedRotation;this.updateAABB(),i.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),qe.calculateInertia(i,this.mass,s),this.invInertia.set(s.x>0&&!o?1/s.x:0,s.y>0&&!o?1/s.y:0,s.z>0&&!o?1/s.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(i,s){const o=new u;return i.vsub(this.position,o),this.angularVelocity.cross(o,s),this.velocity.vadd(s,s),s}integrate(i,s,o){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===U.DYNAMIC||this.type===U.KINEMATIC)||this.sleepState===U.SLEEPING)return;const a=this.velocity,l=this.angularVelocity,c=this.position,h=this.force,p=this.torque,v=this.quaternion,m=this.invMass,w=this.invInertiaWorld,f=this.linearFactor,b=m*i;a.x+=h.x*b*f.x,a.y+=h.y*b*f.y,a.z+=h.z*b*f.z;const g=w.elements,C=this.angularFactor,y=p.x*C.x,E=p.y*C.y,_=p.z*C.z;l.x+=i*(g[0]*y+g[1]*E+g[2]*_),l.y+=i*(g[3]*y+g[4]*E+g[5]*_),l.z+=i*(g[6]*y+g[7]*E+g[8]*_),c.x+=a.x*i,c.y+=a.y*i,c.z+=a.z*i,v.integrate(this.angularVelocity,i,this.angularFactor,v),s&&(o?v.normalizeFast():v.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}U.idCounter=0;U.COLLIDE_EVENT_NAME="collide";U.DYNAMIC=ai.DYNAMIC;U.STATIC=ai.STATIC;U.KINEMATIC=ai.KINEMATIC;U.AWAKE=li.AWAKE;U.SLEEPY=li.SLEEPY;U.SLEEPING=li.SLEEPING;U.wakeupEvent={type:"wakeup"};U.sleepyEvent={type:"sleepy"};U.sleepEvent={type:"sleep"};const Fl=new u,Dl=new lt,Ol=new bt,ql=new yt,jl=new yt,Ul=new yt,Hl=new u,Gl=new u,Kl=new u,Wl=new u,$l=new u,Yl=new u,Xl=new u,Zl=new u;class Jl{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(i,s,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(i,s){return!((i.collisionFilterGroup&s.collisionFilterMask)===0||(s.collisionFilterGroup&i.collisionFilterMask)===0||((i.type&U.STATIC)!==0||i.sleepState===U.SLEEPING)&&((s.type&U.STATIC)!==0||s.sleepState===U.SLEEPING))}intersectionTest(i,s,o,a){this.useBoundingBoxes?this.doBoundingBoxBroadphase(i,s,o,a):this.doBoundingSphereBroadphase(i,s,o,a)}doBoundingSphereBroadphase(i,s,o,a){const l=Ql;s.position.vsub(i.position,l);const c=(i.boundingRadius+s.boundingRadius)**2;l.lengthSquared()<c&&(o.push(i),a.push(s))}doBoundingBoxBroadphase(i,s,o,a){i.aabbNeedsUpdate&&i.updateAABB(),s.aabbNeedsUpdate&&s.updateAABB(),i.aabb.overlaps(s.aabb)&&(o.push(i),a.push(s))}makePairsUnique(i,s){const o=tc,a=ec,l=nc,c=i.length;for(let h=0;h!==c;h++)a[h]=i[h],l[h]=s[h];i.length=0,s.length=0;for(let h=0;h!==c;h++){const p=a[h].id,v=l[h].id,m=p<v?`${p},${v}`:`${v},${p}`;o[m]=h,o.keys.push(m)}for(let h=0;h!==o.keys.length;h++){const p=o.keys.pop(),v=o[p];i.push(a[v]),s.push(l[v]),delete o[p]}}setWorld(i){}static boundingSphereCheck(i,s){const o=new u;i.position.vsub(s.position,o);const a=i.shapes[0],l=s.shapes[0];return Math.pow(a.boundingSphereRadius+l.boundingSphereRadius,2)>o.lengthSquared()}aabbQuery(i,s,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Ql=new u;new u;new lt;new u;const tc={keys:[]},ec=[],nc=[];new u;new u;new u;class ic extends Jl{constructor(){super()}collisionPairs(i,s,o){const a=i.bodies,l=a.length;let c,h;for(let p=0;p!==l;p++)for(let v=0;v!==p;v++)c=a[p],h=a[v],!!this.needBroadphaseCollision(c,h)&&this.intersectionTest(c,h,s,o)}aabbQuery(i,s,o){o===void 0&&(o=[]);for(let a=0;a<i.bodies.length;a++){const l=i.bodies[a];l.aabbNeedsUpdate&&l.updateAABB(),l.aabb.overlaps(s)&&o.push(l)}return o}}class vn{constructor(){this.rayFromWorld=new u,this.rayToWorld=new u,this.hitNormalWorld=new u,this.hitPointWorld=new u,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(i,s,o,a,l,c,h){this.rayFromWorld.copy(i),this.rayToWorld.copy(s),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(a),this.shape=l,this.body=c,this.distance=h}}let Rs,Is,Fs,Ds,Os,qs,js;const ci={CLOSEST:1,ANY:2,ALL:4};Rs=H.types.SPHERE;Is=H.types.PLANE;Fs=H.types.BOX;Ds=H.types.CYLINDER;Os=H.types.CONVEXPOLYHEDRON;qs=H.types.HEIGHTFIELD;js=H.types.TRIMESH;class at{get[Rs](){return this._intersectSphere}get[Is](){return this._intersectPlane}get[Fs](){return this._intersectBox}get[Ds](){return this._intersectConvex}get[Os](){return this._intersectConvex}get[qs](){return this._intersectHeightfield}get[js](){return this._intersectTrimesh}constructor(i,s){i===void 0&&(i=new u),s===void 0&&(s=new u),this.from=i.clone(),this.to=s.clone(),this.direction=new u,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=at.ANY,this.result=new vn,this.hasHit=!1,this.callback=o=>{}}intersectWorld(i,s){return this.mode=s.mode||at.ANY,this.result=s.result||new vn,this.skipBackfaces=!!s.skipBackfaces,this.collisionFilterMask=typeof s.collisionFilterMask!="undefined"?s.collisionFilterMask:-1,this.collisionFilterGroup=typeof s.collisionFilterGroup!="undefined"?s.collisionFilterGroup:-1,this.checkCollisionResponse=typeof s.checkCollisionResponse!="undefined"?s.checkCollisionResponse:!0,s.from&&this.from.copy(s.from),s.to&&this.to.copy(s.to),this.callback=s.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(gs),ni.length=0,i.broadphase.aabbQuery(i,gs,ni),this.intersectBodies(ni),this.hasHit}intersectBody(i,s){s&&(this.result=s,this.updateDirection());const o=this.checkCollisionResponse;if(o&&!i.collisionResponse||(this.collisionFilterGroup&i.collisionFilterMask)===0||(i.collisionFilterGroup&this.collisionFilterMask)===0)return;const a=sc,l=oc;for(let c=0,h=i.shapes.length;c<h;c++){const p=i.shapes[c];if(!(o&&!p.collisionResponse)&&(i.quaternion.mult(i.shapeOrientations[c],l),i.quaternion.vmult(i.shapeOffsets[c],a),a.vadd(i.position,a),this.intersectShape(p,l,a,i),this.result.shouldStop))break}}intersectBodies(i,s){s&&(this.result=s,this.updateDirection());for(let o=0,a=i.length;!this.result.shouldStop&&o<a;o++)this.intersectBody(i[o])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(i,s,o,a){const l=this.from;if(gc(l,this.direction,o)>i.boundingSphereRadius)return;const h=this[i.type];h&&h.call(this,i,s,o,a,i)}_intersectBox(i,s,o,a,l){return this._intersectConvex(i.convexPolyhedronRepresentation,s,o,a,l)}_intersectPlane(i,s,o,a,l){const c=this.from,h=this.to,p=this.direction,v=new u(0,0,1);s.vmult(v,v);const m=new u;c.vsub(o,m);const w=m.dot(v);h.vsub(o,m);const f=m.dot(v);if(w*f>0||c.distanceTo(h)<w)return;const b=v.dot(p);if(Math.abs(b)<this.precision)return;const g=new u,C=new u,y=new u;c.vsub(o,g);const E=-v.dot(g)/b;p.scale(E,C),c.vadd(C,y),this.reportIntersection(v,y,l,a,-1)}getAABB(i){const{lowerBound:s,upperBound:o}=i,a=this.to,l=this.from;s.x=Math.min(a.x,l.x),s.y=Math.min(a.y,l.y),s.z=Math.min(a.z,l.z),o.x=Math.max(a.x,l.x),o.y=Math.max(a.y,l.y),o.z=Math.max(a.z,l.z)}_intersectHeightfield(i,s,o,a,l){i.data,i.elementSize;const c=rc;c.from.copy(this.from),c.to.copy(this.to),nt.pointToLocalFrame(o,s,c.from,c.from),nt.pointToLocalFrame(o,s,c.to,c.to),c.updateDirection();const h=ac;let p,v,m,w;p=v=0,m=w=i.data.length-1;const f=new bt;c.getAABB(f),i.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,h,!0),p=Math.max(p,h[0]),v=Math.max(v,h[1]),i.getIndexOfPosition(f.upperBound.x,f.upperBound.y,h,!0),m=Math.min(m,h[0]+1),w=Math.min(w,h[1]+1);for(let b=p;b<m;b++)for(let g=v;g<w;g++){if(this.result.shouldStop)return;if(i.getAabbAtIndex(b,g,f),!!f.overlapsRay(c)){if(i.getConvexTrianglePillar(b,g,!1),nt.pointToWorldFrame(o,s,i.pillarOffset,cn),this._intersectConvex(i.pillarConvex,s,cn,a,l,_s),this.result.shouldStop)return;i.getConvexTrianglePillar(b,g,!0),nt.pointToWorldFrame(o,s,i.pillarOffset,cn),this._intersectConvex(i.pillarConvex,s,cn,a,l,_s)}}}_intersectSphere(i,s,o,a,l){const c=this.from,h=this.to,p=i.radius,v=(h.x-c.x)**2+(h.y-c.y)**2+(h.z-c.z)**2,m=2*((h.x-c.x)*(c.x-o.x)+(h.y-c.y)*(c.y-o.y)+(h.z-c.z)*(c.z-o.z)),w=(c.x-o.x)**2+(c.y-o.y)**2+(c.z-o.z)**2-p**2,f=m**2-4*v*w,b=lc,g=cc;if(!(f<0))if(f===0)c.lerp(h,f,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1);else{const C=(-m-Math.sqrt(f))/(2*v),y=(-m+Math.sqrt(f))/(2*v);if(C>=0&&C<=1&&(c.lerp(h,C,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(c.lerp(h,y,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1))}}_intersectConvex(i,s,o,a,l,c){const h=hc,p=ys,v=c&&c.faceList||null,m=i.faces,w=i.vertices,f=i.faceNormals,b=this.direction,g=this.from,C=this.to,y=g.distanceTo(C),E=v?v.length:m.length,_=this.result;for(let M=0;!_.shouldStop&&M<E;M++){const S=v?v[M]:M,A=m[S],V=f[S],N=s,O=o;p.copy(w[A[0]]),N.vmult(p,p),p.vadd(O,p),p.vsub(g,p),N.vmult(V,h);const q=b.dot(h);if(Math.abs(q)<this.precision)continue;const R=h.dot(p)/q;if(!(R<0)){b.scale(R,vt),vt.vadd(g,vt),_t.copy(w[A[0]]),N.vmult(_t,_t),O.vadd(_t,_t);for(let L=1;!_.shouldStop&&L<A.length-1;L++){St.copy(w[A[L]]),At.copy(w[A[L+1]]),N.vmult(St,St),N.vmult(At,At),O.vadd(St,St),O.vadd(At,At);const j=vt.distanceTo(g);!(at.pointInTriangle(vt,_t,St,At)||at.pointInTriangle(vt,St,_t,At))||j>y||this.reportIntersection(h,vt,l,a,S)}}}}_intersectTrimesh(i,s,o,a,l,c){const h=dc,p=bc,v=wc,m=ys,w=pc,f=uc,b=vc,g=fc,C=mc,y=i.indices;i.vertices;const E=this.from,_=this.to,M=this.direction;v.position.copy(o),v.quaternion.copy(s),nt.vectorToLocalFrame(o,s,M,w),nt.pointToLocalFrame(o,s,E,f),nt.pointToLocalFrame(o,s,_,b),b.x*=i.scale.x,b.y*=i.scale.y,b.z*=i.scale.z,f.x*=i.scale.x,f.y*=i.scale.y,f.z*=i.scale.z,b.vsub(f,w),w.normalize();const S=f.distanceSquared(b);i.tree.rayQuery(this,v,p);for(let A=0,V=p.length;!this.result.shouldStop&&A!==V;A++){const N=p[A];i.getNormal(N,h),i.getVertex(y[N*3],_t),_t.vsub(f,m);const O=w.dot(h),q=h.dot(m)/O;if(q<0)continue;w.scale(q,vt),vt.vadd(f,vt),i.getVertex(y[N*3+1],St),i.getVertex(y[N*3+2],At);const R=vt.distanceSquared(f);!(at.pointInTriangle(vt,St,_t,At)||at.pointInTriangle(vt,_t,St,At))||R>S||(nt.vectorToWorldFrame(s,h,C),nt.pointToWorldFrame(o,s,vt,g),this.reportIntersection(C,g,l,a,N))}p.length=0}reportIntersection(i,s,o,a,l){const c=this.from,h=this.to,p=c.distanceTo(s),v=this.result;if(!(this.skipBackfaces&&i.dot(this.direction)>0))switch(v.hitFaceIndex=typeof l!="undefined"?l:-1,this.mode){case at.ALL:this.hasHit=!0,v.set(c,h,i,s,o,a,p),v.hasHit=!0,this.callback(v);break;case at.CLOSEST:(p<v.distance||!v.hasHit)&&(this.hasHit=!0,v.hasHit=!0,v.set(c,h,i,s,o,a,p));break;case at.ANY:this.hasHit=!0,v.hasHit=!0,v.set(c,h,i,s,o,a,p),v.shouldStop=!0;break}}static pointInTriangle(i,s,o,a){a.vsub(s,ne),o.vsub(s,Ie),i.vsub(s,ii);const l=ne.dot(ne),c=ne.dot(Ie),h=ne.dot(ii),p=Ie.dot(Ie),v=Ie.dot(ii);let m,w;return(m=p*h-c*v)>=0&&(w=l*v-c*h)>=0&&m+w<l*p-c*c}}at.CLOSEST=ci.CLOSEST;at.ANY=ci.ANY;at.ALL=ci.ALL;const gs=new bt,ni=[],Ie=new u,ii=new u,sc=new u,oc=new lt,vt=new u,_t=new u,St=new u,At=new u;new u;new vn;const _s={faceList:[0]},cn=new u,rc=new at,ac=[],lc=new u,cc=new u,hc=new u;new u;new u;const ys=new u,dc=new u,pc=new u,uc=new u,vc=new u,mc=new u,fc=new u;new bt;const bc=[],wc=new nt,ne=new u,hn=new u;function gc(z,i,s){s.vsub(z,ne);const o=ne.dot(i);return i.scale(o,hn),hn.vadd(z,hn),s.distanceTo(hn)}class _c{static defaults(i,s){i===void 0&&(i={});for(let o in s)o in i||(i[o]=s[o]);return i}}class xs{constructor(){this.spatial=new u,this.rotational=new u}multiplyElement(i){return i.spatial.dot(this.spatial)+i.rotational.dot(this.rotational)}multiplyVectors(i,s){return i.dot(this.spatial)+s.dot(this.rotational)}}class je{constructor(i,s,o,a){o===void 0&&(o=-1e6),a===void 0&&(a=1e6),this.id=je.idCounter++,this.minForce=o,this.maxForce=a,this.bi=i,this.bj=s,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new xs,this.jacobianElementB=new xs,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(i,s,o){const a=s,l=i,c=o;this.a=4/(c*(1+4*a)),this.b=4*a/(1+4*a),this.eps=4/(c*c*l*(1+4*a))}computeB(i,s,o){const a=this.computeGW(),l=this.computeGq(),c=this.computeGiMf();return-l*i-a*s-c*o}computeGq(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.position,c=a.position;return i.spatial.dot(l)+s.spatial.dot(c)}computeGW(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.velocity,c=a.velocity,h=o.angularVelocity,p=a.angularVelocity;return i.multiplyVectors(l,h)+s.multiplyVectors(c,p)}computeGWlambda(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.vlambda,c=a.vlambda,h=o.wlambda,p=a.wlambda;return i.multiplyVectors(l,h)+s.multiplyVectors(c,p)}computeGiMf(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.force,c=o.torque,h=a.force,p=a.torque,v=o.invMassSolve,m=a.invMassSolve;return l.scale(v,Cs),h.scale(m,Es),o.invInertiaWorldSolve.vmult(c,Ps),a.invInertiaWorldSolve.vmult(p,ks),i.multiplyVectors(Cs,Ps)+s.multiplyVectors(Es,ks)}computeGiMGt(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.invMassSolve,c=a.invMassSolve,h=o.invInertiaWorldSolve,p=a.invInertiaWorldSolve;let v=l+c;return h.vmult(i.rotational,dn),v+=dn.dot(i.rotational),p.vmult(s.rotational,dn),v+=dn.dot(s.rotational),v}addToWlambda(i){const s=this.jacobianElementA,o=this.jacobianElementB,a=this.bi,l=this.bj,c=yc;a.vlambda.addScaledVector(a.invMassSolve*i,s.spatial,a.vlambda),l.vlambda.addScaledVector(l.invMassSolve*i,o.spatial,l.vlambda),a.invInertiaWorldSolve.vmult(s.rotational,c),a.wlambda.addScaledVector(i,c,a.wlambda),l.invInertiaWorldSolve.vmult(o.rotational,c),l.wlambda.addScaledVector(i,c,l.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}je.idCounter=0;const Cs=new u,Es=new u,Ps=new u,ks=new u,dn=new u,yc=new u;class xc extends je{constructor(i,s,o){o===void 0&&(o=1e6);super(i,s,0,o);this.restitution=0,this.ri=new u,this.rj=new u,this.ni=new u}computeB(i){const s=this.a,o=this.b,a=this.bi,l=this.bj,c=this.ri,h=this.rj,p=Cc,v=Ec,m=a.velocity,w=a.angularVelocity;a.force,a.torque;const f=l.velocity,b=l.angularVelocity;l.force,l.torque;const g=Pc,C=this.jacobianElementA,y=this.jacobianElementB,E=this.ni;c.cross(E,p),h.cross(E,v),E.negate(C.spatial),p.negate(C.rotational),y.spatial.copy(E),y.rotational.copy(v),g.copy(l.position),g.vadd(h,g),g.vsub(a.position,g),g.vsub(c,g);const _=E.dot(g),M=this.restitution+1,S=M*f.dot(E)-M*m.dot(E)+b.dot(v)-w.dot(p),A=this.computeGiMf();return-_*s-S*o-i*A}getImpactVelocityAlongNormal(){const i=kc,s=Sc,o=Ac,a=Mc,l=Vc;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,a),this.bi.getVelocityAtWorldPoint(o,i),this.bj.getVelocityAtWorldPoint(a,s),i.vsub(s,l),this.ni.dot(l)}}const Cc=new u,Ec=new u,Pc=new u,kc=new u,Sc=new u,Ac=new u,Mc=new u,Vc=new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;class Ss extends je{constructor(i,s,o){super(i,s,-o,o);this.ri=new u,this.rj=new u,this.t=new u}computeB(i){this.a;const s=this.b;this.bi,this.bj;const o=this.ri,a=this.rj,l=Bc,c=Lc,h=this.t;o.cross(h,l),a.cross(h,c);const p=this.jacobianElementA,v=this.jacobianElementB;h.negate(p.spatial),l.negate(p.rotational),v.spatial.copy(h),v.rotational.copy(c);const m=this.computeGW(),w=this.computeGiMf();return-m*s-i*w}}const Bc=new u,Lc=new u;class Ue{constructor(i,s,o){o=_c.defaults(o,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Ue.idCounter++,this.materials=[i,s],this.friction=o.friction,this.restitution=o.restitution,this.contactEquationStiffness=o.contactEquationStiffness,this.contactEquationRelaxation=o.contactEquationRelaxation,this.frictionEquationStiffness=o.frictionEquationStiffness,this.frictionEquationRelaxation=o.frictionEquationRelaxation}}Ue.idCounter=0;class He{constructor(i){i===void 0&&(i={});let s="";typeof i=="string"&&(s=i,i={}),this.name=s,this.id=He.idCounter++,this.friction=typeof i.friction!="undefined"?i.friction:-1,this.restitution=typeof i.restitution!="undefined"?i.restitution:-1}}He.idCounter=0;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new at;new u;new u;new u;new u(1,0,0),new u(0,1,0),new u(0,0,1);new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;class Nc extends we{constructor(i,s,o,a){if(i===void 0&&(i=1),s===void 0&&(s=1),o===void 0&&(o=1),a===void 0&&(a=8),i<0)throw new Error("The cylinder radiusTop cannot be negative.");if(s<0)throw new Error("The cylinder radiusBottom cannot be negative.");const l=a,c=[],h=[],p=[],v=[],m=[],w=Math.cos,f=Math.sin;c.push(new u(-s*f(0),-o*.5,s*w(0))),v.push(0),c.push(new u(-i*f(0),o*.5,i*w(0))),m.push(1);for(let g=0;g<l;g++){const C=2*Math.PI/l*(g+1),y=2*Math.PI/l*(g+.5);g<l-1?(c.push(new u(-s*f(C),-o*.5,s*w(C))),v.push(2*g+2),c.push(new u(-i*f(C),o*.5,i*w(C))),m.push(2*g+3),p.push([2*g,2*g+1,2*g+3,2*g+2])):p.push([2*g,2*g+1,1,0]),(l%2===1||g<l/2)&&h.push(new u(-f(y),0,w(y)))}p.push(v),h.push(new u(0,1,0));const b=[];for(let g=0;g<m.length;g++)b.push(m[m.length-g-1]);p.push(b);super({vertices:c,faces:p,axes:h});this.type=H.types.CYLINDER,this.radiusTop=i,this.radiusBottom=s,this.height=o,this.numSegments=a}}class Tc extends H{constructor(){super({type:H.types.PLANE});this.worldNormal=new u,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(i){const s=this.worldNormal;s.set(0,0,1),i.vmult(s,s),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(i,s){return s===void 0&&(s=new u),s}volume(){return Number.MAX_VALUE}calculateWorldAABB(i,s,o,a){Bt.set(0,0,1),s.vmult(Bt,Bt);const l=Number.MAX_VALUE;o.set(-l,-l,-l),a.set(l,l,l),Bt.x===1?a.x=i.x:Bt.x===-1&&(o.x=i.x),Bt.y===1?a.y=i.y:Bt.y===-1&&(o.y=i.y),Bt.z===1?a.z=i.z:Bt.z===-1&&(o.z=i.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Bt=new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new bt;new u;new bt;new u;new u;new u;new u;new u;new u;new u;new bt;new u;new nt;new bt;class zc{constructor(){this.equations=[]}solve(i,s){return 0}addEquation(i){i.enabled&&!i.bi.isTrigger&&!i.bj.isTrigger&&this.equations.push(i)}removeEquation(i){const s=this.equations,o=s.indexOf(i);o!==-1&&s.splice(o,1)}removeAllEquations(){this.equations.length=0}}class Rc extends zc{constructor(){super();this.iterations=10,this.tolerance=1e-7}solve(i,s){let o=0;const a=this.iterations,l=this.tolerance*this.tolerance,c=this.equations,h=c.length,p=s.bodies,v=p.length,m=i;let w,f,b,g,C,y;if(h!==0)for(let S=0;S!==v;S++)p[S].updateSolveMassProperties();const E=Fc,_=Dc,M=Ic;E.length=h,_.length=h,M.length=h;for(let S=0;S!==h;S++){const A=c[S];M[S]=0,_[S]=A.computeB(m),E[S]=1/A.computeC()}if(h!==0){for(let V=0;V!==v;V++){const N=p[V],O=N.vlambda,q=N.wlambda;O.set(0,0,0),q.set(0,0,0)}for(o=0;o!==a;o++){g=0;for(let V=0;V!==h;V++){const N=c[V];w=_[V],f=E[V],y=M[V],C=N.computeGWlambda(),b=f*(w-C-N.eps*y),y+b<N.minForce?b=N.minForce-y:y+b>N.maxForce&&(b=N.maxForce-y),M[V]+=b,g+=b>0?b:-b,N.addToWlambda(b)}if(g*g<l)break}for(let V=0;V!==v;V++){const N=p[V],O=N.velocity,q=N.angularVelocity;N.vlambda.vmul(N.linearFactor,N.vlambda),O.vadd(N.vlambda,O),N.wlambda.vmul(N.angularFactor,N.wlambda),q.vadd(N.wlambda,q)}let S=c.length;const A=1/m;for(;S--;)c[S].multiplier=M[S]*A}return o}}const Ic=[],Fc=[],Dc=[];class Oc{constructor(){this.objects=[],this.type=Object}release(){const i=arguments.length;for(let s=0;s!==i;s++)this.objects.push(s<0||arguments.length<=s?void 0:arguments[s]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(i){const s=this.objects;for(;s.length>i;)s.pop();for(;s.length<i;)s.push(this.constructObject());return this}}class qc extends Oc{constructor(){super(...arguments);this.type=u}constructObject(){return new u}}const st={sphereSphere:H.types.SPHERE,spherePlane:H.types.SPHERE|H.types.PLANE,boxBox:H.types.BOX|H.types.BOX,sphereBox:H.types.SPHERE|H.types.BOX,planeBox:H.types.PLANE|H.types.BOX,convexConvex:H.types.CONVEXPOLYHEDRON,sphereConvex:H.types.SPHERE|H.types.CONVEXPOLYHEDRON,planeConvex:H.types.PLANE|H.types.CONVEXPOLYHEDRON,boxConvex:H.types.BOX|H.types.CONVEXPOLYHEDRON,sphereHeightfield:H.types.SPHERE|H.types.HEIGHTFIELD,boxHeightfield:H.types.BOX|H.types.HEIGHTFIELD,convexHeightfield:H.types.CONVEXPOLYHEDRON|H.types.HEIGHTFIELD,sphereParticle:H.types.PARTICLE|H.types.SPHERE,planeParticle:H.types.PLANE|H.types.PARTICLE,boxParticle:H.types.BOX|H.types.PARTICLE,convexParticle:H.types.PARTICLE|H.types.CONVEXPOLYHEDRON,cylinderCylinder:H.types.CYLINDER,sphereCylinder:H.types.SPHERE|H.types.CYLINDER,planeCylinder:H.types.PLANE|H.types.CYLINDER,boxCylinder:H.types.BOX|H.types.CYLINDER,convexCylinder:H.types.CONVEXPOLYHEDRON|H.types.CYLINDER,heightfieldCylinder:H.types.HEIGHTFIELD|H.types.CYLINDER,particleCylinder:H.types.PARTICLE|H.types.CYLINDER,sphereTrimesh:H.types.SPHERE|H.types.TRIMESH,planeTrimesh:H.types.PLANE|H.types.TRIMESH};class jc{get[st.sphereSphere](){return this.sphereSphere}get[st.spherePlane](){return this.spherePlane}get[st.boxBox](){return this.boxBox}get[st.sphereBox](){return this.sphereBox}get[st.planeBox](){return this.planeBox}get[st.convexConvex](){return this.convexConvex}get[st.sphereConvex](){return this.sphereConvex}get[st.planeConvex](){return this.planeConvex}get[st.boxConvex](){return this.boxConvex}get[st.sphereHeightfield](){return this.sphereHeightfield}get[st.boxHeightfield](){return this.boxHeightfield}get[st.convexHeightfield](){return this.convexHeightfield}get[st.sphereParticle](){return this.sphereParticle}get[st.planeParticle](){return this.planeParticle}get[st.boxParticle](){return this.boxParticle}get[st.convexParticle](){return this.convexParticle}get[st.cylinderCylinder](){return this.convexConvex}get[st.sphereCylinder](){return this.sphereConvex}get[st.planeCylinder](){return this.planeConvex}get[st.boxCylinder](){return this.boxConvex}get[st.convexCylinder](){return this.convexConvex}get[st.heightfieldCylinder](){return this.heightfieldCylinder}get[st.particleCylinder](){return this.particleCylinder}get[st.sphereTrimesh](){return this.sphereTrimesh}get[st.planeTrimesh](){return this.planeTrimesh}constructor(i){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new qc,this.world=i,this.currentContactMaterial=i.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(i,s,o,a,l,c){let h;this.contactPointPool.length?(h=this.contactPointPool.pop(),h.bi=i,h.bj=s):h=new xc(i,s),h.enabled=i.collisionResponse&&s.collisionResponse&&o.collisionResponse&&a.collisionResponse;const p=this.currentContactMaterial;h.restitution=p.restitution,h.setSpookParams(p.contactEquationStiffness,p.contactEquationRelaxation,this.world.dt);const v=o.material||i.material,m=a.material||s.material;return v&&m&&v.restitution>=0&&m.restitution>=0&&(h.restitution=v.restitution*m.restitution),h.si=l||o,h.sj=c||a,h}createFrictionEquationsFromContact(i,s){const o=i.bi,a=i.bj,l=i.si,c=i.sj,h=this.world,p=this.currentContactMaterial;let v=p.friction;const m=l.material||o.material,w=c.material||a.material;if(m&&w&&m.friction>=0&&w.friction>=0&&(v=m.friction*w.friction),v>0){const f=v*h.gravity.length();let b=o.invMass+a.invMass;b>0&&(b=1/b);const g=this.frictionEquationPool,C=g.length?g.pop():new Ss(o,a,f*b),y=g.length?g.pop():new Ss(o,a,f*b);return C.bi=y.bi=o,C.bj=y.bj=a,C.minForce=y.minForce=-f*b,C.maxForce=y.maxForce=f*b,C.ri.copy(i.ri),C.rj.copy(i.rj),y.ri.copy(i.ri),y.rj.copy(i.rj),i.ni.tangents(C.t,y.t),C.setSpookParams(p.frictionEquationStiffness,p.frictionEquationRelaxation,h.dt),y.setSpookParams(p.frictionEquationStiffness,p.frictionEquationRelaxation,h.dt),C.enabled=y.enabled=i.enabled,s.push(C,y),!0}return!1}createFrictionFromAverage(i){let s=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(s,this.frictionResult)||i===1)return;const o=this.frictionResult[this.frictionResult.length-2],a=this.frictionResult[this.frictionResult.length-1];ee.setZero(),me.setZero(),fe.setZero();const l=s.bi;s.bj;for(let h=0;h!==i;h++)s=this.result[this.result.length-1-h],s.bi!==l?(ee.vadd(s.ni,ee),me.vadd(s.ri,me),fe.vadd(s.rj,fe)):(ee.vsub(s.ni,ee),me.vadd(s.rj,me),fe.vadd(s.ri,fe));const c=1/i;me.scale(c,o.ri),fe.scale(c,o.rj),a.ri.copy(o.ri),a.rj.copy(o.rj),ee.normalize(),ee.tangents(o.t,a.t)}getContacts(i,s,o,a,l,c,h){this.contactPointPool=l,this.frictionEquationPool=h,this.result=a,this.frictionResult=c;const p=Gc,v=Kc,m=Uc,w=Hc;for(let f=0,b=i.length;f!==b;f++){const g=i[f],C=s[f];let y=null;g.material&&C.material&&(y=o.getContactMaterial(g.material,C.material)||null);const E=g.type&U.KINEMATIC&&C.type&U.STATIC||g.type&U.STATIC&&C.type&U.KINEMATIC||g.type&U.KINEMATIC&&C.type&U.KINEMATIC;for(let _=0;_<g.shapes.length;_++){g.quaternion.mult(g.shapeOrientations[_],p),g.quaternion.vmult(g.shapeOffsets[_],m),m.vadd(g.position,m);const M=g.shapes[_];for(let S=0;S<C.shapes.length;S++){C.quaternion.mult(C.shapeOrientations[S],v),C.quaternion.vmult(C.shapeOffsets[S],w),w.vadd(C.position,w);const A=C.shapes[S];if(!(M.collisionFilterMask&A.collisionFilterGroup&&A.collisionFilterMask&M.collisionFilterGroup)||m.distanceTo(w)>M.boundingSphereRadius+A.boundingSphereRadius)continue;let V=null;M.material&&A.material&&(V=o.getContactMaterial(M.material,A.material)||null),this.currentContactMaterial=V||y||o.defaultContactMaterial;const N=M.type|A.type,O=this[N];if(O){let q=!1;M.type<A.type?q=O.call(this,M,A,m,w,p,v,g,C,M,A,E):q=O.call(this,A,M,w,m,v,p,C,g,M,A,E),q&&E&&(o.shapeOverlapKeeper.set(M.id,A.id),o.bodyOverlapKeeper.set(g.id,C.id))}}}}}sphereSphere(i,s,o,a,l,c,h,p,v,m,w){if(w)return o.distanceSquared(a)<(i.radius+s.radius)**2;const f=this.createContactEquation(h,p,i,s,v,m);a.vsub(o,f.ni),f.ni.normalize(),f.ri.copy(f.ni),f.rj.copy(f.ni),f.ri.scale(i.radius,f.ri),f.rj.scale(-s.radius,f.rj),f.ri.vadd(o,f.ri),f.ri.vsub(h.position,f.ri),f.rj.vadd(a,f.rj),f.rj.vsub(p.position,f.rj),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}spherePlane(i,s,o,a,l,c,h,p,v,m,w){const f=this.createContactEquation(h,p,i,s,v,m);if(f.ni.set(0,0,1),c.vmult(f.ni,f.ni),f.ni.negate(f.ni),f.ni.normalize(),f.ni.scale(i.radius,f.ri),o.vsub(a,pn),f.ni.scale(f.ni.dot(pn),As),pn.vsub(As,f.rj),-pn.dot(f.ni)<=i.radius){if(w)return!0;const b=f.ri,g=f.rj;b.vadd(o,b),b.vsub(h.position,b),g.vadd(a,g),g.vsub(p.position,g),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}}boxBox(i,s,o,a,l,c,h,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,s.convexPolyhedronRepresentation.material=s.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,s.convexPolyhedronRepresentation.collisionResponse=s.collisionResponse,this.convexConvex(i.convexPolyhedronRepresentation,s.convexPolyhedronRepresentation,o,a,l,c,h,p,i,s,w)}sphereBox(i,s,o,a,l,c,h,p,v,m,w){const f=this.v3pool,b=wh;o.vsub(a,un),s.getSideNormals(b,c);const g=i.radius;let C=!1;const y=_h,E=yh,_=xh;let M=null,S=0,A=0,V=0,N=null;for(let k=0,X=b.length;k!==X&&C===!1;k++){const K=mh;K.copy(b[k]);const $=K.length();K.normalize();const Y=un.dot(K);if(Y<$+g&&Y>0){const tt=fh,D=bh;tt.copy(b[(k+1)%3]),D.copy(b[(k+2)%3]);const J=tt.length(),Rt=D.length();tt.normalize(),D.normalize();const dt=un.dot(tt),It=un.dot(D);if(dt<J&&dt>-J&&It<Rt&&It>-Rt){const Wt=Math.abs(Y-$-g);if((N===null||Wt<N)&&(N=Wt,A=dt,V=It,M=$,y.copy(K),E.copy(tt),_.copy(D),S++,w))return!0}}}if(S){C=!0;const k=this.createContactEquation(h,p,i,s,v,m);y.scale(-g,k.ri),k.ni.copy(y),k.ni.negate(k.ni),y.scale(M,y),E.scale(A,E),y.vadd(E,y),_.scale(V,_),y.vadd(_,k.rj),k.ri.vadd(o,k.ri),k.ri.vsub(h.position,k.ri),k.rj.vadd(a,k.rj),k.rj.vsub(p.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}let O=f.get();const q=gh;for(let k=0;k!==2&&!C;k++)for(let X=0;X!==2&&!C;X++)for(let K=0;K!==2&&!C;K++)if(O.set(0,0,0),k?O.vadd(b[0],O):O.vsub(b[0],O),X?O.vadd(b[1],O):O.vsub(b[1],O),K?O.vadd(b[2],O):O.vsub(b[2],O),a.vadd(O,q),q.vsub(o,q),q.lengthSquared()<g*g){if(w)return!0;C=!0;const $=this.createContactEquation(h,p,i,s,v,m);$.ri.copy(q),$.ri.normalize(),$.ni.copy($.ri),$.ri.scale(g,$.ri),$.rj.copy(O),$.ri.vadd(o,$.ri),$.ri.vsub(h.position,$.ri),$.rj.vadd(a,$.rj),$.rj.vsub(p.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}f.release(O),O=null;const R=f.get(),L=f.get(),j=f.get(),B=f.get(),I=f.get(),T=b.length;for(let k=0;k!==T&&!C;k++)for(let X=0;X!==T&&!C;X++)if(k%3!==X%3){b[X].cross(b[k],R),R.normalize(),b[k].vadd(b[X],L),j.copy(o),j.vsub(L,j),j.vsub(a,j);const K=j.dot(R);R.scale(K,B);let $=0;for(;$===k%3||$===X%3;)$++;I.copy(o),I.vsub(B,I),I.vsub(L,I),I.vsub(a,I);const Y=Math.abs(K),tt=I.length();if(Y<b[$].length()&&tt<g){if(w)return!0;C=!0;const D=this.createContactEquation(h,p,i,s,v,m);L.vadd(B,D.rj),D.rj.copy(D.rj),I.negate(D.ni),D.ni.normalize(),D.ri.copy(D.rj),D.ri.vadd(a,D.ri),D.ri.vsub(o,D.ri),D.ri.normalize(),D.ri.scale(g,D.ri),D.ri.vadd(o,D.ri),D.ri.vsub(h.position,D.ri),D.rj.vadd(a,D.rj),D.rj.vsub(p.position,D.rj),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult)}}f.release(R,L,j,B,I)}planeBox(i,s,o,a,l,c,h,p,v,m,w){return s.convexPolyhedronRepresentation.material=s.material,s.convexPolyhedronRepresentation.collisionResponse=s.collisionResponse,s.convexPolyhedronRepresentation.id=s.id,this.planeConvex(i,s.convexPolyhedronRepresentation,o,a,l,c,h,p,i,s,w)}convexConvex(i,s,o,a,l,c,h,p,v,m,w,f,b){const g=Ih;if(!(o.distanceTo(a)>i.boundingSphereRadius+s.boundingSphereRadius)&&i.findSeparatingAxis(s,o,l,a,c,g,f,b)){const C=[],y=Fh;i.clipAgainstHull(o,l,s,a,c,g,-100,100,C);let E=0;for(let _=0;_!==C.length;_++){if(w)return!0;const M=this.createContactEquation(h,p,i,s,v,m),S=M.ri,A=M.rj;g.negate(M.ni),C[_].normal.negate(y),y.scale(C[_].depth,y),C[_].point.vadd(y,S),A.copy(C[_].point),S.vsub(o,S),A.vsub(a,A),S.vadd(o,S),S.vsub(h.position,S),A.vadd(a,A),A.vsub(p.position,A),this.result.push(M),E++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(M,this.frictionResult)}this.enableFrictionReduction&&E&&this.createFrictionFromAverage(E)}}sphereConvex(i,s,o,a,l,c,h,p,v,m,w){const f=this.v3pool;o.vsub(a,Ch);const b=s.faceNormals,g=s.faces,C=s.vertices,y=i.radius;let E=!1;for(let _=0;_!==C.length;_++){const M=C[_],S=Sh;c.vmult(M,S),a.vadd(S,S);const A=kh;if(S.vsub(o,A),A.lengthSquared()<y*y){if(w)return!0;E=!0;const V=this.createContactEquation(h,p,i,s,v,m);V.ri.copy(A),V.ri.normalize(),V.ni.copy(V.ri),V.ri.scale(y,V.ri),S.vsub(a,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(h.position,V.ri),V.rj.vadd(a,V.rj),V.rj.vsub(p.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult);return}}for(let _=0,M=g.length;_!==M&&E===!1;_++){const S=b[_],A=g[_],V=Ah;c.vmult(S,V);const N=Mh;c.vmult(C[A[0]],N),N.vadd(a,N);const O=Vh;V.scale(-y,O),o.vadd(O,O);const q=Bh;O.vsub(N,q);const R=q.dot(V),L=Lh;if(o.vsub(N,L),R<0&&L.dot(V)>0){const j=[];for(let B=0,I=A.length;B!==I;B++){const T=f.get();c.vmult(C[A[B]],T),a.vadd(T,T),j.push(T)}if(vh(j,V,o)){if(w)return!0;E=!0;const B=this.createContactEquation(h,p,i,s,v,m);V.scale(-y,B.ri),V.negate(B.ni);const I=f.get();V.scale(-R,I);const T=f.get();V.scale(-y,T),o.vsub(a,B.rj),B.rj.vadd(T,B.rj),B.rj.vadd(I,B.rj),B.rj.vadd(a,B.rj),B.rj.vsub(p.position,B.rj),B.ri.vadd(o,B.ri),B.ri.vsub(h.position,B.ri),f.release(I),f.release(T),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);for(let k=0,X=j.length;k!==X;k++)f.release(j[k]);return}else for(let B=0;B!==A.length;B++){const I=f.get(),T=f.get();c.vmult(C[A[(B+1)%A.length]],I),c.vmult(C[A[(B+2)%A.length]],T),a.vadd(I,I),a.vadd(T,T);const k=Eh;T.vsub(I,k);const X=Ph;k.unit(X);const K=f.get(),$=f.get();o.vsub(I,$);const Y=$.dot(X);X.scale(Y,K),K.vadd(I,K);const tt=f.get();if(K.vsub(o,tt),Y>0&&Y*Y<k.lengthSquared()&&tt.lengthSquared()<y*y){if(w)return!0;const D=this.createContactEquation(h,p,i,s,v,m);K.vsub(a,D.rj),K.vsub(o,D.ni),D.ni.normalize(),D.ni.scale(y,D.ri),D.rj.vadd(a,D.rj),D.rj.vsub(p.position,D.rj),D.ri.vadd(o,D.ri),D.ri.vsub(h.position,D.ri),this.result.push(D),this.createFrictionEquationsFromContact(D,this.frictionResult);for(let J=0,Rt=j.length;J!==Rt;J++)f.release(j[J]);f.release(I),f.release(T),f.release(K),f.release(tt),f.release($);return}f.release(I),f.release(T),f.release(K),f.release(tt),f.release($)}for(let B=0,I=j.length;B!==I;B++)f.release(j[B])}}}planeConvex(i,s,o,a,l,c,h,p,v,m,w){const f=Nh,b=Th;b.set(0,0,1),l.vmult(b,b);let g=0;const C=zh;for(let y=0;y!==s.vertices.length;y++)if(f.copy(s.vertices[y]),c.vmult(f,f),a.vadd(f,f),f.vsub(o,C),b.dot(C)<=0){if(w)return!0;const _=this.createContactEquation(h,p,i,s,v,m),M=Rh;b.scale(b.dot(C),M),f.vsub(M,M),M.vsub(o,_.ri),_.ni.copy(b),f.vsub(a,_.rj),_.ri.vadd(o,_.ri),_.ri.vsub(h.position,_.ri),_.rj.vadd(a,_.rj),_.rj.vsub(p.position,_.rj),this.result.push(_),g++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}boxConvex(i,s,o,a,l,c,h,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexConvex(i.convexPolyhedronRepresentation,s,o,a,l,c,h,p,i,s,w)}sphereHeightfield(i,s,o,a,l,c,h,p,v,m,w){const f=s.data,b=i.radius,g=s.elementSize,C=Xh,y=Yh;nt.pointToLocalFrame(a,c,o,y);let E=Math.floor((y.x-b)/g)-1,_=Math.ceil((y.x+b)/g)+1,M=Math.floor((y.y-b)/g)-1,S=Math.ceil((y.y+b)/g)+1;if(_<0||S<0||E>f.length||M>f[0].length)return;E<0&&(E=0),_<0&&(_=0),M<0&&(M=0),S<0&&(S=0),E>=f.length&&(E=f.length-1),_>=f.length&&(_=f.length-1),S>=f[0].length&&(S=f[0].length-1),M>=f[0].length&&(M=f[0].length-1);const A=[];s.getRectMinMax(E,M,_,S,A);const V=A[0],N=A[1];if(y.z-b>N||y.z+b<V)return;const O=this.result;for(let q=E;q<_;q++)for(let R=M;R<S;R++){const L=O.length;let j=!1;if(s.getConvexTrianglePillar(q,R,!1),nt.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(j=this.sphereConvex(i,s.pillarConvex,o,C,l,c,h,p,i,s,w)),w&&j||(s.getConvexTrianglePillar(q,R,!0),nt.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(j=this.sphereConvex(i,s.pillarConvex,o,C,l,c,h,p,i,s,w)),w&&j))return!0;if(O.length-L>2)return}}boxHeightfield(i,s,o,a,l,c,h,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexHeightfield(i.convexPolyhedronRepresentation,s,o,a,l,c,h,p,i,s,w)}convexHeightfield(i,s,o,a,l,c,h,p,v,m,w){const f=s.data,b=s.elementSize,g=i.boundingSphereRadius,C=Wh,y=$h,E=Kh;nt.pointToLocalFrame(a,c,o,E);let _=Math.floor((E.x-g)/b)-1,M=Math.ceil((E.x+g)/b)+1,S=Math.floor((E.y-g)/b)-1,A=Math.ceil((E.y+g)/b)+1;if(M<0||A<0||_>f.length||S>f[0].length)return;_<0&&(_=0),M<0&&(M=0),S<0&&(S=0),A<0&&(A=0),_>=f.length&&(_=f.length-1),M>=f.length&&(M=f.length-1),A>=f[0].length&&(A=f[0].length-1),S>=f[0].length&&(S=f[0].length-1);const V=[];s.getRectMinMax(_,S,M,A,V);const N=V[0],O=V[1];if(!(E.z-g>O||E.z+g<N))for(let q=_;q<M;q++)for(let R=S;R<A;R++){let L=!1;if(s.getConvexTrianglePillar(q,R,!1),nt.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(L=this.convexConvex(i,s.pillarConvex,o,C,l,c,h,p,null,null,w,y,null)),w&&L||(s.getConvexTrianglePillar(q,R,!0),nt.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(L=this.convexConvex(i,s.pillarConvex,o,C,l,c,h,p,null,null,w,y,null)),w&&L))return!0}}sphereParticle(i,s,o,a,l,c,h,p,v,m,w){const f=jh;if(f.set(0,0,1),a.vsub(o,f),f.lengthSquared()<=i.radius*i.radius){if(w)return!0;const g=this.createContactEquation(p,h,s,i,v,m);f.normalize(),g.rj.copy(f),g.rj.scale(i.radius,g.rj),g.ni.copy(f),g.ni.negate(g.ni),g.ri.set(0,0,0),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}planeParticle(i,s,o,a,l,c,h,p,v,m,w){const f=Dh;f.set(0,0,1),h.quaternion.vmult(f,f);const b=Oh;if(a.vsub(h.position,b),f.dot(b)<=0){if(w)return!0;const C=this.createContactEquation(p,h,s,i,v,m);C.ni.copy(f),C.ni.negate(C.ni),C.ri.set(0,0,0);const y=qh;f.scale(f.dot(a),y),a.vsub(y,y),C.rj.copy(y),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}}boxParticle(i,s,o,a,l,c,h,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexParticle(i.convexPolyhedronRepresentation,s,o,a,l,c,h,p,i,s,w)}convexParticle(i,s,o,a,l,c,h,p,v,m,w){let f=-1;const b=Hh,g=Gh;let C=null;const y=Uh;if(y.copy(a),y.vsub(o,y),l.conjugate(Ms),Ms.vmult(y,y),i.pointIsInside(y)){i.worldVerticesNeedsUpdate&&i.computeWorldVertices(o,l),i.worldFaceNormalsNeedsUpdate&&i.computeWorldFaceNormals(l);for(let E=0,_=i.faces.length;E!==_;E++){const M=[i.worldVertices[i.faces[E][0]]],S=i.worldFaceNormals[E];a.vsub(M[0],Vs);const A=-S.dot(Vs);if(C===null||Math.abs(A)<Math.abs(C)){if(w)return!0;C=A,f=E,b.copy(S)}}if(f!==-1){const E=this.createContactEquation(p,h,s,i,v,m);b.scale(C,g),g.vadd(a,g),g.vsub(o,g),E.rj.copy(g),b.negate(E.ni),E.ri.set(0,0,0);const _=E.ri,M=E.rj;_.vadd(a,_),_.vsub(p.position,_),M.vadd(o,M),M.vsub(h.position,M),this.result.push(E),this.createFrictionEquationsFromContact(E,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(i,s,o,a,l,c,h,p,v,m,w){return this.convexHeightfield(s,i,a,o,c,l,p,h,v,m,w)}particleCylinder(i,s,o,a,l,c,h,p,v,m,w){return this.convexParticle(s,i,a,o,c,l,p,h,v,m,w)}sphereTrimesh(i,s,o,a,l,c,h,p,v,m,w){const f=th,b=eh,g=nh,C=ih,y=sh,E=oh,_=ch,M=Qc,S=Zc,A=hh;nt.pointToLocalFrame(a,c,o,y);const V=i.radius;_.lowerBound.set(y.x-V,y.y-V,y.z-V),_.upperBound.set(y.x+V,y.y+V,y.z+V),s.getTrianglesInAABB(_,A);const N=Jc,O=i.radius*i.radius;for(let B=0;B<A.length;B++)for(let I=0;I<3;I++)if(s.getVertex(s.indices[A[B]*3+I],N),N.vsub(y,S),S.lengthSquared()<=O){if(M.copy(N),nt.pointToWorldFrame(a,c,M,N),N.vsub(o,S),w)return!0;let T=this.createContactEquation(h,p,i,s,v,m);T.ni.copy(S),T.ni.normalize(),T.ri.copy(T.ni),T.ri.scale(i.radius,T.ri),T.ri.vadd(o,T.ri),T.ri.vsub(h.position,T.ri),T.rj.copy(N),T.rj.vsub(p.position,T.rj),this.result.push(T),this.createFrictionEquationsFromContact(T,this.frictionResult)}for(let B=0;B<A.length;B++)for(let I=0;I<3;I++){s.getVertex(s.indices[A[B]*3+I],f),s.getVertex(s.indices[A[B]*3+(I+1)%3],b),b.vsub(f,g),y.vsub(b,E);const T=E.dot(g);y.vsub(f,E);let k=E.dot(g);if(k>0&&T<0&&(y.vsub(f,E),C.copy(g),C.normalize(),k=E.dot(C),C.scale(k,E),E.vadd(f,E),E.distanceTo(y)<i.radius)){if(w)return!0;const K=this.createContactEquation(h,p,i,s,v,m);E.vsub(y,K.ni),K.ni.normalize(),K.ni.scale(i.radius,K.ri),K.ri.vadd(o,K.ri),K.ri.vsub(h.position,K.ri),nt.pointToWorldFrame(a,c,E,E),E.vsub(p.position,K.rj),nt.vectorToWorldFrame(c,K.ni,K.ni),nt.vectorToWorldFrame(c,K.ri,K.ri),this.result.push(K),this.createFrictionEquationsFromContact(K,this.frictionResult)}}const q=rh,R=ah,L=lh,j=Xc;for(let B=0,I=A.length;B!==I;B++){s.getTriangleVertices(A[B],q,R,L),s.getNormal(A[B],j),y.vsub(q,E);let T=E.dot(j);if(j.scale(T,E),y.vsub(E,E),T=E.distanceTo(y),at.pointInTriangle(E,q,R,L)&&T<i.radius){if(w)return!0;let k=this.createContactEquation(h,p,i,s,v,m);E.vsub(y,k.ni),k.ni.normalize(),k.ni.scale(i.radius,k.ri),k.ri.vadd(o,k.ri),k.ri.vsub(h.position,k.ri),nt.pointToWorldFrame(a,c,E,E),E.vsub(p.position,k.rj),nt.vectorToWorldFrame(c,k.ni,k.ni),nt.vectorToWorldFrame(c,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}}A.length=0}planeTrimesh(i,s,o,a,l,c,h,p,v,m,w){const f=new u,b=Wc;b.set(0,0,1),l.vmult(b,b);for(let g=0;g<s.vertices.length/3;g++){s.getVertex(g,f);const C=new u;C.copy(f),nt.pointToWorldFrame(a,c,C,f);const y=$c;if(f.vsub(o,y),b.dot(y)<=0){if(w)return!0;const _=this.createContactEquation(h,p,i,s,v,m);_.ni.copy(b);const M=Yc;b.scale(y.dot(b),M),f.vsub(M,M),_.ri.copy(M),_.ri.vsub(h.position,_.ri),_.rj.copy(f),_.rj.vsub(p.position,_.rj),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}}}const ee=new u,me=new u,fe=new u,Uc=new u,Hc=new u,Gc=new lt,Kc=new lt,Wc=new u,$c=new u,Yc=new u,Xc=new u,Zc=new u;new u;const Jc=new u,Qc=new u,th=new u,eh=new u,nh=new u,ih=new u,sh=new u,oh=new u,rh=new u,ah=new u,lh=new u,ch=new bt,hh=[],pn=new u,As=new u,dh=new u,ph=new u,uh=new u;function vh(z,i,s){let o=null;const a=z.length;for(let l=0;l!==a;l++){const c=z[l],h=dh;z[(l+1)%a].vsub(c,h);const p=ph;h.cross(i,p);const v=uh;s.vsub(c,v);const m=p.dot(v);if(o===null||m>0&&o===!0||m<=0&&o===!1){o===null&&(o=m>0);continue}else return!1}return!0}const un=new u,mh=new u,fh=new u,bh=new u,wh=[new u,new u,new u,new u,new u,new u],gh=new u,_h=new u,yh=new u,xh=new u,Ch=new u,Eh=new u,Ph=new u,kh=new u,Sh=new u,Ah=new u,Mh=new u,Vh=new u,Bh=new u,Lh=new u;new u;new u;const Nh=new u,Th=new u,zh=new u,Rh=new u,Ih=new u,Fh=new u,Dh=new u,Oh=new u,qh=new u,jh=new u,Ms=new lt,Uh=new u;new u;const Hh=new u,Vs=new u,Gh=new u,Kh=new u,Wh=new u,$h=[0],Yh=new u,Xh=new u;class Bs{constructor(){this.current=[],this.previous=[]}getKey(i,s){if(s<i){const o=s;s=i,i=o}return i<<16|s}set(i,s){const o=this.getKey(i,s),a=this.current;let l=0;for(;o>a[l];)l++;if(o!==a[l]){for(let c=a.length-1;c>=l;c--)a[c+1]=a[c];a[l]=o}}tick(){const i=this.current;this.current=this.previous,this.previous=i,this.current.length=0}getDiff(i,s){const o=this.current,a=this.previous,l=o.length,c=a.length;let h=0;for(let p=0;p<l;p++){let v=!1;const m=o[p];for(;m>a[h];)h++;v=m===a[h],v||Ls(i,m)}h=0;for(let p=0;p<c;p++){let v=!1;const m=a[p];for(;m>o[h];)h++;v=o[h]===m,v||Ls(s,m)}}}function Ls(z,i){z.push((i&4294901760)>>16,i&65535)}const si=(z,i)=>z<i?`${z}-${i}`:`${i}-${z}`;class Zh{constructor(){this.data={keys:[]}}get(i,s){const o=si(i,s);return this.data[o]}set(i,s,o){const a=si(i,s);this.get(i,s)||this.data.keys.push(a),this.data[a]=o}delete(i,s){const o=si(i,s),a=this.data.keys.indexOf(o);a!==-1&&this.data.keys.splice(a,1),delete this.data[o]}reset(){const i=this.data,s=i.keys;for(;s.length>0;){const o=s.pop();delete i[o]}}}class Jh extends zs{constructor(i){i===void 0&&(i={});super();this.dt=-1,this.allowSleep=!!i.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=i.quatNormalizeSkip!==void 0?i.quatNormalizeSkip:0,this.quatNormalizeFast=i.quatNormalizeFast!==void 0?i.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new u,i.gravity&&this.gravity.copy(i.gravity),this.broadphase=i.broadphase!==void 0?i.broadphase:new ic,this.bodies=[],this.hasActiveBodies=!1,this.solver=i.solver!==void 0?i.solver:new Rc,this.constraints=[],this.narrowphase=new jc(this),this.collisionMatrix=new bs,this.collisionMatrixPrevious=new bs,this.bodyOverlapKeeper=new Bs,this.shapeOverlapKeeper=new Bs,this.contactmaterials=[],this.contactMaterialTable=new Zh,this.defaultMaterial=new He("default"),this.defaultContactMaterial=new Ue(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(i,s){return this.contactMaterialTable.get(i.id,s.id)}collisionMatrixTick(){const i=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=i,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(i){this.constraints.push(i)}removeConstraint(i){const s=this.constraints.indexOf(i);s!==-1&&this.constraints.splice(s,1)}rayTest(i,s,o){o instanceof vn?this.raycastClosest(i,s,{skipBackfaces:!0},o):this.raycastAll(i,s,{skipBackfaces:!0},o)}raycastAll(i,s,o,a){return o===void 0&&(o={}),o.mode=at.ALL,o.from=i,o.to=s,o.callback=a,oi.intersectWorld(this,o)}raycastAny(i,s,o,a){return o===void 0&&(o={}),o.mode=at.ANY,o.from=i,o.to=s,o.result=a,oi.intersectWorld(this,o)}raycastClosest(i,s,o,a){return o===void 0&&(o={}),o.mode=at.CLOSEST,o.from=i,o.to=s,o.result=a,oi.intersectWorld(this,o)}addBody(i){this.bodies.includes(i)||(i.index=this.bodies.length,this.bodies.push(i),i.world=this,i.initPosition.copy(i.position),i.initVelocity.copy(i.velocity),i.timeLastSleepy=this.time,i instanceof U&&(i.initAngularVelocity.copy(i.angularVelocity),i.initQuaternion.copy(i.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=i,this.idToBodyMap[i.id]=i,this.dispatchEvent(this.addBodyEvent))}removeBody(i){i.world=null;const s=this.bodies.length-1,o=this.bodies,a=o.indexOf(i);if(a!==-1){o.splice(a,1);for(let l=0;l!==o.length;l++)o[l].index=l;this.collisionMatrix.setNumObjects(s),this.removeBodyEvent.body=i,delete this.idToBodyMap[i.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(i){return this.idToBodyMap[i]}getShapeById(i){const s=this.bodies;for(let o=0;o<s.length;o++){const a=s[o].shapes;for(let l=0;l<a.length;l++){const c=a[l];if(c.id===i)return c}}return null}addContactMaterial(i){this.contactmaterials.push(i),this.contactMaterialTable.set(i.materials[0].id,i.materials[1].id,i)}removeContactMaterial(i){const s=this.contactmaterials.indexOf(i);s!==-1&&(this.contactmaterials.splice(s,1),this.contactMaterialTable.delete(i.materials[0].id,i.materials[1].id))}fixedStep(i,s){i===void 0&&(i=1/60),s===void 0&&(s=10);const o=ct.now()/1e3;if(!this.lastCallTime)this.step(i,void 0,s);else{const a=o-this.lastCallTime;this.step(i,a,s)}this.lastCallTime=o}step(i,s,o){if(o===void 0&&(o=10),s===void 0)this.internalStep(i),this.time+=i;else{this.accumulator+=s;const a=ct.now();let l=0;for(;this.accumulator>=i&&l<o&&(this.internalStep(i),this.accumulator-=i,l++,!(ct.now()-a>i*1e3)););this.accumulator=this.accumulator%i;const c=this.accumulator/i;for(let h=0;h!==this.bodies.length;h++){const p=this.bodies[h];p.previousPosition.lerp(p.position,c,p.interpolatedPosition),p.previousQuaternion.slerp(p.quaternion,c,p.interpolatedQuaternion),p.previousQuaternion.normalize()}this.time+=s}}internalStep(i){this.dt=i;const s=this.contacts,o=id,a=sd,l=this.bodies.length,c=this.bodies,h=this.solver,p=this.gravity,v=this.doProfiling,m=this.profile,w=U.DYNAMIC;let f=-1/0;const b=this.constraints,g=nd;p.length();const C=p.x,y=p.y,E=p.z;let _=0;for(v&&(f=ct.now()),_=0;_!==l;_++){const B=c[_];if(B.type===w){const I=B.force,T=B.mass;I.x+=T*C,I.y+=T*y,I.z+=T*E}}for(let B=0,I=this.subsystems.length;B!==I;B++)this.subsystems[B].update();v&&(f=ct.now()),o.length=0,a.length=0,this.broadphase.collisionPairs(this,o,a),v&&(m.broadphase=ct.now()-f);let M=b.length;for(_=0;_!==M;_++){const B=b[_];if(!B.collideConnected)for(let I=o.length-1;I>=0;I-=1)(B.bodyA===o[I]&&B.bodyB===a[I]||B.bodyB===o[I]&&B.bodyA===a[I])&&(o.splice(I,1),a.splice(I,1))}this.collisionMatrixTick(),v&&(f=ct.now());const S=ed,A=s.length;for(_=0;_!==A;_++)S.push(s[_]);s.length=0;const V=this.frictionEquations.length;for(_=0;_!==V;_++)g.push(this.frictionEquations[_]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(o,a,this,s,S,this.frictionEquations,g),v&&(m.narrowphase=ct.now()-f),v&&(f=ct.now()),_=0;_<this.frictionEquations.length;_++)h.addEquation(this.frictionEquations[_]);const N=s.length;for(let B=0;B!==N;B++){const I=s[B],T=I.bi,k=I.bj,X=I.si,K=I.sj;let $;if(T.material&&k.material?$=this.getContactMaterial(T.material,k.material)||this.defaultContactMaterial:$=this.defaultContactMaterial,$.friction,T.material&&k.material&&(T.material.friction>=0&&k.material.friction>=0&&T.material.friction*k.material.friction,T.material.restitution>=0&&k.material.restitution>=0&&(I.restitution=T.material.restitution*k.material.restitution)),h.addEquation(I),T.allowSleep&&T.type===U.DYNAMIC&&T.sleepState===U.SLEEPING&&k.sleepState===U.AWAKE&&k.type!==U.STATIC){const Y=k.velocity.lengthSquared()+k.angularVelocity.lengthSquared(),tt=k.sleepSpeedLimit**2;Y>=tt*2&&(T.wakeUpAfterNarrowphase=!0)}if(k.allowSleep&&k.type===U.DYNAMIC&&k.sleepState===U.SLEEPING&&T.sleepState===U.AWAKE&&T.type!==U.STATIC){const Y=T.velocity.lengthSquared()+T.angularVelocity.lengthSquared(),tt=T.sleepSpeedLimit**2;Y>=tt*2&&(k.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(T,k,!0),this.collisionMatrixPrevious.get(T,k)||(Fe.body=k,Fe.contact=I,T.dispatchEvent(Fe),Fe.body=T,k.dispatchEvent(Fe)),this.bodyOverlapKeeper.set(T.id,k.id),this.shapeOverlapKeeper.set(X.id,K.id)}for(this.emitContactEvents(),v&&(m.makeContactConstraints=ct.now()-f,f=ct.now()),_=0;_!==l;_++){const B=c[_];B.wakeUpAfterNarrowphase&&(B.wakeUp(),B.wakeUpAfterNarrowphase=!1)}for(M=b.length,_=0;_!==M;_++){const B=b[_];B.update();for(let I=0,T=B.equations.length;I!==T;I++){const k=B.equations[I];h.addEquation(k)}}h.solve(i,this),v&&(m.solve=ct.now()-f),h.removeAllEquations();const O=Math.pow;for(_=0;_!==l;_++){const B=c[_];if(B.type&w){const I=O(1-B.linearDamping,i),T=B.velocity;T.scale(I,T);const k=B.angularVelocity;if(k){const X=O(1-B.angularDamping,i);k.scale(X,k)}}}this.dispatchEvent(td),v&&(f=ct.now());const R=this.stepnumber%(this.quatNormalizeSkip+1)===0,L=this.quatNormalizeFast;for(_=0;_!==l;_++)c[_].integrate(i,R,L);this.clearForces(),this.broadphase.dirty=!0,v&&(m.integrate=ct.now()-f),this.stepnumber+=1,this.dispatchEvent(Qh);let j=!0;if(this.allowSleep)for(j=!1,_=0;_!==l;_++){const B=c[_];B.sleepTick(this.time),B.sleepState!==U.SLEEPING&&(j=!0)}this.hasActiveBodies=j}emitContactEvents(){const i=this.hasAnyEventListener("beginContact"),s=this.hasAnyEventListener("endContact");if((i||s)&&this.bodyOverlapKeeper.getDiff(Lt,Nt),i){for(let l=0,c=Lt.length;l<c;l+=2)De.bodyA=this.getBodyById(Lt[l]),De.bodyB=this.getBodyById(Lt[l+1]),this.dispatchEvent(De);De.bodyA=De.bodyB=null}if(s){for(let l=0,c=Nt.length;l<c;l+=2)Oe.bodyA=this.getBodyById(Nt[l]),Oe.bodyB=this.getBodyById(Nt[l+1]),this.dispatchEvent(Oe);Oe.bodyA=Oe.bodyB=null}Lt.length=Nt.length=0;const o=this.hasAnyEventListener("beginShapeContact"),a=this.hasAnyEventListener("endShapeContact");if((o||a)&&this.shapeOverlapKeeper.getDiff(Lt,Nt),o){for(let l=0,c=Lt.length;l<c;l+=2){const h=this.getShapeById(Lt[l]),p=this.getShapeById(Lt[l+1]);Tt.shapeA=h,Tt.shapeB=p,h&&(Tt.bodyA=h.body),p&&(Tt.bodyB=p.body),this.dispatchEvent(Tt)}Tt.bodyA=Tt.bodyB=Tt.shapeA=Tt.shapeB=null}if(a){for(let l=0,c=Nt.length;l<c;l+=2){const h=this.getShapeById(Nt[l]),p=this.getShapeById(Nt[l+1]);zt.shapeA=h,zt.shapeB=p,h&&(zt.bodyA=h.body),p&&(zt.bodyB=p.body),this.dispatchEvent(zt)}zt.bodyA=zt.bodyB=zt.shapeA=zt.shapeB=null}}clearForces(){const i=this.bodies,s=i.length;for(let o=0;o!==s;o++){const a=i[o];a.force,a.torque,a.force.set(0,0,0),a.torque.set(0,0,0)}}}new bt;const oi=new at,ct=globalThis.performance||{};if(!ct.now){let z=Date.now();ct.timing&&ct.timing.navigationStart&&(z=ct.timing.navigationStart),ct.now=()=>Date.now()-z}new u;const Qh={type:"postStep"},td={type:"preStep"},Fe={type:U.COLLIDE_EVENT_NAME,body:null,contact:null},ed=[],nd=[],id=[],sd=[],Lt=[],Nt=[],De={type:"beginContact",bodyA:null,bodyB:null},Oe={type:"endContact",bodyA:null,bodyB:null},Tt={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},zt={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var ri={exports:{}};/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */(function(z,i){(function(s,o){o(i)})(El,function(s){class o{constructor(t){const[e,r]=t.split("-"),d=e.split(".");this.major=parseInt(d[0],10),this.minor=parseInt(d[1],10),this.patch=parseInt(d[2],10),this.prerelease=r!=null?r:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class a{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(t){this.target=t}}class c extends l{constructor(t,e,r,d){super(t);this.value=e,this.presetKey=r,this.last=d!=null?d:!0}}class h extends l{constructor(t,e,r){super(t);this.value=e,this.presetKey=r}}class p extends l{constructor(t,e){super(t);this.expanded=e}}function v(n){return n}function m(n){return n==null}function w(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}const f={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class b{constructor(t){var e;this.message=(e=f[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new b({type:"alreadydisposed"})}static notBindable(){return new b({type:"notbindable"})}static propertyNotFound(t){return new b({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new b({type:"shouldneverhappen"})}}class g{constructor(t,e,r){this.obj_=t,this.key_=e,this.presetKey_=r!=null?r:e}static isBindable(t){return!(t===null||typeof t!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const r=this.read();if(!g.isBindable(r))throw b.notBindable();if(!(t in r))throw b.propertyNotFound(t);r[t]=e}}class C extends a{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const r=e.bind(this);return this.controller_.valueController.emitter.on(t,()=>{r(new l(this))}),this}}class y{constructor(){this.observers_={}}on(t,e){let r=this.observers_[t];return r||(r=this.observers_[t]=[]),r.push({handler:e}),this}off(t,e){const r=this.observers_[t];return r&&(this.observers_[t]=r.filter(d=>d.handler!==e)),this}emit(t,e){const r=this.observers_[t];!r||r.forEach(d=>{d.handler(e)})}}const E="tp";function _(n){return(e,r)=>[E,"-",n,"v",e?`_${e}`:"",r?`-${r}`:""].join("")}function M(n,t){return e=>t(n(e))}function S(n){return n.rawValue}function A(n,t){n.emitter.on("change",M(S,t)),t(n.rawValue)}function V(n,t,e){A(n.value(t),e)}function N(n,t,e){e?n.classList.add(t):n.classList.remove(t)}function O(n,t){return e=>{N(n,t,e)}}function q(n,t){A(n,e=>{t.textContent=e!=null?e:""})}const R=_("btn");class L{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(R()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("button");r.classList.add(R("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const d=t.createElement("div");d.classList.add(R("t")),q(e.props.value("title"),d),this.buttonElement.appendChild(d)}}class j{constructor(t,e){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new L(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class B{constructor(t,e){var r;this.constraint_=e==null?void 0:e.constraint,this.equals_=(r=e==null?void 0:e.equals)!==null&&r!==void 0?r:(d,x)=>d===x,this.emitter=new y,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const r=e!=null?e:{forceEmit:!1,last:!0},d=this.constraint_?this.constraint_.constrain(t):t;!!this.equals_(this.rawValue_,d)&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=d,this.emitter.emit("change",{options:r,rawValue:d,sender:this}))}}class I{constructor(t){this.emitter=new y,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const r=e!=null?e:{forceEmit:!1,last:!0};this.value_===t&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:r,rawValue:this.value_,sender:this}))}}function T(n,t){const e=t==null?void 0:t.constraint,r=t==null?void 0:t.equals;return!e&&!r?new I(n):new B(n,t)}class k{constructor(t){this.emitter=new y,this.valMap_=t;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((r,d)=>Object.assign(r,{[d]:T(t[d])}),{})}static fromObject(t){const e=this.createCore(t);return new k(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function X(n,t){const r=Object.keys(t).reduce((d,x)=>{if(d===void 0)return;const F=t[x](n[x]);return F.succeeded?Object.assign(Object.assign({},d),{[x]:F.value}):void 0},{});return r}function K(n,t){return n.reduce((e,r)=>{if(e===void 0)return;const d=t(r);if(!(!d.succeeded||d.value===void 0))return[...e,d.value]},[])}function $(n){return n===null?!1:typeof n=="object"}function Y(n){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};const r=n(e);return r!==void 0?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function tt(n){return{custom:t=>Y(t)(n),boolean:Y(t=>typeof t=="boolean"?t:void 0)(n),number:Y(t=>typeof t=="number"?t:void 0)(n),string:Y(t=>typeof t=="string"?t:void 0)(n),function:Y(t=>typeof t=="function"?t:void 0)(n),constant:t=>Y(e=>e===t?t:void 0)(n),raw:Y(t=>t)(n),object:t=>Y(e=>{if(!!$(e))return X(e,t)})(n),array:t=>Y(e=>{if(!!Array.isArray(e))return K(e,t)})(n)}}const D={optional:tt(!0),required:tt(!1)};function J(n,t){const e=D.required.object(t)(n);return e.succeeded?e.value:void 0}function Rt(n){return n&&n.parentElement&&n.parentElement.removeChild(n),null}function dt(){return["veryfirst","first","last","verylast"]}const It=_(""),Wt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class xt{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{dt().forEach(r=>{e.classList.remove(It(void 0,Wt[r]))}),this.blade.get("positions").forEach(r=>{e.classList.add(It(void 0,Wt[r]))})}),this.viewProps.handleDispose(()=>{Rt(e)})}get parent(){return this.parent_}}const rt="http://www.w3.org/2000/svg";function ie(n){n.offsetHeight}function $t(n,t){const e=n.style.transition;n.style.transition="none",t(),n.style.transition=e}function mt(n){return n.ontouchstart!==void 0}function fn(){return new Function("return this")()}function bn(){return fn().document}function se(n){const t=n.ownerDocument.defaultView;return t&&"document"in t?n.getContext("2d"):null}const Ct={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Ge(n,t){const e=n.createElementNS(rt,"svg");return e.innerHTML=Ct[t],e}function hi(n,t,e){n.insertBefore(t,n.children[e])}function di(n){n.parentElement&&n.parentElement.removeChild(n)}function pi(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Us(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function ui(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}const ge=_("lbl");function Hs(n,t){const e=n.createDocumentFragment();return t.split(`
`).map(d=>n.createTextNode(d)).forEach((d,x)=>{x>0&&e.appendChild(n.createElement("br")),e.appendChild(d)}),e}class vi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ge()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(ge("l")),V(e.props,"label",x=>{m(x)?this.element.classList.add(ge(void 0,"nol")):(this.element.classList.remove(ge(void 0,"nol")),Us(r),r.appendChild(Hs(t,x)))}),this.element.appendChild(r),this.labelElement=r;const d=t.createElement("div");d.classList.add(ge("v")),this.element.appendChild(d),this.valueElement=d}}class Ke extends xt{constructor(t,e){const r=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new vi(t,{props:e.props,viewProps:r}),viewProps:r}));this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Gs={id:"button",type:"blade",accept(n){const t=D,e=J(n,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return e?{params:e}:null},controller(n){return new Ke(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:new j(n.document,{props:k.fromObject({title:n.params.title}),viewProps:n.viewProps})})},api(n){return!(n.controller instanceof Ke)||!(n.controller.valueController instanceof j)?null:new C(n.controller)}};class oe extends xt{constructor(t){super(t);this.value=t.value}}function _e(){return new k({positions:T([],{equals:w})})}class ye extends k{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},r=k.createCore(e);return new ye(r)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!m(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const r=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};V(this,"expanded",r),V(this,"temporaryExpanded",r)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ks(n,t){let e=0;return $t(t,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),ie(t),e=t.clientHeight,n.set("temporaryExpanded",null),ie(t)}),e}function mi(n,t){t.style.height=n.styleHeight}function wn(n,t){n.value("expanded").emitter.on("beforechange",()=>{n.set("completed",!1),m(n.get("expandedHeight"))&&n.set("expandedHeight",Ks(n,t)),n.set("shouldFixHeight",!0),ie(t)}),n.emitter.on("change",()=>{mi(n,t)}),mi(n,t),t.addEventListener("transitionend",e=>{e.propertyName==="height"&&n.cleanUpTransition()})}class gn extends a{constructor(t,e){super(t);this.rackApi_=e}}function Ws(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function $s(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Ys(n,t){const e=t||{};return n.addBlade(Object.assign(Object.assign({},e),{view:"separator"}))}function Xs(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class _n{constructor(t){this.emitter=new y,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw b.shouldNeverHappen();const r=e!==void 0?e:this.items_.length;this.items_.splice(r,0,t),this.cache_.add(t);const d=this.extract_(t);d&&(d.emitter.on("add",this.onSubListAdd_),d.emitter.on("remove",this.onSubListRemove_),d.allItems().forEach(x=>{this.cache_.add(x)})),this.emitter.emit("add",{index:r,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const r=this.extract_(t);r&&(r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class yn extends a{constructor(t){super(t);this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new c(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class Et extends Ke{constructor(t,e){super(t,e);this.binding=e.binding}}class xn extends a{constructor(t){super(t);this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new h(this,e,this.controller_.binding.target.presetKey)})}}class Ft extends Ke{constructor(t,e){super(t,e);this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Zs(n){return n instanceof We?n.apiSet_:n instanceof gn?n.rackApi_.apiSet_:null}function xe(n,t){const e=n.find(r=>r.controller_===t);if(!e)throw b.shouldNeverHappen();return e}function fi(n,t,e){if(!g.isBindable(n))throw b.notBindable();return new g(n,t,e)}class We extends a{constructor(t,e){super(t);this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new y,this.apiSet_=new _n(Zs),this.pool_=e;const r=this.controller_.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),r.emitter.on("inputchange",this.onRackInputChange_),r.emitter.on("monitorupdate",this.onRackMonitorUpdate_),r.children.forEach(d=>{this.setUpApi_(d)})}get children(){return this.controller_.rack.children.map(t=>xe(this.apiSet_,t))}addInput(t,e,r){const d=r||{},x=this.controller_.view.element.ownerDocument,P=this.pool_.createInput(x,fi(t,e,d.presetKey),d),F=new yn(P);return this.add(F,d.index)}addMonitor(t,e,r){const d=r||{},x=this.controller_.view.element.ownerDocument,P=this.pool_.createMonitor(x,fi(t,e),d),F=new xn(P);return this.add(F,d.index)}addFolder(t){return $s(this,t)}addButton(t){return Ws(this,t)}addSeparator(t){return Ys(this,t)}addTab(t){return Xs(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const r=this.apiSet_.find(d=>d.controller_===t.controller_);return r&&this.apiSet_.remove(r),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,r=this.pool_.createBlade(e,t),d=this.pool_.createBladeApi(r);return this.add(d,t.index)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}setUpApi_(t){this.apiSet_.find(r=>r.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=xe(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof Et){const r=xe(this.apiSet_,e),d=e.binding;this.emitter_.emit("change",{event:new c(r,d.target.read(),d.target.presetKey,t.options.last)})}else if(e instanceof oe){const r=xe(this.apiSet_,e);this.emitter_.emit("change",{event:new c(r,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof Ft))throw b.shouldNeverHappen();const e=xe(this.apiSet_,t.bladeController),r=t.bladeController.binding;this.emitter_.emit("update",{event:new h(e,r.target.read(),r.target.presetKey)})}}class Cn extends gn{constructor(t,e){super(t,new We(t.rackController,e));this.emitter_=new y,this.controller_.foldable.value("expanded").emitter.on("change",r=>{this.emitter_.emit("fold",{event:new p(this,r.sender.rawValue)})}),this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,r){return this.rackApi_.addInput(t,e,r)}addMonitor(t,e,r){return this.rackApi_.addMonitor(t,e,r)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}}class En extends xt{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps});this.rackController=t.rackController}}class Js{constructor(t,e){const r=_(e.viewName);this.element=t.createElement("div"),this.element.classList.add(r()),e.viewProps.bindClassModifiers(this.element)}}function Qs(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof Et&&r.binding===t)return r}return null}function to(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof Ft&&r.binding===t)return r}return null}function eo(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof oe&&r.value===t)return r}return null}function Pn(n){return n instanceof Ce?n.rack:n instanceof En?n.rackController.rack:null}function no(n){const t=Pn(n);return t?t.bcSet_:null}class io{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new y,this.blade_=t!=null?t:null,(e=this.blade_)===null||e===void 0||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new _n(no),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(e=>e instanceof t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const r=t.item;if(r.viewProps.emitter.on("change",this.onChildViewPropsChange_),r.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),r.viewProps.handleDispose(this.onChildDispose_),r instanceof Et)r.binding.emitter.on("change",this.onChildInputChange_);else if(r instanceof Ft)r.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(r instanceof oe)r.value.emitter.on("change",this.onChildValueChange_);else{const d=Pn(r);if(d){const x=d.emitter;x.on("layout",this.onDescendantLayout_),x.on("inputchange",this.onDescendantInputChange_),x.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const r=t.item;if(r instanceof Et)r.binding.emitter.off("change",this.onChildInputChange_);else if(r instanceof Ft)r.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(r instanceof oe)r.value.emitter.off("change",this.onChildValueChange_);else{const d=Pn(r);if(d){const x=d.emitter;x.off("layout",this.onDescendantLayout_),x.off("inputchange",this.onDescendantInputChange_),x.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(d=>!d.viewProps.get("hidden")),e=t[0],r=t[t.length-1];this.bcSet_.items.forEach(d=>{const x=[];d===e&&(x.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&x.push("veryfirst")),d===r&&(x.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&x.push("verylast")),d.blade.set("positions",x)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(t){const e=Qs(this.find(Et),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=to(this.find(Ft),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=eo(this.find(oe),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Ce extends xt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Js(t,{viewName:"brk",viewProps:e.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=new io(e.root?void 0:e.blade);r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.rack=r,this.viewProps.handleDispose(()=>{for(let d=this.rack.children.length-1;d>=0;d--)this.rack.children[d].viewProps.set("disposed",!0)})}onRackAdd_(t){!t.isRoot||hi(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){!t.isRoot||di(t.bladeController.view.element)}}const bi=_("cnt");class so{constructor(t,e){this.className_=_(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),bi()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),V(this.foldable_,"completed",O(this.element,this.className_(void 0,"cpl")));const r=t.createElement("button");r.classList.add(this.className_("b")),V(e.props,"title",F=>{m(F)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const d=t.createElement("div");d.classList.add(this.className_("t")),q(e.props.value("title"),d),this.buttonElement.appendChild(d),this.titleElement=d;const x=t.createElement("div");x.classList.add(this.className_("m")),this.buttonElement.appendChild(x);const P=e.containerElement;P.classList.add(this.className_("c")),this.element.appendChild(P),this.containerElement=P}}class kn extends En{constructor(t,e){var r;const d=ye.create((r=e.expanded)!==null&&r!==void 0?r:!0),x=new Ce(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:x,view:new so(t,{containerElement:x.view.element,foldable:d,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=d,wn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const oo={id:"folder",type:"blade",accept(n){const t=D,e=J(n,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return e?{params:e}:null},controller(n){return new kn(n.document,{blade:n.blade,expanded:n.params.expanded,props:k.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof kn?new Cn(n.controller,n.pool):null}};class re extends oe{constructor(t,e){const r=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new vi(t,{props:e.props,viewProps:r}),viewProps:r}));this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class wi extends a{}const gi=_("spr");class ro{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(gi()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("hr");r.classList.add(gi("r")),this.element.appendChild(r)}}class _i extends xt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new ro(t,{viewProps:e.viewProps})}))}}const ao={id:"separator",type:"blade",accept(n){const e=J(n,{view:D.required.constant("separator")});return e?{params:e}:null},controller(n){return new _i(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof _i?new wi(n.controller):null}},lo=_("");function yi(n,t){return O(n,lo(void 0,t))}class Dt extends k{constructor(t){super(t)}static create(t){var e,r;const d=t!=null?t:{},x={disabled:(e=d.disabled)!==null&&e!==void 0?e:!1,disposed:!1,hidden:(r=d.hidden)!==null&&r!==void 0?r:!1},P=k.createCore(x);return new Dt(P)}bindClassModifiers(t){V(this,"disabled",yi(t,"disabled")),V(this,"hidden",yi(t,"hidden"))}bindDisabled(t){V(this,"disabled",e=>{t.disabled=e})}bindTabIndex(t){V(this,"disabled",e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}}const Ee=_("tbi");class co{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ee()),e.viewProps.bindClassModifiers(this.element),V(e.props,"selected",x=>{x?this.element.classList.add(Ee(void 0,"sel")):this.element.classList.remove(Ee(void 0,"sel"))});const r=t.createElement("button");r.classList.add(Ee("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const d=t.createElement("div");d.classList.add(Ee("t")),q(e.props.value("title"),d),this.buttonElement.appendChild(d),this.titleElement=d}}class ho{constructor(t,e){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new co(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class xi{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ho(t,{props:e.itemProps,viewProps:Dt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Ce(t,{blade:_e(),viewProps:Dt.create()}),this.props=e.props,V(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.contentController.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ci{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,r){return this.rackApi_.addInput(t,e,r)}addMonitor(t,e,r){return this.rackApi_.addMonitor(t,e,r)}addBlade(t){return this.rackApi_.addBlade(t)}}class Ei extends gn{constructor(t,e){super(t,new We(t.rackController,e));this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new y,this.pageApiMap_=new Map,this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(r=>{this.setUpPageApi_(r)})}get pages(){return this.controller_.pageSet.items.map(t=>{const e=this.pageApiMap_.get(t);if(!e)throw b.shouldNeverHappen();return e})}addPage(t){const e=this.controller_.view.element.ownerDocument,r=new xi(e,{itemProps:k.fromObject({selected:!1,title:t.title}),props:k.fromObject({selected:!1})});this.controller_.add(r,t.index);const d=this.pageApiMap_.get(r);if(!d)throw b.shouldNeverHappen();return d}removePage(t){this.controller_.remove(t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find(d=>d.controller_===t.contentController);if(!e)throw b.shouldNeverHappen();const r=new Ci(t,e);this.pageApiMap_.set(t,r)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw b.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const $e=_("tab");class po{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add($e(),bi()),e.viewProps.bindClassModifiers(this.element),A(e.empty,O(this.element,$e(void 0,"nop")));const r=t.createElement("div");r.classList.add($e("i")),this.element.appendChild(r),this.itemsElement=r;const d=e.contentsElement;d.classList.add($e("c")),this.element.appendChild(d),this.contentsElement=d}}class Pi extends En{constructor(t,e){const r=new Ce(t,{blade:e.blade,viewProps:e.viewProps}),d=T(!0);super({blade:e.blade,rackController:r,view:new po(t,{contentsElement:r.view.element,empty:d,viewProps:e.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new _n(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=d,this.applyPages_()}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e!=null?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(t){const e=t.item;hi(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const e=t.item;di(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const t=this.pageSet_.items.findIndex(e=>e.props.get("selected"));t<0?this.pageSet_.items.forEach((e,r)=>{e.props.set("selected",r===0)}):this.pageSet_.items.forEach((e,r)=>{e.props.set("selected",r===t)})}onPageSelectedChange_(t){if(t.rawValue){const e=this.pageSet_.items.findIndex(r=>r.props.value("selected")===t.sender);this.pageSet_.items.forEach((r,d)=>{r.props.set("selected",d===e)})}else this.keepSelection_()}}const ki={id:"tab",type:"blade",accept(n){const t=D,e=J(n,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!e||e.pages.length===0?null:{params:e}},controller(n){const t=new Pi(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(e=>{const r=new xi(n.document,{itemProps:k.fromObject({selected:!1,title:e.title}),props:k.fromObject({selected:!1})});t.add(r)}),t},api(n){return n.controller instanceof Pi?new Ei(n.controller,n.pool):null}};function uo(n,t){const e=n.accept(t.params);if(!e)return null;const r=D.optional.boolean(t.params.disabled).value,d=D.optional.boolean(t.params.hidden).value;return n.controller({blade:_e(),document:t.document,params:Object.assign(Object.assign({},e.params),{disabled:r,hidden:d}),viewProps:Dt.create({disabled:r,hidden:d})})}class vo{constructor(){this.disabled=!1,this.emitter=new y}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class mo{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new y,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Yt{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((e,r)=>r.constrain(e),t)}}function Pt(n,t){if(n instanceof t)return n;if(n instanceof Yt){const e=n.constraints.reduce((r,d)=>r||(d instanceof t?d:null),null);if(e)return e}return null}class Pe{constructor(t){this.options=t}constrain(t){const e=this.options;return e.length===0||e.filter(d=>d.value===t).length>0?t:e[0].value}}class ft{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let e=t;return m(this.minValue)||(e=Math.max(e,this.minValue)),m(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}class Xt{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const Sn=_("lst");class fo{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Sn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("select");r.classList.add(Sn("s")),V(this.props_,"options",x=>{pi(r),x.forEach((P,F)=>{const G=t.createElement("option");G.dataset.index=String(F),G.textContent=P.text,G.value=String(P.value),r.appendChild(G)})}),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const d=t.createElement("div");d.classList.add(Sn("m")),d.appendChild(Ge(t,"dropdown")),this.element.appendChild(d),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ke{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new fo(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const r=t.currentTarget.selectedOptions.item(0);if(!r)return;const d=Number(r.dataset.index);this.value.rawValue=this.props.get("options")[d].value}}const Si=_("pop");class bo{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Si()),e.viewProps.bindClassModifiers(this.element),A(e.shows,O(this.element,Si(void 0,"v")))}}class Ai{constructor(t,e){this.shows=T(!1),this.viewProps=e.viewProps,this.view=new bo(t,{shows:this.shows,viewProps:this.viewProps})}}const Mi=_("txt");class wo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mi()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const r=t.createElement("input");r.classList.add(Mi("i")),r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Ye{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new wo(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const r=t.currentTarget.value,d=this.parser_(r);m(d)||(this.value.rawValue=d),this.view.refresh()}}function go(n){return String(n)}function Vi(n){return n==="false"?!1:!!n}function Bi(n){return go(n)}class _o{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const yo={"**":(n,t)=>Math.pow(n,t),"*":(n,t)=>n*t,"/":(n,t)=>n/t,"%":(n,t)=>n%t,"+":(n,t)=>n+t,"-":(n,t)=>n-t,"<<":(n,t)=>n<<t,">>":(n,t)=>n>>t,">>>":(n,t)=>n>>>t,"&":(n,t)=>n&t,"^":(n,t)=>n^t,"|":(n,t)=>n|t};class xo{constructor(t,e,r){this.left=e,this.operator=t,this.right=r}evaluate(){const t=yo[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Co={"+":n=>n,"-":n=>-n,"~":n=>~n};class Eo{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=Co[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function An(n){return(t,e)=>{for(let r=0;r<n.length;r++){const d=n[r](t,e);if(d!=="")return d}return""}}function Se(n,t){var e;const r=n.substr(t).match(/^\s+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Po(n,t){const e=n.substr(t,1);return e.match(/^[1-9]$/)?e:""}function Ae(n,t){var e;const r=n.substr(t).match(/^[0-9]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function ko(n,t){const e=Ae(n,t);if(e!=="")return e;const r=n.substr(t,1);if(t+=1,r!=="-"&&r!=="+")return"";const d=Ae(n,t);return d===""?"":r+d}function Mn(n,t){const e=n.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";const r=ko(n,t);return r===""?"":e+r}function Li(n,t){const e=n.substr(t,1);if(e==="0")return e;const r=Po(n,t);return t+=r.length,r===""?"":r+Ae(n,t)}function So(n,t){const e=Li(n,t);if(t+=e.length,e==="")return"";const r=n.substr(t,1);if(t+=r.length,r!==".")return"";const d=Ae(n,t);return t+=d.length,e+r+d+Mn(n,t)}function Ao(n,t){const e=n.substr(t,1);if(t+=e.length,e!==".")return"";const r=Ae(n,t);return t+=r.length,r===""?"":e+r+Mn(n,t)}function Mo(n,t){const e=Li(n,t);return t+=e.length,e===""?"":e+Mn(n,t)}const Vo=An([So,Ao,Mo]);function Bo(n,t){var e;const r=n.substr(t).match(/^[01]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Lo(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";const r=Bo(n,t);return r===""?"":e+r}function No(n,t){var e;const r=n.substr(t).match(/^[0-7]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function To(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";const r=No(n,t);return r===""?"":e+r}function zo(n,t){var e;const r=n.substr(t).match(/^[0-9a-f]+/i);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Ro(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";const r=zo(n,t);return r===""?"":e+r}const Io=An([Lo,To,Ro]),Fo=An([Io,Vo]);function Do(n,t){const e=Fo(n,t);return t+=e.length,e===""?null:{evaluable:new _o(e),cursor:t}}function Oo(n,t){const e=n.substr(t,1);if(t+=e.length,e!=="(")return null;const r=Ti(n,t);if(!r)return null;t=r.cursor,t+=Se(n,t).length;const d=n.substr(t,1);return t+=d.length,d!==")"?null:{evaluable:r.evaluable,cursor:t}}function qo(n,t){return Do(n,t)||Oo(n,t)}function Ni(n,t){const e=qo(n,t);if(e)return e;const r=n.substr(t,1);if(t+=r.length,r!=="+"&&r!=="-"&&r!=="~")return null;const d=Ni(n,t);return d?(t=d.cursor,{cursor:t,evaluable:new Eo(r,d.evaluable)}):null}function jo(n,t,e){e+=Se(t,e).length;const r=n.filter(d=>t.startsWith(d,e))[0];return r?(e+=r.length,e+=Se(t,e).length,{cursor:e,operator:r}):null}function Uo(n,t){return(e,r)=>{const d=n(e,r);if(!d)return null;r=d.cursor;let x=d.evaluable;for(;;){const P=jo(t,e,r);if(!P)break;r=P.cursor;const F=n(e,r);if(!F)return null;r=F.cursor,x=new xo(P.operator,x,F.evaluable)}return x?{cursor:r,evaluable:x}:null}}const Ho=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,t)=>Uo(n,t),Ni);function Ti(n,t){return t+=Se(n,t).length,Ho(n,t)}function Go(n){const t=Ti(n,0);return!t||t.cursor+Se(n,t.cursor).length!==n.length?null:t.evaluable}function Mt(n){var t;const e=Go(n);return(t=e==null?void 0:e.evaluate())!==null&&t!==void 0?t:null}function zi(n){if(typeof n=="number")return n;if(typeof n=="string"){const t=Mt(n);if(!m(t))return t}return 0}function Ko(n){return String(n)}function pt(n){return t=>t.toFixed(Math.max(Math.min(n,20),0))}const Wo=pt(0);function Xe(n){return Wo(n)+"%"}function Ri(n){return String(n)}function Vn(n){return n}function Ii(n,t){for(;n.length<t;)n.push(void 0)}function $o(n){const t=[];return Ii(t,n),T(t)}function Yo(n){const t=n.indexOf(void 0);return t<0?n:n.slice(0,t)}function Xo(n,t){const e=[...Yo(n),t];return e.length>n.length?e.splice(0,e.length-n.length):Ii(e,n.length),e}function Me({primary:n,secondary:t,forward:e,backward:r}){let d=!1;function x(P){d||(d=!0,P(),d=!1)}n.emitter.on("change",P=>{x(()=>{t.setRawValue(e(n,t),P.options)})}),t.emitter.on("change",P=>{x(()=>{n.setRawValue(r(n,t),P.options)}),x(()=>{t.setRawValue(e(n,t),P.options)})}),x(()=>{t.setRawValue(e(n,t),{forceEmit:!1,last:!0})})}function ut(n,t){const e=n*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function Ve(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Vt(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function Zo(n){return n==="ArrowUp"||n==="ArrowDown"}function Fi(n){return Zo(n)||n==="ArrowLeft"||n==="ArrowRight"}function Bn(n,t){const e=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:n.pageX-((e&&e.scrollX||0)+r.left),y:n.pageY-((e&&e.scrollY||0)+r.top)}}class Zt{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new y,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();const r=this.elem_.ownerDocument;r.addEventListener("mousemove",this.onDocumentMouseMove_),r.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Bn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Bn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Bn(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-r.left,y:e.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-r.left,y:e.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const r=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,d=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(r?{x:r.clientX-d.left,y:r.clientY-d.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function ot(n,t,e,r,d){const x=(n-t)/(e-t);return r+x*(d-r)}function Di(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function it(n,t,e){return Math.min(Math.max(n,t),e)}function Ln(n,t){return(n%t+t)%t}const wt=_("txt");class Jo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(wt(),wt(void 0,"num")),e.arrayPosition&&this.element.classList.add(wt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("input");r.classList.add(wt("i")),r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(wt()),this.inputElement.classList.add(wt("i"));const d=t.createElement("div");d.classList.add(wt("k")),this.element.appendChild(d),this.knobElement=d;const x=t.createElementNS(rt,"svg");x.classList.add(wt("g")),this.knobElement.appendChild(x);const P=t.createElementNS(rt,"path");P.classList.add(wt("gb")),x.appendChild(P),this.guideBodyElem_=P;const F=t.createElementNS(rt,"path");F.classList.add(wt("gh")),x.appendChild(F),this.guideHeadElem_=F;const G=t.createElement("div");G.classList.add(_("tt")()),this.knobElement.appendChild(G),this.tooltipElem_=G,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(wt(void 0,"drg"));return}this.element.classList.add(wt(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),r=e+(e>0?-1:e<0?1:0),d=it(-r,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${r+d},0 L${r},4 L${r+d},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const x=this.props_.get("formatter");this.tooltipElem_.textContent=x(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Be{constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=T(null),this.view=new Jo(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Zt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const r=t.currentTarget.value,d=this.parser_(r);m(d)||(this.value.rawValue=d),this.view.refresh()}onInputKeyDown_(t){const e=ut(this.baseStep_,Ve(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){ut(this.baseStep_,Ve(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Nn=_("sld");class Qo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Nn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(Nn("t")),e.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;const d=t.createElement("div");d.classList.add(Nn("k")),this.trackElement.appendChild(d),this.knobElement=d,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=it(ot(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class tr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Qo(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){!t.point||this.value.setRawValue(ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ut(this.baseStep_,Vt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){ut(this.baseStep_,Vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Tn=_("sldtxt");class er{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Tn());const r=t.createElement("div");r.classList.add(Tn("s")),this.sliderView_=e.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);const d=t.createElement("div");d.classList.add(Tn("t")),this.textView_=e.textView,d.appendChild(this.textView_.element),this.element.appendChild(d)}}class zn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new tr(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Be(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps}),this.view=new er(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Le(n,t){n.write(t)}function Ze(n){const t=D;if(Array.isArray(n))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(n).value;if(typeof n=="object")return t.required.raw(n).value}function Oi(n){if(n==="inline"||n==="popup")return n}function Ot(n){const t=D;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(n).value}function qi(n){if(Array.isArray(n))return n;const t=[];return Object.keys(n).forEach(e=>{t.push({text:e,value:n[e]})}),t}function Rn(n){return m(n)?null:new Pe(qi(n))}function In(n){const t=n?Pt(n,Pe):null;return t?t.options:null}function nr(n){const t=n?Pt(n,Xt):null;return t?t.step:null}function Je(n,t){const e=n&&Pt(n,Xt);return e?Di(e.step):Math.max(Di(t),2)}function ae(n){const t=nr(n);return t!=null?t:1}function le(n,t){var e;const r=n&&Pt(n,Xt),d=Math.abs((e=r==null?void 0:r.step)!==null&&e!==void 0?e:t);return d===0?.1:Math.pow(10,Math.floor(Math.log10(d))-1)}const Qe=_("ckb");class ir{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Qe()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("label");r.classList.add(Qe("l")),this.element.appendChild(r);const d=t.createElement("input");d.classList.add(Qe("i")),d.type="checkbox",r.appendChild(d),this.inputElement=d,e.viewProps.bindDisabled(this.inputElement);const x=t.createElement("div");x.classList.add(Qe("w")),r.appendChild(x);const P=Ge(t,"check");x.appendChild(P),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class sr{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ir(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}function or(n){const t=[],e=Rn(n.options);return e&&t.push(e),new Yt(t)}const rr={id:"input-bool",type:"input",accept:(n,t)=>{if(typeof n!="boolean")return null;const r=J(t,{options:D.optional.custom(Ze)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Vi,constraint:n=>or(n.params),writer:n=>Le},controller:n=>{var t;const e=n.document,r=n.value,d=n.constraint;return d&&Pt(d,Pe)?new ke(e,{props:k.fromObject({options:(t=In(d))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps}):new sr(e,{value:r,viewProps:n.viewProps})}},Jt=_("col");class ar{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Jt()),e.foldable.bindExpandedClass(this.element,Jt(void 0,"expanded")),V(e.foldable,"completed",O(this.element,Jt(void 0,"cpl")));const r=t.createElement("div");r.classList.add(Jt("h")),this.element.appendChild(r);const d=t.createElement("div");d.classList.add(Jt("s")),r.appendChild(d),this.swatchElement=d;const x=t.createElement("div");if(x.classList.add(Jt("t")),r.appendChild(x),this.textElement=x,e.pickerLayout==="inline"){const P=t.createElement("div");P.classList.add(Jt("p")),this.element.appendChild(P),this.pickerElement=P}else this.pickerElement=null}}function lr(n,t,e){const r=it(n/255,0,1),d=it(t/255,0,1),x=it(e/255,0,1),P=Math.max(r,d,x),F=Math.min(r,d,x),G=P-F;let W=0,Q=0;const et=(F+P)/2;return G!==0&&(Q=G/(1-Math.abs(P+F-1)),r===P?W=(d-x)/G:d===P?W=2+(x-r)/G:W=4+(r-d)/G,W=W/6+(W<0?1:0)),[W*360,Q*100,et*100]}function cr(n,t,e){const r=(n%360+360)%360,d=it(t/100,0,1),x=it(e/100,0,1),P=(1-Math.abs(2*x-1))*d,F=P*(1-Math.abs(r/60%2-1)),G=x-P/2;let W,Q,et;return r>=0&&r<60?[W,Q,et]=[P,F,0]:r>=60&&r<120?[W,Q,et]=[F,P,0]:r>=120&&r<180?[W,Q,et]=[0,P,F]:r>=180&&r<240?[W,Q,et]=[0,F,P]:r>=240&&r<300?[W,Q,et]=[F,0,P]:[W,Q,et]=[P,0,F],[(W+G)*255,(Q+G)*255,(et+G)*255]}function hr(n,t,e){const r=it(n/255,0,1),d=it(t/255,0,1),x=it(e/255,0,1),P=Math.max(r,d,x),F=Math.min(r,d,x),G=P-F;let W;G===0?W=0:P===r?W=60*(((d-x)/G%6+6)%6):P===d?W=60*((x-r)/G+2):W=60*((r-d)/G+4);const Q=P===0?0:G/P,et=P;return[W,Q*100,et*100]}function ji(n,t,e){const r=Ln(n,360),d=it(t/100,0,1),x=it(e/100,0,1),P=x*d,F=P*(1-Math.abs(r/60%2-1)),G=x-P;let W,Q,et;return r>=0&&r<60?[W,Q,et]=[P,F,0]:r>=60&&r<120?[W,Q,et]=[F,P,0]:r>=120&&r<180?[W,Q,et]=[0,P,F]:r>=180&&r<240?[W,Q,et]=[0,F,P]:r>=240&&r<300?[W,Q,et]=[F,0,P]:[W,Q,et]=[P,0,F],[(W+G)*255,(Q+G)*255,(et+G)*255]}function dr(n,t,e){const r=e+t*(100-Math.abs(2*e-100))/200;return[n,r!==0?t*(100-Math.abs(2*e-100))/r:0,e+t*(100-Math.abs(2*e-100))/(2*100)]}function pr(n,t,e){const r=100-Math.abs(e*(200-t)/100-100);return[n,r!==0?t*e/r:0,e*(200-t)/(2*100)]}function ce(n){return[n[0],n[1],n[2]]}function Ui(n,t){return[n[0],n[1],n[2],t]}const ur={hsl:{hsl:(n,t,e)=>[n,t,e],hsv:dr,rgb:cr},hsv:{hsl:pr,hsv:(n,t,e)=>[n,t,e],rgb:ji},rgb:{hsl:lr,hsv:hr,rgb:(n,t,e)=>[n,t,e]}};function vr(n,t,e){return ur[t][e](...n)}const mr={hsl:n=>{var t;return[Ln(n[0],360),it(n[1],0,100),it(n[2],0,100),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]},hsv:n=>{var t;return[Ln(n[0],360),it(n[1],0,100),it(n[2],0,100),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]},rgb:n=>{var t;return[it(n[0],0,255),it(n[1],0,255),it(n[2],0,255),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]}};function tn(n,t){return typeof n!="object"||m(n)?!1:t in n&&typeof n[t]=="number"}class Z{constructor(t,e){this.mode_=e,this.comps_=mr[e](t)}static black(){return new Z([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new Z(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return tn(t,"r")&&tn(t,"g")&&tn(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&tn(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return!1;const r=t.comps_,d=e.comps_;for(let x=0;x<r.length;x++)if(r[x]!==d[x])return!1;return!0}get mode(){return this.mode_}getComponents(t){return Ui(vr(ce(this.comps_),this.mode_,t||this.mode_),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const qt=_("colp");class fr{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(qt());const r=t.createElement("div");r.classList.add(qt("hsv"));const d=t.createElement("div");d.classList.add(qt("sv")),this.svPaletteView_=e.svPaletteView,d.appendChild(this.svPaletteView_.element),r.appendChild(d);const x=t.createElement("div");x.classList.add(qt("h")),this.hPaletteView_=e.hPaletteView,x.appendChild(this.hPaletteView_.element),r.appendChild(x),this.element.appendChild(r);const P=t.createElement("div");if(P.classList.add(qt("rgb")),this.textView_=e.textView,P.appendChild(this.textView_.element),this.element.appendChild(P),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const F=t.createElement("div");F.classList.add(qt("a"));const G=t.createElement("div");G.classList.add(qt("ap")),G.appendChild(this.alphaViews_.palette.element),F.appendChild(G);const W=t.createElement("div");W.classList.add(qt("at")),W.appendChild(this.alphaViews_.text.element),F.appendChild(W),this.element.appendChild(F)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Fn(n){const t=D;return J(n,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom(Oi)})}function Qt(n){return n?.1:1}function gt(n,t){const e=n.match(/^(.+)%$/);return Math.min(e?parseFloat(e[1])*.01*t:parseFloat(n),t)}const br={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function Hi(n){const t=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(n);const e=parseFloat(t[1]),r=t[2];return br[r](e)}const Dn={"func.rgb":n=>{const t=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[gt(t[1],255),gt(t[2],255),gt(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:new Z(e,"rgb")},"func.rgba":n=>{const t=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[gt(t[1],255),gt(t[2],255),gt(t[3],255),gt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:new Z(e,"rgb")},"func.hsl":n=>{const t=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Hi(t[1]),gt(t[2],100),gt(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:new Z(e,"hsl")},"func.hsla":n=>{const t=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Hi(t[1]),gt(t[2],100),gt(t[3],100),gt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:new Z(e,"hsl")},"hex.rgb":n=>{const t=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const e=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?new Z([parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)],"rgb"):null},"hex.rgba":n=>{const t=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),ot(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const e=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?new Z([parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),ot(parseInt(e[4],16),0,255,0,1)],"rgb"):null}};function en(n){return Object.keys(Dn).reduce((e,r)=>e||(Dn[r](n)?r:null),null)}const nn=n=>{const t=en(n);return t?Dn[t](n):null};function wr(n){return n==="func.hsla"||n==="func.rgba"||n==="hex.rgba"}function gr(n){if(typeof n=="string"){const t=nn(n);if(t)return t}return Z.black()}function Gi(n){const t=it(Math.floor(n),0,255).toString(16);return t.length===1?`0${t}`:t}function On(n,t="#"){const e=ce(n.getComponents("rgb")).map(Gi).join("");return`${t}${e}`}function sn(n,t="#"){const e=n.getComponents("rgb"),r=[e[0],e[1],e[2],e[3]*255].map(Gi).join("");return`${t}${r}`}function Ki(n){const t=pt(0);return`rgb(${ce(n.getComponents("rgb")).map(r=>t(r)).join(", ")})`}function on(n){const t=pt(2),e=pt(0);return`rgba(${n.getComponents("rgb").map((d,x)=>(x===3?t:e)(d)).join(", ")})`}function _r(n){const t=[pt(0),Xe,Xe];return`hsl(${ce(n.getComponents("hsl")).map((r,d)=>t[d](r)).join(", ")})`}function yr(n){const t=[pt(0),Xe,Xe,pt(2)];return`hsla(${n.getComponents("hsl").map((r,d)=>t[d](r)).join(", ")})`}const xr={"func.hsl":_r,"func.hsla":yr,"func.rgb":Ki,"func.rgba":on,"hex.rgb":On,"hex.rgba":sn};function Wi(n){return xr[n]}const Ne=_("apl");class Cr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Ne()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("div");r.classList.add(Ne("b")),this.element.appendChild(r);const d=t.createElement("div");d.classList.add(Ne("c")),r.appendChild(d),this.colorElem_=d;const x=t.createElement("div");x.classList.add(Ne("m")),this.element.appendChild(x),this.markerElem_=x;const P=t.createElement("div");P.classList.add(Ne("p")),this.markerElem_.appendChild(P),this.previewElem_=P,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),r=new Z([e[0],e[1],e[2],0],"rgb"),d=new Z([e[0],e[1],e[2],255],"rgb"),x=["to right",on(r),on(d)];this.colorElem_.style.background=`linear-gradient(${x.join(",")})`,this.previewElem_.style.backgroundColor=on(t);const P=ot(e[3],0,1,0,100);this.markerElem_.style.left=`${P}%`}onValueChange_(){this.update_()}}class Er{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Cr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=t.point.x/t.bounds.width,d=this.value.rawValue,[x,P,F]=d.getComponents("hsv");this.value.setRawValue(new Z([x,P,F,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ut(Qt(!0),Vt(t));if(e===0)return;const r=this.value.rawValue,[d,x,P,F]=r.getComponents("hsv");this.value.setRawValue(new Z([d,x,P,F+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){ut(Qt(!0),Vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const he=_("coltxt");function Pr(n){const t=n.createElement("select"),e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(e.reduce((r,d)=>{const x=n.createElement("option");return x.textContent=d.text,x.value=d.value,r.appendChild(x),r},n.createDocumentFragment())),t}class kr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(he());const r=t.createElement("div");r.classList.add(he("m")),this.modeElem_=Pr(t),this.modeElem_.classList.add(he("ms")),r.appendChild(this.modeSelectElement);const d=t.createElement("div");d.classList.add(he("mm")),d.appendChild(Ge(t,"dropdown")),r.appendChild(d),this.element.appendChild(r);const x=t.createElement("div");x.classList.add(he("w")),this.element.appendChild(x),this.textsElem_=x,this.textViews_=e.textViews,this.applyTextViews_(),A(e.colorMode,P=>{this.modeElem_.value=P})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){pi(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(e=>{const r=t.createElement("div");r.classList.add(he("c")),r.appendChild(e.element),this.textsElem_.appendChild(r)})}}const Sr=pt(0),Ar={rgb:()=>new ft({min:0,max:255}),hsl:n=>n===0?new ft({min:0,max:360}):new ft({min:0,max:100}),hsv:n=>n===0?new ft({min:0,max:360}):new ft({min:0,max:100})};function qn(n,t,e){return new Be(n,{arrayPosition:e===0?"fst":e===3-1?"lst":"mid",baseStep:Qt(!1),parser:t.parser,props:k.fromObject({draggingScale:1,formatter:Sr}),value:T(0,{constraint:Ar[t.colorMode](e)}),viewProps:t.viewProps})}class Mr{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=T(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new kr(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},r=[qn(t,e,0),qn(t,e,1),qn(t,e,2)];return r.forEach((d,x)=>{Me({primary:this.value,secondary:d.value,forward:P=>P.rawValue.getComponents(this.colorMode.rawValue)[x],backward:(P,F)=>{const G=this.colorMode.rawValue,W=P.rawValue.getComponents(G);return W[x]=F.rawValue,new Z(Ui(ce(W),W[3]),G)}})}),r}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const jn=_("hpl");class Vr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(jn()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("div");r.classList.add(jn("c")),this.element.appendChild(r);const d=t.createElement("div");d.classList.add(jn("m")),this.element.appendChild(d),this.markerElem_=d,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Ki(new Z([e,100,100],"hsv"));const r=ot(e,0,360,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class Br{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Vr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),d=this.value.rawValue,[,x,P,F]=d.getComponents("hsv");this.value.setRawValue(new Z([r,x,P,F],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=ut(Qt(!1),Vt(t));if(e===0)return;const r=this.value.rawValue,[d,x,P,F]=r.getComponents("hsv");this.value.setRawValue(new Z([d+e,x,P,F],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){ut(Qt(!1),Vt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Un=_("svp"),$i=64;class Lr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Un()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("canvas");r.height=$i,r.width=$i,r.classList.add(Un("c")),this.element.appendChild(r),this.canvasElement=r;const d=t.createElement("div");d.classList.add(Un("m")),this.element.appendChild(d),this.markerElem_=d,this.update_()}update_(){const t=se(this.canvasElement);if(!t)return;const r=this.value.rawValue.getComponents("hsv"),d=this.canvasElement.width,x=this.canvasElement.height,P=t.getImageData(0,0,d,x),F=P.data;for(let Q=0;Q<x;Q++)for(let et=0;et<d;et++){const te=ot(et,0,d,0,100),ze=ot(Q,0,x,100,0),Re=ji(r[0],te,ze),ve=(Q*d+et)*4;F[ve]=Re[0],F[ve+1]=Re[1],F[ve+2]=Re[2],F[ve+3]=255}t.putImageData(P,0,0);const G=ot(r[1],0,100,0,100);this.markerElem_.style.left=`${G}%`;const W=ot(r[2],0,100,100,0);this.markerElem_.style.top=`${W}%`}onValueChange_(){this.update_()}}class Nr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Lr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=ot(t.point.x,0,t.bounds.width,0,100),d=ot(t.point.y,0,t.bounds.height,100,0),[x,,,P]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Z([x,r,d,P],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Fi(t.key)&&t.preventDefault();const[e,r,d,x]=this.value.rawValue.getComponents("hsv"),P=Qt(!1),F=ut(P,Vt(t)),G=ut(P,Ve(t));F===0&&G===0||this.value.setRawValue(new Z([e,r+F,d+G,x],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Qt(!1),r=ut(e,Vt(t)),d=ut(e,Ve(t));r===0&&d===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Tr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Br(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Nr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Er(t,{value:this.value,viewProps:this.viewProps}),text:new Be(t,{parser:Mt,baseStep:.1,props:k.fromObject({draggingScale:.01,formatter:pt(2)}),value:T(0,{constraint:new ft({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Me({primary:this.value,secondary:this.alphaIcs_.text.value,forward:r=>r.rawValue.getComponents()[3],backward:(r,d)=>{const x=r.rawValue.getComponents();return x[3]=d.rawValue,new Z(x,r.rawValue.mode)}}),this.textC_=new Mr(t,{parser:Mt,value:this.value,viewProps:this.viewProps}),this.view=new fr(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Hn=_("colsw");class zr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Hn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(Hn("sw")),this.element.appendChild(r),this.swatchElem_=r;const d=t.createElement("button");d.classList.add(Hn("b")),e.viewProps.bindDisabled(d),this.element.appendChild(d),this.buttonElement=d,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=sn(t)}onValueChange_(){this.update_()}}class Rr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new zr(t,{value:this.value,viewProps:this.viewProps})}}class Gn{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ye.create(e.expanded),this.swatchC_=new Rr(t,{value:this.value,viewProps:this.viewProps});const r=this.swatchC_.view.buttonElement;r.addEventListener("blur",this.onButtonBlur_),r.addEventListener("click",this.onButtonClick_),this.textC_=new Ye(t,{parser:e.parser,props:k.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ar(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Ai(t,{viewProps:this.viewProps}):null;const d=new Tr(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});d.view.allFocusableElements.forEach(x=>{x.addEventListener("blur",this.onPopupChildBlur_),x.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=d,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(d.view.element),Me({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:x=>x.rawValue,backward:(x,P)=>P.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),wn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,r=t.relatedTarget;(!r||!e.contains(r))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,r=ui(t);r&&e.contains(r)||r&&r===this.swatchC_.view.buttonElement&&!mt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ir(n){return Z.isColorObject(n)?Z.fromObject(n):Z.black()}function Fr(n){return ce(n.getComponents("rgb")).reduce((t,e)=>t<<8|Math.floor(e)&255,0)}function Dr(n){return n.getComponents("rgb").reduce((t,e,r)=>{const d=Math.floor(r===3?e*255:e)&255;return t<<8|d},0)>>>0}function Or(n){return new Z([n>>16&255,n>>8&255,n&255],"rgb")}function qr(n){return new Z([n>>24&255,n>>16&255,n>>8&255,ot(n&255,0,255,0,1)],"rgb")}function jr(n){return typeof n!="number"?Z.black():Or(n)}function Ur(n){return typeof n!="number"?Z.black():qr(n)}function Hr(n){const t=Wi(n);return(e,r)=>{Le(e,t(r))}}function Gr(n){const t=n?Dr:Fr;return(e,r)=>{Le(e,t(r))}}function Kr(n,t){const e=t.toRgbaObject();n.writeProperty("r",e.r),n.writeProperty("g",e.g),n.writeProperty("b",e.b),n.writeProperty("a",e.a)}function Wr(n,t){const e=t.toRgbaObject();n.writeProperty("r",e.r),n.writeProperty("g",e.g),n.writeProperty("b",e.b)}function $r(n){return n?Kr:Wr}function Kn(n){return"alpha"in n&&n.alpha===!0}function Yr(n){return n?t=>sn(t,"0x"):t=>On(t,"0x")}const Xr={id:"input-color-number",type:"input",accept:(n,t)=>{if(typeof n!="number"||!("view"in t)||t.view!=="color")return null;const e=Fn(t);return e?{initialValue:n,params:e}:null},binding:{reader:n=>Kn(n.params)?Ur:jr,equals:Z.equals,writer:n=>Gr(Kn(n.params))},controller:n=>{const t=Kn(n.params),e="expanded"in n.params?n.params.expanded:void 0,r="picker"in n.params?n.params.picker:void 0;return new Gn(n.document,{expanded:e!=null?e:!1,formatter:Yr(t),parser:nn,pickerLayout:r!=null?r:"popup",supportsAlpha:t,value:n.value,viewProps:n.viewProps})}};function Zr(n){return Z.isRgbaColorObject(n)}const Jr={id:"input-color-object",type:"input",accept:(n,t)=>{if(!Z.isColorObject(n))return null;const e=Fn(t);return e?{initialValue:n,params:e}:null},binding:{reader:n=>Ir,equals:Z.equals,writer:n=>$r(Zr(n.initialValue))},controller:n=>{const t=Z.isRgbaColorObject(n.initialValue),e="expanded"in n.params?n.params.expanded:void 0,r="picker"in n.params?n.params.picker:void 0,d=t?sn:On;return new Gn(n.document,{expanded:e!=null?e:!1,formatter:d,parser:nn,pickerLayout:r!=null?r:"popup",supportsAlpha:t,value:n.value,viewProps:n.viewProps})}},Qr={id:"input-color-string",type:"input",accept:(n,t)=>{if(typeof n!="string"||"view"in t&&t.view==="text"||!en(n))return null;const r=Fn(t);return r?{initialValue:n,params:r}:null},binding:{reader:n=>gr,equals:Z.equals,writer:n=>{const t=en(n.initialValue);if(!t)throw b.shouldNeverHappen();return Hr(t)}},controller:n=>{const t=en(n.initialValue);if(!t)throw b.shouldNeverHappen();const e=Wi(t),r="expanded"in n.params?n.params.expanded:void 0,d="picker"in n.params?n.params.picker:void 0;return new Gn(n.document,{expanded:r!=null?r:!1,formatter:e,parser:nn,pickerLayout:d!=null?d:"popup",supportsAlpha:wr(t),value:n.value,viewProps:n.viewProps})}};class jt{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((r,d)=>{var x,P;return(P=(x=this.components[d])===null||x===void 0?void 0:x.constrain(r))!==null&&P!==void 0?P:r});return this.asm_.fromComponents(e)}}const Yi=_("pndtxt");class ta{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Yi()),this.textViews.forEach(r=>{const d=t.createElement("div");d.classList.add(Yi("a")),d.appendChild(r.element),this.element.appendChild(d)})}}function ea(n,t,e){return new Be(n,{arrayPosition:e===0?"fst":e===t.axes.length-1?"lst":"mid",baseStep:t.axes[e].baseStep,parser:t.parser,props:t.axes[e].textProps,value:T(0,{constraint:t.axes[e].constraint}),viewProps:t.viewProps})}class Wn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((r,d)=>ea(t,e,d)),this.acs_.forEach((r,d)=>{Me({primary:this.value,secondary:r.value,forward:x=>e.assembly.toComponents(x.rawValue)[d],backward:(x,P)=>{const F=e.assembly.toComponents(x.rawValue);return F[d]=P.rawValue,e.assembly.fromComponents(F)}})}),this.view=new ta(t,{textViews:this.acs_.map(r=>r.view)})}}function na(n){return"step"in n&&!m(n.step)?new Xt(n.step):null}function ia(n){return"max"in n&&!m(n.max)||"min"in n&&!m(n.min)?new ft({max:n.max,min:n.min}):null}function sa(n){const t=[],e=na(n);e&&t.push(e);const r=ia(n);r&&t.push(r);const d=Rn(n.options);return d&&t.push(d),new Yt(t)}function oa(n){const t=n?Pt(n,ft):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function ra(n){const[t,e]=oa(n);return[t!=null?t:0,e!=null?e:100]}const aa={id:"input-number",type:"input",accept:(n,t)=>{if(typeof n!="number")return null;const e=D,r=J(t,{format:e.optional.function,max:e.optional.number,min:e.optional.number,options:e.optional.custom(Ze),step:e.optional.number});return r?{initialValue:n,params:r}:null},binding:{reader:n=>zi,constraint:n=>sa(n.params),writer:n=>Le},controller:n=>{var t,e;const r=n.value,d=n.constraint;if(d&&Pt(d,Pe))return new ke(n.document,{props:k.fromObject({options:(t=In(d))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps});const x=(e="format"in n.params?n.params.format:void 0)!==null&&e!==void 0?e:pt(Je(d,r.rawValue));if(d&&Pt(d,ft)){const[P,F]=ra(d);return new zn(n.document,{baseStep:ae(d),parser:Mt,sliderProps:k.fromObject({maxValue:F,minValue:P}),textProps:k.fromObject({draggingScale:le(d,r.rawValue),formatter:x}),value:r,viewProps:n.viewProps})}return new Be(n.document,{baseStep:ae(d),parser:Mt,props:k.fromObject({draggingScale:le(d,r.rawValue),formatter:x}),value:r,viewProps:n.viewProps})}};class Ut{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y;return!(typeof e!="number"||typeof r!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Xi={toComponents:n=>n.getComponents(),fromComponents:n=>new Ut(...n)},de=_("p2d");class la{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(de()),e.viewProps.bindClassModifiers(this.element),A(e.expanded,O(this.element,de(void 0,"expanded")));const r=t.createElement("div");r.classList.add(de("h")),this.element.appendChild(r);const d=t.createElement("button");d.classList.add(de("b")),d.appendChild(Ge(t,"p2dpad")),e.viewProps.bindDisabled(d),r.appendChild(d),this.buttonElement=d;const x=t.createElement("div");if(x.classList.add(de("t")),r.appendChild(x),this.textElement=x,e.pickerLayout==="inline"){const P=t.createElement("div");P.classList.add(de("p")),this.element.appendChild(P),this.pickerElement=P}else this.pickerElement=null}}const Ht=_("p2dp");class ca{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Ht()),e.layout==="popup"&&this.element.classList.add(Ht(void 0,"p"));const r=t.createElement("div");r.classList.add(Ht("p")),e.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;const d=t.createElementNS(rt,"svg");d.classList.add(Ht("g")),this.padElement.appendChild(d),this.svgElem_=d;const x=t.createElementNS(rt,"line");x.classList.add(Ht("ax")),x.setAttributeNS(null,"x1","0"),x.setAttributeNS(null,"y1","50%"),x.setAttributeNS(null,"x2","100%"),x.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(x);const P=t.createElementNS(rt,"line");P.classList.add(Ht("ax")),P.setAttributeNS(null,"x1","50%"),P.setAttributeNS(null,"y1","0"),P.setAttributeNS(null,"x2","50%"),P.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(P);const F=t.createElementNS(rt,"line");F.classList.add(Ht("l")),F.setAttributeNS(null,"x1","50%"),F.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(F),this.lineElem_=F;const G=t.createElement("div");G.classList.add(Ht("m")),this.padElement.appendChild(G),this.markerElem_=G,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),r=this.maxValue_,d=ot(t,-r,+r,0,100),x=ot(e,-r,+r,0,100),P=this.invertsY_?100-x:x;this.lineElem_.setAttributeNS(null,"x2",`${d}%`),this.lineElem_.setAttributeNS(null,"y2",`${P}%`),this.markerElem_.style.left=`${d}%`,this.markerElem_.style.top=`${P}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Zi(n,t,e){return[ut(t[0],Vt(n)),ut(t[1],Ve(n))*(e?1:-1)]}class ha{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new ca(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Zt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=this.maxValue_,d=ot(t.point.x,0,t.bounds.width,-r,+r),x=ot(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-r,+r);this.value.setRawValue(new Ut(d,x),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Fi(t.key)&&t.preventDefault();const[e,r]=Zi(t,this.baseSteps_,this.invertsY_);e===0&&r===0||this.value.setRawValue(new Ut(this.value.rawValue.x+e,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,r]=Zi(t,this.baseSteps_,this.invertsY_);e===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class da{constructor(t,e){var r,d;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ye.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Ai(t,{viewProps:this.viewProps}):null;const x=new ha(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});x.view.allFocusableElements.forEach(P=>{P.addEventListener("blur",this.onPopupChildBlur_),P.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.textC_=new Wn(t,{assembly:Xi,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new la(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("blur",this.onPadButtonBlur_),(d=this.view.buttonElement)===null||d===void 0||d.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Me({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:P=>P.rawValue,backward:(P,F)=>F.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),wn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,r=t.relatedTarget;(!r||!e.contains(r))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,r=ui(t);r&&e.contains(r)||r&&r===this.view.buttonElement&&!mt(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function pa(n){return Ut.isObject(n)?new Ut(n.x,n.y):new Ut}function ua(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y)}function Ji(n){if(!n)return;const t=[];return m(n.step)||t.push(new Xt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new ft({max:n.max,min:n.min})),new Yt(t)}function va(n){return new jt({assembly:Xi,components:[Ji("x"in n?n.x:void 0),Ji("y"in n?n.y:void 0)]})}function Qi(n,t){const e=n&&Pt(n,ft);if(e)return Math.max(Math.abs(e.minValue||0),Math.abs(e.maxValue||0));const r=ae(n);return Math.max(Math.abs(r)*10,Math.abs(t)*10)}function ma(n,t){const e=t instanceof jt?t.components[0]:void 0,r=t instanceof jt?t.components[1]:void 0,d=Qi(e,n.x),x=Qi(r,n.y);return Math.max(d,x)}function ts(n,t){return{baseStep:ae(t),constraint:t,textProps:k.fromObject({draggingScale:le(t,n),formatter:pt(Je(t,n))})}}function fa(n){if(!("y"in n))return!1;const t=n.y;return t&&"inverted"in t?!!t.inverted:!1}const ba={id:"input-point2d",type:"input",accept:(n,t)=>{if(!Ut.isObject(n))return null;const e=D,r=J(t,{expanded:e.optional.boolean,picker:e.optional.custom(Oi),x:e.optional.custom(Ot),y:e.optional.object({inverted:e.optional.boolean,max:e.optional.number,min:e.optional.number,step:e.optional.number})});return r?{initialValue:n,params:r}:null},binding:{reader:n=>pa,constraint:n=>va(n.params),equals:Ut.equals,writer:n=>ua},controller:n=>{const t=n.document,e=n.value,r=n.constraint;if(!(r instanceof jt))throw b.shouldNeverHappen();const d="expanded"in n.params?n.params.expanded:void 0,x="picker"in n.params?n.params.picker:void 0;return new da(t,{axes:[ts(e.rawValue.x,r.components[0]),ts(e.rawValue.y,r.components[1])],expanded:d!=null?d:!1,invertsY:fa(n.params),maxValue:ma(e.rawValue,r),parser:Mt,pickerLayout:x!=null?x:"popup",value:e,viewProps:n.viewProps})}};class pe{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y,d=t.z;return!(typeof e!="number"||typeof r!="number"||typeof d!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const es={toComponents:n=>n.getComponents(),fromComponents:n=>new pe(...n)};function wa(n){return pe.isObject(n)?new pe(n.x,n.y,n.z):new pe}function ga(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z)}function $n(n){if(!n)return;const t=[];return m(n.step)||t.push(new Xt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new ft({max:n.max,min:n.min})),new Yt(t)}function _a(n){return new jt({assembly:es,components:[$n("x"in n?n.x:void 0),$n("y"in n?n.y:void 0),$n("z"in n?n.z:void 0)]})}function Yn(n,t){return{baseStep:ae(t),constraint:t,textProps:k.fromObject({draggingScale:le(t,n),formatter:pt(Je(t,n))})}}const ya={id:"input-point3d",type:"input",accept:(n,t)=>{if(!pe.isObject(n))return null;const e=D,r=J(t,{x:e.optional.custom(Ot),y:e.optional.custom(Ot),z:e.optional.custom(Ot)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>wa,constraint:n=>_a(n.params),equals:pe.equals,writer:n=>ga},controller:n=>{const t=n.value,e=n.constraint;if(!(e instanceof jt))throw b.shouldNeverHappen();return new Wn(n.document,{assembly:es,axes:[Yn(t.rawValue.x,e.components[0]),Yn(t.rawValue.y,e.components[1]),Yn(t.rawValue.z,e.components[2])],parser:Mt,value:t,viewProps:n.viewProps})}};class ue{constructor(t=0,e=0,r=0,d=0){this.x=t,this.y=e,this.z=r,this.w=d}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y,d=t.z,x=t.w;return!(typeof e!="number"||typeof r!="number"||typeof d!="number"||typeof x!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const ns={toComponents:n=>n.getComponents(),fromComponents:n=>new ue(...n)};function xa(n){return ue.isObject(n)?new ue(n.x,n.y,n.z,n.w):new ue}function Ca(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z),n.writeProperty("w",t.w)}function rn(n){if(!n)return;const t=[];return m(n.step)||t.push(new Xt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new ft({max:n.max,min:n.min})),new Yt(t)}function Ea(n){return new jt({assembly:ns,components:[rn("x"in n?n.x:void 0),rn("y"in n?n.y:void 0),rn("z"in n?n.z:void 0),rn("w"in n?n.w:void 0)]})}function Pa(n,t){return{baseStep:ae(t),constraint:t,textProps:k.fromObject({draggingScale:le(t,n),formatter:pt(Je(t,n))})}}const ka={id:"input-point4d",type:"input",accept:(n,t)=>{if(!ue.isObject(n))return null;const e=D,r=J(t,{x:e.optional.custom(Ot),y:e.optional.custom(Ot),z:e.optional.custom(Ot),w:e.optional.custom(Ot)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>xa,constraint:n=>Ea(n.params),equals:ue.equals,writer:n=>Ca},controller:n=>{const t=n.value,e=n.constraint;if(!(e instanceof jt))throw b.shouldNeverHappen();return new Wn(n.document,{assembly:ns,axes:t.rawValue.getComponents().map((r,d)=>Pa(r,e.components[d])),parser:Mt,value:t,viewProps:n.viewProps})}};function Sa(n){const t=[],e=Rn(n.options);return e&&t.push(e),new Yt(t)}const Aa={id:"input-string",type:"input",accept:(n,t)=>{if(typeof n!="string")return null;const r=J(t,{options:D.optional.custom(Ze)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Ri,constraint:n=>Sa(n.params),writer:n=>Le},controller:n=>{var t;const e=n.document,r=n.value,d=n.constraint;return d&&Pt(d,Pe)?new ke(e,{props:k.fromObject({options:(t=In(d))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps}):new Ye(e,{parser:x=>x,props:k.fromObject({formatter:Vn}),value:r,viewProps:n.viewProps})}},Te={monitor:{defaultInterval:200,defaultLineCount:3}},is=_("mll");class Ma{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(is()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("textarea");r.classList.add(is("i")),r.style.height=`calc(var(--bld-us) * ${e.lineCount})`,r.readOnly=!0,e.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,r=[];this.value.rawValue.forEach(d=>{d!==void 0&&r.push(this.formatter_(d))}),t.textContent=r.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Xn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Ma(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const ss=_("sgl");class Va{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(ss()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("input");r.classList.add(ss("i")),r.readOnly=!0,r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class Zn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Va(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Ba={id:"monitor-bool",type:"monitor",accept:(n,t)=>{if(typeof n!="boolean")return null;const r=J(t,{lineCount:D.optional.number});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Vi},controller:n=>{var t;return n.value.rawValue.length===1?new Zn(n.document,{formatter:Bi,value:n.value,viewProps:n.viewProps}):new Xn(n.document,{formatter:Bi,lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Te.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}};class La{constructor(){this.emitter=new y,this.index_=-1}get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}const Gt=_("grl");class Na{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Gt()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const r=t.createElementNS(rt,"svg");r.classList.add(Gt("g")),r.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(r),this.svgElem_=r;const d=t.createElementNS(rt,"polyline");this.svgElem_.appendChild(d),this.lineElem_=d;const x=t.createElement("div");x.classList.add(Gt("t"),_("tt")()),this.element.appendChild(x),this.tooltipElem_=x,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,r=this.minValue_,d=this.maxValue_,x=[];this.value.rawValue.forEach((Q,et)=>{if(Q===void 0)return;const te=ot(et,0,e,0,t.width),ze=ot(Q,r,d,t.height,0);x.push([te,ze].join(","))}),this.lineElem_.setAttributeNS(null,"points",x.join(" "));const P=this.tooltipElem_,F=this.value.rawValue[this.cursor_.index];if(F===void 0){P.classList.remove(Gt("t","a"));return}const G=ot(this.cursor_.index,0,e,0,t.width),W=ot(F,r,d,t.height,0);P.style.left=`${G}px`,P.style.top=`${W}px`,P.textContent=`${this.formatter_(F)}`,P.classList.contains(Gt("t","a"))||(P.classList.add(Gt("t","a"),Gt("t","in")),ie(P),P.classList.remove(Gt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ta{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new La,this.view=new Na(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),!mt(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const r=new Zt(this.view.element);r.emitter.on("down",this.onGraphPointerDown_),r.emitter.on("move",this.onGraphPointerMove_),r.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(ot(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(ot(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function Jn(n){return"format"in n&&!m(n.format)?n.format:pt(2)}function za(n){var t;return n.value.rawValue.length===1?new Zn(n.document,{formatter:Jn(n.params),value:n.value,viewProps:n.viewProps}):new Xn(n.document,{formatter:Jn(n.params),lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Te.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}function Ra(n){var t,e,r;return new Ta(n.document,{formatter:Jn(n.params),lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Te.monitor.defaultLineCount,maxValue:(e="max"in n.params?n.params.max:null)!==null&&e!==void 0?e:100,minValue:(r="min"in n.params?n.params.min:null)!==null&&r!==void 0?r:0,value:n.value,viewProps:n.viewProps})}function os(n){return"view"in n&&n.view==="graph"}const Ia={id:"monitor-number",type:"monitor",accept:(n,t)=>{if(typeof n!="number")return null;const e=D,r=J(t,{format:e.optional.function,lineCount:e.optional.number,max:e.optional.number,min:e.optional.number,view:e.optional.string});return r?{initialValue:n,params:r}:null},binding:{defaultBufferSize:n=>os(n)?64:1,reader:n=>zi},controller:n=>os(n.params)?Ra(n):za(n)},Fa={id:"monitor-string",type:"monitor",accept:(n,t)=>{if(typeof n!="string")return null;const e=D,r=J(t,{lineCount:e.optional.number,multiline:e.optional.boolean});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Ri},controller:n=>{var t;const e=n.value;return e.rawValue.length>1||"multiline"in n.params&&n.params.multiline?new Xn(n.document,{formatter:Vn,lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Te.monitor.defaultLineCount,value:e,viewProps:n.viewProps}):new Zn(n.document,{formatter:Vn,value:e,viewProps:n.viewProps})}};class Da{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new y,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function Oa(n,t){const e=n.accept(t.target.read(),t.params);if(m(e))return null;const r=D,d={target:t.target,initialValue:e.initialValue,params:e.params},x=n.binding.reader(d),P=n.binding.constraint?n.binding.constraint(d):void 0,F=T(x(e.initialValue),{constraint:P,equals:n.binding.equals}),G=new Da({reader:x,target:t.target,value:F,writer:n.binding.writer(d)}),W=r.optional.boolean(t.params.disabled).value,Q=r.optional.boolean(t.params.hidden).value,et=n.controller({constraint:P,document:t.document,initialValue:e.initialValue,params:e.params,value:G.value,viewProps:Dt.create({disabled:W,hidden:Q})}),te=r.optional.string(t.params.label).value;return new Et(t.document,{binding:G,blade:_e(),props:k.fromObject({label:te||t.target.key}),valueController:et})}class qa{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new y,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const e=this.value.rawValue,r=this.reader_(t);this.value.rawValue=Xo(e,r),this.emitter.emit("update",{rawValue:r,sender:this})}onTick_(t){this.read()}}function ja(n,t){return t===0?new vo:new mo(n,t!=null?t:Te.monitor.defaultInterval)}function Ua(n,t){var e,r,d;const x=D,P=n.accept(t.target.read(),t.params);if(m(P))return null;const F={target:t.target,initialValue:P.initialValue,params:P.params},G=n.binding.reader(F),W=(r=(e=x.optional.number(t.params.bufferSize).value)!==null&&e!==void 0?e:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(P.params))!==null&&r!==void 0?r:1,Q=x.optional.number(t.params.interval).value,et=new qa({reader:G,target:t.target,ticker:ja(t.document,Q),value:$o(W)}),te=x.optional.boolean(t.params.disabled).value,ze=x.optional.boolean(t.params.hidden).value,Re=n.controller({document:t.document,params:P.params,value:et.value,viewProps:Dt.create({disabled:te,hidden:ze})}),ve=(d=x.optional.string(t.params.label).value)!==null&&d!==void 0?d:t.target.key;return new Ft(t.document,{binding:et,blade:_e(),props:k.fromObject({label:ve}),valueController:Re})}class Ha{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,r){const d=e.read();if(m(d))throw new b({context:{key:e.key},type:"nomatchingcontroller"});const x=this.pluginsMap_.inputs.reduce((P,F)=>P||Oa(F,{document:t,target:e,params:r}),null);if(x)return x;throw new b({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,r){const d=this.pluginsMap_.monitors.reduce((x,P)=>x||Ua(P,{document:t,params:r,target:e}),null);if(d)return d;throw new b({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const r=this.pluginsMap_.blades.reduce((d,x)=>d||uo(x,{document:t,params:e}),null);if(!r)throw new b({type:"nomatchingview",context:{params:e}});return r}createBladeApi(t){if(t instanceof Et)return new yn(t);if(t instanceof Ft)return new xn(t);if(t instanceof Ce)return new We(t,this);const e=this.pluginsMap_.blades.reduce((r,d)=>r||d.api({controller:t,pool:this}),null);if(!e)throw b.shouldNeverHappen();return e}}function Ga(){const n=new Ha;return[ba,ya,ka,Aa,aa,Qr,Jr,Xr,rr,Ba,Fa,Ia,Gs,oo,ao,ki].forEach(t=>{n.register(t)}),n}class rs extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}}class as extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}}class ls extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,d=>{r(d.event)}),this}}const Ka=function(){return{id:"list",type:"blade",accept(n){const t=D,e=J(n,{options:t.required.custom(Ze),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return e?{params:e}:null},controller(n){const t=new ke(n.document,{props:k.fromObject({options:qi(n.params.options)}),value:T(n.params.value),viewProps:n.viewProps});return new re(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:t})},api(n){return!(n.controller instanceof re)||!(n.controller.valueController instanceof ke)?null:new rs(n.controller)}}}();function Wa(n){return n.reduce((t,e)=>Object.assign(t,{[e.presetKey]:e.read()}),{})}function $a(n,t){n.forEach(e=>{const r=t[e.presetKey];r!==void 0&&e.write(r)})}class Ya extends Cn{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){const e=this.controller_.rackController.rack.find(Et).map(r=>r.binding.target);$a(e,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(Et).map(e=>e.binding.target);return Wa(t)}refresh(){this.controller_.rackController.rack.find(Et).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(Ft).forEach(t=>{t.binding.read()})}}class Xa extends kn{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Za={id:"slider",type:"blade",accept(n){const t=D,e=J(n,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return e?{params:e}:null},controller(n){var t,e;const r=(t=n.params.value)!==null&&t!==void 0?t:0,d=new zn(n.document,{baseStep:1,parser:Mt,sliderProps:k.fromObject({maxValue:n.params.max,minValue:n.params.min}),textProps:k.fromObject({draggingScale:le(void 0,r),formatter:(e=n.params.format)!==null&&e!==void 0?e:Ko}),value:T(r),viewProps:n.viewProps});return new re(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:d})},api(n){return!(n.controller instanceof re)||!(n.controller.valueController instanceof zn)?null:new as(n.controller)}},Ja=function(){return{id:"text",type:"blade",accept(n){const t=D,e=J(n,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return e?{params:e}:null},controller(n){var t;const e=new Ye(n.document,{parser:n.params.parse,props:k.fromObject({formatter:(t=n.params.format)!==null&&t!==void 0?t:r=>String(r)}),value:T(n.params.value),viewProps:n.viewProps});return new re(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:e})},api(n){return!(n.controller instanceof re)||!(n.controller.valueController instanceof Ye)?null:new ls(n.controller)}}}();function Qa(n){const t=n.createElement("div");return t.classList.add(_("dfw")()),n.body&&n.body.appendChild(t),t}function cs(n,t,e){if(n.querySelector(`style[data-tp-style=${t}]`))return;const r=n.createElement("style");r.dataset.tpStyle=t,r.textContent=e,n.head.appendChild(r)}class tl extends Ya{constructor(t){var e;const r=t||{},d=(e=r.document)!==null&&e!==void 0?e:bn(),x=Ga(),P=new Xa(d,{expanded:r.expanded,blade:_e(),props:k.fromObject({title:r.title}),viewProps:Dt.create()});super(P,x);this.pool_=x,this.containerElem_=r.container||Qa(d),this.containerElem_.appendChild(this.element),this.doc_=d,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw b.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw b.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(r=>{this.pool_.register(r),this.embedPluginStyle_(r)})}embedPluginStyle_(t){t.css&&cs(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){cs(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[Za,Ka,ki,Ja]})}}const el=new o("3.0.8");s.BladeApi=a,s.ButtonApi=C,s.FolderApi=Cn,s.InputBindingApi=yn,s.ListApi=rs,s.MonitorBindingApi=xn,s.Pane=tl,s.SeparatorApi=wi,s.SliderApi=as,s.TabApi=Ei,s.TabPageApi=Ci,s.TextApi=ls,s.TpChangeEvent=c,s.VERSION=el,Object.defineProperty(s,"__esModule",{value:!0})})})(ri,ri.exports);var mn=function(z,i,s){var o=new nl,a=new Ns,l=new be,c=new ht,h=new ht,p=new ht,v=new il,m=[],w=null,f=null,b=this;function g(){s.addEventListener("pointermove",_,!1),s.addEventListener("pointerdown",S,!1),s.addEventListener("pointerup",V,!1),s.addEventListener("pointerleave",V,!1),s.addEventListener("touchmove",O,!1),s.addEventListener("touchstart",q,!1),s.addEventListener("touchend",R,!1)}function C(){s.removeEventListener("pointermove",_,!1),s.removeEventListener("pointerdown",S,!1),s.removeEventListener("pointerup",V,!1),s.removeEventListener("pointerleave",V,!1),s.removeEventListener("touchmove",O,!1),s.removeEventListener("touchstart",q,!1),s.removeEventListener("touchend",R,!1),s.style.cursor=""}function y(){C()}function E(){return z}function _(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":M(L);break}}function M(L){var j=s.getBoundingClientRect();if(l.x=(L.clientX-j.left)/j.width*2-1,l.y=-((L.clientY-j.top)/j.height)*2+1,a.setFromCamera(l,i),w&&b.enabled){a.ray.intersectPlane(o,h)&&w.position.copy(h.sub(c).applyMatrix4(v)),b.dispatchEvent({type:"drag",object:w});return}if(m.length=0,a.setFromCamera(l,i),a.intersectObjects(z,!0,m),m.length>0){var B=m[0].object;o.setFromNormalAndCoplanarPoint(i.getWorldDirection(o.normal),p.setFromMatrixPosition(B.matrixWorld)),f!==B&&(b.dispatchEvent({type:"hoveron",object:B}),s.style.cursor="pointer",f=B)}else f!==null&&(b.dispatchEvent({type:"hoveroff",object:f}),s.style.cursor="auto",f=null)}function S(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":A(L);break}}function A(L){L.preventDefault(),m.length=0,a.setFromCamera(l,i),a.intersectObjects(z,!0,m),m.length>0&&(w=b.transformGroup===!0?z[0]:m[0].object,a.ray.intersectPlane(o,h)&&(v.copy(w.parent.matrixWorld).invert(),c.copy(h).sub(p.setFromMatrixPosition(w.matrixWorld))),s.style.cursor="move",b.dispatchEvent({type:"dragstart",object:w}))}function V(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":N(L);break}}function N(L){L.preventDefault(),w&&(b.dispatchEvent({type:"dragend",object:w}),w=null),s.style.cursor=f?"pointer":"auto"}function O(L){L.preventDefault(),L=L.changedTouches[0];var j=s.getBoundingClientRect();if(l.x=(L.clientX-j.left)/j.width*2-1,l.y=-((L.clientY-j.top)/j.height)*2+1,a.setFromCamera(l,i),w&&b.enabled){a.ray.intersectPlane(o,h)&&w.position.copy(h.sub(c).applyMatrix4(v)),b.dispatchEvent({type:"drag",object:w});return}}function q(L){L.preventDefault(),L=L.changedTouches[0];var j=s.getBoundingClientRect();l.x=(L.clientX-j.left)/j.width*2-1,l.y=-((L.clientY-j.top)/j.height)*2+1,m.length=0,a.setFromCamera(l,i),a.intersectObjects(z,!0,m),m.length>0&&(w=b.transformGroup===!0?z[0]:m[0].object,o.setFromNormalAndCoplanarPoint(i.getWorldDirection(o.normal),p.setFromMatrixPosition(w.matrixWorld)),a.ray.intersectPlane(o,h)&&(v.copy(w.parent.matrixWorld).invert(),c.copy(h).sub(p.setFromMatrixPosition(w.matrixWorld))),s.style.cursor="move",b.dispatchEvent({type:"dragstart",object:w}))}function R(L){L.preventDefault(),w&&(b.dispatchEvent({type:"dragend",object:w}),w=null),s.style.cursor="auto"}g(),this.enabled=!0,this.transformGroup=!1,this.activate=g,this.deactivate=C,this.dispose=y,this.getObjects=E};mn.prototype=Object.create(sl.prototype);mn.prototype.constructor=mn;var od={computeTangents:function(z){var i=z.index,s=z.attributes;if(i===null||s.position===void 0||s.normal===void 0||s.uv===void 0){console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var o=i.array,a=s.position.array,l=s.normal.array,c=s.uv.array,h=a.length/3;s.tangent===void 0&&z.setAttribute("tangent",new an(new Float32Array(4*h),4));for(var p=s.tangent.array,v=[],m=[],w=0;w<h;w++)v[w]=new ht,m[w]=new ht;var f=new ht,b=new ht,g=new ht,C=new be,y=new be,E=new be,_=new ht,M=new ht;function S(Y,tt,D){f.fromArray(a,Y*3),b.fromArray(a,tt*3),g.fromArray(a,D*3),C.fromArray(c,Y*2),y.fromArray(c,tt*2),E.fromArray(c,D*2),b.sub(f),g.sub(f),y.sub(C),E.sub(C);var J=1/(y.x*E.y-E.x*y.y);!isFinite(J)||(_.copy(b).multiplyScalar(E.y).addScaledVector(g,-y.y).multiplyScalar(J),M.copy(g).multiplyScalar(y.x).addScaledVector(b,-E.x).multiplyScalar(J),v[Y].add(_),v[tt].add(_),v[D].add(_),m[Y].add(M),m[tt].add(M),m[D].add(M))}var A=z.groups;A.length===0&&(A=[{start:0,count:o.length}]);for(var w=0,V=A.length;w<V;++w)for(var N=A[w],O=N.start,q=N.count,R=O,L=O+q;R<L;R+=3)S(o[R+0],o[R+1],o[R+2]);var j=new ht,B=new ht,I=new ht,T=new ht,k,X,K;function $(Y){I.fromArray(l,Y*3),T.copy(I),X=v[Y],j.copy(X),j.sub(I.multiplyScalar(I.dot(X))).normalize(),B.crossVectors(T,X),K=B.dot(m[Y]),k=K<0?-1:1,p[Y*4]=j.x,p[Y*4+1]=j.y,p[Y*4+2]=j.z,p[Y*4+3]=k}for(var w=0,V=A.length;w<V;++w)for(var N=A[w],O=N.start,q=N.count,R=O,L=O+q;R<L;R+=3)$(o[R+0]),$(o[R+1]),$(o[R+2])},mergeBufferGeometries:function(z,i){for(var s=z[0].index!==null,o=new Set(Object.keys(z[0].attributes)),a=new Set(Object.keys(z[0].morphAttributes)),l={},c={},h=z[0].morphTargetsRelative,p=new Ts,v=0,m=0;m<z.length;++m){var w=z[m],f=0;if(s!==(w.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var b in w.attributes){if(!o.has(b))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+'. All geometries must have compatible attributes; make sure "'+b+'" attribute exists among all geometries, or in none of them.'),null;l[b]===void 0&&(l[b]=[]),l[b].push(w.attributes[b]),f++}if(f!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". Make sure all geometries have the same number of attributes."),null;if(h!==w.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var b in w.morphAttributes){if(!a.has(b))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+".  .morphAttributes must be consistent throughout all geometries."),null;c[b]===void 0&&(c[b]=[]),c[b].push(w.morphAttributes[b])}if(p.userData.mergedUserData=p.userData.mergedUserData||[],p.userData.mergedUserData.push(w.userData),i){var g;if(s)g=w.index.count;else if(w.attributes.position!==void 0)g=w.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". The geometry must have either an index or a position attribute"),null;p.addGroup(v,g,m),v+=g}}if(s){for(var C=0,y=[],m=0;m<z.length;++m){for(var E=z[m].index,_=0;_<E.count;++_)y.push(E.getX(_)+C);C+=z[m].attributes.position.count}p.setIndex(y)}for(var b in l){var M=this.mergeBufferAttributes(l[b]);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+b+" attribute."),null;p.setAttribute(b,M)}for(var b in c){var S=c[b][0].length;if(S===0)break;p.morphAttributes=p.morphAttributes||{},p.morphAttributes[b]=[];for(var m=0;m<S;++m){for(var A=[],_=0;_<c[b].length;++_)A.push(c[b][_][m]);var V=this.mergeBufferAttributes(A);if(!V)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+b+" morphAttribute."),null;p.morphAttributes[b].push(V)}}return p},mergeBufferAttributes:function(z){for(var i,s,o,a=0,l=0;l<z.length;++l){var c=z[l];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(i===void 0&&(i=c.array.constructor),i!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(s===void 0&&(s=c.itemSize),s!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(o===void 0&&(o=c.normalized),o!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=c.array.length}for(var h=new i(a),p=0,l=0;l<z.length;++l)h.set(z[l].array,p),p+=z[l].array.length;return new an(h,s,o)},interleaveAttributes:function(z){for(var i,s=0,o=0,a=0,l=z.length;a<l;++a){var c=z[a];if(i===void 0&&(i=c.array.constructor),i!==c.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;s+=c.array.length,o+=c.itemSize}for(var h=new ol(new i(s),o),p=0,v=[],m=["getX","getY","getZ","getW"],w=["setX","setY","setZ","setW"],f=0,l=z.length;f<l;f++){var c=z[f],b=c.itemSize,g=c.count,C=new rl(h,b,p,c.normalized);v.push(C),p+=b;for(var y=0;y<g;y++)for(var E=0;E<b;E++)C[w[E]](y,c[m[E]](y))}return v},estimateBytesUsed:function(z){var i=0;for(var s in z.attributes){var o=z.getAttribute(s);i+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}var a=z.getIndex();return i+=a?a.count*a.itemSize*a.array.BYTES_PER_ELEMENT:0,i},mergeVertices:function(z,i=1e-4){i=Math.max(i,Number.EPSILON);for(var s={},o=z.getIndex(),a=z.getAttribute("position"),l=o?o.count:a.count,c=0,h=Object.keys(z.attributes),p={},v={},m=[],w=["getX","getY","getZ","getW"],f=0,b=h.length;f<b;f++){var g=h[f];p[g]=[];var C=z.morphAttributes[g];C&&(v[g]=new Array(C.length).fill().map(()=>[]))}for(var y=Math.log10(1/i),E=Math.pow(10,y),f=0;f<l;f++){for(var _=o?o.getX(f):f,M="",S=0,b=h.length;S<b;S++)for(var g=h[S],A=z.getAttribute(g),V=A.itemSize,N=0;N<V;N++)M+=`${~~(A[w[N]](_)*E)},`;if(M in s)m.push(s[M]);else{for(var S=0,b=h.length;S<b;S++)for(var g=h[S],A=z.getAttribute(g),C=z.morphAttributes[g],V=A.itemSize,O=p[g],q=v[g],N=0;N<V;N++){var R=w[N];if(O.push(A[R](_)),C)for(var L=0,j=C.length;L<j;L++)q[L].push(C[L][R](_))}s[M]=c,m.push(c),c++}}const B=z.clone();for(var f=0,b=h.length;f<b;f++){var g=h[f],I=z.getAttribute(g),T=new I.array.constructor(p[g]),A=new an(T,I.itemSize,I.normalized);if(B.setAttribute(g,A),g in v)for(var S=0;S<v[g].length;S++){var k=z.morphAttributes[g][S],T=new k.array.constructor(v[g][S]),X=new an(T,k.itemSize,k.normalized);B.morphAttributes[g][S]=X}}return B.setIndex(m),B},toTrianglesDrawMode:function(z,i){if(i===al)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),z;if(i===hs||i===ll){var s=z.getIndex();if(s===null){var o=[],a=z.getAttribute("position");if(a!==void 0){for(var l=0;l<a.count;l++)o.push(l);z.setIndex(o),s=z.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),z}var c=s.count-2,h=[];if(i===hs)for(var l=1;l<=c;l++)h.push(s.getX(0)),h.push(s.getX(l)),h.push(s.getX(l+1));else for(var l=0;l<c;l++)l%2===0?(h.push(s.getX(l)),h.push(s.getX(l+1)),h.push(s.getX(l+2))):(h.push(s.getX(l+2)),h.push(s.getX(l+1)),h.push(s.getX(l)));h.length/3!==c&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var p=z.clone();return p.setIndex(h),p.clearGroups(),p}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),z}};const rd=Al('<div id="progressDiv" class="w-full bg-gray-200 h-2 mb-6 absolute top-1/2" data-v-ea880274><div id="progress" class="transition-all duration-200 ease-in-out bg-main-active h-2 w-{{progressRatio}}" data-v-ea880274></div></div><div class="point point-0" data-v-ea880274><div class="label select-none" data-v-ea880274>1</div><div class="text select-none" data-v-ea880274>This is creation of Roy</div></div><div class="point point-1" data-v-ea880274><div class="label select-none" data-v-ea880274>2</div><div class="text select-none" data-v-ea880274>Switch</div></div><div class="point point-2" data-v-ea880274><div class="label select-none" data-v-ea880274>3</div><div class="text select-none" data-v-ea880274>Light Switch</div></div><div class="point point-3" data-v-ea880274><div class="label select-none" data-v-ea880274>4</div><div class="text select-none" data-v-ea880274>Power</div></div><div class="point point-4" data-v-ea880274><div class="label select-none" data-v-ea880274>5</div><div class="text select-none" data-v-ea880274>Elden Ring</div></div><div class="point point-5" data-v-ea880274><div class="label select-none" data-v-ea880274>6</div><div class="text select-none" data-v-ea880274>USB</div></div><div class="point point-6" data-v-ea880274><div class="label select-none" data-v-ea880274>7</div><div class="text select-none" data-v-ea880274>This is creation of Roy</div></div><div class="point point-7" data-v-ea880274><div class="label select-none" data-v-ea880274>8</div><div class="text select-none" data-v-ea880274>This is creation of Roy</div></div><div class="point point-8" data-v-ea880274><div class="label select-none" data-v-ea880274>9</div><div class="text select-none" data-v-ea880274>This is creation of Roy</div></div>',10),ad={setup(z){let i,s,o,a,l,c,h=Pl(0),p,v,m=0,w=!1,f=-1;new Ns,new be,new be;const b=new gl,g=[],C=[],y=new ri.exports.Pane;i={},kl(()=>{M(),_(),window.addEventListener("resize",()=>{E.width=window.innerWidth,E.height=window.innerHeight,s.aspect=E.width/E.height,s.updateProjectionMatrix(),o.setSize(E.width,E.height),o.setPixelRatio(Math.min(window.devicePixelRatio,2))}),A()});const E={width:window.innerWidth,height:window.innerHeight};function _(){const N=document.querySelector("#progress"),O=document.querySelector("#progressDiv");c=new cl,s=new hl(75,E.width/E.height,.1,100),s.position.set(.7043043492115377,14.388569228135337,9.239105833036682),s.quaternion.set(-.27029782041898764,-.0006752835476387169,-.00018958467553528339,.9627765038296925),s.rotation.set(-.5474052811931926,-.0011978059034376911,-.0007301112729914485),c.add(s);const q=new dl(4210752);q.intensity=3,c.add(q);const R=20,L=new pl("#ffffff",3);L.position.set(0,34,-21),L.castShadow=!0,L.shadow.camera.far=50,L.shadow.mapSize.set(1024,1024),L.shadow.camera.top=R,L.shadow.camera.bottom=-R,L.shadow.camera.left=-R,L.shadow.camera.right=R,L.show=200,c.add(L),y.addInput(L,"intensity",{min:0,max:100,step:.001}),y.addInput(L.position,"x",{min:-100,max:100,step:.001}),y.addInput(L.position,"y",{min:-100,max:100,step:.001}),y.addInput(L.position,"z",{min:-100,max:100,step:.001});const j=new _l(()=>{window.setTimeout(()=>{Cl.to($.uniforms.uAlpha,{duration:1,value:0}),O.style.visibility="hidden"},500)},(tt,D,J)=>{h.value=D/J*100,N.style.width=`${h.value}%`}),B=new yl;B.setDecoderPath("/draco/");const I=new xl(j);I.setDRACOLoader(B);const k=new ul(j).load(["/textures/environmentMaps/0/px.jpg","/textures/environmentMaps/0/nx.jpg","/textures/environmentMaps/0/py.jpg","/textures/environmentMaps/0/ny.jpg","/textures/environmentMaps/0/pz.jpg","/textures/environmentMaps/0/nz.jpg"]);Promise.all([I.loadAsync("models/DSPEC_jr/DSPEC_jr.gltf"),I.loadAsync("models/Detector_model/Detector.gltf"),I.loadAsync("models/modern_coffee_table_01_2k_2.blend/modern_coffee_table_01_2k.gltf")]).then(tt=>{const[D,J,Rt]=tt;let dt;D.scene.traverse(function(Ct){Ct.name==="DSPEC_jr"&&(dt=V(Ct.children),dt.geometry.center())}),dt.scale.set(.7,.7,.7),dt.position.set(0,8.28,0),dt.userData.i=0;const It=new ds().setFromObject(dt),Wt=new qe(It.getSize().divide(new ht(2,2,2))),xt=new U({mass:1,material:v});xt.addShape(Wt),xt.position.copy(dt.position),p.addBody(xt),c.add(dt),g.push(xt),C.push(dt);let rt;J.scene.traverse(function(Ct){Ct.name==="Detector"&&(rt=V(Ct.children),rt.geometry.center())}),rt.userData.i=1,rt.position.set(5,8.28,0),rt.rotation.z=-Math.PI/2,rt.rotation.y=-Math.PI/2;const ie=new Nc(.57,.57,3.55,20),$t=new U({mass:20,material:v});$t.addShape(ie),$t.position.copy(rt.position),$t.quaternion.copy(rt.quaternion),p.addBody($t),c.add(rt),g.push($t),C.push(rt);let mt;Rt.scene.traverse(function(Ct){Ct.name==="modern_coffee_table_01"&&(mt=Ct,mt.geometry.center())}),mt.userData.i=-1,mt.scale.set(20,20,20),mt.position.set(0,3.9,0);let fn=new ds().setFromObject(mt);const bn=new qe(fn.getSize().divide(new ht(2,2,2))),se=new U({mass:20,material:v});se.addShape(bn),se.position.copy(mt.position),p.addBody(se),c.add(mt),g.push(se),C.push(mt),S(),w=!0});const X=new ln(new ps(50,50),new Qn({color:"#777777",metalness:.3,roughness:.4,envMap:k}));X.receiveShadow=!0,X.rotation.x=-Math.PI*.5,c.add(X);const K=new ps(2,2,1,1),$=new vl({wireframe:!0,transparent:!0,uniforms:{uAlpha:{value:1}},vertexShader:`

    void main(){
        gl_Position = vec4(position, 1.0);
        
    }`,fragmentShader:`
    uniform float uAlpha;

    void main(){
        gl_FragColor = vec4(0.0, 0.0, 0.0, uAlpha);
    }`}),Y=new ln(K,$);c.add(Y),k.encoding=us,c.background=k,c.environment=k,o=new ml({antialias:!0}),o.setSize(E.width,E.height),o.setPixelRatio(window.devicePixelRatio),o.physicallyCorrectLights=!0,o.outputEncoding=us,o.toneMapping=fl,o.toneMappingExposure=3,o.shadowMap.enabled=!0,o.shadowMap.type=bl,document.body.appendChild(o.domElement),a=new wl(s,o.domElement),a.enableDamping=!0,l=new mn(C,s,o.domElement),l.addEventListener("dragstart",function(tt){f=tt.object.userData.i,console.log(f),f!==-1&&(a.enabled=!1)}),l.addEventListener("dragend",function(tt){f=-1,a.enabled=!0}),l.addEventListener("drag",function(tt){})}function M(){p=new Jh,p.gravity.set(0,-9.8,0),p.allowSleep=!0,v=new He("physics");const N=new Ue(v,v,{friction:10,restitution:0});p.addContactMaterial(N);const O=new Tc,q=new U({mass:0,material:v});q.addShape(O),q.quaternion.setFromEuler(-Math.PI/2,0,0),p.addBody(q)}i.envMapIntensity=10,y.addInput(i,"envMapIntensity",{min:0,max:10,step:.01}).on("change",S);function S(){c.traverse(N=>{N instanceof ln&&N.material instanceof Qn&&(N.material.envMapIntensity=i.envMapIntensity,N.material.needsUpdate=!0,N.castShadow=!0,N.receiveShadow=!0)})}Sl(()=>{});const A=()=>{const N=b.getElapsedTime(),O=N-m;m=N,p.step(1/60,O,3),w&&C.forEach((q,R)=>{R===f?(g[R].position.copy(q.position),g[R].quaternion.copy(q.quaternion),g[R].velocity.set(0,0,0),g[R].angularVelocity.set(0,0,0)):(q.position.copy(g[R].position),q.quaternion.copy(g[R].quaternion))}),a.update(),o.render(c,s),window.requestAnimationFrame(A)};function V(N){var O=[],q=[],R=new Ts,L,j;return N.forEach(function(B,I){B.updateMatrix(),q.push(B.geometry),L=new Qn(B.material),O.push(L)}),R=od.mergeBufferGeometries(q,!0),R.groupsNeedUpdate=!0,j=new ln(R,O),j}return(N,O)=>rd}};var pd=Ml(ad,[["__scopeId","data-v-ea880274"]]);export{pd as default};
