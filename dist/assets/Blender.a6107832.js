import{e as nl,R as Ns,V as we,f as ct,M as il,E as sl,a as ln,B as Ts,I as ol,g as rl,T as al,h as ds,i as ll,S as cl,P as dl,j as hl,D as pl,k as ul,l as hs,m as cn,n as ps,o as ti,b as vl,s as us,W as ml,p as fl,q as bl,O as wl,d as gl,L as _l}from"./OrbitControls.3c74ff74.js";import{D as yl,G as xl,g as Cl}from"./index.62bb5d1d.js";import{D as El,l as Pl,C as kl,B as Sl,p as Al}from"./vendor.69ab715b.js";import{_ as Ml}from"./index.92b88ea0.js";class Ct{constructor(i){i===void 0&&(i=[0,0,0,0,0,0,0,0,0]),this.elements=i}identity(){const i=this.elements;i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1}setZero(){const i=this.elements;i[0]=0,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=0,i[6]=0,i[7]=0,i[8]=0}setTrace(i){const s=this.elements;s[0]=i.x,s[4]=i.y,s[8]=i.z}getTrace(i){i===void 0&&(i=new u);const s=this.elements;return i.x=s[0],i.y=s[4],i.z=s[8],i}vmult(i,s){s===void 0&&(s=new u);const o=this.elements,a=i.x,l=i.y,c=i.z;return s.x=o[0]*a+o[1]*l+o[2]*c,s.y=o[3]*a+o[4]*l+o[5]*c,s.z=o[6]*a+o[7]*l+o[8]*c,s}smult(i){for(let s=0;s<this.elements.length;s++)this.elements[s]*=i}mmult(i,s){s===void 0&&(s=new Ct);const o=this.elements,a=i.elements,l=s.elements,c=o[0],d=o[1],p=o[2],v=o[3],m=o[4],w=o[5],f=o[6],b=o[7],g=o[8],C=a[0],y=a[1],P=a[2],_=a[3],M=a[4],S=a[5],A=a[6],V=a[7],I=a[8];return l[0]=c*C+d*_+p*A,l[1]=c*y+d*M+p*V,l[2]=c*P+d*S+p*I,l[3]=v*C+m*_+w*A,l[4]=v*y+m*M+w*V,l[5]=v*P+m*S+w*I,l[6]=f*C+b*_+g*A,l[7]=f*y+b*M+g*V,l[8]=f*P+b*S+g*I,s}scale(i,s){s===void 0&&(s=new Ct);const o=this.elements,a=s.elements;for(let l=0;l!==3;l++)a[3*l+0]=i.x*o[3*l+0],a[3*l+1]=i.y*o[3*l+1],a[3*l+2]=i.z*o[3*l+2];return s}solve(i,s){s===void 0&&(s=new u);const o=3,a=4,l=[];let c,d;for(c=0;c<o*a;c++)l.push(0);for(c=0;c<3;c++)for(d=0;d<3;d++)l[c+a*d]=this.elements[c+3*d];l[3+4*0]=i.x,l[3+4*1]=i.y,l[3+4*2]=i.z;let p=3;const v=p;let m;const w=4;let f;do{if(c=v-p,l[c+a*c]===0){for(d=c+1;d<v;d++)if(l[c+a*d]!==0){m=w;do f=w-m,l[f+a*c]+=l[f+a*d];while(--m);break}}if(l[c+a*c]!==0)for(d=c+1;d<v;d++){const b=l[c+a*d]/l[c+a*c];m=w;do f=w-m,l[f+a*d]=f<=c?0:l[f+a*d]-l[f+a*c]*b;while(--m)}}while(--p);if(s.z=l[2*a+3]/l[2*a+2],s.y=(l[1*a+3]-l[1*a+2]*s.z)/l[1*a+1],s.x=(l[0*a+3]-l[0*a+2]*s.z-l[0*a+1]*s.y)/l[0*a+0],isNaN(s.x)||isNaN(s.y)||isNaN(s.z)||s.x===1/0||s.y===1/0||s.z===1/0)throw`Could not solve equation! Got x=[${s.toString()}], b=[${i.toString()}], A=[${this.toString()}]`;return s}e(i,s,o){if(o===void 0)return this.elements[s+3*i];this.elements[s+3*i]=o}copy(i){for(let s=0;s<i.elements.length;s++)this.elements[s]=i.elements[s];return this}toString(){let i="";const s=",";for(let o=0;o<9;o++)i+=this.elements[o]+s;return i}reverse(i){i===void 0&&(i=new Ct);const s=3,o=6,a=Vl;let l,c;for(l=0;l<3;l++)for(c=0;c<3;c++)a[l+o*c]=this.elements[l+3*c];a[3+6*0]=1,a[3+6*1]=0,a[3+6*2]=0,a[4+6*0]=0,a[4+6*1]=1,a[4+6*2]=0,a[5+6*0]=0,a[5+6*1]=0,a[5+6*2]=1;let d=3;const p=d;let v;const m=o;let w;do{if(l=p-d,a[l+o*l]===0){for(c=l+1;c<p;c++)if(a[l+o*c]!==0){v=m;do w=m-v,a[w+o*l]+=a[w+o*c];while(--v);break}}if(a[l+o*l]!==0)for(c=l+1;c<p;c++){const f=a[l+o*c]/a[l+o*l];v=m;do w=m-v,a[w+o*c]=w<=l?0:a[w+o*c]-a[w+o*l]*f;while(--v)}}while(--d);l=2;do{c=l-1;do{const f=a[l+o*c]/a[l+o*l];v=o;do w=o-v,a[w+o*c]=a[w+o*c]-a[w+o*l]*f;while(--v)}while(c--)}while(--l);l=2;do{const f=1/a[l+o*l];v=o;do w=o-v,a[w+o*l]=a[w+o*l]*f;while(--v)}while(l--);l=2;do{c=2;do{if(w=a[s+c+o*l],isNaN(w)||w===1/0)throw`Could not reverse! A=[${this.toString()}]`;i.e(l,c,w)}while(c--)}while(l--);return i}setRotationFromQuaternion(i){const s=i.x,o=i.y,a=i.z,l=i.w,c=s+s,d=o+o,p=a+a,v=s*c,m=s*d,w=s*p,f=o*d,b=o*p,g=a*p,C=l*c,y=l*d,P=l*p,_=this.elements;return _[3*0+0]=1-(f+g),_[3*0+1]=m-P,_[3*0+2]=w+y,_[3*1+0]=m+P,_[3*1+1]=1-(v+g),_[3*1+2]=b-C,_[3*2+0]=w-y,_[3*2+1]=b+C,_[3*2+2]=1-(v+f),this}transpose(i){i===void 0&&(i=new Ct);const s=this.elements,o=i.elements;let a;return o[0]=s[0],o[4]=s[4],o[8]=s[8],a=s[1],o[1]=s[3],o[3]=a,a=s[2],o[2]=s[6],o[6]=a,a=s[5],o[5]=s[7],o[7]=a,i}}const Vl=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class u{constructor(i,s,o){i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),this.x=i,this.y=s,this.z=o}cross(i,s){s===void 0&&(s=new u);const o=i.x,a=i.y,l=i.z,c=this.x,d=this.y,p=this.z;return s.x=d*l-p*a,s.y=p*o-c*l,s.z=c*a-d*o,s}set(i,s,o){return this.x=i,this.y=s,this.z=o,this}setZero(){this.x=this.y=this.z=0}vadd(i,s){if(s)s.x=i.x+this.x,s.y=i.y+this.y,s.z=i.z+this.z;else return new u(this.x+i.x,this.y+i.y,this.z+i.z)}vsub(i,s){if(s)s.x=this.x-i.x,s.y=this.y-i.y,s.z=this.z-i.z;else return new u(this.x-i.x,this.y-i.y,this.z-i.z)}crossmat(){return new Ct([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const i=this.x,s=this.y,o=this.z,a=Math.sqrt(i*i+s*s+o*o);if(a>0){const l=1/a;this.x*=l,this.y*=l,this.z*=l}else this.x=0,this.y=0,this.z=0;return a}unit(i){i===void 0&&(i=new u);const s=this.x,o=this.y,a=this.z;let l=Math.sqrt(s*s+o*o+a*a);return l>0?(l=1/l,i.x=s*l,i.y=o*l,i.z=a*l):(i.x=1,i.y=0,i.z=0),i}length(){const i=this.x,s=this.y,o=this.z;return Math.sqrt(i*i+s*s+o*o)}lengthSquared(){return this.dot(this)}distanceTo(i){const s=this.x,o=this.y,a=this.z,l=i.x,c=i.y,d=i.z;return Math.sqrt((l-s)*(l-s)+(c-o)*(c-o)+(d-a)*(d-a))}distanceSquared(i){const s=this.x,o=this.y,a=this.z,l=i.x,c=i.y,d=i.z;return(l-s)*(l-s)+(c-o)*(c-o)+(d-a)*(d-a)}scale(i,s){s===void 0&&(s=new u);const o=this.x,a=this.y,l=this.z;return s.x=i*o,s.y=i*a,s.z=i*l,s}vmul(i,s){return s===void 0&&(s=new u),s.x=i.x*this.x,s.y=i.y*this.y,s.z=i.z*this.z,s}addScaledVector(i,s,o){return o===void 0&&(o=new u),o.x=this.x+i*s.x,o.y=this.y+i*s.y,o.z=this.z+i*s.z,o}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(i){return i===void 0&&(i=new u),i.x=-this.x,i.y=-this.y,i.z=-this.z,i}tangents(i,s){const o=this.length();if(o>0){const a=Bl,l=1/o;a.set(this.x*l,this.y*l,this.z*l);const c=Ll;Math.abs(a.x)<.9?(c.set(1,0,0),a.cross(c,i)):(c.set(0,1,0),a.cross(c,i)),a.cross(i,s)}else i.set(1,0,0),s.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}lerp(i,s,o){const a=this.x,l=this.y,c=this.z;o.x=a+(i.x-a)*s,o.y=l+(i.y-l)*s,o.z=c+(i.z-c)*s}almostEquals(i,s){return s===void 0&&(s=1e-6),!(Math.abs(this.x-i.x)>s||Math.abs(this.y-i.y)>s||Math.abs(this.z-i.z)>s)}almostZero(i){return i===void 0&&(i=1e-6),!(Math.abs(this.x)>i||Math.abs(this.y)>i||Math.abs(this.z)>i)}isAntiparallelTo(i,s){return this.negate(vs),vs.almostEquals(i,s)}clone(){return new u(this.x,this.y,this.z)}}u.ZERO=new u(0,0,0);u.UNIT_X=new u(1,0,0);u.UNIT_Y=new u(0,1,0);u.UNIT_Z=new u(0,0,1);const Bl=new u,Ll=new u,vs=new u;class mt{constructor(i){i===void 0&&(i={}),this.lowerBound=new u,this.upperBound=new u,i.lowerBound&&this.lowerBound.copy(i.lowerBound),i.upperBound&&this.upperBound.copy(i.upperBound)}setFromPoints(i,s,o,a){const l=this.lowerBound,c=this.upperBound,d=o;l.copy(i[0]),d&&d.vmult(l,l),c.copy(l);for(let p=1;p<i.length;p++){let v=i[p];d&&(d.vmult(v,ms),v=ms),v.x>c.x&&(c.x=v.x),v.x<l.x&&(l.x=v.x),v.y>c.y&&(c.y=v.y),v.y<l.y&&(l.y=v.y),v.z>c.z&&(c.z=v.z),v.z<l.z&&(l.z=v.z)}return s&&(s.vadd(l,l),s.vadd(c,c)),a&&(l.x-=a,l.y-=a,l.z-=a,c.x+=a,c.y+=a,c.z+=a),this}copy(i){return this.lowerBound.copy(i.lowerBound),this.upperBound.copy(i.upperBound),this}clone(){return new mt().copy(this)}extend(i){this.lowerBound.x=Math.min(this.lowerBound.x,i.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,i.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,i.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,i.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,i.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,i.upperBound.z)}overlaps(i){const s=this.lowerBound,o=this.upperBound,a=i.lowerBound,l=i.upperBound,c=a.x<=o.x&&o.x<=l.x||s.x<=l.x&&l.x<=o.x,d=a.y<=o.y&&o.y<=l.y||s.y<=l.y&&l.y<=o.y,p=a.z<=o.z&&o.z<=l.z||s.z<=l.z&&l.z<=o.z;return c&&d&&p}volume(){const i=this.lowerBound,s=this.upperBound;return(s.x-i.x)*(s.y-i.y)*(s.z-i.z)}contains(i){const s=this.lowerBound,o=this.upperBound,a=i.lowerBound,l=i.upperBound;return s.x<=a.x&&o.x>=l.x&&s.y<=a.y&&o.y>=l.y&&s.z<=a.z&&o.z>=l.z}getCorners(i,s,o,a,l,c,d,p){const v=this.lowerBound,m=this.upperBound;i.copy(v),s.set(m.x,v.y,v.z),o.set(m.x,m.y,v.z),a.set(v.x,m.y,m.z),l.set(m.x,v.y,m.z),c.set(v.x,m.y,v.z),d.set(v.x,v.y,m.z),p.copy(m)}toLocalFrame(i,s){const o=fs,a=o[0],l=o[1],c=o[2],d=o[3],p=o[4],v=o[5],m=o[6],w=o[7];this.getCorners(a,l,c,d,p,v,m,w);for(let f=0;f!==8;f++){const b=o[f];i.pointToLocal(b,b)}return s.setFromPoints(o)}toWorldFrame(i,s){const o=fs,a=o[0],l=o[1],c=o[2],d=o[3],p=o[4],v=o[5],m=o[6],w=o[7];this.getCorners(a,l,c,d,p,v,m,w);for(let f=0;f!==8;f++){const b=o[f];i.pointToWorld(b,b)}return s.setFromPoints(o)}overlapsRay(i){const{direction:s,from:o}=i,a=1/s.x,l=1/s.y,c=1/s.z,d=(this.lowerBound.x-o.x)*a,p=(this.upperBound.x-o.x)*a,v=(this.lowerBound.y-o.y)*l,m=(this.upperBound.y-o.y)*l,w=(this.lowerBound.z-o.z)*c,f=(this.upperBound.z-o.z)*c,b=Math.max(Math.max(Math.min(d,p),Math.min(v,m)),Math.min(w,f)),g=Math.min(Math.min(Math.max(d,p),Math.max(v,m)),Math.max(w,f));return!(g<0||b>g)}}const ms=new u,fs=[new u,new u,new u,new u,new u,new u,new u,new u];class bs{constructor(){this.matrix=[]}get(i,s){let{index:o}=i,{index:a}=s;if(a>o){const l=a;a=o,o=l}return this.matrix[(o*(o+1)>>1)+a-1]}set(i,s,o){let{index:a}=i,{index:l}=s;if(l>a){const c=l;l=a,a=c}this.matrix[(a*(a+1)>>1)+l-1]=o?1:0}reset(){for(let i=0,s=this.matrix.length;i!==s;i++)this.matrix[i]=0}setNumObjects(i){this.matrix.length=i*(i-1)>>1}}class zs{addEventListener(i,s){this._listeners===void 0&&(this._listeners={});const o=this._listeners;return o[i]===void 0&&(o[i]=[]),o[i].includes(s)||o[i].push(s),this}hasEventListener(i,s){if(this._listeners===void 0)return!1;const o=this._listeners;return!!(o[i]!==void 0&&o[i].includes(s))}hasAnyEventListener(i){return this._listeners===void 0?!1:this._listeners[i]!==void 0}removeEventListener(i,s){if(this._listeners===void 0)return this;const o=this._listeners;if(o[i]===void 0)return this;const a=o[i].indexOf(s);return a!==-1&&o[i].splice(a,1),this}dispatchEvent(i){if(this._listeners===void 0)return this;const o=this._listeners[i.type];if(o!==void 0){i.target=this;for(let a=0,l=o.length;a<l;a++)o[a].call(this,i)}return this}}class at{constructor(i,s,o,a){i===void 0&&(i=0),s===void 0&&(s=0),o===void 0&&(o=0),a===void 0&&(a=1),this.x=i,this.y=s,this.z=o,this.w=a}set(i,s,o,a){return this.x=i,this.y=s,this.z=o,this.w=a,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(i,s){const o=Math.sin(s*.5);return this.x=i.x*o,this.y=i.y*o,this.z=i.z*o,this.w=Math.cos(s*.5),this}toAxisAngle(i){i===void 0&&(i=new u),this.normalize();const s=2*Math.acos(this.w),o=Math.sqrt(1-this.w*this.w);return o<.001?(i.x=this.x,i.y=this.y,i.z=this.z):(i.x=this.x/o,i.y=this.y/o,i.z=this.z/o),[i,s]}setFromVectors(i,s){if(i.isAntiparallelTo(s)){const o=Nl,a=Tl;i.tangents(o,a),this.setFromAxisAngle(o,Math.PI)}else{const o=i.cross(s);this.x=o.x,this.y=o.y,this.z=o.z,this.w=Math.sqrt(i.length()**2*s.length()**2)+i.dot(s),this.normalize()}return this}mult(i,s){s===void 0&&(s=new at);const o=this.x,a=this.y,l=this.z,c=this.w,d=i.x,p=i.y,v=i.z,m=i.w;return s.x=o*m+c*d+a*v-l*p,s.y=a*m+c*p+l*d-o*v,s.z=l*m+c*v+o*p-a*d,s.w=c*m-o*d-a*p-l*v,s}inverse(i){i===void 0&&(i=new at);const s=this.x,o=this.y,a=this.z,l=this.w;this.conjugate(i);const c=1/(s*s+o*o+a*a+l*l);return i.x*=c,i.y*=c,i.z*=c,i.w*=c,i}conjugate(i){return i===void 0&&(i=new at),i.x=-this.x,i.y=-this.y,i.z=-this.z,i.w=this.w,i}normalize(){let i=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return i===0?(this.x=0,this.y=0,this.z=0,this.w=0):(i=1/i,this.x*=i,this.y*=i,this.z*=i,this.w*=i),this}normalizeFast(){const i=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return i===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=i,this.y*=i,this.z*=i,this.w*=i),this}vmult(i,s){s===void 0&&(s=new u);const o=i.x,a=i.y,l=i.z,c=this.x,d=this.y,p=this.z,v=this.w,m=v*o+d*l-p*a,w=v*a+p*o-c*l,f=v*l+c*a-d*o,b=-c*o-d*a-p*l;return s.x=m*v+b*-c+w*-p-f*-d,s.y=w*v+b*-d+f*-c-m*-p,s.z=f*v+b*-p+m*-d-w*-c,s}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w,this}toEuler(i,s){s===void 0&&(s="YZX");let o,a,l;const c=this.x,d=this.y,p=this.z,v=this.w;switch(s){case"YZX":const m=c*d+p*v;if(m>.499&&(o=2*Math.atan2(c,v),a=Math.PI/2,l=0),m<-.499&&(o=-2*Math.atan2(c,v),a=-Math.PI/2,l=0),o===void 0){const w=c*c,f=d*d,b=p*p;o=Math.atan2(2*d*v-2*c*p,1-2*f-2*b),a=Math.asin(2*m),l=Math.atan2(2*c*v-2*d*p,1-2*w-2*b)}break;default:throw new Error(`Euler order ${s} not supported yet.`)}i.y=o,i.z=a,i.x=l}setFromEuler(i,s,o,a){a===void 0&&(a="XYZ");const l=Math.cos(i/2),c=Math.cos(s/2),d=Math.cos(o/2),p=Math.sin(i/2),v=Math.sin(s/2),m=Math.sin(o/2);return a==="XYZ"?(this.x=p*c*d+l*v*m,this.y=l*v*d-p*c*m,this.z=l*c*m+p*v*d,this.w=l*c*d-p*v*m):a==="YXZ"?(this.x=p*c*d+l*v*m,this.y=l*v*d-p*c*m,this.z=l*c*m-p*v*d,this.w=l*c*d+p*v*m):a==="ZXY"?(this.x=p*c*d-l*v*m,this.y=l*v*d+p*c*m,this.z=l*c*m+p*v*d,this.w=l*c*d-p*v*m):a==="ZYX"?(this.x=p*c*d-l*v*m,this.y=l*v*d+p*c*m,this.z=l*c*m-p*v*d,this.w=l*c*d+p*v*m):a==="YZX"?(this.x=p*c*d+l*v*m,this.y=l*v*d+p*c*m,this.z=l*c*m-p*v*d,this.w=l*c*d-p*v*m):a==="XZY"&&(this.x=p*c*d-l*v*m,this.y=l*v*d-p*c*m,this.z=l*c*m+p*v*d,this.w=l*c*d+p*v*m),this}clone(){return new at(this.x,this.y,this.z,this.w)}slerp(i,s,o){o===void 0&&(o=new at);const a=this.x,l=this.y,c=this.z,d=this.w;let p=i.x,v=i.y,m=i.z,w=i.w,f,b,g,C,y;return b=a*p+l*v+c*m+d*w,b<0&&(b=-b,p=-p,v=-v,m=-m,w=-w),1-b>1e-6?(f=Math.acos(b),g=Math.sin(f),C=Math.sin((1-s)*f)/g,y=Math.sin(s*f)/g):(C=1-s,y=s),o.x=C*a+y*p,o.y=C*l+y*v,o.z=C*c+y*m,o.w=C*d+y*w,o}integrate(i,s,o,a){a===void 0&&(a=new at);const l=i.x*o.x,c=i.y*o.y,d=i.z*o.z,p=this.x,v=this.y,m=this.z,w=this.w,f=s*.5;return a.x+=f*(l*w+c*m-d*v),a.y+=f*(c*w+d*p-l*m),a.z+=f*(d*w+l*v-c*p),a.w+=f*(-l*p-c*v-d*m),a}}const Nl=new u,Tl=new u,zl={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class U{constructor(i){i===void 0&&(i={}),this.id=U.idCounter++,this.type=i.type||0,this.boundingSphereRadius=0,this.collisionResponse=i.collisionResponse?i.collisionResponse:!0,this.collisionFilterGroup=i.collisionFilterGroup!==void 0?i.collisionFilterGroup:1,this.collisionFilterMask=i.collisionFilterMask!==void 0?i.collisionFilterMask:-1,this.material=i.material?i.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(i,s){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(i,s,o,a){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}U.idCounter=0;U.types=zl;class et{constructor(i){i===void 0&&(i={}),this.position=new u,this.quaternion=new at,i.position&&this.position.copy(i.position),i.quaternion&&this.quaternion.copy(i.quaternion)}pointToLocal(i,s){return et.pointToLocalFrame(this.position,this.quaternion,i,s)}pointToWorld(i,s){return et.pointToWorldFrame(this.position,this.quaternion,i,s)}vectorToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s}static pointToLocalFrame(i,s,o,a){return a===void 0&&(a=new u),o.vsub(i,a),s.conjugate(ws),ws.vmult(a,a),a}static pointToWorldFrame(i,s,o,a){return a===void 0&&(a=new u),s.vmult(o,a),a.vadd(i,a),a}static vectorToWorldFrame(i,s,o){return o===void 0&&(o=new u),i.vmult(s,o),o}static vectorToLocalFrame(i,s,o,a){return a===void 0&&(a=new u),s.w*=-1,s.vmult(o,a),s.w*=-1,a}}const ws=new at;class ge extends U{constructor(i){i===void 0&&(i={});const{vertices:s=[],faces:o=[],normals:a=[],axes:l,boundingSphereRadius:c}=i;super({type:U.types.CONVEXPOLYHEDRON});this.vertices=s,this.faces=o,this.faceNormals=a,this.faceNormals.length===0&&this.computeNormals(),c?this.boundingSphereRadius=c:this.updateBoundingSphereRadius(),this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.worldFaceNormals=[],this.worldFaceNormalsNeedsUpdate=!0,this.uniqueAxes=l?l.slice():null,this.uniqueEdges=[],this.computeEdges()}computeEdges(){const i=this.faces,s=this.vertices,o=this.uniqueEdges;o.length=0;const a=new u;for(let l=0;l!==i.length;l++){const c=i[l],d=c.length;for(let p=0;p!==d;p++){const v=(p+1)%d;s[c[p]].vsub(s[c[v]],a),a.normalize();let m=!1;for(let w=0;w!==o.length;w++)if(o[w].almostEquals(a)||o[w].almostEquals(a)){m=!0;break}m||o.push(a.clone())}}}computeNormals(){this.faceNormals.length=this.faces.length;for(let i=0;i<this.faces.length;i++){for(let a=0;a<this.faces[i].length;a++)if(!this.vertices[this.faces[i][a]])throw new Error(`Vertex ${this.faces[i][a]} not found!`);const s=this.faceNormals[i]||new u;this.getFaceNormal(i,s),s.negate(s),this.faceNormals[i]=s;const o=this.vertices[this.faces[i][0]];if(s.dot(o)<0){console.error(`.faceNormals[${i}] = Vec3(${s.toString()}) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.`);for(let a=0;a<this.faces[i].length;a++)console.warn(`.vertices[${this.faces[i][a]}] = Vec3(${this.vertices[this.faces[i][a]].toString()})`)}}}getFaceNormal(i,s){const o=this.faces[i],a=this.vertices[o[0]],l=this.vertices[o[1]],c=this.vertices[o[2]];ge.computeNormal(a,l,c,s)}static computeNormal(i,s,o,a){const l=new u,c=new u;s.vsub(i,c),o.vsub(s,l),l.cross(c,a),a.isZero()||a.normalize()}clipAgainstHull(i,s,o,a,l,c,d,p,v){const m=new u;let w=-1,f=-Number.MAX_VALUE;for(let g=0;g<o.faces.length;g++){m.copy(o.faceNormals[g]),l.vmult(m,m);const C=m.dot(c);C>f&&(f=C,w=g)}const b=[];for(let g=0;g<o.faces[w].length;g++){const C=o.vertices[o.faces[w][g]],y=new u;y.copy(C),l.vmult(y,y),a.vadd(y,y),b.push(y)}w>=0&&this.clipFaceAgainstHull(c,i,s,b,d,p,v)}findSeparatingAxis(i,s,o,a,l,c,d,p){const v=new u,m=new u,w=new u,f=new u,b=new u,g=new u;let C=Number.MAX_VALUE;const y=this;if(y.uniqueAxes)for(let P=0;P!==y.uniqueAxes.length;P++){o.vmult(y.uniqueAxes[P],v);const _=y.testSepAxis(v,i,s,o,a,l);if(_===!1)return!1;_<C&&(C=_,c.copy(v))}else{const P=d?d.length:y.faces.length;for(let _=0;_<P;_++){const M=d?d[_]:_;v.copy(y.faceNormals[M]),o.vmult(v,v);const S=y.testSepAxis(v,i,s,o,a,l);if(S===!1)return!1;S<C&&(C=S,c.copy(v))}}if(i.uniqueAxes)for(let P=0;P!==i.uniqueAxes.length;P++){l.vmult(i.uniqueAxes[P],m);const _=y.testSepAxis(m,i,s,o,a,l);if(_===!1)return!1;_<C&&(C=_,c.copy(m))}else{const P=p?p.length:i.faces.length;for(let _=0;_<P;_++){const M=p?p[_]:_;m.copy(i.faceNormals[M]),l.vmult(m,m);const S=y.testSepAxis(m,i,s,o,a,l);if(S===!1)return!1;S<C&&(C=S,c.copy(m))}}for(let P=0;P!==y.uniqueEdges.length;P++){o.vmult(y.uniqueEdges[P],f);for(let _=0;_!==i.uniqueEdges.length;_++)if(l.vmult(i.uniqueEdges[_],b),f.cross(b,g),!g.almostZero()){g.normalize();const M=y.testSepAxis(g,i,s,o,a,l);if(M===!1)return!1;M<C&&(C=M,c.copy(g))}}return a.vsub(s,w),w.dot(c)>0&&c.negate(c),!0}testSepAxis(i,s,o,a,l,c){const d=this;ge.project(d,i,o,a,ei),ge.project(s,i,l,c,ni);const p=ei[0],v=ei[1],m=ni[0],w=ni[1];if(p<w||m<v)return!1;const f=p-w,b=m-v;return f<b?f:b}calculateLocalInertia(i,s){const o=new u,a=new u;this.computeLocalAABB(a,o);const l=o.x-a.x,c=o.y-a.y,d=o.z-a.z;s.x=1/12*i*(2*c*2*c+2*d*2*d),s.y=1/12*i*(2*l*2*l+2*d*2*d),s.z=1/12*i*(2*c*2*c+2*l*2*l)}getPlaneConstantOfFace(i){const s=this.faces[i],o=this.faceNormals[i],a=this.vertices[s[0]];return-o.dot(a)}clipFaceAgainstHull(i,s,o,a,l,c,d){const p=new u,v=new u,m=new u,w=new u,f=new u,b=new u,g=new u,C=new u,y=this,P=[],_=a,M=P;let S=-1,A=Number.MAX_VALUE;for(let z=0;z<y.faces.length;z++){p.copy(y.faceNormals[z]),o.vmult(p,p);const L=p.dot(i);L<A&&(A=L,S=z)}if(S<0)return;const V=y.faces[S];V.connectedFaces=[];for(let z=0;z<y.faces.length;z++)for(let L=0;L<y.faces[z].length;L++)V.indexOf(y.faces[z][L])!==-1&&z!==S&&V.connectedFaces.indexOf(z)===-1&&V.connectedFaces.push(z);const I=V.length;for(let z=0;z<I;z++){const L=y.vertices[V[z]],q=y.vertices[V[(z+1)%I]];L.vsub(q,v),m.copy(v),o.vmult(m,m),s.vadd(m,m),w.copy(this.faceNormals[S]),o.vmult(w,w),s.vadd(w,w),m.cross(w,f),f.negate(f),b.copy(L),o.vmult(b,b),s.vadd(b,b);const B=V.connectedFaces[z];g.copy(this.faceNormals[B]);const R=this.getPlaneConstantOfFace(B);C.copy(g),o.vmult(C,C);const N=R-C.dot(s);for(this.clipFaceAgainstPlane(_,M,C,N);_.length;)_.shift();for(;M.length;)_.push(M.shift())}g.copy(this.faceNormals[S]);const F=this.getPlaneConstantOfFace(S);C.copy(g),o.vmult(C,C);const H=F-C.dot(s);for(let z=0;z<_.length;z++){let L=C.dot(_[z])+H;if(L<=l&&(console.log(`clamped: depth=${L} to minDist=${l}`),L=l),L<=c){const q=_[z];if(L<=1e-6){const B={point:q,normal:C,depth:L};d.push(B)}}}}clipFaceAgainstPlane(i,s,o,a){let l,c;const d=i.length;if(d<2)return s;let p=i[i.length-1],v=i[0];l=o.dot(p)+a;for(let m=0;m<d;m++){if(v=i[m],c=o.dot(v)+a,l<0)if(c<0){const w=new u;w.copy(v),s.push(w)}else{const w=new u;p.lerp(v,l/(l-c),w),s.push(w)}else if(c<0){const w=new u;p.lerp(v,l/(l-c),w),s.push(w),s.push(v)}p=v,l=c}return s}computeWorldVertices(i,s){for(;this.worldVertices.length<this.vertices.length;)this.worldVertices.push(new u);const o=this.vertices,a=this.worldVertices;for(let l=0;l!==this.vertices.length;l++)s.vmult(o[l],a[l]),i.vadd(a[l],a[l]);this.worldVerticesNeedsUpdate=!1}computeLocalAABB(i,s){const o=this.vertices;i.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),s.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let a=0;a<this.vertices.length;a++){const l=o[a];l.x<i.x?i.x=l.x:l.x>s.x&&(s.x=l.x),l.y<i.y?i.y=l.y:l.y>s.y&&(s.y=l.y),l.z<i.z?i.z=l.z:l.z>s.z&&(s.z=l.z)}}computeWorldFaceNormals(i){const s=this.faceNormals.length;for(;this.worldFaceNormals.length<s;)this.worldFaceNormals.push(new u);const o=this.faceNormals,a=this.worldFaceNormals;for(let l=0;l!==s;l++)i.vmult(o[l],a[l]);this.worldFaceNormalsNeedsUpdate=!1}updateBoundingSphereRadius(){let i=0;const s=this.vertices;for(let o=0;o!==s.length;o++){const a=s[o].lengthSquared();a>i&&(i=a)}this.boundingSphereRadius=Math.sqrt(i)}calculateWorldAABB(i,s,o,a){const l=this.vertices;let c,d,p,v,m,w,f=new u;for(let b=0;b<l.length;b++){f.copy(l[b]),s.vmult(f,f),i.vadd(f,f);const g=f;(c===void 0||g.x<c)&&(c=g.x),(v===void 0||g.x>v)&&(v=g.x),(d===void 0||g.y<d)&&(d=g.y),(m===void 0||g.y>m)&&(m=g.y),(p===void 0||g.z<p)&&(p=g.z),(w===void 0||g.z>w)&&(w=g.z)}o.set(c,d,p),a.set(v,m,w)}volume(){return 4*Math.PI*this.boundingSphereRadius/3}getAveragePointLocal(i){i===void 0&&(i=new u);const s=this.vertices;for(let o=0;o<s.length;o++)i.vadd(s[o],i);return i.scale(1/s.length,i),i}transformAllPoints(i,s){const o=this.vertices.length,a=this.vertices;if(s){for(let l=0;l<o;l++){const c=a[l];s.vmult(c,c)}for(let l=0;l<this.faceNormals.length;l++){const c=this.faceNormals[l];s.vmult(c,c)}}if(i)for(let l=0;l<o;l++){const c=a[l];c.vadd(i,c)}}pointIsInside(i){const s=this.vertices,o=this.faces,a=this.faceNormals,l=new u;this.getAveragePointLocal(l);for(let c=0;c<this.faces.length;c++){let d=a[c];const p=s[o[c][0]],v=new u;i.vsub(p,v);const m=d.dot(v),w=new u;l.vsub(p,w);const f=d.dot(w);if(m<0&&f>0||m>0&&f<0)return!1}return-1}static project(i,s,o,a,l){const c=i.vertices.length,d=Rl;let p=0,v=0;const m=Il,w=i.vertices;m.setZero(),et.vectorToLocalFrame(o,a,s,d),et.pointToLocalFrame(o,a,m,m);const f=m.dot(d);v=p=w[0].dot(d);for(let b=1;b<c;b++){const g=w[b].dot(d);g>p&&(p=g),g<v&&(v=g)}if(v-=f,p-=f,v>p){const b=v;v=p,p=b}l[0]=p,l[1]=v}}const ei=[],ni=[];new u;const Rl=new u,Il=new u;class Ue extends U{constructor(i){super({type:U.types.BOX});this.halfExtents=i,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}updateConvexPolyhedronRepresentation(){const i=this.halfExtents.x,s=this.halfExtents.y,o=this.halfExtents.z,a=u,l=[new a(-i,-s,-o),new a(i,-s,-o),new a(i,s,-o),new a(-i,s,-o),new a(-i,-s,o),new a(i,-s,o),new a(i,s,o),new a(-i,s,o)],c=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],d=[new a(0,0,1),new a(0,1,0),new a(1,0,0)],p=new ge({vertices:l,faces:c,axes:d});this.convexPolyhedronRepresentation=p,p.material=this.material}calculateLocalInertia(i,s){return s===void 0&&(s=new u),Ue.calculateInertia(this.halfExtents,i,s),s}static calculateInertia(i,s,o){const a=i;o.x=1/12*s*(2*a.y*2*a.y+2*a.z*2*a.z),o.y=1/12*s*(2*a.x*2*a.x+2*a.z*2*a.z),o.z=1/12*s*(2*a.y*2*a.y+2*a.x*2*a.x)}getSideNormals(i,s){const o=i,a=this.halfExtents;if(o[0].set(a.x,0,0),o[1].set(0,a.y,0),o[2].set(0,0,a.z),o[3].set(-a.x,0,0),o[4].set(0,-a.y,0),o[5].set(0,0,-a.z),s!==void 0)for(let l=0;l!==o.length;l++)s.vmult(o[l],o[l]);return o}volume(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z}updateBoundingSphereRadius(){this.boundingSphereRadius=this.halfExtents.length()}forEachWorldCorner(i,s,o){const a=this.halfExtents,l=[[a.x,a.y,a.z],[-a.x,a.y,a.z],[-a.x,-a.y,a.z],[-a.x,-a.y,-a.z],[a.x,-a.y,-a.z],[a.x,a.y,-a.z],[-a.x,a.y,-a.z],[a.x,-a.y,a.z]];for(let c=0;c<l.length;c++)$t.set(l[c][0],l[c][1],l[c][2]),s.vmult($t,$t),i.vadd($t,$t),o($t.x,$t.y,$t.z)}calculateWorldAABB(i,s,o,a){const l=this.halfExtents;St[0].set(l.x,l.y,l.z),St[1].set(-l.x,l.y,l.z),St[2].set(-l.x,-l.y,l.z),St[3].set(-l.x,-l.y,-l.z),St[4].set(l.x,-l.y,-l.z),St[5].set(l.x,l.y,-l.z),St[6].set(-l.x,l.y,-l.z),St[7].set(l.x,-l.y,l.z);const c=St[0];s.vmult(c,c),i.vadd(c,c),a.copy(c),o.copy(c);for(let d=1;d<8;d++){const p=St[d];s.vmult(p,p),i.vadd(p,p);const v=p.x,m=p.y,w=p.z;v>a.x&&(a.x=v),m>a.y&&(a.y=m),w>a.z&&(a.z=w),v<o.x&&(o.x=v),m<o.y&&(o.y=m),w<o.z&&(o.z=w)}}}const $t=new u,St=[new u,new u,new u,new u,new u,new u,new u,new u],li={DYNAMIC:1,STATIC:2,KINEMATIC:4},ci={AWAKE:0,SLEEPY:1,SLEEPING:2};class j extends zs{constructor(i){i===void 0&&(i={});super();this.id=j.idCounter++,this.index=-1,this.world=null,this.vlambda=new u,this.collisionFilterGroup=typeof i.collisionFilterGroup=="number"?i.collisionFilterGroup:1,this.collisionFilterMask=typeof i.collisionFilterMask=="number"?i.collisionFilterMask:-1,this.collisionResponse=typeof i.collisionResponse=="boolean"?i.collisionResponse:!0,this.position=new u,this.previousPosition=new u,this.interpolatedPosition=new u,this.initPosition=new u,i.position&&(this.position.copy(i.position),this.previousPosition.copy(i.position),this.interpolatedPosition.copy(i.position),this.initPosition.copy(i.position)),this.velocity=new u,i.velocity&&this.velocity.copy(i.velocity),this.initVelocity=new u,this.force=new u;const s=typeof i.mass=="number"?i.mass:0;this.mass=s,this.invMass=s>0?1/s:0,this.material=i.material||null,this.linearDamping=typeof i.linearDamping=="number"?i.linearDamping:.01,this.type=s<=0?j.STATIC:j.DYNAMIC,typeof i.type==typeof j.STATIC&&(this.type=i.type),this.allowSleep=typeof i.allowSleep!="undefined"?i.allowSleep:!0,this.sleepState=j.AWAKE,this.sleepSpeedLimit=typeof i.sleepSpeedLimit!="undefined"?i.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof i.sleepTimeLimit!="undefined"?i.sleepTimeLimit:1,this.timeLastSleepy=0,this.wakeUpAfterNarrowphase=!1,this.torque=new u,this.quaternion=new at,this.initQuaternion=new at,this.previousQuaternion=new at,this.interpolatedQuaternion=new at,i.quaternion&&(this.quaternion.copy(i.quaternion),this.initQuaternion.copy(i.quaternion),this.previousQuaternion.copy(i.quaternion),this.interpolatedQuaternion.copy(i.quaternion)),this.angularVelocity=new u,i.angularVelocity&&this.angularVelocity.copy(i.angularVelocity),this.initAngularVelocity=new u,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new u,this.invInertia=new u,this.invInertiaWorld=new Ct,this.invMassSolve=0,this.invInertiaSolve=new u,this.invInertiaWorldSolve=new Ct,this.fixedRotation=typeof i.fixedRotation!="undefined"?i.fixedRotation:!1,this.angularDamping=typeof i.angularDamping!="undefined"?i.angularDamping:.01,this.linearFactor=new u(1,1,1),i.linearFactor&&this.linearFactor.copy(i.linearFactor),this.angularFactor=new u(1,1,1),i.angularFactor&&this.angularFactor.copy(i.angularFactor),this.aabb=new mt,this.aabbNeedsUpdate=!0,this.boundingRadius=0,this.wlambda=new u,this.isTrigger=Boolean(i.isTrigger),i.shape&&this.addShape(i.shape),this.updateMassProperties()}wakeUp(){const i=this.sleepState;this.sleepState=j.AWAKE,this.wakeUpAfterNarrowphase=!1,i===j.SLEEPING&&this.dispatchEvent(j.wakeupEvent)}sleep(){this.sleepState=j.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1}sleepTick(i){if(this.allowSleep){const s=this.sleepState,o=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),a=this.sleepSpeedLimit**2;s===j.AWAKE&&o<a?(this.sleepState=j.SLEEPY,this.timeLastSleepy=i,this.dispatchEvent(j.sleepyEvent)):s===j.SLEEPY&&o>a?this.wakeUp():s===j.SLEEPY&&i-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(j.sleepEvent))}}updateSolveMassProperties(){this.sleepState===j.SLEEPING||this.type===j.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))}pointToLocalFrame(i,s){return s===void 0&&(s=new u),i.vsub(this.position,s),this.quaternion.conjugate().vmult(s,s),s}vectorToLocalFrame(i,s){return s===void 0&&(s=new u),this.quaternion.conjugate().vmult(i,s),s}pointToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s.vadd(this.position,s),s}vectorToWorldFrame(i,s){return s===void 0&&(s=new u),this.quaternion.vmult(i,s),s}addShape(i,s,o){const a=new u,l=new at;return s&&a.copy(s),o&&l.copy(o),this.shapes.push(i),this.shapeOffsets.push(a),this.shapeOrientations.push(l),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,i.body=this,this}removeShape(i){const s=this.shapes.indexOf(i);return s===-1?(console.warn("Shape does not belong to the body"),this):(this.shapes.splice(s,1),this.shapeOffsets.splice(s,1),this.shapeOrientations.splice(s,1),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,i.body=null,this)}updateBoundingRadius(){const i=this.shapes,s=this.shapeOffsets,o=i.length;let a=0;for(let l=0;l!==o;l++){const c=i[l];c.updateBoundingSphereRadius();const d=s[l].length(),p=c.boundingSphereRadius;d+p>a&&(a=d+p)}this.boundingRadius=a}updateAABB(){const i=this.shapes,s=this.shapeOffsets,o=this.shapeOrientations,a=i.length,l=Fl,c=Dl,d=this.quaternion,p=this.aabb,v=Ol;for(let m=0;m!==a;m++){const w=i[m];d.vmult(s[m],l),l.vadd(this.position,l),d.mult(o[m],c),w.calculateWorldAABB(l,c,v.lowerBound,v.upperBound),m===0?p.copy(v):p.extend(v)}this.aabbNeedsUpdate=!1}updateInertiaWorld(i){const s=this.invInertia;if(!(s.x===s.y&&s.y===s.z&&!i)){const o=ql,a=jl;o.setRotationFromQuaternion(this.quaternion),o.transpose(a),o.scale(s,o),o.mmult(a,this.invInertiaWorld)}}applyForce(i,s){if(s===void 0&&(s=new u),this.type!==j.DYNAMIC)return;this.sleepState===j.SLEEPING&&this.wakeUp();const o=Hl;s.cross(i,o),this.force.vadd(i,this.force),this.torque.vadd(o,this.torque)}applyLocalForce(i,s){if(s===void 0&&(s=new u),this.type!==j.DYNAMIC)return;const o=Gl,a=Kl;this.vectorToWorldFrame(i,o),this.vectorToWorldFrame(s,a),this.applyForce(o,a)}applyTorque(i){this.type===j.DYNAMIC&&(this.sleepState===j.SLEEPING&&this.wakeUp(),this.torque.vadd(i,this.torque))}applyImpulse(i,s){if(s===void 0&&(s=new u),this.type!==j.DYNAMIC)return;this.sleepState===j.SLEEPING&&this.wakeUp();const o=s,a=Wl;a.copy(i),a.scale(this.invMass,a),this.velocity.vadd(a,this.velocity);const l=$l;o.cross(i,l),this.invInertiaWorld.vmult(l,l),this.angularVelocity.vadd(l,this.angularVelocity)}applyLocalImpulse(i,s){if(s===void 0&&(s=new u),this.type!==j.DYNAMIC)return;const o=Yl,a=Xl;this.vectorToWorldFrame(i,o),this.vectorToWorldFrame(s,a),this.applyImpulse(o,a)}updateMassProperties(){const i=Zl;this.invMass=this.mass>0?1/this.mass:0;const s=this.inertia,o=this.fixedRotation;this.updateAABB(),i.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Ue.calculateInertia(i,this.mass,s),this.invInertia.set(s.x>0&&!o?1/s.x:0,s.y>0&&!o?1/s.y:0,s.z>0&&!o?1/s.z:0),this.updateInertiaWorld(!0)}getVelocityAtWorldPoint(i,s){const o=new u;return i.vsub(this.position,o),this.angularVelocity.cross(o,s),this.velocity.vadd(s,s),s}integrate(i,s,o){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),!(this.type===j.DYNAMIC||this.type===j.KINEMATIC)||this.sleepState===j.SLEEPING)return;const a=this.velocity,l=this.angularVelocity,c=this.position,d=this.force,p=this.torque,v=this.quaternion,m=this.invMass,w=this.invInertiaWorld,f=this.linearFactor,b=m*i;a.x+=d.x*b*f.x,a.y+=d.y*b*f.y,a.z+=d.z*b*f.z;const g=w.elements,C=this.angularFactor,y=p.x*C.x,P=p.y*C.y,_=p.z*C.z;l.x+=i*(g[0]*y+g[1]*P+g[2]*_),l.y+=i*(g[3]*y+g[4]*P+g[5]*_),l.z+=i*(g[6]*y+g[7]*P+g[8]*_),c.x+=a.x*i,c.y+=a.y*i,c.z+=a.z*i,v.integrate(this.angularVelocity,i,this.angularFactor,v),s&&(o?v.normalizeFast():v.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}}j.idCounter=0;j.COLLIDE_EVENT_NAME="collide";j.DYNAMIC=li.DYNAMIC;j.STATIC=li.STATIC;j.KINEMATIC=li.KINEMATIC;j.AWAKE=ci.AWAKE;j.SLEEPY=ci.SLEEPY;j.SLEEPING=ci.SLEEPING;j.wakeupEvent={type:"wakeup"};j.sleepyEvent={type:"sleepy"};j.sleepEvent={type:"sleep"};const Fl=new u,Dl=new at,Ol=new mt,ql=new Ct,jl=new Ct,Ul=new Ct,Hl=new u,Gl=new u,Kl=new u,Wl=new u,$l=new u,Yl=new u,Xl=new u,Zl=new u;class Jl{constructor(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}collisionPairs(i,s,o){throw new Error("collisionPairs not implemented for this BroadPhase class!")}needBroadphaseCollision(i,s){return!((i.collisionFilterGroup&s.collisionFilterMask)===0||(s.collisionFilterGroup&i.collisionFilterMask)===0||((i.type&j.STATIC)!==0||i.sleepState===j.SLEEPING)&&((s.type&j.STATIC)!==0||s.sleepState===j.SLEEPING))}intersectionTest(i,s,o,a){this.useBoundingBoxes?this.doBoundingBoxBroadphase(i,s,o,a):this.doBoundingSphereBroadphase(i,s,o,a)}doBoundingSphereBroadphase(i,s,o,a){const l=Ql;s.position.vsub(i.position,l);const c=(i.boundingRadius+s.boundingRadius)**2;l.lengthSquared()<c&&(o.push(i),a.push(s))}doBoundingBoxBroadphase(i,s,o,a){i.aabbNeedsUpdate&&i.updateAABB(),s.aabbNeedsUpdate&&s.updateAABB(),i.aabb.overlaps(s.aabb)&&(o.push(i),a.push(s))}makePairsUnique(i,s){const o=tc,a=ec,l=nc,c=i.length;for(let d=0;d!==c;d++)a[d]=i[d],l[d]=s[d];i.length=0,s.length=0;for(let d=0;d!==c;d++){const p=a[d].id,v=l[d].id,m=p<v?`${p},${v}`:`${v},${p}`;o[m]=d,o.keys.push(m)}for(let d=0;d!==o.keys.length;d++){const p=o.keys.pop(),v=o[p];i.push(a[v]),s.push(l[v]),delete o[p]}}setWorld(i){}static boundingSphereCheck(i,s){const o=new u;i.position.vsub(s.position,o);const a=i.shapes[0],l=s.shapes[0];return Math.pow(a.boundingSphereRadius+l.boundingSphereRadius,2)>o.lengthSquared()}aabbQuery(i,s,o){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}}const Ql=new u;new u;new at;new u;const tc={keys:[]},ec=[],nc=[];new u;new u;new u;class ic extends Jl{constructor(){super()}collisionPairs(i,s,o){const a=i.bodies,l=a.length;let c,d;for(let p=0;p!==l;p++)for(let v=0;v!==p;v++)c=a[p],d=a[v],!!this.needBroadphaseCollision(c,d)&&this.intersectionTest(c,d,s,o)}aabbQuery(i,s,o){o===void 0&&(o=[]);for(let a=0;a<i.bodies.length;a++){const l=i.bodies[a];l.aabbNeedsUpdate&&l.updateAABB(),l.aabb.overlaps(s)&&o.push(l)}return o}}class mn{constructor(){this.rayFromWorld=new u,this.rayToWorld=new u,this.hitNormalWorld=new u,this.hitPointWorld=new u,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(i,s,o,a,l,c,d){this.rayFromWorld.copy(i),this.rayToWorld.copy(s),this.hitNormalWorld.copy(o),this.hitPointWorld.copy(a),this.shape=l,this.body=c,this.distance=d}}let Rs,Is,Fs,Ds,Os,qs,js;const di={CLOSEST:1,ANY:2,ALL:4};Rs=U.types.SPHERE;Is=U.types.PLANE;Fs=U.types.BOX;Ds=U.types.CYLINDER;Os=U.types.CONVEXPOLYHEDRON;qs=U.types.HEIGHTFIELD;js=U.types.TRIMESH;class rt{get[Rs](){return this._intersectSphere}get[Is](){return this._intersectPlane}get[Fs](){return this._intersectBox}get[Ds](){return this._intersectConvex}get[Os](){return this._intersectConvex}get[qs](){return this._intersectHeightfield}get[js](){return this._intersectTrimesh}constructor(i,s){i===void 0&&(i=new u),s===void 0&&(s=new u),this.from=i.clone(),this.to=s.clone(),this.direction=new u,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=rt.ANY,this.result=new mn,this.hasHit=!1,this.callback=o=>{}}intersectWorld(i,s){return this.mode=s.mode||rt.ANY,this.result=s.result||new mn,this.skipBackfaces=!!s.skipBackfaces,this.collisionFilterMask=typeof s.collisionFilterMask!="undefined"?s.collisionFilterMask:-1,this.collisionFilterGroup=typeof s.collisionFilterGroup!="undefined"?s.collisionFilterGroup:-1,this.checkCollisionResponse=typeof s.checkCollisionResponse!="undefined"?s.checkCollisionResponse:!0,s.from&&this.from.copy(s.from),s.to&&this.to.copy(s.to),this.callback=s.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(gs),ii.length=0,i.broadphase.aabbQuery(i,gs,ii),this.intersectBodies(ii),this.hasHit}intersectBody(i,s){s&&(this.result=s,this.updateDirection());const o=this.checkCollisionResponse;if(o&&!i.collisionResponse||(this.collisionFilterGroup&i.collisionFilterMask)===0||(i.collisionFilterGroup&this.collisionFilterMask)===0)return;const a=sc,l=oc;for(let c=0,d=i.shapes.length;c<d;c++){const p=i.shapes[c];if(!(o&&!p.collisionResponse)&&(i.quaternion.mult(i.shapeOrientations[c],l),i.quaternion.vmult(i.shapeOffsets[c],a),a.vadd(i.position,a),this.intersectShape(p,l,a,i),this.result.shouldStop))break}}intersectBodies(i,s){s&&(this.result=s,this.updateDirection());for(let o=0,a=i.length;!this.result.shouldStop&&o<a;o++)this.intersectBody(i[o])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(i,s,o,a){const l=this.from;if(gc(l,this.direction,o)>i.boundingSphereRadius)return;const d=this[i.type];d&&d.call(this,i,s,o,a,i)}_intersectBox(i,s,o,a,l){return this._intersectConvex(i.convexPolyhedronRepresentation,s,o,a,l)}_intersectPlane(i,s,o,a,l){const c=this.from,d=this.to,p=this.direction,v=new u(0,0,1);s.vmult(v,v);const m=new u;c.vsub(o,m);const w=m.dot(v);d.vsub(o,m);const f=m.dot(v);if(w*f>0||c.distanceTo(d)<w)return;const b=v.dot(p);if(Math.abs(b)<this.precision)return;const g=new u,C=new u,y=new u;c.vsub(o,g);const P=-v.dot(g)/b;p.scale(P,C),c.vadd(C,y),this.reportIntersection(v,y,l,a,-1)}getAABB(i){const{lowerBound:s,upperBound:o}=i,a=this.to,l=this.from;s.x=Math.min(a.x,l.x),s.y=Math.min(a.y,l.y),s.z=Math.min(a.z,l.z),o.x=Math.max(a.x,l.x),o.y=Math.max(a.y,l.y),o.z=Math.max(a.z,l.z)}_intersectHeightfield(i,s,o,a,l){i.data,i.elementSize;const c=rc;c.from.copy(this.from),c.to.copy(this.to),et.pointToLocalFrame(o,s,c.from,c.from),et.pointToLocalFrame(o,s,c.to,c.to),c.updateDirection();const d=ac;let p,v,m,w;p=v=0,m=w=i.data.length-1;const f=new mt;c.getAABB(f),i.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,d,!0),p=Math.max(p,d[0]),v=Math.max(v,d[1]),i.getIndexOfPosition(f.upperBound.x,f.upperBound.y,d,!0),m=Math.min(m,d[0]+1),w=Math.min(w,d[1]+1);for(let b=p;b<m;b++)for(let g=v;g<w;g++){if(this.result.shouldStop)return;if(i.getAabbAtIndex(b,g,f),!!f.overlapsRay(c)){if(i.getConvexTrianglePillar(b,g,!1),et.pointToWorldFrame(o,s,i.pillarOffset,dn),this._intersectConvex(i.pillarConvex,s,dn,a,l,_s),this.result.shouldStop)return;i.getConvexTrianglePillar(b,g,!0),et.pointToWorldFrame(o,s,i.pillarOffset,dn),this._intersectConvex(i.pillarConvex,s,dn,a,l,_s)}}}_intersectSphere(i,s,o,a,l){const c=this.from,d=this.to,p=i.radius,v=(d.x-c.x)**2+(d.y-c.y)**2+(d.z-c.z)**2,m=2*((d.x-c.x)*(c.x-o.x)+(d.y-c.y)*(c.y-o.y)+(d.z-c.z)*(c.z-o.z)),w=(c.x-o.x)**2+(c.y-o.y)**2+(c.z-o.z)**2-p**2,f=m**2-4*v*w,b=lc,g=cc;if(!(f<0))if(f===0)c.lerp(d,f,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1);else{const C=(-m-Math.sqrt(f))/(2*v),y=(-m+Math.sqrt(f))/(2*v);if(C>=0&&C<=1&&(c.lerp(d,C,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1)),this.result.shouldStop)return;y>=0&&y<=1&&(c.lerp(d,y,b),b.vsub(o,g),g.normalize(),this.reportIntersection(g,b,l,a,-1))}}_intersectConvex(i,s,o,a,l,c){const d=dc,p=ys,v=c&&c.faceList||null,m=i.faces,w=i.vertices,f=i.faceNormals,b=this.direction,g=this.from,C=this.to,y=g.distanceTo(C),P=v?v.length:m.length,_=this.result;for(let M=0;!_.shouldStop&&M<P;M++){const S=v?v[M]:M,A=m[S],V=f[S],I=s,F=o;p.copy(w[A[0]]),I.vmult(p,p),p.vadd(F,p),p.vsub(g,p),I.vmult(V,d);const H=b.dot(d);if(Math.abs(H)<this.precision)continue;const z=d.dot(p)/H;if(!(z<0)){b.scale(z,ut),ut.vadd(g,ut),xt.copy(w[A[0]]),I.vmult(xt,xt),F.vadd(xt,xt);for(let L=1;!_.shouldStop&&L<A.length-1;L++){At.copy(w[A[L]]),Mt.copy(w[A[L+1]]),I.vmult(At,At),I.vmult(Mt,Mt),F.vadd(At,At),F.vadd(Mt,Mt);const q=ut.distanceTo(g);!(rt.pointInTriangle(ut,xt,At,Mt)||rt.pointInTriangle(ut,At,xt,Mt))||q>y||this.reportIntersection(d,ut,l,a,S)}}}}_intersectTrimesh(i,s,o,a,l,c){const d=hc,p=bc,v=wc,m=ys,w=pc,f=uc,b=vc,g=fc,C=mc,y=i.indices;i.vertices;const P=this.from,_=this.to,M=this.direction;v.position.copy(o),v.quaternion.copy(s),et.vectorToLocalFrame(o,s,M,w),et.pointToLocalFrame(o,s,P,f),et.pointToLocalFrame(o,s,_,b),b.x*=i.scale.x,b.y*=i.scale.y,b.z*=i.scale.z,f.x*=i.scale.x,f.y*=i.scale.y,f.z*=i.scale.z,b.vsub(f,w),w.normalize();const S=f.distanceSquared(b);i.tree.rayQuery(this,v,p);for(let A=0,V=p.length;!this.result.shouldStop&&A!==V;A++){const I=p[A];i.getNormal(I,d),i.getVertex(y[I*3],xt),xt.vsub(f,m);const F=w.dot(d),H=d.dot(m)/F;if(H<0)continue;w.scale(H,ut),ut.vadd(f,ut),i.getVertex(y[I*3+1],At),i.getVertex(y[I*3+2],Mt);const z=ut.distanceSquared(f);!(rt.pointInTriangle(ut,At,xt,Mt)||rt.pointInTriangle(ut,xt,At,Mt))||z>S||(et.vectorToWorldFrame(s,d,C),et.pointToWorldFrame(o,s,ut,g),this.reportIntersection(C,g,l,a,I))}p.length=0}reportIntersection(i,s,o,a,l){const c=this.from,d=this.to,p=c.distanceTo(s),v=this.result;if(!(this.skipBackfaces&&i.dot(this.direction)>0))switch(v.hitFaceIndex=typeof l!="undefined"?l:-1,this.mode){case rt.ALL:this.hasHit=!0,v.set(c,d,i,s,o,a,p),v.hasHit=!0,this.callback(v);break;case rt.CLOSEST:(p<v.distance||!v.hasHit)&&(this.hasHit=!0,v.hasHit=!0,v.set(c,d,i,s,o,a,p));break;case rt.ANY:this.hasHit=!0,v.hasHit=!0,v.set(c,d,i,s,o,a,p),v.shouldStop=!0;break}}static pointInTriangle(i,s,o,a){a.vsub(s,se),o.vsub(s,De),i.vsub(s,si);const l=se.dot(se),c=se.dot(De),d=se.dot(si),p=De.dot(De),v=De.dot(si);let m,w;return(m=p*d-c*v)>=0&&(w=l*v-c*d)>=0&&m+w<l*p-c*c}}rt.CLOSEST=di.CLOSEST;rt.ANY=di.ANY;rt.ALL=di.ALL;const gs=new mt,ii=[],De=new u,si=new u,sc=new u,oc=new at,ut=new u,xt=new u,At=new u,Mt=new u;new u;new mn;const _s={faceList:[0]},dn=new u,rc=new rt,ac=[],lc=new u,cc=new u,dc=new u;new u;new u;const ys=new u,hc=new u,pc=new u,uc=new u,vc=new u,mc=new u,fc=new u;new mt;const bc=[],wc=new et,se=new u,hn=new u;function gc(T,i,s){s.vsub(T,se);const o=se.dot(i);return i.scale(o,hn),hn.vadd(T,hn),s.distanceTo(hn)}class _c{static defaults(i,s){i===void 0&&(i={});for(let o in s)o in i||(i[o]=s[o]);return i}}class xs{constructor(){this.spatial=new u,this.rotational=new u}multiplyElement(i){return i.spatial.dot(this.spatial)+i.rotational.dot(this.rotational)}multiplyVectors(i,s){return i.dot(this.spatial)+s.dot(this.rotational)}}class He{constructor(i,s,o,a){o===void 0&&(o=-1e6),a===void 0&&(a=1e6),this.id=He.idCounter++,this.minForce=o,this.maxForce=a,this.bi=i,this.bj=s,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new xs,this.jacobianElementB=new xs,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}setSpookParams(i,s,o){const a=s,l=i,c=o;this.a=4/(c*(1+4*a)),this.b=4*a/(1+4*a),this.eps=4/(c*c*l*(1+4*a))}computeB(i,s,o){const a=this.computeGW(),l=this.computeGq(),c=this.computeGiMf();return-l*i-a*s-c*o}computeGq(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.position,c=a.position;return i.spatial.dot(l)+s.spatial.dot(c)}computeGW(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.velocity,c=a.velocity,d=o.angularVelocity,p=a.angularVelocity;return i.multiplyVectors(l,d)+s.multiplyVectors(c,p)}computeGWlambda(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.vlambda,c=a.vlambda,d=o.wlambda,p=a.wlambda;return i.multiplyVectors(l,d)+s.multiplyVectors(c,p)}computeGiMf(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.force,c=o.torque,d=a.force,p=a.torque,v=o.invMassSolve,m=a.invMassSolve;return l.scale(v,Cs),d.scale(m,Es),o.invInertiaWorldSolve.vmult(c,Ps),a.invInertiaWorldSolve.vmult(p,ks),i.multiplyVectors(Cs,Ps)+s.multiplyVectors(Es,ks)}computeGiMGt(){const i=this.jacobianElementA,s=this.jacobianElementB,o=this.bi,a=this.bj,l=o.invMassSolve,c=a.invMassSolve,d=o.invInertiaWorldSolve,p=a.invInertiaWorldSolve;let v=l+c;return d.vmult(i.rotational,pn),v+=pn.dot(i.rotational),p.vmult(s.rotational,pn),v+=pn.dot(s.rotational),v}addToWlambda(i){const s=this.jacobianElementA,o=this.jacobianElementB,a=this.bi,l=this.bj,c=yc;a.vlambda.addScaledVector(a.invMassSolve*i,s.spatial,a.vlambda),l.vlambda.addScaledVector(l.invMassSolve*i,o.spatial,l.vlambda),a.invInertiaWorldSolve.vmult(s.rotational,c),a.wlambda.addScaledVector(i,c,a.wlambda),l.invInertiaWorldSolve.vmult(o.rotational,c),l.wlambda.addScaledVector(i,c,l.wlambda)}computeC(){return this.computeGiMGt()+this.eps}}He.idCounter=0;const Cs=new u,Es=new u,Ps=new u,ks=new u,pn=new u,yc=new u;class xc extends He{constructor(i,s,o){o===void 0&&(o=1e6);super(i,s,0,o);this.restitution=0,this.ri=new u,this.rj=new u,this.ni=new u}computeB(i){const s=this.a,o=this.b,a=this.bi,l=this.bj,c=this.ri,d=this.rj,p=Cc,v=Ec,m=a.velocity,w=a.angularVelocity;a.force,a.torque;const f=l.velocity,b=l.angularVelocity;l.force,l.torque;const g=Pc,C=this.jacobianElementA,y=this.jacobianElementB,P=this.ni;c.cross(P,p),d.cross(P,v),P.negate(C.spatial),p.negate(C.rotational),y.spatial.copy(P),y.rotational.copy(v),g.copy(l.position),g.vadd(d,g),g.vsub(a.position,g),g.vsub(c,g);const _=P.dot(g),M=this.restitution+1,S=M*f.dot(P)-M*m.dot(P)+b.dot(v)-w.dot(p),A=this.computeGiMf();return-_*s-S*o-i*A}getImpactVelocityAlongNormal(){const i=kc,s=Sc,o=Ac,a=Mc,l=Vc;return this.bi.position.vadd(this.ri,o),this.bj.position.vadd(this.rj,a),this.bi.getVelocityAtWorldPoint(o,i),this.bj.getVelocityAtWorldPoint(a,s),i.vsub(s,l),this.ni.dot(l)}}const Cc=new u,Ec=new u,Pc=new u,kc=new u,Sc=new u,Ac=new u,Mc=new u,Vc=new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;class Ss extends He{constructor(i,s,o){super(i,s,-o,o);this.ri=new u,this.rj=new u,this.t=new u}computeB(i){this.a;const s=this.b;this.bi,this.bj;const o=this.ri,a=this.rj,l=Bc,c=Lc,d=this.t;o.cross(d,l),a.cross(d,c);const p=this.jacobianElementA,v=this.jacobianElementB;d.negate(p.spatial),l.negate(p.rotational),v.spatial.copy(d),v.rotational.copy(c);const m=this.computeGW(),w=this.computeGiMf();return-m*s-i*w}}const Bc=new u,Lc=new u;class Ge{constructor(i,s,o){o=_c.defaults(o,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=Ge.idCounter++,this.materials=[i,s],this.friction=o.friction,this.restitution=o.restitution,this.contactEquationStiffness=o.contactEquationStiffness,this.contactEquationRelaxation=o.contactEquationRelaxation,this.frictionEquationStiffness=o.frictionEquationStiffness,this.frictionEquationRelaxation=o.frictionEquationRelaxation}}Ge.idCounter=0;class Ke{constructor(i){i===void 0&&(i={});let s="";typeof i=="string"&&(s=i,i={}),this.name=s,this.id=Ke.idCounter++,this.friction=typeof i.friction!="undefined"?i.friction:-1,this.restitution=typeof i.restitution!="undefined"?i.restitution:-1}}Ke.idCounter=0;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new rt;new u;new u;new u;new u(1,0,0),new u(0,1,0),new u(0,0,1);new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;class Nc extends ge{constructor(i,s,o,a){if(i===void 0&&(i=1),s===void 0&&(s=1),o===void 0&&(o=1),a===void 0&&(a=8),i<0)throw new Error("The cylinder radiusTop cannot be negative.");if(s<0)throw new Error("The cylinder radiusBottom cannot be negative.");const l=a,c=[],d=[],p=[],v=[],m=[],w=Math.cos,f=Math.sin;c.push(new u(-s*f(0),-o*.5,s*w(0))),v.push(0),c.push(new u(-i*f(0),o*.5,i*w(0))),m.push(1);for(let g=0;g<l;g++){const C=2*Math.PI/l*(g+1),y=2*Math.PI/l*(g+.5);g<l-1?(c.push(new u(-s*f(C),-o*.5,s*w(C))),v.push(2*g+2),c.push(new u(-i*f(C),o*.5,i*w(C))),m.push(2*g+3),p.push([2*g,2*g+1,2*g+3,2*g+2])):p.push([2*g,2*g+1,1,0]),(l%2===1||g<l/2)&&d.push(new u(-f(y),0,w(y)))}p.push(v),d.push(new u(0,1,0));const b=[];for(let g=0;g<m.length;g++)b.push(m[m.length-g-1]);p.push(b);super({vertices:c,faces:p,axes:d});this.type=U.types.CYLINDER,this.radiusTop=i,this.radiusBottom=s,this.height=o,this.numSegments=a}}class Tc extends U{constructor(){super({type:U.types.PLANE});this.worldNormal=new u,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}computeWorldNormal(i){const s=this.worldNormal;s.set(0,0,1),i.vmult(s,s),this.worldNormalNeedsUpdate=!1}calculateLocalInertia(i,s){return s===void 0&&(s=new u),s}volume(){return Number.MAX_VALUE}calculateWorldAABB(i,s,o,a){Tt.set(0,0,1),s.vmult(Tt,Tt);const l=Number.MAX_VALUE;o.set(-l,-l,-l),a.set(l,l,l),Tt.x===1?a.x=i.x:Tt.x===-1&&(o.x=i.x),Tt.y===1?a.y=i.y:Tt.y===-1&&(o.y=i.y),Tt.z===1?a.z=i.z:Tt.z===-1&&(o.z=i.z)}updateBoundingSphereRadius(){this.boundingSphereRadius=Number.MAX_VALUE}}const Tt=new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new u;new mt;new u;new mt;new u;new u;new u;new u;new u;new u;new u;new mt;new u;new et;new mt;class zc{constructor(){this.equations=[]}solve(i,s){return 0}addEquation(i){i.enabled&&!i.bi.isTrigger&&!i.bj.isTrigger&&this.equations.push(i)}removeEquation(i){const s=this.equations,o=s.indexOf(i);o!==-1&&s.splice(o,1)}removeAllEquations(){this.equations.length=0}}class Rc extends zc{constructor(){super();this.iterations=10,this.tolerance=1e-7}solve(i,s){let o=0;const a=this.iterations,l=this.tolerance*this.tolerance,c=this.equations,d=c.length,p=s.bodies,v=p.length,m=i;let w,f,b,g,C,y;if(d!==0)for(let S=0;S!==v;S++)p[S].updateSolveMassProperties();const P=Fc,_=Dc,M=Ic;P.length=d,_.length=d,M.length=d;for(let S=0;S!==d;S++){const A=c[S];M[S]=0,_[S]=A.computeB(m),P[S]=1/A.computeC()}if(d!==0){for(let V=0;V!==v;V++){const I=p[V],F=I.vlambda,H=I.wlambda;F.set(0,0,0),H.set(0,0,0)}for(o=0;o!==a;o++){g=0;for(let V=0;V!==d;V++){const I=c[V];w=_[V],f=P[V],y=M[V],C=I.computeGWlambda(),b=f*(w-C-I.eps*y),y+b<I.minForce?b=I.minForce-y:y+b>I.maxForce&&(b=I.maxForce-y),M[V]+=b,g+=b>0?b:-b,I.addToWlambda(b)}if(g*g<l)break}for(let V=0;V!==v;V++){const I=p[V],F=I.velocity,H=I.angularVelocity;I.vlambda.vmul(I.linearFactor,I.vlambda),F.vadd(I.vlambda,F),I.wlambda.vmul(I.angularFactor,I.wlambda),H.vadd(I.wlambda,H)}let S=c.length;const A=1/m;for(;S--;)c[S].multiplier=M[S]*A}return o}}const Ic=[],Fc=[],Dc=[];class Oc{constructor(){this.objects=[],this.type=Object}release(){const i=arguments.length;for(let s=0;s!==i;s++)this.objects.push(s<0||arguments.length<=s?void 0:arguments[s]);return this}get(){return this.objects.length===0?this.constructObject():this.objects.pop()}constructObject(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}resize(i){const s=this.objects;for(;s.length>i;)s.pop();for(;s.length<i;)s.push(this.constructObject());return this}}class qc extends Oc{constructor(){super(...arguments);this.type=u}constructObject(){return new u}}const st={sphereSphere:U.types.SPHERE,spherePlane:U.types.SPHERE|U.types.PLANE,boxBox:U.types.BOX|U.types.BOX,sphereBox:U.types.SPHERE|U.types.BOX,planeBox:U.types.PLANE|U.types.BOX,convexConvex:U.types.CONVEXPOLYHEDRON,sphereConvex:U.types.SPHERE|U.types.CONVEXPOLYHEDRON,planeConvex:U.types.PLANE|U.types.CONVEXPOLYHEDRON,boxConvex:U.types.BOX|U.types.CONVEXPOLYHEDRON,sphereHeightfield:U.types.SPHERE|U.types.HEIGHTFIELD,boxHeightfield:U.types.BOX|U.types.HEIGHTFIELD,convexHeightfield:U.types.CONVEXPOLYHEDRON|U.types.HEIGHTFIELD,sphereParticle:U.types.PARTICLE|U.types.SPHERE,planeParticle:U.types.PLANE|U.types.PARTICLE,boxParticle:U.types.BOX|U.types.PARTICLE,convexParticle:U.types.PARTICLE|U.types.CONVEXPOLYHEDRON,cylinderCylinder:U.types.CYLINDER,sphereCylinder:U.types.SPHERE|U.types.CYLINDER,planeCylinder:U.types.PLANE|U.types.CYLINDER,boxCylinder:U.types.BOX|U.types.CYLINDER,convexCylinder:U.types.CONVEXPOLYHEDRON|U.types.CYLINDER,heightfieldCylinder:U.types.HEIGHTFIELD|U.types.CYLINDER,particleCylinder:U.types.PARTICLE|U.types.CYLINDER,sphereTrimesh:U.types.SPHERE|U.types.TRIMESH,planeTrimesh:U.types.PLANE|U.types.TRIMESH};class jc{get[st.sphereSphere](){return this.sphereSphere}get[st.spherePlane](){return this.spherePlane}get[st.boxBox](){return this.boxBox}get[st.sphereBox](){return this.sphereBox}get[st.planeBox](){return this.planeBox}get[st.convexConvex](){return this.convexConvex}get[st.sphereConvex](){return this.sphereConvex}get[st.planeConvex](){return this.planeConvex}get[st.boxConvex](){return this.boxConvex}get[st.sphereHeightfield](){return this.sphereHeightfield}get[st.boxHeightfield](){return this.boxHeightfield}get[st.convexHeightfield](){return this.convexHeightfield}get[st.sphereParticle](){return this.sphereParticle}get[st.planeParticle](){return this.planeParticle}get[st.boxParticle](){return this.boxParticle}get[st.convexParticle](){return this.convexParticle}get[st.cylinderCylinder](){return this.convexConvex}get[st.sphereCylinder](){return this.sphereConvex}get[st.planeCylinder](){return this.planeConvex}get[st.boxCylinder](){return this.boxConvex}get[st.convexCylinder](){return this.convexConvex}get[st.heightfieldCylinder](){return this.heightfieldCylinder}get[st.particleCylinder](){return this.particleCylinder}get[st.sphereTrimesh](){return this.sphereTrimesh}get[st.planeTrimesh](){return this.planeTrimesh}constructor(i){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new qc,this.world=i,this.currentContactMaterial=i.defaultContactMaterial,this.enableFrictionReduction=!1}createContactEquation(i,s,o,a,l,c){let d;this.contactPointPool.length?(d=this.contactPointPool.pop(),d.bi=i,d.bj=s):d=new xc(i,s),d.enabled=i.collisionResponse&&s.collisionResponse&&o.collisionResponse&&a.collisionResponse;const p=this.currentContactMaterial;d.restitution=p.restitution,d.setSpookParams(p.contactEquationStiffness,p.contactEquationRelaxation,this.world.dt);const v=o.material||i.material,m=a.material||s.material;return v&&m&&v.restitution>=0&&m.restitution>=0&&(d.restitution=v.restitution*m.restitution),d.si=l||o,d.sj=c||a,d}createFrictionEquationsFromContact(i,s){const o=i.bi,a=i.bj,l=i.si,c=i.sj,d=this.world,p=this.currentContactMaterial;let v=p.friction;const m=l.material||o.material,w=c.material||a.material;if(m&&w&&m.friction>=0&&w.friction>=0&&(v=m.friction*w.friction),v>0){const f=v*d.gravity.length();let b=o.invMass+a.invMass;b>0&&(b=1/b);const g=this.frictionEquationPool,C=g.length?g.pop():new Ss(o,a,f*b),y=g.length?g.pop():new Ss(o,a,f*b);return C.bi=y.bi=o,C.bj=y.bj=a,C.minForce=y.minForce=-f*b,C.maxForce=y.maxForce=f*b,C.ri.copy(i.ri),C.rj.copy(i.rj),y.ri.copy(i.ri),y.rj.copy(i.rj),i.ni.tangents(C.t,y.t),C.setSpookParams(p.frictionEquationStiffness,p.frictionEquationRelaxation,d.dt),y.setSpookParams(p.frictionEquationStiffness,p.frictionEquationRelaxation,d.dt),C.enabled=y.enabled=i.enabled,s.push(C,y),!0}return!1}createFrictionFromAverage(i){let s=this.result[this.result.length-1];if(!this.createFrictionEquationsFromContact(s,this.frictionResult)||i===1)return;const o=this.frictionResult[this.frictionResult.length-2],a=this.frictionResult[this.frictionResult.length-1];ie.setZero(),fe.setZero(),be.setZero();const l=s.bi;s.bj;for(let d=0;d!==i;d++)s=this.result[this.result.length-1-d],s.bi!==l?(ie.vadd(s.ni,ie),fe.vadd(s.ri,fe),be.vadd(s.rj,be)):(ie.vsub(s.ni,ie),fe.vadd(s.rj,fe),be.vadd(s.ri,be));const c=1/i;fe.scale(c,o.ri),be.scale(c,o.rj),a.ri.copy(o.ri),a.rj.copy(o.rj),ie.normalize(),ie.tangents(o.t,a.t)}getContacts(i,s,o,a,l,c,d){this.contactPointPool=l,this.frictionEquationPool=d,this.result=a,this.frictionResult=c;const p=Gc,v=Kc,m=Uc,w=Hc;for(let f=0,b=i.length;f!==b;f++){const g=i[f],C=s[f];let y=null;g.material&&C.material&&(y=o.getContactMaterial(g.material,C.material)||null);const P=g.type&j.KINEMATIC&&C.type&j.STATIC||g.type&j.STATIC&&C.type&j.KINEMATIC||g.type&j.KINEMATIC&&C.type&j.KINEMATIC;for(let _=0;_<g.shapes.length;_++){g.quaternion.mult(g.shapeOrientations[_],p),g.quaternion.vmult(g.shapeOffsets[_],m),m.vadd(g.position,m);const M=g.shapes[_];for(let S=0;S<C.shapes.length;S++){C.quaternion.mult(C.shapeOrientations[S],v),C.quaternion.vmult(C.shapeOffsets[S],w),w.vadd(C.position,w);const A=C.shapes[S];if(!(M.collisionFilterMask&A.collisionFilterGroup&&A.collisionFilterMask&M.collisionFilterGroup)||m.distanceTo(w)>M.boundingSphereRadius+A.boundingSphereRadius)continue;let V=null;M.material&&A.material&&(V=o.getContactMaterial(M.material,A.material)||null),this.currentContactMaterial=V||y||o.defaultContactMaterial;const I=M.type|A.type,F=this[I];if(F){let H=!1;M.type<A.type?H=F.call(this,M,A,m,w,p,v,g,C,M,A,P):H=F.call(this,A,M,w,m,v,p,C,g,M,A,P),H&&P&&(o.shapeOverlapKeeper.set(M.id,A.id),o.bodyOverlapKeeper.set(g.id,C.id))}}}}}sphereSphere(i,s,o,a,l,c,d,p,v,m,w){if(w)return o.distanceSquared(a)<(i.radius+s.radius)**2;const f=this.createContactEquation(d,p,i,s,v,m);a.vsub(o,f.ni),f.ni.normalize(),f.ri.copy(f.ni),f.rj.copy(f.ni),f.ri.scale(i.radius,f.ri),f.rj.scale(-s.radius,f.rj),f.ri.vadd(o,f.ri),f.ri.vsub(d.position,f.ri),f.rj.vadd(a,f.rj),f.rj.vsub(p.position,f.rj),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}spherePlane(i,s,o,a,l,c,d,p,v,m,w){const f=this.createContactEquation(d,p,i,s,v,m);if(f.ni.set(0,0,1),c.vmult(f.ni,f.ni),f.ni.negate(f.ni),f.ni.normalize(),f.ni.scale(i.radius,f.ri),o.vsub(a,un),f.ni.scale(f.ni.dot(un),As),un.vsub(As,f.rj),-un.dot(f.ni)<=i.radius){if(w)return!0;const b=f.ri,g=f.rj;b.vadd(o,b),b.vsub(d.position,b),g.vadd(a,g),g.vsub(p.position,g),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}}boxBox(i,s,o,a,l,c,d,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,s.convexPolyhedronRepresentation.material=s.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,s.convexPolyhedronRepresentation.collisionResponse=s.collisionResponse,this.convexConvex(i.convexPolyhedronRepresentation,s.convexPolyhedronRepresentation,o,a,l,c,d,p,i,s,w)}sphereBox(i,s,o,a,l,c,d,p,v,m,w){const f=this.v3pool,b=wd;o.vsub(a,vn),s.getSideNormals(b,c);const g=i.radius;let C=!1;const y=_d,P=yd,_=xd;let M=null,S=0,A=0,V=0,I=null;for(let k=0,X=b.length;k!==X&&C===!1;k++){const K=md;K.copy(b[k]);const $=K.length();K.normalize();const Y=vn.dot(K);if(Y<$+g&&Y>0){const nt=fd,O=bd;nt.copy(b[(k+1)%3]),O.copy(b[(k+2)%3]);const J=nt.length(),Et=O.length();nt.normalize(),O.normalize();const oe=vn.dot(nt),Dt=vn.dot(O);if(oe<J&&oe>-J&&Dt<Et&&Dt>-Et){const dt=Math.abs(Y-$-g);if((I===null||dt<I)&&(I=dt,A=oe,V=Dt,M=$,y.copy(K),P.copy(nt),_.copy(O),S++,w))return!0}}}if(S){C=!0;const k=this.createContactEquation(d,p,i,s,v,m);y.scale(-g,k.ri),k.ni.copy(y),k.ni.negate(k.ni),y.scale(M,y),P.scale(A,P),y.vadd(P,y),_.scale(V,_),y.vadd(_,k.rj),k.ri.vadd(o,k.ri),k.ri.vsub(d.position,k.ri),k.rj.vadd(a,k.rj),k.rj.vsub(p.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}let F=f.get();const H=gd;for(let k=0;k!==2&&!C;k++)for(let X=0;X!==2&&!C;X++)for(let K=0;K!==2&&!C;K++)if(F.set(0,0,0),k?F.vadd(b[0],F):F.vsub(b[0],F),X?F.vadd(b[1],F):F.vsub(b[1],F),K?F.vadd(b[2],F):F.vsub(b[2],F),a.vadd(F,H),H.vsub(o,H),H.lengthSquared()<g*g){if(w)return!0;C=!0;const $=this.createContactEquation(d,p,i,s,v,m);$.ri.copy(H),$.ri.normalize(),$.ni.copy($.ri),$.ri.scale(g,$.ri),$.rj.copy(F),$.ri.vadd(o,$.ri),$.ri.vsub(d.position,$.ri),$.rj.vadd(a,$.rj),$.rj.vsub(p.position,$.rj),this.result.push($),this.createFrictionEquationsFromContact($,this.frictionResult)}f.release(F),F=null;const z=f.get(),L=f.get(),q=f.get(),B=f.get(),R=f.get(),N=b.length;for(let k=0;k!==N&&!C;k++)for(let X=0;X!==N&&!C;X++)if(k%3!==X%3){b[X].cross(b[k],z),z.normalize(),b[k].vadd(b[X],L),q.copy(o),q.vsub(L,q),q.vsub(a,q);const K=q.dot(z);z.scale(K,B);let $=0;for(;$===k%3||$===X%3;)$++;R.copy(o),R.vsub(B,R),R.vsub(L,R),R.vsub(a,R);const Y=Math.abs(K),nt=R.length();if(Y<b[$].length()&&nt<g){if(w)return!0;C=!0;const O=this.createContactEquation(d,p,i,s,v,m);L.vadd(B,O.rj),O.rj.copy(O.rj),R.negate(O.ni),O.ni.normalize(),O.ri.copy(O.rj),O.ri.vadd(a,O.ri),O.ri.vsub(o,O.ri),O.ri.normalize(),O.ri.scale(g,O.ri),O.ri.vadd(o,O.ri),O.ri.vsub(d.position,O.ri),O.rj.vadd(a,O.rj),O.rj.vsub(p.position,O.rj),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult)}}f.release(z,L,q,B,R)}planeBox(i,s,o,a,l,c,d,p,v,m,w){return s.convexPolyhedronRepresentation.material=s.material,s.convexPolyhedronRepresentation.collisionResponse=s.collisionResponse,s.convexPolyhedronRepresentation.id=s.id,this.planeConvex(i,s.convexPolyhedronRepresentation,o,a,l,c,d,p,i,s,w)}convexConvex(i,s,o,a,l,c,d,p,v,m,w,f,b){const g=Id;if(!(o.distanceTo(a)>i.boundingSphereRadius+s.boundingSphereRadius)&&i.findSeparatingAxis(s,o,l,a,c,g,f,b)){const C=[],y=Fd;i.clipAgainstHull(o,l,s,a,c,g,-100,100,C);let P=0;for(let _=0;_!==C.length;_++){if(w)return!0;const M=this.createContactEquation(d,p,i,s,v,m),S=M.ri,A=M.rj;g.negate(M.ni),C[_].normal.negate(y),y.scale(C[_].depth,y),C[_].point.vadd(y,S),A.copy(C[_].point),S.vsub(o,S),A.vsub(a,A),S.vadd(o,S),S.vsub(d.position,S),A.vadd(a,A),A.vsub(p.position,A),this.result.push(M),P++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(M,this.frictionResult)}this.enableFrictionReduction&&P&&this.createFrictionFromAverage(P)}}sphereConvex(i,s,o,a,l,c,d,p,v,m,w){const f=this.v3pool;o.vsub(a,Cd);const b=s.faceNormals,g=s.faces,C=s.vertices,y=i.radius;let P=!1;for(let _=0;_!==C.length;_++){const M=C[_],S=Sd;c.vmult(M,S),a.vadd(S,S);const A=kd;if(S.vsub(o,A),A.lengthSquared()<y*y){if(w)return!0;P=!0;const V=this.createContactEquation(d,p,i,s,v,m);V.ri.copy(A),V.ri.normalize(),V.ni.copy(V.ri),V.ri.scale(y,V.ri),S.vsub(a,V.rj),V.ri.vadd(o,V.ri),V.ri.vsub(d.position,V.ri),V.rj.vadd(a,V.rj),V.rj.vsub(p.position,V.rj),this.result.push(V),this.createFrictionEquationsFromContact(V,this.frictionResult);return}}for(let _=0,M=g.length;_!==M&&P===!1;_++){const S=b[_],A=g[_],V=Ad;c.vmult(S,V);const I=Md;c.vmult(C[A[0]],I),I.vadd(a,I);const F=Vd;V.scale(-y,F),o.vadd(F,F);const H=Bd;F.vsub(I,H);const z=H.dot(V),L=Ld;if(o.vsub(I,L),z<0&&L.dot(V)>0){const q=[];for(let B=0,R=A.length;B!==R;B++){const N=f.get();c.vmult(C[A[B]],N),a.vadd(N,N),q.push(N)}if(vd(q,V,o)){if(w)return!0;P=!0;const B=this.createContactEquation(d,p,i,s,v,m);V.scale(-y,B.ri),V.negate(B.ni);const R=f.get();V.scale(-z,R);const N=f.get();V.scale(-y,N),o.vsub(a,B.rj),B.rj.vadd(N,B.rj),B.rj.vadd(R,B.rj),B.rj.vadd(a,B.rj),B.rj.vsub(p.position,B.rj),B.ri.vadd(o,B.ri),B.ri.vsub(d.position,B.ri),f.release(R),f.release(N),this.result.push(B),this.createFrictionEquationsFromContact(B,this.frictionResult);for(let k=0,X=q.length;k!==X;k++)f.release(q[k]);return}else for(let B=0;B!==A.length;B++){const R=f.get(),N=f.get();c.vmult(C[A[(B+1)%A.length]],R),c.vmult(C[A[(B+2)%A.length]],N),a.vadd(R,R),a.vadd(N,N);const k=Ed;N.vsub(R,k);const X=Pd;k.unit(X);const K=f.get(),$=f.get();o.vsub(R,$);const Y=$.dot(X);X.scale(Y,K),K.vadd(R,K);const nt=f.get();if(K.vsub(o,nt),Y>0&&Y*Y<k.lengthSquared()&&nt.lengthSquared()<y*y){if(w)return!0;const O=this.createContactEquation(d,p,i,s,v,m);K.vsub(a,O.rj),K.vsub(o,O.ni),O.ni.normalize(),O.ni.scale(y,O.ri),O.rj.vadd(a,O.rj),O.rj.vsub(p.position,O.rj),O.ri.vadd(o,O.ri),O.ri.vsub(d.position,O.ri),this.result.push(O),this.createFrictionEquationsFromContact(O,this.frictionResult);for(let J=0,Et=q.length;J!==Et;J++)f.release(q[J]);f.release(R),f.release(N),f.release(K),f.release(nt),f.release($);return}f.release(R),f.release(N),f.release(K),f.release(nt),f.release($)}for(let B=0,R=q.length;B!==R;B++)f.release(q[B])}}}planeConvex(i,s,o,a,l,c,d,p,v,m,w){const f=Nd,b=Td;b.set(0,0,1),l.vmult(b,b);let g=0;const C=zd;for(let y=0;y!==s.vertices.length;y++)if(f.copy(s.vertices[y]),c.vmult(f,f),a.vadd(f,f),f.vsub(o,C),b.dot(C)<=0){if(w)return!0;const _=this.createContactEquation(d,p,i,s,v,m),M=Rd;b.scale(b.dot(C),M),f.vsub(M,M),M.vsub(o,_.ri),_.ni.copy(b),f.vsub(a,_.rj),_.ri.vadd(o,_.ri),_.ri.vsub(d.position,_.ri),_.rj.vadd(a,_.rj),_.rj.vsub(p.position,_.rj),this.result.push(_),g++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&g&&this.createFrictionFromAverage(g)}boxConvex(i,s,o,a,l,c,d,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexConvex(i.convexPolyhedronRepresentation,s,o,a,l,c,d,p,i,s,w)}sphereHeightfield(i,s,o,a,l,c,d,p,v,m,w){const f=s.data,b=i.radius,g=s.elementSize,C=Xd,y=Yd;et.pointToLocalFrame(a,c,o,y);let P=Math.floor((y.x-b)/g)-1,_=Math.ceil((y.x+b)/g)+1,M=Math.floor((y.y-b)/g)-1,S=Math.ceil((y.y+b)/g)+1;if(_<0||S<0||P>f.length||M>f[0].length)return;P<0&&(P=0),_<0&&(_=0),M<0&&(M=0),S<0&&(S=0),P>=f.length&&(P=f.length-1),_>=f.length&&(_=f.length-1),S>=f[0].length&&(S=f[0].length-1),M>=f[0].length&&(M=f[0].length-1);const A=[];s.getRectMinMax(P,M,_,S,A);const V=A[0],I=A[1];if(y.z-b>I||y.z+b<V)return;const F=this.result;for(let H=P;H<_;H++)for(let z=M;z<S;z++){const L=F.length;let q=!1;if(s.getConvexTrianglePillar(H,z,!1),et.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(q=this.sphereConvex(i,s.pillarConvex,o,C,l,c,d,p,i,s,w)),w&&q||(s.getConvexTrianglePillar(H,z,!0),et.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(q=this.sphereConvex(i,s.pillarConvex,o,C,l,c,d,p,i,s,w)),w&&q))return!0;if(F.length-L>2)return}}boxHeightfield(i,s,o,a,l,c,d,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexHeightfield(i.convexPolyhedronRepresentation,s,o,a,l,c,d,p,i,s,w)}convexHeightfield(i,s,o,a,l,c,d,p,v,m,w){const f=s.data,b=s.elementSize,g=i.boundingSphereRadius,C=Wd,y=$d,P=Kd;et.pointToLocalFrame(a,c,o,P);let _=Math.floor((P.x-g)/b)-1,M=Math.ceil((P.x+g)/b)+1,S=Math.floor((P.y-g)/b)-1,A=Math.ceil((P.y+g)/b)+1;if(M<0||A<0||_>f.length||S>f[0].length)return;_<0&&(_=0),M<0&&(M=0),S<0&&(S=0),A<0&&(A=0),_>=f.length&&(_=f.length-1),M>=f.length&&(M=f.length-1),A>=f[0].length&&(A=f[0].length-1),S>=f[0].length&&(S=f[0].length-1);const V=[];s.getRectMinMax(_,S,M,A,V);const I=V[0],F=V[1];if(!(P.z-g>F||P.z+g<I))for(let H=_;H<M;H++)for(let z=S;z<A;z++){let L=!1;if(s.getConvexTrianglePillar(H,z,!1),et.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(L=this.convexConvex(i,s.pillarConvex,o,C,l,c,d,p,null,null,w,y,null)),w&&L||(s.getConvexTrianglePillar(H,z,!0),et.pointToWorldFrame(a,c,s.pillarOffset,C),o.distanceTo(C)<s.pillarConvex.boundingSphereRadius+i.boundingSphereRadius&&(L=this.convexConvex(i,s.pillarConvex,o,C,l,c,d,p,null,null,w,y,null)),w&&L))return!0}}sphereParticle(i,s,o,a,l,c,d,p,v,m,w){const f=jd;if(f.set(0,0,1),a.vsub(o,f),f.lengthSquared()<=i.radius*i.radius){if(w)return!0;const g=this.createContactEquation(p,d,s,i,v,m);f.normalize(),g.rj.copy(f),g.rj.scale(i.radius,g.rj),g.ni.copy(f),g.ni.negate(g.ni),g.ri.set(0,0,0),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}}planeParticle(i,s,o,a,l,c,d,p,v,m,w){const f=Dd;f.set(0,0,1),d.quaternion.vmult(f,f);const b=Od;if(a.vsub(d.position,b),f.dot(b)<=0){if(w)return!0;const C=this.createContactEquation(p,d,s,i,v,m);C.ni.copy(f),C.ni.negate(C.ni),C.ri.set(0,0,0);const y=qd;f.scale(f.dot(a),y),a.vsub(y,y),C.rj.copy(y),this.result.push(C),this.createFrictionEquationsFromContact(C,this.frictionResult)}}boxParticle(i,s,o,a,l,c,d,p,v,m,w){return i.convexPolyhedronRepresentation.material=i.material,i.convexPolyhedronRepresentation.collisionResponse=i.collisionResponse,this.convexParticle(i.convexPolyhedronRepresentation,s,o,a,l,c,d,p,i,s,w)}convexParticle(i,s,o,a,l,c,d,p,v,m,w){let f=-1;const b=Hd,g=Gd;let C=null;const y=Ud;if(y.copy(a),y.vsub(o,y),l.conjugate(Ms),Ms.vmult(y,y),i.pointIsInside(y)){i.worldVerticesNeedsUpdate&&i.computeWorldVertices(o,l),i.worldFaceNormalsNeedsUpdate&&i.computeWorldFaceNormals(l);for(let P=0,_=i.faces.length;P!==_;P++){const M=[i.worldVertices[i.faces[P][0]]],S=i.worldFaceNormals[P];a.vsub(M[0],Vs);const A=-S.dot(Vs);if(C===null||Math.abs(A)<Math.abs(C)){if(w)return!0;C=A,f=P,b.copy(S)}}if(f!==-1){const P=this.createContactEquation(p,d,s,i,v,m);b.scale(C,g),g.vadd(a,g),g.vsub(o,g),P.rj.copy(g),b.negate(P.ni),P.ri.set(0,0,0);const _=P.ri,M=P.rj;_.vadd(a,_),_.vsub(p.position,_),M.vadd(o,M),M.vsub(d.position,M),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}}heightfieldCylinder(i,s,o,a,l,c,d,p,v,m,w){return this.convexHeightfield(s,i,a,o,c,l,p,d,v,m,w)}particleCylinder(i,s,o,a,l,c,d,p,v,m,w){return this.convexParticle(s,i,a,o,c,l,p,d,v,m,w)}sphereTrimesh(i,s,o,a,l,c,d,p,v,m,w){const f=td,b=ed,g=nd,C=id,y=sd,P=od,_=cd,M=Qc,S=Zc,A=dd;et.pointToLocalFrame(a,c,o,y);const V=i.radius;_.lowerBound.set(y.x-V,y.y-V,y.z-V),_.upperBound.set(y.x+V,y.y+V,y.z+V),s.getTrianglesInAABB(_,A);const I=Jc,F=i.radius*i.radius;for(let B=0;B<A.length;B++)for(let R=0;R<3;R++)if(s.getVertex(s.indices[A[B]*3+R],I),I.vsub(y,S),S.lengthSquared()<=F){if(M.copy(I),et.pointToWorldFrame(a,c,M,I),I.vsub(o,S),w)return!0;let N=this.createContactEquation(d,p,i,s,v,m);N.ni.copy(S),N.ni.normalize(),N.ri.copy(N.ni),N.ri.scale(i.radius,N.ri),N.ri.vadd(o,N.ri),N.ri.vsub(d.position,N.ri),N.rj.copy(I),N.rj.vsub(p.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}for(let B=0;B<A.length;B++)for(let R=0;R<3;R++){s.getVertex(s.indices[A[B]*3+R],f),s.getVertex(s.indices[A[B]*3+(R+1)%3],b),b.vsub(f,g),y.vsub(b,P);const N=P.dot(g);y.vsub(f,P);let k=P.dot(g);if(k>0&&N<0&&(y.vsub(f,P),C.copy(g),C.normalize(),k=P.dot(C),C.scale(k,P),P.vadd(f,P),P.distanceTo(y)<i.radius)){if(w)return!0;const K=this.createContactEquation(d,p,i,s,v,m);P.vsub(y,K.ni),K.ni.normalize(),K.ni.scale(i.radius,K.ri),K.ri.vadd(o,K.ri),K.ri.vsub(d.position,K.ri),et.pointToWorldFrame(a,c,P,P),P.vsub(p.position,K.rj),et.vectorToWorldFrame(c,K.ni,K.ni),et.vectorToWorldFrame(c,K.ri,K.ri),this.result.push(K),this.createFrictionEquationsFromContact(K,this.frictionResult)}}const H=rd,z=ad,L=ld,q=Xc;for(let B=0,R=A.length;B!==R;B++){s.getTriangleVertices(A[B],H,z,L),s.getNormal(A[B],q),y.vsub(H,P);let N=P.dot(q);if(q.scale(N,P),y.vsub(P,P),N=P.distanceTo(y),rt.pointInTriangle(P,H,z,L)&&N<i.radius){if(w)return!0;let k=this.createContactEquation(d,p,i,s,v,m);P.vsub(y,k.ni),k.ni.normalize(),k.ni.scale(i.radius,k.ri),k.ri.vadd(o,k.ri),k.ri.vsub(d.position,k.ri),et.pointToWorldFrame(a,c,P,P),P.vsub(p.position,k.rj),et.vectorToWorldFrame(c,k.ni,k.ni),et.vectorToWorldFrame(c,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}}A.length=0}planeTrimesh(i,s,o,a,l,c,d,p,v,m,w){const f=new u,b=Wc;b.set(0,0,1),l.vmult(b,b);for(let g=0;g<s.vertices.length/3;g++){s.getVertex(g,f);const C=new u;C.copy(f),et.pointToWorldFrame(a,c,C,f);const y=$c;if(f.vsub(o,y),b.dot(y)<=0){if(w)return!0;const _=this.createContactEquation(d,p,i,s,v,m);_.ni.copy(b);const M=Yc;b.scale(y.dot(b),M),f.vsub(M,M),_.ri.copy(M),_.ri.vsub(d.position,_.ri),_.rj.copy(f),_.rj.vsub(p.position,_.rj),this.result.push(_),this.createFrictionEquationsFromContact(_,this.frictionResult)}}}}const ie=new u,fe=new u,be=new u,Uc=new u,Hc=new u,Gc=new at,Kc=new at,Wc=new u,$c=new u,Yc=new u,Xc=new u,Zc=new u;new u;const Jc=new u,Qc=new u,td=new u,ed=new u,nd=new u,id=new u,sd=new u,od=new u,rd=new u,ad=new u,ld=new u,cd=new mt,dd=[],un=new u,As=new u,hd=new u,pd=new u,ud=new u;function vd(T,i,s){let o=null;const a=T.length;for(let l=0;l!==a;l++){const c=T[l],d=hd;T[(l+1)%a].vsub(c,d);const p=pd;d.cross(i,p);const v=ud;s.vsub(c,v);const m=p.dot(v);if(o===null||m>0&&o===!0||m<=0&&o===!1){o===null&&(o=m>0);continue}else return!1}return!0}const vn=new u,md=new u,fd=new u,bd=new u,wd=[new u,new u,new u,new u,new u,new u],gd=new u,_d=new u,yd=new u,xd=new u,Cd=new u,Ed=new u,Pd=new u,kd=new u,Sd=new u,Ad=new u,Md=new u,Vd=new u,Bd=new u,Ld=new u;new u;new u;const Nd=new u,Td=new u,zd=new u,Rd=new u,Id=new u,Fd=new u,Dd=new u,Od=new u,qd=new u,jd=new u,Ms=new at,Ud=new u;new u;const Hd=new u,Vs=new u,Gd=new u,Kd=new u,Wd=new u,$d=[0],Yd=new u,Xd=new u;class Bs{constructor(){this.current=[],this.previous=[]}getKey(i,s){if(s<i){const o=s;s=i,i=o}return i<<16|s}set(i,s){const o=this.getKey(i,s),a=this.current;let l=0;for(;o>a[l];)l++;if(o!==a[l]){for(let c=a.length-1;c>=l;c--)a[c+1]=a[c];a[l]=o}}tick(){const i=this.current;this.current=this.previous,this.previous=i,this.current.length=0}getDiff(i,s){const o=this.current,a=this.previous,l=o.length,c=a.length;let d=0;for(let p=0;p<l;p++){let v=!1;const m=o[p];for(;m>a[d];)d++;v=m===a[d],v||Ls(i,m)}d=0;for(let p=0;p<c;p++){let v=!1;const m=a[p];for(;m>o[d];)d++;v=o[d]===m,v||Ls(s,m)}}}function Ls(T,i){T.push((i&4294901760)>>16,i&65535)}const oi=(T,i)=>T<i?`${T}-${i}`:`${i}-${T}`;class Zd{constructor(){this.data={keys:[]}}get(i,s){const o=oi(i,s);return this.data[o]}set(i,s,o){const a=oi(i,s);this.get(i,s)||this.data.keys.push(a),this.data[a]=o}delete(i,s){const o=oi(i,s),a=this.data.keys.indexOf(o);a!==-1&&this.data.keys.splice(a,1),delete this.data[o]}reset(){const i=this.data,s=i.keys;for(;s.length>0;){const o=s.pop();delete i[o]}}}class Jd extends zs{constructor(i){i===void 0&&(i={});super();this.dt=-1,this.allowSleep=!!i.allowSleep,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=i.quatNormalizeSkip!==void 0?i.quatNormalizeSkip:0,this.quatNormalizeFast=i.quatNormalizeFast!==void 0?i.quatNormalizeFast:!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new u,i.gravity&&this.gravity.copy(i.gravity),this.broadphase=i.broadphase!==void 0?i.broadphase:new ic,this.bodies=[],this.hasActiveBodies=!1,this.solver=i.solver!==void 0?i.solver:new Rc,this.constraints=[],this.narrowphase=new jc(this),this.collisionMatrix=new bs,this.collisionMatrixPrevious=new bs,this.bodyOverlapKeeper=new Bs,this.shapeOverlapKeeper=new Bs,this.contactmaterials=[],this.contactMaterialTable=new Zd,this.defaultMaterial=new Ke("default"),this.defaultContactMaterial=new Ge(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.accumulator=0,this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.idToBodyMap={},this.broadphase.setWorld(this)}getContactMaterial(i,s){return this.contactMaterialTable.get(i.id,s.id)}collisionMatrixTick(){const i=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=i,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()}addConstraint(i){this.constraints.push(i)}removeConstraint(i){const s=this.constraints.indexOf(i);s!==-1&&this.constraints.splice(s,1)}rayTest(i,s,o){o instanceof mn?this.raycastClosest(i,s,{skipBackfaces:!0},o):this.raycastAll(i,s,{skipBackfaces:!0},o)}raycastAll(i,s,o,a){return o===void 0&&(o={}),o.mode=rt.ALL,o.from=i,o.to=s,o.callback=a,ri.intersectWorld(this,o)}raycastAny(i,s,o,a){return o===void 0&&(o={}),o.mode=rt.ANY,o.from=i,o.to=s,o.result=a,ri.intersectWorld(this,o)}raycastClosest(i,s,o,a){return o===void 0&&(o={}),o.mode=rt.CLOSEST,o.from=i,o.to=s,o.result=a,ri.intersectWorld(this,o)}addBody(i){this.bodies.includes(i)||(i.index=this.bodies.length,this.bodies.push(i),i.world=this,i.initPosition.copy(i.position),i.initVelocity.copy(i.velocity),i.timeLastSleepy=this.time,i instanceof j&&(i.initAngularVelocity.copy(i.angularVelocity),i.initQuaternion.copy(i.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=i,this.idToBodyMap[i.id]=i,this.dispatchEvent(this.addBodyEvent))}removeBody(i){i.world=null;const s=this.bodies.length-1,o=this.bodies,a=o.indexOf(i);if(a!==-1){o.splice(a,1);for(let l=0;l!==o.length;l++)o[l].index=l;this.collisionMatrix.setNumObjects(s),this.removeBodyEvent.body=i,delete this.idToBodyMap[i.id],this.dispatchEvent(this.removeBodyEvent)}}getBodyById(i){return this.idToBodyMap[i]}getShapeById(i){const s=this.bodies;for(let o=0;o<s.length;o++){const a=s[o].shapes;for(let l=0;l<a.length;l++){const c=a[l];if(c.id===i)return c}}return null}addContactMaterial(i){this.contactmaterials.push(i),this.contactMaterialTable.set(i.materials[0].id,i.materials[1].id,i)}removeContactMaterial(i){const s=this.contactmaterials.indexOf(i);s!==-1&&(this.contactmaterials.splice(s,1),this.contactMaterialTable.delete(i.materials[0].id,i.materials[1].id))}fixedStep(i,s){i===void 0&&(i=1/60),s===void 0&&(s=10);const o=lt.now()/1e3;if(!this.lastCallTime)this.step(i,void 0,s);else{const a=o-this.lastCallTime;this.step(i,a,s)}this.lastCallTime=o}step(i,s,o){if(o===void 0&&(o=10),s===void 0)this.internalStep(i),this.time+=i;else{this.accumulator+=s;const a=lt.now();let l=0;for(;this.accumulator>=i&&l<o&&(this.internalStep(i),this.accumulator-=i,l++,!(lt.now()-a>i*1e3)););this.accumulator=this.accumulator%i;const c=this.accumulator/i;for(let d=0;d!==this.bodies.length;d++){const p=this.bodies[d];p.previousPosition.lerp(p.position,c,p.interpolatedPosition),p.previousQuaternion.slerp(p.quaternion,c,p.interpolatedQuaternion),p.previousQuaternion.normalize()}this.time+=s}}internalStep(i){this.dt=i;const s=this.contacts,o=ih,a=sh,l=this.bodies.length,c=this.bodies,d=this.solver,p=this.gravity,v=this.doProfiling,m=this.profile,w=j.DYNAMIC;let f=-1/0;const b=this.constraints,g=nh;p.length();const C=p.x,y=p.y,P=p.z;let _=0;for(v&&(f=lt.now()),_=0;_!==l;_++){const B=c[_];if(B.type===w){const R=B.force,N=B.mass;R.x+=N*C,R.y+=N*y,R.z+=N*P}}for(let B=0,R=this.subsystems.length;B!==R;B++)this.subsystems[B].update();v&&(f=lt.now()),o.length=0,a.length=0,this.broadphase.collisionPairs(this,o,a),v&&(m.broadphase=lt.now()-f);let M=b.length;for(_=0;_!==M;_++){const B=b[_];if(!B.collideConnected)for(let R=o.length-1;R>=0;R-=1)(B.bodyA===o[R]&&B.bodyB===a[R]||B.bodyB===o[R]&&B.bodyA===a[R])&&(o.splice(R,1),a.splice(R,1))}this.collisionMatrixTick(),v&&(f=lt.now());const S=eh,A=s.length;for(_=0;_!==A;_++)S.push(s[_]);s.length=0;const V=this.frictionEquations.length;for(_=0;_!==V;_++)g.push(this.frictionEquations[_]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(o,a,this,s,S,this.frictionEquations,g),v&&(m.narrowphase=lt.now()-f),v&&(f=lt.now()),_=0;_<this.frictionEquations.length;_++)d.addEquation(this.frictionEquations[_]);const I=s.length;for(let B=0;B!==I;B++){const R=s[B],N=R.bi,k=R.bj,X=R.si,K=R.sj;let $;if(N.material&&k.material?$=this.getContactMaterial(N.material,k.material)||this.defaultContactMaterial:$=this.defaultContactMaterial,$.friction,N.material&&k.material&&(N.material.friction>=0&&k.material.friction>=0&&N.material.friction*k.material.friction,N.material.restitution>=0&&k.material.restitution>=0&&(R.restitution=N.material.restitution*k.material.restitution)),d.addEquation(R),N.allowSleep&&N.type===j.DYNAMIC&&N.sleepState===j.SLEEPING&&k.sleepState===j.AWAKE&&k.type!==j.STATIC){const Y=k.velocity.lengthSquared()+k.angularVelocity.lengthSquared(),nt=k.sleepSpeedLimit**2;Y>=nt*2&&(N.wakeUpAfterNarrowphase=!0)}if(k.allowSleep&&k.type===j.DYNAMIC&&k.sleepState===j.SLEEPING&&N.sleepState===j.AWAKE&&N.type!==j.STATIC){const Y=N.velocity.lengthSquared()+N.angularVelocity.lengthSquared(),nt=N.sleepSpeedLimit**2;Y>=nt*2&&(k.wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(N,k,!0),this.collisionMatrixPrevious.get(N,k)||(Oe.body=k,Oe.contact=R,N.dispatchEvent(Oe),Oe.body=N,k.dispatchEvent(Oe)),this.bodyOverlapKeeper.set(N.id,k.id),this.shapeOverlapKeeper.set(X.id,K.id)}for(this.emitContactEvents(),v&&(m.makeContactConstraints=lt.now()-f,f=lt.now()),_=0;_!==l;_++){const B=c[_];B.wakeUpAfterNarrowphase&&(B.wakeUp(),B.wakeUpAfterNarrowphase=!1)}for(M=b.length,_=0;_!==M;_++){const B=b[_];B.update();for(let R=0,N=B.equations.length;R!==N;R++){const k=B.equations[R];d.addEquation(k)}}d.solve(i,this),v&&(m.solve=lt.now()-f),d.removeAllEquations();const F=Math.pow;for(_=0;_!==l;_++){const B=c[_];if(B.type&w){const R=F(1-B.linearDamping,i),N=B.velocity;N.scale(R,N);const k=B.angularVelocity;if(k){const X=F(1-B.angularDamping,i);k.scale(X,k)}}}this.dispatchEvent(th),v&&(f=lt.now());const z=this.stepnumber%(this.quatNormalizeSkip+1)===0,L=this.quatNormalizeFast;for(_=0;_!==l;_++)c[_].integrate(i,z,L);this.clearForces(),this.broadphase.dirty=!0,v&&(m.integrate=lt.now()-f),this.stepnumber+=1,this.dispatchEvent(Qd);let q=!0;if(this.allowSleep)for(q=!1,_=0;_!==l;_++){const B=c[_];B.sleepTick(this.time),B.sleepState!==j.SLEEPING&&(q=!0)}this.hasActiveBodies=q}emitContactEvents(){const i=this.hasAnyEventListener("beginContact"),s=this.hasAnyEventListener("endContact");if((i||s)&&this.bodyOverlapKeeper.getDiff(zt,Rt),i){for(let l=0,c=zt.length;l<c;l+=2)qe.bodyA=this.getBodyById(zt[l]),qe.bodyB=this.getBodyById(zt[l+1]),this.dispatchEvent(qe);qe.bodyA=qe.bodyB=null}if(s){for(let l=0,c=Rt.length;l<c;l+=2)je.bodyA=this.getBodyById(Rt[l]),je.bodyB=this.getBodyById(Rt[l+1]),this.dispatchEvent(je);je.bodyA=je.bodyB=null}zt.length=Rt.length=0;const o=this.hasAnyEventListener("beginShapeContact"),a=this.hasAnyEventListener("endShapeContact");if((o||a)&&this.shapeOverlapKeeper.getDiff(zt,Rt),o){for(let l=0,c=zt.length;l<c;l+=2){const d=this.getShapeById(zt[l]),p=this.getShapeById(zt[l+1]);It.shapeA=d,It.shapeB=p,d&&(It.bodyA=d.body),p&&(It.bodyB=p.body),this.dispatchEvent(It)}It.bodyA=It.bodyB=It.shapeA=It.shapeB=null}if(a){for(let l=0,c=Rt.length;l<c;l+=2){const d=this.getShapeById(Rt[l]),p=this.getShapeById(Rt[l+1]);Ft.shapeA=d,Ft.shapeB=p,d&&(Ft.bodyA=d.body),p&&(Ft.bodyB=p.body),this.dispatchEvent(Ft)}Ft.bodyA=Ft.bodyB=Ft.shapeA=Ft.shapeB=null}}clearForces(){const i=this.bodies,s=i.length;for(let o=0;o!==s;o++){const a=i[o];a.force,a.torque,a.force.set(0,0,0),a.torque.set(0,0,0)}}}new mt;const ri=new rt,lt=globalThis.performance||{};if(!lt.now){let T=Date.now();lt.timing&&lt.timing.navigationStart&&(T=lt.timing.navigationStart),lt.now=()=>Date.now()-T}new u;const Qd={type:"postStep"},th={type:"preStep"},Oe={type:j.COLLIDE_EVENT_NAME,body:null,contact:null},eh=[],nh=[],ih=[],sh=[],zt=[],Rt=[],qe={type:"beginContact",bodyA:null,bodyB:null},je={type:"endContact",bodyA:null,bodyB:null},It={type:"beginShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null},Ft={type:"endShapeContact",bodyA:null,bodyB:null,shapeA:null,shapeB:null};var ai={exports:{}};/*! Tweakpane 3.0.8 (c) 2016 cocopon, licensed under the MIT license. */(function(T,i){(function(s,o){o(i)})(El,function(s){class o{constructor(t){const[e,r]=t.split("-"),h=e.split(".");this.major=parseInt(h[0],10),this.minor=parseInt(h[1],10),this.patch=parseInt(h[2],10),this.prerelease=r!=null?r:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[t,this.prerelease].join("-"):t}}class a{constructor(t){this.controller_=t}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class l{constructor(t){this.target=t}}class c extends l{constructor(t,e,r,h){super(t);this.value=e,this.presetKey=r,this.last=h!=null?h:!0}}class d extends l{constructor(t,e,r){super(t);this.value=e,this.presetKey=r}}class p extends l{constructor(t,e){super(t);this.expanded=e}}function v(n){return n}function m(n){return n==null}function w(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}const f={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class b{constructor(t){var e;this.message=(e=f[t.type](t.context))!==null&&e!==void 0?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new b({type:"alreadydisposed"})}static notBindable(){return new b({type:"notbindable"})}static propertyNotFound(t){return new b({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new b({type:"shouldneverhappen"})}}class g{constructor(t,e,r){this.obj_=t,this.key_=e,this.presetKey_=r!=null?r:e}static isBindable(t){return!(t===null||typeof t!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const r=this.read();if(!g.isBindable(r))throw b.notBindable();if(!(t in r))throw b.propertyNotFound(t);r[t]=e}}class C extends a{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return(t=this.controller_.valueController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const r=e.bind(this);return this.controller_.valueController.emitter.on(t,()=>{r(new l(this))}),this}}class y{constructor(){this.observers_={}}on(t,e){let r=this.observers_[t];return r||(r=this.observers_[t]=[]),r.push({handler:e}),this}off(t,e){const r=this.observers_[t];return r&&(this.observers_[t]=r.filter(h=>h.handler!==e)),this}emit(t,e){const r=this.observers_[t];!r||r.forEach(h=>{h.handler(e)})}}const P="tp";function _(n){return(e,r)=>[P,"-",n,"v",e?`_${e}`:"",r?`-${r}`:""].join("")}function M(n,t){return e=>t(n(e))}function S(n){return n.rawValue}function A(n,t){n.emitter.on("change",M(S,t)),t(n.rawValue)}function V(n,t,e){A(n.value(t),e)}function I(n,t,e){e?n.classList.add(t):n.classList.remove(t)}function F(n,t){return e=>{I(n,t,e)}}function H(n,t){A(n,e=>{t.textContent=e!=null?e:""})}const z=_("btn");class L{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(z()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("button");r.classList.add(z("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const h=t.createElement("div");h.classList.add(z("t")),H(e.props.value("title"),h),this.buttonElement.appendChild(h)}}class q{constructor(t,e){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new L(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class B{constructor(t,e){var r;this.constraint_=e==null?void 0:e.constraint,this.equals_=(r=e==null?void 0:e.equals)!==null&&r!==void 0?r:(h,x)=>h===x,this.emitter=new y,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const r=e!=null?e:{forceEmit:!1,last:!0},h=this.constraint_?this.constraint_.constrain(t):t;!!this.equals_(this.rawValue_,h)&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=h,this.emitter.emit("change",{options:r,rawValue:h,sender:this}))}}class R{constructor(t){this.emitter=new y,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const r=e!=null?e:{forceEmit:!1,last:!0};this.value_===t&&!r.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:r,rawValue:this.value_,sender:this}))}}function N(n,t){const e=t==null?void 0:t.constraint,r=t==null?void 0:t.equals;return!e&&!r?new R(n):new B(n,t)}class k{constructor(t){this.emitter=new y,this.valMap_=t;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",()=>{this.emitter.emit("change",{key:e,sender:this})})}static createCore(t){return Object.keys(t).reduce((r,h)=>Object.assign(r,{[h]:N(t[h])}),{})}static fromObject(t){const e=this.createCore(t);return new k(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function X(n,t){const r=Object.keys(t).reduce((h,x)=>{if(h===void 0)return;const D=t[x](n[x]);return D.succeeded?Object.assign(Object.assign({},h),{[x]:D.value}):void 0},{});return r}function K(n,t){return n.reduce((e,r)=>{if(e===void 0)return;const h=t(r);if(!(!h.succeeded||h.value===void 0))return[...e,h.value]},[])}function $(n){return n===null?!1:typeof n=="object"}function Y(n){return t=>e=>{if(!t&&e===void 0)return{succeeded:!1,value:void 0};if(t&&e===void 0)return{succeeded:!0,value:void 0};const r=n(e);return r!==void 0?{succeeded:!0,value:r}:{succeeded:!1,value:void 0}}}function nt(n){return{custom:t=>Y(t)(n),boolean:Y(t=>typeof t=="boolean"?t:void 0)(n),number:Y(t=>typeof t=="number"?t:void 0)(n),string:Y(t=>typeof t=="string"?t:void 0)(n),function:Y(t=>typeof t=="function"?t:void 0)(n),constant:t=>Y(e=>e===t?t:void 0)(n),raw:Y(t=>t)(n),object:t=>Y(e=>{if(!!$(e))return X(e,t)})(n),array:t=>Y(e=>{if(!!Array.isArray(e))return K(e,t)})(n)}}const O={optional:nt(!0),required:nt(!1)};function J(n,t){const e=O.required.object(t)(n);return e.succeeded?e.value:void 0}function Et(n){return n&&n.parentElement&&n.parentElement.removeChild(n),null}function oe(){return["veryfirst","first","last","verylast"]}const Dt=_(""),dt={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Yt{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{oe().forEach(r=>{e.classList.remove(Dt(void 0,dt[r]))}),this.blade.get("positions").forEach(r=>{e.classList.add(Dt(void 0,dt[r]))})}),this.viewProps.handleDispose(()=>{Et(e)})}get parent(){return this.parent_}}const ft="http://www.w3.org/2000/svg";function Vt(n){n.offsetHeight}function bt(n,t){const e=n.style.transition;n.style.transition="none",t(),n.style.transition=e}function _e(n){return n.ontouchstart!==void 0}function Xt(){return new Function("return this")()}function _t(){return Xt().document}function bn(n){const t=n.ownerDocument.defaultView;return t&&"document"in t?n.getContext("2d"):null}const wn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Bt(n,t){const e=n.createElementNS(ft,"svg");return e.innerHTML=wn[t],e}function yt(n,t,e){n.insertBefore(t,n.children[e])}function hi(n){n.parentElement&&n.parentElement.removeChild(n)}function pi(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Us(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function ui(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}const ye=_("lbl");function Hs(n,t){const e=n.createDocumentFragment();return t.split(`
`).map(h=>n.createTextNode(h)).forEach((h,x)=>{x>0&&e.appendChild(n.createElement("br")),e.appendChild(h)}),e}class vi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ye()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(ye("l")),V(e.props,"label",x=>{m(x)?this.element.classList.add(ye(void 0,"nol")):(this.element.classList.remove(ye(void 0,"nol")),Us(r),r.appendChild(Hs(t,x)))}),this.element.appendChild(r),this.labelElement=r;const h=t.createElement("div");h.classList.add(ye("v")),this.element.appendChild(h),this.valueElement=h}}class We extends Yt{constructor(t,e){const r=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new vi(t,{props:e.props,viewProps:r}),viewProps:r}));this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Gs={id:"button",type:"blade",accept(n){const t=O,e=J(n,{title:t.required.string,view:t.required.constant("button"),label:t.optional.string});return e?{params:e}:null},controller(n){return new We(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:new q(n.document,{props:k.fromObject({title:n.params.title}),viewProps:n.viewProps})})},api(n){return!(n.controller instanceof We)||!(n.controller.valueController instanceof q)?null:new C(n.controller)}};class re extends Yt{constructor(t){super(t);this.value=t.value}}function xe(){return new k({positions:N([],{equals:w})})}class Ce extends k{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},r=k.createCore(e);return new Ce(r)}get styleExpanded(){var t;return(t=this.get("temporaryExpanded"))!==null&&t!==void 0?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!m(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const r=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};V(this,"expanded",r),V(this,"temporaryExpanded",r)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ks(n,t){let e=0;return bt(t,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Vt(t),e=t.clientHeight,n.set("temporaryExpanded",null),Vt(t)}),e}function mi(n,t){t.style.height=n.styleHeight}function gn(n,t){n.value("expanded").emitter.on("beforechange",()=>{n.set("completed",!1),m(n.get("expandedHeight"))&&n.set("expandedHeight",Ks(n,t)),n.set("shouldFixHeight",!0),Vt(t)}),n.emitter.on("change",()=>{mi(n,t)}),mi(n,t),t.addEventListener("transitionend",e=>{e.propertyName==="height"&&n.cleanUpTransition()})}class _n extends a{constructor(t,e){super(t);this.rackApi_=e}}function Ws(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"button"}))}function $s(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"folder"}))}function Ys(n,t){const e=t||{};return n.addBlade(Object.assign(Object.assign({},e),{view:"separator"}))}function Xs(n,t){return n.addBlade(Object.assign(Object.assign({},t),{view:"tab"}))}class yn{constructor(t){this.emitter=new y,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw b.shouldNeverHappen();const r=e!==void 0?e:this.items_.length;this.items_.splice(r,0,t),this.cache_.add(t);const h=this.extract_(t);h&&(h.emitter.on("add",this.onSubListAdd_),h.emitter.on("remove",this.onSubListRemove_),h.allItems().forEach(x=>{this.cache_.add(x)})),this.emitter.emit("add",{index:r,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const r=this.extract_(t);r&&(r.emitter.off("add",this.onSubListAdd_),r.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class xn extends a{constructor(t){super(t);this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new c(this,e,this.controller_.binding.target.presetKey,t.options.last)})}}class Pt extends We{constructor(t,e){super(t,e);this.binding=e.binding}}class Cn extends a{constructor(t){super(t);this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new y,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new d(this,e,this.controller_.binding.target.presetKey)})}}class Ot extends We{constructor(t,e){super(t,e);this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Zs(n){return n instanceof $e?n.apiSet_:n instanceof _n?n.rackApi_.apiSet_:null}function Ee(n,t){const e=n.find(r=>r.controller_===t);if(!e)throw b.shouldNeverHappen();return e}function fi(n,t,e){if(!g.isBindable(n))throw b.notBindable();return new g(n,t,e)}class $e extends a{constructor(t,e){super(t);this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new y,this.apiSet_=new yn(Zs),this.pool_=e;const r=this.controller_.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),r.emitter.on("inputchange",this.onRackInputChange_),r.emitter.on("monitorupdate",this.onRackMonitorUpdate_),r.children.forEach(h=>{this.setUpApi_(h)})}get children(){return this.controller_.rack.children.map(t=>Ee(this.apiSet_,t))}addInput(t,e,r){const h=r||{},x=this.controller_.view.element.ownerDocument,E=this.pool_.createInput(x,fi(t,e,h.presetKey),h),D=new xn(E);return this.add(D,h.index)}addMonitor(t,e,r){const h=r||{},x=this.controller_.view.element.ownerDocument,E=this.pool_.createMonitor(x,fi(t,e),h),D=new Cn(E);return this.add(D,h.index)}addFolder(t){return $s(this,t)}addButton(t){return Ws(this,t)}addSeparator(t){return Ys(this,t)}addTab(t){return Xs(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const r=this.apiSet_.find(h=>h.controller_===t.controller_);return r&&this.apiSet_.remove(r),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,r=this.pool_.createBlade(e,t),h=this.pool_.createBladeApi(r);return this.add(h,t.index)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}setUpApi_(t){this.apiSet_.find(r=>r.controller_===t)||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=Ee(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof Pt){const r=Ee(this.apiSet_,e),h=e.binding;this.emitter_.emit("change",{event:new c(r,h.target.read(),h.target.presetKey,t.options.last)})}else if(e instanceof re){const r=Ee(this.apiSet_,e);this.emitter_.emit("change",{event:new c(r,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof Ot))throw b.shouldNeverHappen();const e=Ee(this.apiSet_,t.bladeController),r=t.bladeController.binding;this.emitter_.emit("update",{event:new d(e,r.target.read(),r.target.presetKey)})}}class En extends _n{constructor(t,e){super(t,new $e(t.rackController,e));this.emitter_=new y,this.controller_.foldable.value("expanded").emitter.on("change",r=>{this.emitter_.emit("fold",{event:new p(this,r.sender.rawValue)})}),this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,r){return this.rackApi_.addInput(t,e,r)}addMonitor(t,e,r){return this.rackApi_.addMonitor(t,e,r)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}}class Pn extends Yt{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps});this.rackController=t.rackController}}class Js{constructor(t,e){const r=_(e.viewName);this.element=t.createElement("div"),this.element.classList.add(r()),e.viewProps.bindClassModifiers(this.element)}}function Qs(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof Pt&&r.binding===t)return r}return null}function to(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof Ot&&r.binding===t)return r}return null}function eo(n,t){for(let e=0;e<n.length;e++){const r=n[e];if(r instanceof re&&r.value===t)return r}return null}function kn(n){return n instanceof Pe?n.rack:n instanceof Pn?n.rackController.rack:null}function no(n){const t=kn(n);return t?t.bcSet_:null}class io{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new y,this.blade_=t!=null?t:null,(e=this.blade_)===null||e===void 0||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new yn(no),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(e=>e instanceof t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const r=t.item;if(r.viewProps.emitter.on("change",this.onChildViewPropsChange_),r.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),r.viewProps.handleDispose(this.onChildDispose_),r instanceof Pt)r.binding.emitter.on("change",this.onChildInputChange_);else if(r instanceof Ot)r.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(r instanceof re)r.value.emitter.on("change",this.onChildValueChange_);else{const h=kn(r);if(h){const x=h.emitter;x.on("layout",this.onDescendantLayout_),x.on("inputchange",this.onDescendantInputChange_),x.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const r=t.item;if(r instanceof Pt)r.binding.emitter.off("change",this.onChildInputChange_);else if(r instanceof Ot)r.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(r instanceof re)r.value.emitter.off("change",this.onChildValueChange_);else{const h=kn(r);if(h){const x=h.emitter;x.off("layout",this.onDescendantLayout_),x.off("inputchange",this.onDescendantInputChange_),x.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter(h=>!h.viewProps.get("hidden")),e=t[0],r=t[t.length-1];this.bcSet_.items.forEach(h=>{const x=[];h===e&&(x.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&x.push("veryfirst")),h===r&&(x.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&x.push("verylast")),h.blade.set("positions",x)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(e=>e.viewProps.get("disposed")).forEach(e=>{this.bcSet_.remove(e)})}onChildInputChange_(t){const e=Qs(this.find(Pt),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=to(this.find(Ot),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=eo(this.find(re),t.sender);if(!e)throw b.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Pe extends Yt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Js(t,{viewName:"brk",viewProps:e.viewProps})}));this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=new io(e.root?void 0:e.blade);r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.rack=r,this.viewProps.handleDispose(()=>{for(let h=this.rack.children.length-1;h>=0;h--)this.rack.children[h].viewProps.set("disposed",!0)})}onRackAdd_(t){!t.isRoot||yt(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){!t.isRoot||hi(t.bladeController.view.element)}}const bi=_("cnt");class so{constructor(t,e){this.className_=_(e.viewName||"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),bi()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),V(this.foldable_,"completed",F(this.element,this.className_(void 0,"cpl")));const r=t.createElement("button");r.classList.add(this.className_("b")),V(e.props,"title",D=>{m(D)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const h=t.createElement("div");h.classList.add(this.className_("t")),H(e.props.value("title"),h),this.buttonElement.appendChild(h),this.titleElement=h;const x=t.createElement("div");x.classList.add(this.className_("m")),this.buttonElement.appendChild(x);const E=e.containerElement;E.classList.add(this.className_("c")),this.element.appendChild(E),this.containerElement=E}}class Sn extends Pn{constructor(t,e){var r;const h=Ce.create((r=e.expanded)!==null&&r!==void 0?r:!0),x=new Pe(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:x,view:new so(t,{containerElement:x.view.element,foldable:h,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})}));this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=h,gn(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const oo={id:"folder",type:"blade",accept(n){const t=O,e=J(n,{title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean});return e?{params:e}:null},controller(n){return new Sn(n.document,{blade:n.blade,expanded:n.params.expanded,props:k.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Sn?new En(n.controller,n.pool):null}};class ae extends re{constructor(t,e){const r=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new vi(t,{props:e.props,viewProps:r}),viewProps:r}));this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class wi extends a{}const gi=_("spr");class ro{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(gi()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("hr");r.classList.add(gi("r")),this.element.appendChild(r)}}class _i extends Yt{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new ro(t,{viewProps:e.viewProps})}))}}const ao={id:"separator",type:"blade",accept(n){const e=J(n,{view:O.required.constant("separator")});return e?{params:e}:null},controller(n){return new _i(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof _i?new wi(n.controller):null}},lo=_("");function yi(n,t){return F(n,lo(void 0,t))}class qt extends k{constructor(t){super(t)}static create(t){var e,r;const h=t!=null?t:{},x={disabled:(e=h.disabled)!==null&&e!==void 0?e:!1,disposed:!1,hidden:(r=h.hidden)!==null&&r!==void 0?r:!1},E=k.createCore(x);return new qt(E)}bindClassModifiers(t){V(this,"disabled",yi(t,"disabled")),V(this,"hidden",yi(t,"hidden"))}bindDisabled(t){V(this,"disabled",e=>{t.disabled=e})}bindTabIndex(t){V(this,"disabled",e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}}const ke=_("tbi");class co{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ke()),e.viewProps.bindClassModifiers(this.element),V(e.props,"selected",x=>{x?this.element.classList.add(ke(void 0,"sel")):this.element.classList.remove(ke(void 0,"sel"))});const r=t.createElement("button");r.classList.add(ke("b")),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.buttonElement=r;const h=t.createElement("div");h.classList.add(ke("t")),H(e.props.value("title"),h),this.buttonElement.appendChild(h),this.titleElement=h}}class ho{constructor(t,e){this.emitter=new y,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new co(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class xi{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new ho(t,{props:e.itemProps,viewProps:qt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Pe(t,{blade:xe(),viewProps:qt.create()}),this.props=e.props,V(this.props,"selected",r=>{this.itemController.props.set("selected",r),this.contentController.viewProps.set("hidden",!r)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ci{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return(t=this.controller_.itemController.props.get("title"))!==null&&t!==void 0?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,r){return this.rackApi_.addInput(t,e,r)}addMonitor(t,e,r){return this.rackApi_.addMonitor(t,e,r)}addBlade(t){return this.rackApi_.addBlade(t)}}class Ei extends _n{constructor(t,e){super(t,new $e(t.rackController,e));this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new y,this.pageApiMap_=new Map,this.rackApi_.on("change",r=>{this.emitter_.emit("change",{event:r})}),this.rackApi_.on("update",r=>{this.emitter_.emit("update",{event:r})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(r=>{this.setUpPageApi_(r)})}get pages(){return this.controller_.pageSet.items.map(t=>{const e=this.pageApiMap_.get(t);if(!e)throw b.shouldNeverHappen();return e})}addPage(t){const e=this.controller_.view.element.ownerDocument,r=new xi(e,{itemProps:k.fromObject({selected:!1,title:t.title}),props:k.fromObject({selected:!1})});this.controller_.add(r,t.index);const h=this.pageApiMap_.get(r);if(!h)throw b.shouldNeverHappen();return h}removePage(t){this.controller_.remove(t)}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find(h=>h.controller_===t.contentController);if(!e)throw b.shouldNeverHappen();const r=new Ci(t,e);this.pageApiMap_.set(t,r)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw b.shouldNeverHappen();this.pageApiMap_.delete(t.item)}}const Ye=_("tab");class po{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ye(),bi()),e.viewProps.bindClassModifiers(this.element),A(e.empty,F(this.element,Ye(void 0,"nop")));const r=t.createElement("div");r.classList.add(Ye("i")),this.element.appendChild(r),this.itemsElement=r;const h=e.contentsElement;h.classList.add(Ye("c")),this.element.appendChild(h),this.contentsElement=h}}class Pi extends Pn{constructor(t,e){const r=new Pe(t,{blade:e.blade,viewProps:e.viewProps}),h=N(!0);super({blade:e.blade,rackController:r,view:new po(t,{contentsElement:r.view.element,empty:h,viewProps:e.viewProps})});this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new yn(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=h,this.applyPages_()}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e!=null?e:this.pageSet_.items.length)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(t){const e=t.item;yt(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),e.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(t){const e=t.item;hi(e.itemController.view.element),this.rackController.rack.remove(e.contentController),e.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const t=this.pageSet_.items.findIndex(e=>e.props.get("selected"));t<0?this.pageSet_.items.forEach((e,r)=>{e.props.set("selected",r===0)}):this.pageSet_.items.forEach((e,r)=>{e.props.set("selected",r===t)})}onPageSelectedChange_(t){if(t.rawValue){const e=this.pageSet_.items.findIndex(r=>r.props.value("selected")===t.sender);this.pageSet_.items.forEach((r,h)=>{r.props.set("selected",h===e)})}else this.keepSelection_()}}const ki={id:"tab",type:"blade",accept(n){const t=O,e=J(n,{pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")});return!e||e.pages.length===0?null:{params:e}},controller(n){const t=new Pi(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(e=>{const r=new xi(n.document,{itemProps:k.fromObject({selected:!1,title:e.title}),props:k.fromObject({selected:!1})});t.add(r)}),t},api(n){return n.controller instanceof Pi?new Ei(n.controller,n.pool):null}};function uo(n,t){const e=n.accept(t.params);if(!e)return null;const r=O.optional.boolean(t.params.disabled).value,h=O.optional.boolean(t.params.hidden).value;return n.controller({blade:xe(),document:t.document,params:Object.assign(Object.assign({},e.params),{disabled:r,hidden:h}),viewProps:qt.create({disabled:r,hidden:h})})}class vo{constructor(){this.disabled=!1,this.emitter=new y}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class mo{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new y,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Zt{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((e,r)=>r.constrain(e),t)}}function kt(n,t){if(n instanceof t)return n;if(n instanceof Zt){const e=n.constraints.reduce((r,h)=>r||(h instanceof t?h:null),null);if(e)return e}return null}class Se{constructor(t){this.options=t}constrain(t){const e=this.options;return e.length===0||e.filter(h=>h.value===t).length>0?t:e[0].value}}class vt{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let e=t;return m(this.minValue)||(e=Math.max(e,this.minValue)),m(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}class Jt{constructor(t){this.step=t}constrain(t){return(t<0?-Math.round(-t/this.step):Math.round(t/this.step))*this.step}}const An=_("lst");class fo{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(An()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("select");r.classList.add(An("s")),V(this.props_,"options",x=>{pi(r),x.forEach((E,D)=>{const G=t.createElement("option");G.dataset.index=String(D),G.textContent=E.text,G.value=String(E.value),r.appendChild(G)})}),e.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const h=t.createElement("div");h.classList.add(An("m")),h.appendChild(Bt(t,"dropdown")),this.element.appendChild(h),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Ae{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new fo(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const r=t.currentTarget.selectedOptions.item(0);if(!r)return;const h=Number(r.dataset.index);this.value.rawValue=this.props.get("options")[h].value}}const Si=_("pop");class bo{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Si()),e.viewProps.bindClassModifiers(this.element),A(e.shows,F(this.element,Si(void 0,"v")))}}class Ai{constructor(t,e){this.shows=N(!1),this.viewProps=e.viewProps,this.view=new bo(t,{shows:this.shows,viewProps:this.viewProps})}}const Mi=_("txt");class wo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Mi()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const r=t.createElement("input");r.classList.add(Mi("i")),r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Xe{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new wo(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const r=t.currentTarget.value,h=this.parser_(r);m(h)||(this.value.rawValue=h),this.view.refresh()}}function go(n){return String(n)}function Vi(n){return n==="false"?!1:!!n}function Bi(n){return go(n)}class _o{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const yo={"**":(n,t)=>Math.pow(n,t),"*":(n,t)=>n*t,"/":(n,t)=>n/t,"%":(n,t)=>n%t,"+":(n,t)=>n+t,"-":(n,t)=>n-t,"<<":(n,t)=>n<<t,">>":(n,t)=>n>>t,">>>":(n,t)=>n>>>t,"&":(n,t)=>n&t,"^":(n,t)=>n^t,"|":(n,t)=>n|t};class xo{constructor(t,e,r){this.left=e,this.operator=t,this.right=r}evaluate(){const t=yo[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Co={"+":n=>n,"-":n=>-n,"~":n=>~n};class Eo{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=Co[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Mn(n){return(t,e)=>{for(let r=0;r<n.length;r++){const h=n[r](t,e);if(h!=="")return h}return""}}function Me(n,t){var e;const r=n.substr(t).match(/^\s+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Po(n,t){const e=n.substr(t,1);return e.match(/^[1-9]$/)?e:""}function Ve(n,t){var e;const r=n.substr(t).match(/^[0-9]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function ko(n,t){const e=Ve(n,t);if(e!=="")return e;const r=n.substr(t,1);if(t+=1,r!=="-"&&r!=="+")return"";const h=Ve(n,t);return h===""?"":r+h}function Vn(n,t){const e=n.substr(t,1);if(t+=1,e.toLowerCase()!=="e")return"";const r=ko(n,t);return r===""?"":e+r}function Li(n,t){const e=n.substr(t,1);if(e==="0")return e;const r=Po(n,t);return t+=r.length,r===""?"":r+Ve(n,t)}function So(n,t){const e=Li(n,t);if(t+=e.length,e==="")return"";const r=n.substr(t,1);if(t+=r.length,r!==".")return"";const h=Ve(n,t);return t+=h.length,e+r+h+Vn(n,t)}function Ao(n,t){const e=n.substr(t,1);if(t+=e.length,e!==".")return"";const r=Ve(n,t);return t+=r.length,r===""?"":e+r+Vn(n,t)}function Mo(n,t){const e=Li(n,t);return t+=e.length,e===""?"":e+Vn(n,t)}const Vo=Mn([So,Ao,Mo]);function Bo(n,t){var e;const r=n.substr(t).match(/^[01]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Lo(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0b")return"";const r=Bo(n,t);return r===""?"":e+r}function No(n,t){var e;const r=n.substr(t).match(/^[0-7]+/);return(e=r&&r[0])!==null&&e!==void 0?e:""}function To(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0o")return"";const r=No(n,t);return r===""?"":e+r}function zo(n,t){var e;const r=n.substr(t).match(/^[0-9a-f]+/i);return(e=r&&r[0])!==null&&e!==void 0?e:""}function Ro(n,t){const e=n.substr(t,2);if(t+=e.length,e.toLowerCase()!=="0x")return"";const r=zo(n,t);return r===""?"":e+r}const Io=Mn([Lo,To,Ro]),Fo=Mn([Io,Vo]);function Do(n,t){const e=Fo(n,t);return t+=e.length,e===""?null:{evaluable:new _o(e),cursor:t}}function Oo(n,t){const e=n.substr(t,1);if(t+=e.length,e!=="(")return null;const r=Ti(n,t);if(!r)return null;t=r.cursor,t+=Me(n,t).length;const h=n.substr(t,1);return t+=h.length,h!==")"?null:{evaluable:r.evaluable,cursor:t}}function qo(n,t){return Do(n,t)||Oo(n,t)}function Ni(n,t){const e=qo(n,t);if(e)return e;const r=n.substr(t,1);if(t+=r.length,r!=="+"&&r!=="-"&&r!=="~")return null;const h=Ni(n,t);return h?(t=h.cursor,{cursor:t,evaluable:new Eo(r,h.evaluable)}):null}function jo(n,t,e){e+=Me(t,e).length;const r=n.filter(h=>t.startsWith(h,e))[0];return r?(e+=r.length,e+=Me(t,e).length,{cursor:e,operator:r}):null}function Uo(n,t){return(e,r)=>{const h=n(e,r);if(!h)return null;r=h.cursor;let x=h.evaluable;for(;;){const E=jo(t,e,r);if(!E)break;r=E.cursor;const D=n(e,r);if(!D)return null;r=D.cursor,x=new xo(E.operator,x,D.evaluable)}return x?{cursor:r,evaluable:x}:null}}const Ho=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,t)=>Uo(n,t),Ni);function Ti(n,t){return t+=Me(n,t).length,Ho(n,t)}function Go(n){const t=Ti(n,0);return!t||t.cursor+Me(n,t.cursor).length!==n.length?null:t.evaluable}function Lt(n){var t;const e=Go(n);return(t=e==null?void 0:e.evaluate())!==null&&t!==void 0?t:null}function zi(n){if(typeof n=="number")return n;if(typeof n=="string"){const t=Lt(n);if(!m(t))return t}return 0}function Ko(n){return String(n)}function ht(n){return t=>t.toFixed(Math.max(Math.min(n,20),0))}const Wo=ht(0);function Ze(n){return Wo(n)+"%"}function Ri(n){return String(n)}function Bn(n){return n}function Ii(n,t){for(;n.length<t;)n.push(void 0)}function $o(n){const t=[];return Ii(t,n),N(t)}function Yo(n){const t=n.indexOf(void 0);return t<0?n:n.slice(0,t)}function Xo(n,t){const e=[...Yo(n),t];return e.length>n.length?e.splice(0,e.length-n.length):Ii(e,n.length),e}function Be({primary:n,secondary:t,forward:e,backward:r}){let h=!1;function x(E){h||(h=!0,E(),h=!1)}n.emitter.on("change",E=>{x(()=>{t.setRawValue(e(n,t),E.options)})}),t.emitter.on("change",E=>{x(()=>{n.setRawValue(r(n,t),E.options)}),x(()=>{t.setRawValue(e(n,t),E.options)})}),x(()=>{t.setRawValue(e(n,t),{forceEmit:!1,last:!0})})}function pt(n,t){const e=n*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+e:t.downKey?-e:0}function Le(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Nt(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function Zo(n){return n==="ArrowUp"||n==="ArrowDown"}function Fi(n){return Zo(n)||n==="ArrowLeft"||n==="ArrowRight"}function Ln(n,t){const e=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:n.pageX-((e&&e.scrollX||0)+r.left),y:n.pageY-((e&&e.scrollY||0)+r.top)}}class Qt{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new y,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),(e=t.currentTarget)===null||e===void 0||e.focus();const r=this.elem_.ownerDocument;r.addEventListener("mousemove",this.onDocumentMouseMove_),r.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(Ln(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(Ln(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(Ln(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-r.left,y:e.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),r=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-r.left,y:e.clientY-r.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const r=(e=t.targetTouches.item(0))!==null&&e!==void 0?e:this.lastTouch_,h=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(r?{x:r.clientX-h.left,y:r.clientY-h.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function ot(n,t,e,r,h){const x=(n-t)/(e-t);return r+x*(h-r)}function Di(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function it(n,t,e){return Math.min(Math.max(n,t),e)}function Nn(n,t){return(n%t+t)%t}const wt=_("txt");class Jo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(wt(),wt(void 0,"num")),e.arrayPosition&&this.element.classList.add(wt(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("input");r.classList.add(wt("i")),r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(wt()),this.inputElement.classList.add(wt("i"));const h=t.createElement("div");h.classList.add(wt("k")),this.element.appendChild(h),this.knobElement=h;const x=t.createElementNS(ft,"svg");x.classList.add(wt("g")),this.knobElement.appendChild(x);const E=t.createElementNS(ft,"path");E.classList.add(wt("gb")),x.appendChild(E),this.guideBodyElem_=E;const D=t.createElementNS(ft,"path");D.classList.add(wt("gh")),x.appendChild(D),this.guideHeadElem_=D;const G=t.createElement("div");G.classList.add(_("tt")()),this.knobElement.appendChild(G),this.tooltipElem_=G,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(t.rawValue===null){this.element.classList.remove(wt(void 0,"drg"));return}this.element.classList.add(wt(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),r=e+(e>0?-1:e<0?1:0),h=it(-r,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${r+h},0 L${r},4 L${r+h},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const x=this.props_.get("formatter");this.tooltipElem_.textContent=x(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Ne{constructor(t,e){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=N(null),this.view=new Jo(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const r=new Qt(this.view.knobElement);r.emitter.on("down",this.onPointerDown_),r.emitter.on("move",this.onPointerMove_),r.emitter.on("up",this.onPointerUp_)}onInputChange_(t){const r=t.currentTarget.value,h=this.parser_(r);m(h)||(this.value.rawValue=h),this.view.refresh()}onInputKeyDown_(t){const e=pt(this.baseStep_,Le(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onInputKeyUp_(t){pt(this.baseStep_,Le(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.originRawValue_+e*this.props.get("draggingScale")}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);e!==null&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Tn=_("sld");class Qo{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Tn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(Tn("t")),e.viewProps.bindTabIndex(r),this.element.appendChild(r),this.trackElement=r;const h=t.createElement("div");h.classList.add(Tn("k")),this.trackElement.appendChild(h),this.knobElement=h,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=it(ot(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class tr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Qo(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){!t.point||this.value.setRawValue(ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=pt(this.baseStep_,Nt(t));e!==0&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){pt(this.baseStep_,Nt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const zn=_("sldtxt");class er{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(zn());const r=t.createElement("div");r.classList.add(zn("s")),this.sliderView_=e.sliderView,r.appendChild(this.sliderView_.element),this.element.appendChild(r);const h=t.createElement("div");h.classList.add(zn("t")),this.textView_=e.textView,h.appendChild(this.textView_.element),this.element.appendChild(h)}}class Rn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new tr(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Ne(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,value:e.value,viewProps:e.viewProps}),this.view=new er(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Te(n,t){n.write(t)}function Je(n){const t=O;if(Array.isArray(n))return t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))(n).value;if(typeof n=="object")return t.required.raw(n).value}function Oi(n){if(n==="inline"||n==="popup")return n}function jt(n){const t=O;return t.required.object({max:t.optional.number,min:t.optional.number,step:t.optional.number})(n).value}function qi(n){if(Array.isArray(n))return n;const t=[];return Object.keys(n).forEach(e=>{t.push({text:e,value:n[e]})}),t}function In(n){return m(n)?null:new Se(qi(n))}function Fn(n){const t=n?kt(n,Se):null;return t?t.options:null}function nr(n){const t=n?kt(n,Jt):null;return t?t.step:null}function Qe(n,t){const e=n&&kt(n,Jt);return e?Di(e.step):Math.max(Di(t),2)}function le(n){const t=nr(n);return t!=null?t:1}function ce(n,t){var e;const r=n&&kt(n,Jt),h=Math.abs((e=r==null?void 0:r.step)!==null&&e!==void 0?e:t);return h===0?.1:Math.pow(10,Math.floor(Math.log10(h))-1)}const tn=_("ckb");class ir{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(tn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("label");r.classList.add(tn("l")),this.element.appendChild(r);const h=t.createElement("input");h.classList.add(tn("i")),h.type="checkbox",r.appendChild(h),this.inputElement=h,e.viewProps.bindDisabled(this.inputElement);const x=t.createElement("div");x.classList.add(tn("w")),r.appendChild(x);const E=Bt(t,"check");x.appendChild(E),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class sr{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ir(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked}}function or(n){const t=[],e=In(n.options);return e&&t.push(e),new Zt(t)}const rr={id:"input-bool",type:"input",accept:(n,t)=>{if(typeof n!="boolean")return null;const r=J(t,{options:O.optional.custom(Je)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Vi,constraint:n=>or(n.params),writer:n=>Te},controller:n=>{var t;const e=n.document,r=n.value,h=n.constraint;return h&&kt(h,Se)?new Ae(e,{props:k.fromObject({options:(t=Fn(h))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps}):new sr(e,{value:r,viewProps:n.viewProps})}},te=_("col");class ar{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(te()),e.foldable.bindExpandedClass(this.element,te(void 0,"expanded")),V(e.foldable,"completed",F(this.element,te(void 0,"cpl")));const r=t.createElement("div");r.classList.add(te("h")),this.element.appendChild(r);const h=t.createElement("div");h.classList.add(te("s")),r.appendChild(h),this.swatchElement=h;const x=t.createElement("div");if(x.classList.add(te("t")),r.appendChild(x),this.textElement=x,e.pickerLayout==="inline"){const E=t.createElement("div");E.classList.add(te("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}function lr(n,t,e){const r=it(n/255,0,1),h=it(t/255,0,1),x=it(e/255,0,1),E=Math.max(r,h,x),D=Math.min(r,h,x),G=E-D;let W=0,Q=0;const tt=(D+E)/2;return G!==0&&(Q=G/(1-Math.abs(E+D-1)),r===E?W=(h-x)/G:h===E?W=2+(x-r)/G:W=4+(r-h)/G,W=W/6+(W<0?1:0)),[W*360,Q*100,tt*100]}function cr(n,t,e){const r=(n%360+360)%360,h=it(t/100,0,1),x=it(e/100,0,1),E=(1-Math.abs(2*x-1))*h,D=E*(1-Math.abs(r/60%2-1)),G=x-E/2;let W,Q,tt;return r>=0&&r<60?[W,Q,tt]=[E,D,0]:r>=60&&r<120?[W,Q,tt]=[D,E,0]:r>=120&&r<180?[W,Q,tt]=[0,E,D]:r>=180&&r<240?[W,Q,tt]=[0,D,E]:r>=240&&r<300?[W,Q,tt]=[D,0,E]:[W,Q,tt]=[E,0,D],[(W+G)*255,(Q+G)*255,(tt+G)*255]}function dr(n,t,e){const r=it(n/255,0,1),h=it(t/255,0,1),x=it(e/255,0,1),E=Math.max(r,h,x),D=Math.min(r,h,x),G=E-D;let W;G===0?W=0:E===r?W=60*(((h-x)/G%6+6)%6):E===h?W=60*((x-r)/G+2):W=60*((r-h)/G+4);const Q=E===0?0:G/E,tt=E;return[W,Q*100,tt*100]}function ji(n,t,e){const r=Nn(n,360),h=it(t/100,0,1),x=it(e/100,0,1),E=x*h,D=E*(1-Math.abs(r/60%2-1)),G=x-E;let W,Q,tt;return r>=0&&r<60?[W,Q,tt]=[E,D,0]:r>=60&&r<120?[W,Q,tt]=[D,E,0]:r>=120&&r<180?[W,Q,tt]=[0,E,D]:r>=180&&r<240?[W,Q,tt]=[0,D,E]:r>=240&&r<300?[W,Q,tt]=[D,0,E]:[W,Q,tt]=[E,0,D],[(W+G)*255,(Q+G)*255,(tt+G)*255]}function hr(n,t,e){const r=e+t*(100-Math.abs(2*e-100))/200;return[n,r!==0?t*(100-Math.abs(2*e-100))/r:0,e+t*(100-Math.abs(2*e-100))/(2*100)]}function pr(n,t,e){const r=100-Math.abs(e*(200-t)/100-100);return[n,r!==0?t*e/r:0,e*(200-t)/(2*100)]}function de(n){return[n[0],n[1],n[2]]}function Ui(n,t){return[n[0],n[1],n[2],t]}const ur={hsl:{hsl:(n,t,e)=>[n,t,e],hsv:hr,rgb:cr},hsv:{hsl:pr,hsv:(n,t,e)=>[n,t,e],rgb:ji},rgb:{hsl:lr,hsv:dr,rgb:(n,t,e)=>[n,t,e]}};function vr(n,t,e){return ur[t][e](...n)}const mr={hsl:n=>{var t;return[Nn(n[0],360),it(n[1],0,100),it(n[2],0,100),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]},hsv:n=>{var t;return[Nn(n[0],360),it(n[1],0,100),it(n[2],0,100),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]},rgb:n=>{var t;return[it(n[0],0,255),it(n[1],0,255),it(n[2],0,255),it((t=n[3])!==null&&t!==void 0?t:1,0,1)]}};function en(n,t){return typeof n!="object"||m(n)?!1:t in n&&typeof n[t]=="number"}class Z{constructor(t,e){this.mode_=e,this.comps_=mr[e](t)}static black(){return new Z([0,0,0],"rgb")}static fromObject(t){const e="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new Z(e,"rgb")}static toRgbaObject(t){return t.toRgbaObject()}static isRgbColorObject(t){return en(t,"r")&&en(t,"g")&&en(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&en(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode_!==e.mode_)return!1;const r=t.comps_,h=e.comps_;for(let x=0;x<r.length;x++)if(r[x]!==h[x])return!1;return!0}get mode(){return this.mode_}getComponents(t){return Ui(vr(de(this.comps_),this.mode_,t||this.mode_),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Ut=_("colp");class fr{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Ut());const r=t.createElement("div");r.classList.add(Ut("hsv"));const h=t.createElement("div");h.classList.add(Ut("sv")),this.svPaletteView_=e.svPaletteView,h.appendChild(this.svPaletteView_.element),r.appendChild(h);const x=t.createElement("div");x.classList.add(Ut("h")),this.hPaletteView_=e.hPaletteView,x.appendChild(this.hPaletteView_.element),r.appendChild(x),this.element.appendChild(r);const E=t.createElement("div");if(E.classList.add(Ut("rgb")),this.textView_=e.textView,E.appendChild(this.textView_.element),this.element.appendChild(E),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const D=t.createElement("div");D.classList.add(Ut("a"));const G=t.createElement("div");G.classList.add(Ut("ap")),G.appendChild(this.alphaViews_.palette.element),D.appendChild(G);const W=t.createElement("div");W.classList.add(Ut("at")),W.appendChild(this.alphaViews_.text.element),D.appendChild(W),this.element.appendChild(D)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(e=>e.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Dn(n){const t=O;return J(n,{alpha:t.optional.boolean,expanded:t.optional.boolean,picker:t.optional.custom(Oi)})}function ee(n){return n?.1:1}function gt(n,t){const e=n.match(/^(.+)%$/);return Math.min(e?parseFloat(e[1])*.01*t:parseFloat(n),t)}const br={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function Hi(n){const t=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(n);const e=parseFloat(t[1]),r=t[2];return br[r](e)}const On={"func.rgb":n=>{const t=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[gt(t[1],255),gt(t[2],255),gt(t[3],255)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:new Z(e,"rgb")},"func.rgba":n=>{const t=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[gt(t[1],255),gt(t[2],255),gt(t[3],255),gt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:new Z(e,"rgb")},"func.hsl":n=>{const t=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Hi(t[1]),gt(t[2],100),gt(t[3],100)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])?null:new Z(e,"hsl")},"func.hsla":n=>{const t=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;const e=[Hi(t[1]),gt(t[2],100),gt(t[3],100),gt(t[4],1)];return isNaN(e[0])||isNaN(e[1])||isNaN(e[2])||isNaN(e[3])?null:new Z(e,"hsl")},"hex.rgb":n=>{const t=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");const e=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?new Z([parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)],"rgb"):null},"hex.rgba":n=>{const t=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new Z([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),ot(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");const e=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return e?new Z([parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),ot(parseInt(e[4],16),0,255,0,1)],"rgb"):null}};function nn(n){return Object.keys(On).reduce((e,r)=>e||(On[r](n)?r:null),null)}const sn=n=>{const t=nn(n);return t?On[t](n):null};function wr(n){return n==="func.hsla"||n==="func.rgba"||n==="hex.rgba"}function gr(n){if(typeof n=="string"){const t=sn(n);if(t)return t}return Z.black()}function Gi(n){const t=it(Math.floor(n),0,255).toString(16);return t.length===1?`0${t}`:t}function qn(n,t="#"){const e=de(n.getComponents("rgb")).map(Gi).join("");return`${t}${e}`}function on(n,t="#"){const e=n.getComponents("rgb"),r=[e[0],e[1],e[2],e[3]*255].map(Gi).join("");return`${t}${r}`}function Ki(n){const t=ht(0);return`rgb(${de(n.getComponents("rgb")).map(r=>t(r)).join(", ")})`}function rn(n){const t=ht(2),e=ht(0);return`rgba(${n.getComponents("rgb").map((h,x)=>(x===3?t:e)(h)).join(", ")})`}function _r(n){const t=[ht(0),Ze,Ze];return`hsl(${de(n.getComponents("hsl")).map((r,h)=>t[h](r)).join(", ")})`}function yr(n){const t=[ht(0),Ze,Ze,ht(2)];return`hsla(${n.getComponents("hsl").map((r,h)=>t[h](r)).join(", ")})`}const xr={"func.hsl":_r,"func.hsla":yr,"func.rgb":Ki,"func.rgba":rn,"hex.rgb":qn,"hex.rgba":on};function Wi(n){return xr[n]}const ze=_("apl");class Cr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(ze()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("div");r.classList.add(ze("b")),this.element.appendChild(r);const h=t.createElement("div");h.classList.add(ze("c")),r.appendChild(h),this.colorElem_=h;const x=t.createElement("div");x.classList.add(ze("m")),this.element.appendChild(x),this.markerElem_=x;const E=t.createElement("div");E.classList.add(ze("p")),this.markerElem_.appendChild(E),this.previewElem_=E,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),r=new Z([e[0],e[1],e[2],0],"rgb"),h=new Z([e[0],e[1],e[2],255],"rgb"),x=["to right",rn(r),rn(h)];this.colorElem_.style.background=`linear-gradient(${x.join(",")})`,this.previewElem_.style.backgroundColor=rn(t);const E=ot(e[3],0,1,0,100);this.markerElem_.style.left=`${E}%`}onValueChange_(){this.update_()}}class Er{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Cr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=t.point.x/t.bounds.width,h=this.value.rawValue,[x,E,D]=h.getComponents("hsv");this.value.setRawValue(new Z([x,E,D,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=pt(ee(!0),Nt(t));if(e===0)return;const r=this.value.rawValue,[h,x,E,D]=r.getComponents("hsv");this.value.setRawValue(new Z([h,x,E,D+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){pt(ee(!0),Nt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const he=_("coltxt");function Pr(n){const t=n.createElement("select"),e=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(e.reduce((r,h)=>{const x=n.createElement("option");return x.textContent=h.text,x.value=h.value,r.appendChild(x),r},n.createDocumentFragment())),t}class kr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(he());const r=t.createElement("div");r.classList.add(he("m")),this.modeElem_=Pr(t),this.modeElem_.classList.add(he("ms")),r.appendChild(this.modeSelectElement);const h=t.createElement("div");h.classList.add(he("mm")),h.appendChild(Bt(t,"dropdown")),r.appendChild(h),this.element.appendChild(r);const x=t.createElement("div");x.classList.add(he("w")),this.element.appendChild(x),this.textsElem_=x,this.textViews_=e.textViews,this.applyTextViews_(),A(e.colorMode,E=>{this.modeElem_.value=E})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){pi(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach(e=>{const r=t.createElement("div");r.classList.add(he("c")),r.appendChild(e.element),this.textsElem_.appendChild(r)})}}const Sr=ht(0),Ar={rgb:()=>new vt({min:0,max:255}),hsl:n=>n===0?new vt({min:0,max:360}):new vt({min:0,max:100}),hsv:n=>n===0?new vt({min:0,max:360}):new vt({min:0,max:100})};function jn(n,t,e){return new Ne(n,{arrayPosition:e===0?"fst":e===3-1?"lst":"mid",baseStep:ee(!1),parser:t.parser,props:k.fromObject({draggingScale:1,formatter:Sr}),value:N(0,{constraint:Ar[t.colorMode](e)}),viewProps:t.viewProps})}class Mr{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=N(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new kr(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},r=[jn(t,e,0),jn(t,e,1),jn(t,e,2)];return r.forEach((h,x)=>{Be({primary:this.value,secondary:h.value,forward:E=>E.rawValue.getComponents(this.colorMode.rawValue)[x],backward:(E,D)=>{const G=this.colorMode.rawValue,W=E.rawValue.getComponents(G);return W[x]=D.rawValue,new Z(Ui(de(W),W[3]),G)}})}),r}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Un=_("hpl");class Vr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Un()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("div");r.classList.add(Un("c")),this.element.appendChild(r);const h=t.createElement("div");h.classList.add(Un("m")),this.element.appendChild(h),this.markerElem_=h,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=Ki(new Z([e,100,100],"hsv"));const r=ot(e,0,360,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class Br{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Vr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=ot(it(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),h=this.value.rawValue,[,x,E,D]=h.getComponents("hsv");this.value.setRawValue(new Z([r,x,E,D],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=pt(ee(!1),Nt(t));if(e===0)return;const r=this.value.rawValue,[h,x,E,D]=r.getComponents("hsv");this.value.setRawValue(new Z([h+e,x,E,D],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){pt(ee(!1),Nt(t))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Hn=_("svp"),$i=64;class Lr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Hn()),e.viewProps.bindTabIndex(this.element);const r=t.createElement("canvas");r.height=$i,r.width=$i,r.classList.add(Hn("c")),this.element.appendChild(r),this.canvasElement=r;const h=t.createElement("div");h.classList.add(Hn("m")),this.element.appendChild(h),this.markerElem_=h,this.update_()}update_(){const t=bn(this.canvasElement);if(!t)return;const r=this.value.rawValue.getComponents("hsv"),h=this.canvasElement.width,x=this.canvasElement.height,E=t.getImageData(0,0,h,x),D=E.data;for(let Q=0;Q<x;Q++)for(let tt=0;tt<h;tt++){const ne=ot(tt,0,h,0,100),Ie=ot(Q,0,x,100,0),Fe=ji(r[0],ne,Ie),me=(Q*h+tt)*4;D[me]=Fe[0],D[me+1]=Fe[1],D[me+2]=Fe[2],D[me+3]=255}t.putImageData(E,0,0);const G=ot(r[1],0,100,0,100);this.markerElem_.style.left=`${G}%`;const W=ot(r[2],0,100,100,0);this.markerElem_.style.top=`${W}%`}onValueChange_(){this.update_()}}class Nr{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Lr(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=ot(t.point.x,0,t.bounds.width,0,100),h=ot(t.point.y,0,t.bounds.height,100,0),[x,,,E]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Z([x,r,h,E],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){Fi(t.key)&&t.preventDefault();const[e,r,h,x]=this.value.rawValue.getComponents("hsv"),E=ee(!1),D=pt(E,Nt(t)),G=pt(E,Le(t));D===0&&G===0||this.value.setRawValue(new Z([e,r+D,h+G,x],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=ee(!1),r=pt(e,Nt(t)),h=pt(e,Le(t));r===0&&h===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Tr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Br(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Nr(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Er(t,{value:this.value,viewProps:this.viewProps}),text:new Ne(t,{parser:Lt,baseStep:.1,props:k.fromObject({draggingScale:.01,formatter:ht(2)}),value:N(0,{constraint:new vt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Be({primary:this.value,secondary:this.alphaIcs_.text.value,forward:r=>r.rawValue.getComponents()[3],backward:(r,h)=>{const x=r.rawValue.getComponents();return x[3]=h.rawValue,new Z(x,r.rawValue.mode)}}),this.textC_=new Mr(t,{parser:Lt,value:this.value,viewProps:this.viewProps}),this.view=new fr(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Gn=_("colsw");class zr{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Gn()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("div");r.classList.add(Gn("sw")),this.element.appendChild(r),this.swatchElem_=r;const h=t.createElement("button");h.classList.add(Gn("b")),e.viewProps.bindDisabled(h),this.element.appendChild(h),this.buttonElement=h,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=on(t)}onValueChange_(){this.update_()}}class Rr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new zr(t,{value:this.value,viewProps:this.viewProps})}}class Kn{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Ce.create(e.expanded),this.swatchC_=new Rr(t,{value:this.value,viewProps:this.viewProps});const r=this.swatchC_.view.buttonElement;r.addEventListener("blur",this.onButtonBlur_),r.addEventListener("click",this.onButtonClick_),this.textC_=new Xe(t,{parser:e.parser,props:k.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new ar(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=e.pickerLayout==="popup"?new Ai(t,{viewProps:this.viewProps}):null;const h=new Tr(t,{supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});h.view.allFocusableElements.forEach(x=>{x.addEventListener("blur",this.onPopupChildBlur_),x.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=h,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(h.view.element),Be({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:x=>x.rawValue,backward:(x,E)=>E.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gn(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,r=t.relatedTarget;(!r||!e.contains(r))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,r=ui(t);r&&e.contains(r)||r&&r===this.swatchC_.view.buttonElement&&!_e(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Ir(n){return Z.isColorObject(n)?Z.fromObject(n):Z.black()}function Fr(n){return de(n.getComponents("rgb")).reduce((t,e)=>t<<8|Math.floor(e)&255,0)}function Dr(n){return n.getComponents("rgb").reduce((t,e,r)=>{const h=Math.floor(r===3?e*255:e)&255;return t<<8|h},0)>>>0}function Or(n){return new Z([n>>16&255,n>>8&255,n&255],"rgb")}function qr(n){return new Z([n>>24&255,n>>16&255,n>>8&255,ot(n&255,0,255,0,1)],"rgb")}function jr(n){return typeof n!="number"?Z.black():Or(n)}function Ur(n){return typeof n!="number"?Z.black():qr(n)}function Hr(n){const t=Wi(n);return(e,r)=>{Te(e,t(r))}}function Gr(n){const t=n?Dr:Fr;return(e,r)=>{Te(e,t(r))}}function Kr(n,t){const e=t.toRgbaObject();n.writeProperty("r",e.r),n.writeProperty("g",e.g),n.writeProperty("b",e.b),n.writeProperty("a",e.a)}function Wr(n,t){const e=t.toRgbaObject();n.writeProperty("r",e.r),n.writeProperty("g",e.g),n.writeProperty("b",e.b)}function $r(n){return n?Kr:Wr}function Wn(n){return"alpha"in n&&n.alpha===!0}function Yr(n){return n?t=>on(t,"0x"):t=>qn(t,"0x")}const Xr={id:"input-color-number",type:"input",accept:(n,t)=>{if(typeof n!="number"||!("view"in t)||t.view!=="color")return null;const e=Dn(t);return e?{initialValue:n,params:e}:null},binding:{reader:n=>Wn(n.params)?Ur:jr,equals:Z.equals,writer:n=>Gr(Wn(n.params))},controller:n=>{const t=Wn(n.params),e="expanded"in n.params?n.params.expanded:void 0,r="picker"in n.params?n.params.picker:void 0;return new Kn(n.document,{expanded:e!=null?e:!1,formatter:Yr(t),parser:sn,pickerLayout:r!=null?r:"popup",supportsAlpha:t,value:n.value,viewProps:n.viewProps})}};function Zr(n){return Z.isRgbaColorObject(n)}const Jr={id:"input-color-object",type:"input",accept:(n,t)=>{if(!Z.isColorObject(n))return null;const e=Dn(t);return e?{initialValue:n,params:e}:null},binding:{reader:n=>Ir,equals:Z.equals,writer:n=>$r(Zr(n.initialValue))},controller:n=>{const t=Z.isRgbaColorObject(n.initialValue),e="expanded"in n.params?n.params.expanded:void 0,r="picker"in n.params?n.params.picker:void 0,h=t?on:qn;return new Kn(n.document,{expanded:e!=null?e:!1,formatter:h,parser:sn,pickerLayout:r!=null?r:"popup",supportsAlpha:t,value:n.value,viewProps:n.viewProps})}},Qr={id:"input-color-string",type:"input",accept:(n,t)=>{if(typeof n!="string"||"view"in t&&t.view==="text"||!nn(n))return null;const r=Dn(t);return r?{initialValue:n,params:r}:null},binding:{reader:n=>gr,equals:Z.equals,writer:n=>{const t=nn(n.initialValue);if(!t)throw b.shouldNeverHappen();return Hr(t)}},controller:n=>{const t=nn(n.initialValue);if(!t)throw b.shouldNeverHappen();const e=Wi(t),r="expanded"in n.params?n.params.expanded:void 0,h="picker"in n.params?n.params.picker:void 0;return new Kn(n.document,{expanded:r!=null?r:!1,formatter:e,parser:sn,pickerLayout:h!=null?h:"popup",supportsAlpha:wr(t),value:n.value,viewProps:n.viewProps})}};class Ht{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((r,h)=>{var x,E;return(E=(x=this.components[h])===null||x===void 0?void 0:x.constrain(r))!==null&&E!==void 0?E:r});return this.asm_.fromComponents(e)}}const Yi=_("pndtxt");class ta{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(Yi()),this.textViews.forEach(r=>{const h=t.createElement("div");h.classList.add(Yi("a")),h.appendChild(r.element),this.element.appendChild(h)})}}function ea(n,t,e){return new Ne(n,{arrayPosition:e===0?"fst":e===t.axes.length-1?"lst":"mid",baseStep:t.axes[e].baseStep,parser:t.parser,props:t.axes[e].textProps,value:N(0,{constraint:t.axes[e].constraint}),viewProps:t.viewProps})}class $n{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((r,h)=>ea(t,e,h)),this.acs_.forEach((r,h)=>{Be({primary:this.value,secondary:r.value,forward:x=>e.assembly.toComponents(x.rawValue)[h],backward:(x,E)=>{const D=e.assembly.toComponents(x.rawValue);return D[h]=E.rawValue,e.assembly.fromComponents(D)}})}),this.view=new ta(t,{textViews:this.acs_.map(r=>r.view)})}}function na(n){return"step"in n&&!m(n.step)?new Jt(n.step):null}function ia(n){return"max"in n&&!m(n.max)||"min"in n&&!m(n.min)?new vt({max:n.max,min:n.min}):null}function sa(n){const t=[],e=na(n);e&&t.push(e);const r=ia(n);r&&t.push(r);const h=In(n.options);return h&&t.push(h),new Zt(t)}function oa(n){const t=n?kt(n,vt):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function ra(n){const[t,e]=oa(n);return[t!=null?t:0,e!=null?e:100]}const aa={id:"input-number",type:"input",accept:(n,t)=>{if(typeof n!="number")return null;const e=O,r=J(t,{format:e.optional.function,max:e.optional.number,min:e.optional.number,options:e.optional.custom(Je),step:e.optional.number});return r?{initialValue:n,params:r}:null},binding:{reader:n=>zi,constraint:n=>sa(n.params),writer:n=>Te},controller:n=>{var t,e;const r=n.value,h=n.constraint;if(h&&kt(h,Se))return new Ae(n.document,{props:k.fromObject({options:(t=Fn(h))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps});const x=(e="format"in n.params?n.params.format:void 0)!==null&&e!==void 0?e:ht(Qe(h,r.rawValue));if(h&&kt(h,vt)){const[E,D]=ra(h);return new Rn(n.document,{baseStep:le(h),parser:Lt,sliderProps:k.fromObject({maxValue:D,minValue:E}),textProps:k.fromObject({draggingScale:ce(h,r.rawValue),formatter:x}),value:r,viewProps:n.viewProps})}return new Ne(n.document,{baseStep:le(h),parser:Lt,props:k.fromObject({draggingScale:ce(h,r.rawValue),formatter:x}),value:r,viewProps:n.viewProps})}};class Gt{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y;return!(typeof e!="number"||typeof r!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const Xi={toComponents:n=>n.getComponents(),fromComponents:n=>new Gt(...n)},pe=_("p2d");class la{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pe()),e.viewProps.bindClassModifiers(this.element),A(e.expanded,F(this.element,pe(void 0,"expanded")));const r=t.createElement("div");r.classList.add(pe("h")),this.element.appendChild(r);const h=t.createElement("button");h.classList.add(pe("b")),h.appendChild(Bt(t,"p2dpad")),e.viewProps.bindDisabled(h),r.appendChild(h),this.buttonElement=h;const x=t.createElement("div");if(x.classList.add(pe("t")),r.appendChild(x),this.textElement=x,e.pickerLayout==="inline"){const E=t.createElement("div");E.classList.add(pe("p")),this.element.appendChild(E),this.pickerElement=E}else this.pickerElement=null}}const Kt=_("p2dp");class ca{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(Kt()),e.layout==="popup"&&this.element.classList.add(Kt(void 0,"p"));const r=t.createElement("div");r.classList.add(Kt("p")),e.viewProps.bindTabIndex(r),this.element.appendChild(r),this.padElement=r;const h=t.createElementNS(ft,"svg");h.classList.add(Kt("g")),this.padElement.appendChild(h),this.svgElem_=h;const x=t.createElementNS(ft,"line");x.classList.add(Kt("ax")),x.setAttributeNS(null,"x1","0"),x.setAttributeNS(null,"y1","50%"),x.setAttributeNS(null,"x2","100%"),x.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(x);const E=t.createElementNS(ft,"line");E.classList.add(Kt("ax")),E.setAttributeNS(null,"x1","50%"),E.setAttributeNS(null,"y1","0"),E.setAttributeNS(null,"x2","50%"),E.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(E);const D=t.createElementNS(ft,"line");D.classList.add(Kt("l")),D.setAttributeNS(null,"x1","50%"),D.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(D),this.lineElem_=D;const G=t.createElement("div");G.classList.add(Kt("m")),this.padElement.appendChild(G),this.markerElem_=G,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),r=this.maxValue_,h=ot(t,-r,+r,0,100),x=ot(e,-r,+r,0,100),E=this.invertsY_?100-x:x;this.lineElem_.setAttributeNS(null,"x2",`${h}%`),this.lineElem_.setAttributeNS(null,"y2",`${E}%`),this.markerElem_.style.left=`${h}%`,this.markerElem_.style.top=`${E}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Zi(n,t,e){return[pt(t[0],Nt(n)),pt(t[1],Le(n))*(e?1:-1)]}class da{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new ca(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Qt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const r=this.maxValue_,h=ot(t.point.x,0,t.bounds.width,-r,+r),x=ot(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-r,+r);this.value.setRawValue(new Gt(h,x),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){Fi(t.key)&&t.preventDefault();const[e,r]=Zi(t,this.baseSteps_,this.invertsY_);e===0&&r===0||this.value.setRawValue(new Gt(this.value.rawValue.x+e,this.value.rawValue.y+r),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,r]=Zi(t,this.baseSteps_,this.invertsY_);e===0&&r===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ha{constructor(t,e){var r,h;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=Ce.create(e.expanded),this.popC_=e.pickerLayout==="popup"?new Ai(t,{viewProps:this.viewProps}):null;const x=new da(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});x.view.allFocusableElements.forEach(E=>{E.addEventListener("blur",this.onPopupChildBlur_),E.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=x,this.textC_=new $n(t,{assembly:Xi,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new la(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(r=this.view.buttonElement)===null||r===void 0||r.addEventListener("blur",this.onPadButtonBlur_),(h=this.view.buttonElement)===null||h===void 0||h.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Be({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:E=>E.rawValue,backward:(E,D)=>D.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),gn(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,r=t.relatedTarget;(!r||!e.contains(r))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,r=ui(t);r&&e.contains(r)||r&&r===this.view.buttonElement&&!_e(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?t.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&t.key==="Escape"&&this.view.buttonElement.focus()}}function pa(n){return Gt.isObject(n)?new Gt(n.x,n.y):new Gt}function ua(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y)}function Ji(n){if(!n)return;const t=[];return m(n.step)||t.push(new Jt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new vt({max:n.max,min:n.min})),new Zt(t)}function va(n){return new Ht({assembly:Xi,components:[Ji("x"in n?n.x:void 0),Ji("y"in n?n.y:void 0)]})}function Qi(n,t){const e=n&&kt(n,vt);if(e)return Math.max(Math.abs(e.minValue||0),Math.abs(e.maxValue||0));const r=le(n);return Math.max(Math.abs(r)*10,Math.abs(t)*10)}function ma(n,t){const e=t instanceof Ht?t.components[0]:void 0,r=t instanceof Ht?t.components[1]:void 0,h=Qi(e,n.x),x=Qi(r,n.y);return Math.max(h,x)}function ts(n,t){return{baseStep:le(t),constraint:t,textProps:k.fromObject({draggingScale:ce(t,n),formatter:ht(Qe(t,n))})}}function fa(n){if(!("y"in n))return!1;const t=n.y;return t&&"inverted"in t?!!t.inverted:!1}const ba={id:"input-point2d",type:"input",accept:(n,t)=>{if(!Gt.isObject(n))return null;const e=O,r=J(t,{expanded:e.optional.boolean,picker:e.optional.custom(Oi),x:e.optional.custom(jt),y:e.optional.object({inverted:e.optional.boolean,max:e.optional.number,min:e.optional.number,step:e.optional.number})});return r?{initialValue:n,params:r}:null},binding:{reader:n=>pa,constraint:n=>va(n.params),equals:Gt.equals,writer:n=>ua},controller:n=>{const t=n.document,e=n.value,r=n.constraint;if(!(r instanceof Ht))throw b.shouldNeverHappen();const h="expanded"in n.params?n.params.expanded:void 0,x="picker"in n.params?n.params.picker:void 0;return new ha(t,{axes:[ts(e.rawValue.x,r.components[0]),ts(e.rawValue.y,r.components[1])],expanded:h!=null?h:!1,invertsY:fa(n.params),maxValue:ma(e.rawValue,r),parser:Lt,pickerLayout:x!=null?x:"popup",value:e,viewProps:n.viewProps})}};class ue{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y,h=t.z;return!(typeof e!="number"||typeof r!="number"||typeof h!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const es={toComponents:n=>n.getComponents(),fromComponents:n=>new ue(...n)};function wa(n){return ue.isObject(n)?new ue(n.x,n.y,n.z):new ue}function ga(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z)}function Yn(n){if(!n)return;const t=[];return m(n.step)||t.push(new Jt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new vt({max:n.max,min:n.min})),new Zt(t)}function _a(n){return new Ht({assembly:es,components:[Yn("x"in n?n.x:void 0),Yn("y"in n?n.y:void 0),Yn("z"in n?n.z:void 0)]})}function Xn(n,t){return{baseStep:le(t),constraint:t,textProps:k.fromObject({draggingScale:ce(t,n),formatter:ht(Qe(t,n))})}}const ya={id:"input-point3d",type:"input",accept:(n,t)=>{if(!ue.isObject(n))return null;const e=O,r=J(t,{x:e.optional.custom(jt),y:e.optional.custom(jt),z:e.optional.custom(jt)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>wa,constraint:n=>_a(n.params),equals:ue.equals,writer:n=>ga},controller:n=>{const t=n.value,e=n.constraint;if(!(e instanceof Ht))throw b.shouldNeverHappen();return new $n(n.document,{assembly:es,axes:[Xn(t.rawValue.x,e.components[0]),Xn(t.rawValue.y,e.components[1]),Xn(t.rawValue.z,e.components[2])],parser:Lt,value:t,viewProps:n.viewProps})}};class ve{constructor(t=0,e=0,r=0,h=0){this.x=t,this.y=e,this.z=r,this.w=h}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(m(t))return!1;const e=t.x,r=t.y,h=t.z,x=t.w;return!(typeof e!="number"||typeof r!="number"||typeof h!="number"||typeof x!="number")}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const ns={toComponents:n=>n.getComponents(),fromComponents:n=>new ve(...n)};function xa(n){return ve.isObject(n)?new ve(n.x,n.y,n.z,n.w):new ve}function Ca(n,t){n.writeProperty("x",t.x),n.writeProperty("y",t.y),n.writeProperty("z",t.z),n.writeProperty("w",t.w)}function an(n){if(!n)return;const t=[];return m(n.step)||t.push(new Jt(n.step)),(!m(n.max)||!m(n.min))&&t.push(new vt({max:n.max,min:n.min})),new Zt(t)}function Ea(n){return new Ht({assembly:ns,components:[an("x"in n?n.x:void 0),an("y"in n?n.y:void 0),an("z"in n?n.z:void 0),an("w"in n?n.w:void 0)]})}function Pa(n,t){return{baseStep:le(t),constraint:t,textProps:k.fromObject({draggingScale:ce(t,n),formatter:ht(Qe(t,n))})}}const ka={id:"input-point4d",type:"input",accept:(n,t)=>{if(!ve.isObject(n))return null;const e=O,r=J(t,{x:e.optional.custom(jt),y:e.optional.custom(jt),z:e.optional.custom(jt),w:e.optional.custom(jt)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>xa,constraint:n=>Ea(n.params),equals:ve.equals,writer:n=>Ca},controller:n=>{const t=n.value,e=n.constraint;if(!(e instanceof Ht))throw b.shouldNeverHappen();return new $n(n.document,{assembly:ns,axes:t.rawValue.getComponents().map((r,h)=>Pa(r,e.components[h])),parser:Lt,value:t,viewProps:n.viewProps})}};function Sa(n){const t=[],e=In(n.options);return e&&t.push(e),new Zt(t)}const Aa={id:"input-string",type:"input",accept:(n,t)=>{if(typeof n!="string")return null;const r=J(t,{options:O.optional.custom(Je)});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Ri,constraint:n=>Sa(n.params),writer:n=>Te},controller:n=>{var t;const e=n.document,r=n.value,h=n.constraint;return h&&kt(h,Se)?new Ae(e,{props:k.fromObject({options:(t=Fn(h))!==null&&t!==void 0?t:[]}),value:r,viewProps:n.viewProps}):new Xe(e,{parser:x=>x,props:k.fromObject({formatter:Bn}),value:r,viewProps:n.viewProps})}},Re={monitor:{defaultInterval:200,defaultLineCount:3}},is=_("mll");class Ma{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(is()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("textarea");r.classList.add(is("i")),r.style.height=`calc(var(--bld-us) * ${e.lineCount})`,r.readOnly=!0,e.viewProps.bindDisabled(r),this.element.appendChild(r),this.textareaElem_=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,r=[];this.value.rawValue.forEach(h=>{h!==void 0&&r.push(this.formatter_(h))}),t.textContent=r.join(`
`),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Zn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Ma(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const ss=_("sgl");class Va{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(ss()),e.viewProps.bindClassModifiers(this.element);const r=t.createElement("input");r.classList.add(ss("i")),r.readOnly=!0,r.type="text",e.viewProps.bindDisabled(r),this.element.appendChild(r),this.inputElement=r,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=e!==void 0?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class Jn{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Va(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Ba={id:"monitor-bool",type:"monitor",accept:(n,t)=>{if(typeof n!="boolean")return null;const r=J(t,{lineCount:O.optional.number});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Vi},controller:n=>{var t;return n.value.rawValue.length===1?new Jn(n.document,{formatter:Bi,value:n.value,viewProps:n.viewProps}):new Zn(n.document,{formatter:Bi,lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}};class La{constructor(){this.emitter=new y,this.index_=-1}get index(){return this.index_}set index(t){this.index_!==t&&(this.index_=t,this.emitter.emit("change",{index:t,sender:this}))}}const Wt=_("grl");class Na{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Wt()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.minValue_=e.minValue,this.maxValue_=e.maxValue,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const r=t.createElementNS(ft,"svg");r.classList.add(Wt("g")),r.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(r),this.svgElem_=r;const h=t.createElementNS(ft,"polyline");this.svgElem_.appendChild(h),this.lineElem_=h;const x=t.createElement("div");x.classList.add(Wt("t"),_("tt")()),this.element.appendChild(x),this.tooltipElem_=x,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,r=this.minValue_,h=this.maxValue_,x=[];this.value.rawValue.forEach((Q,tt)=>{if(Q===void 0)return;const ne=ot(tt,0,e,0,t.width),Ie=ot(Q,r,h,t.height,0);x.push([ne,Ie].join(","))}),this.lineElem_.setAttributeNS(null,"points",x.join(" "));const E=this.tooltipElem_,D=this.value.rawValue[this.cursor_.index];if(D===void 0){E.classList.remove(Wt("t","a"));return}const G=ot(this.cursor_.index,0,e,0,t.width),W=ot(D,r,h,t.height,0);E.style.left=`${G}px`,E.style.top=`${W}px`,E.textContent=`${this.formatter_(D)}`,E.classList.contains(Wt("t","a"))||(E.classList.add(Wt("t","a"),Wt("t","in")),Vt(E),E.classList.remove(Wt("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Ta{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.cursor_=new La,this.view=new Na(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,maxValue:e.maxValue,minValue:e.minValue,value:this.value,viewProps:this.viewProps}),!_e(t))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const r=new Qt(this.view.element);r.emitter.on("down",this.onGraphPointerDown_),r.emitter.on("move",this.onGraphPointerMove_),r.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(ot(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){if(!t.data.point){this.cursor_.index=-1;return}this.cursor_.index=Math.floor(ot(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.index=-1}}function Qn(n){return"format"in n&&!m(n.format)?n.format:ht(2)}function za(n){var t;return n.value.rawValue.length===1?new Jn(n.document,{formatter:Qn(n.params),value:n.value,viewProps:n.viewProps}):new Zn(n.document,{formatter:Qn(n.params),lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:n.value,viewProps:n.viewProps})}function Ra(n){var t,e,r;return new Ta(n.document,{formatter:Qn(n.params),lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,maxValue:(e="max"in n.params?n.params.max:null)!==null&&e!==void 0?e:100,minValue:(r="min"in n.params?n.params.min:null)!==null&&r!==void 0?r:0,value:n.value,viewProps:n.viewProps})}function os(n){return"view"in n&&n.view==="graph"}const Ia={id:"monitor-number",type:"monitor",accept:(n,t)=>{if(typeof n!="number")return null;const e=O,r=J(t,{format:e.optional.function,lineCount:e.optional.number,max:e.optional.number,min:e.optional.number,view:e.optional.string});return r?{initialValue:n,params:r}:null},binding:{defaultBufferSize:n=>os(n)?64:1,reader:n=>zi},controller:n=>os(n.params)?Ra(n):za(n)},Fa={id:"monitor-string",type:"monitor",accept:(n,t)=>{if(typeof n!="string")return null;const e=O,r=J(t,{lineCount:e.optional.number,multiline:e.optional.boolean});return r?{initialValue:n,params:r}:null},binding:{reader:n=>Ri},controller:n=>{var t;const e=n.value;return e.rawValue.length>1||"multiline"in n.params&&n.params.multiline?new Zn(n.document,{formatter:Bn,lineCount:(t=n.params.lineCount)!==null&&t!==void 0?t:Re.monitor.defaultLineCount,value:e,viewProps:n.viewProps}):new Jn(n.document,{formatter:Bn,value:e,viewProps:n.viewProps})}};class Da{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new y,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();t!==void 0&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function Oa(n,t){const e=n.accept(t.target.read(),t.params);if(m(e))return null;const r=O,h={target:t.target,initialValue:e.initialValue,params:e.params},x=n.binding.reader(h),E=n.binding.constraint?n.binding.constraint(h):void 0,D=N(x(e.initialValue),{constraint:E,equals:n.binding.equals}),G=new Da({reader:x,target:t.target,value:D,writer:n.binding.writer(h)}),W=r.optional.boolean(t.params.disabled).value,Q=r.optional.boolean(t.params.hidden).value,tt=n.controller({constraint:E,document:t.document,initialValue:e.initialValue,params:e.params,value:G.value,viewProps:qt.create({disabled:W,hidden:Q})}),ne=r.optional.string(t.params.label).value;return new Pt(t.document,{binding:G,blade:xe(),props:k.fromObject({label:ne||t.target.key}),valueController:tt})}class qa{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new y,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(t===void 0)return;const e=this.value.rawValue,r=this.reader_(t);this.value.rawValue=Xo(e,r),this.emitter.emit("update",{rawValue:r,sender:this})}onTick_(t){this.read()}}function ja(n,t){return t===0?new vo:new mo(n,t!=null?t:Re.monitor.defaultInterval)}function Ua(n,t){var e,r,h;const x=O,E=n.accept(t.target.read(),t.params);if(m(E))return null;const D={target:t.target,initialValue:E.initialValue,params:E.params},G=n.binding.reader(D),W=(r=(e=x.optional.number(t.params.bufferSize).value)!==null&&e!==void 0?e:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(E.params))!==null&&r!==void 0?r:1,Q=x.optional.number(t.params.interval).value,tt=new qa({reader:G,target:t.target,ticker:ja(t.document,Q),value:$o(W)}),ne=x.optional.boolean(t.params.disabled).value,Ie=x.optional.boolean(t.params.hidden).value,Fe=n.controller({document:t.document,params:E.params,value:tt.value,viewProps:qt.create({disabled:ne,hidden:Ie})}),me=(h=x.optional.string(t.params.label).value)!==null&&h!==void 0?h:t.target.key;return new Ot(t.document,{binding:tt,blade:xe(),props:k.fromObject({label:me}),valueController:Fe})}class Ha{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,r){const h=e.read();if(m(h))throw new b({context:{key:e.key},type:"nomatchingcontroller"});const x=this.pluginsMap_.inputs.reduce((E,D)=>E||Oa(D,{document:t,target:e,params:r}),null);if(x)return x;throw new b({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,r){const h=this.pluginsMap_.monitors.reduce((x,E)=>x||Ua(E,{document:t,params:r,target:e}),null);if(h)return h;throw new b({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const r=this.pluginsMap_.blades.reduce((h,x)=>h||uo(x,{document:t,params:e}),null);if(!r)throw new b({type:"nomatchingview",context:{params:e}});return r}createBladeApi(t){if(t instanceof Pt)return new xn(t);if(t instanceof Ot)return new Cn(t);if(t instanceof Pe)return new $e(t,this);const e=this.pluginsMap_.blades.reduce((r,h)=>r||h.api({controller:t,pool:this}),null);if(!e)throw b.shouldNeverHappen();return e}}function Ga(){const n=new Ha;return[ba,ya,ka,Aa,aa,Qr,Jr,Xr,rr,Ba,Fa,Ia,Gs,oo,ao,ki].forEach(t=>{n.register(t)}),n}class rs extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}}class as extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}}class ls extends a{constructor(t){super(t);this.emitter_=new y,this.controller_.valueController.value.emitter.on("change",e=>{this.emitter_.emit("change",{event:new c(this,e.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const r=e.bind(this);return this.emitter_.on(t,h=>{r(h.event)}),this}}const Ka=function(){return{id:"list",type:"blade",accept(n){const t=O,e=J(n,{options:t.required.custom(Je),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string});return e?{params:e}:null},controller(n){const t=new Ae(n.document,{props:k.fromObject({options:qi(n.params.options)}),value:N(n.params.value),viewProps:n.viewProps});return new ae(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:t})},api(n){return!(n.controller instanceof ae)||!(n.controller.valueController instanceof Ae)?null:new rs(n.controller)}}}();function Wa(n){return n.reduce((t,e)=>Object.assign(t,{[e.presetKey]:e.read()}),{})}function $a(n,t){n.forEach(e=>{const r=t[e.presetKey];r!==void 0&&e.write(r)})}class Ya extends En{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){const e=this.controller_.rackController.rack.find(Pt).map(r=>r.binding.target);$a(e,t),this.refresh()}exportPreset(){const t=this.controller_.rackController.rack.find(Pt).map(e=>e.binding.target);return Wa(t)}refresh(){this.controller_.rackController.rack.find(Pt).forEach(t=>{t.binding.read()}),this.controller_.rackController.rack.find(Ot).forEach(t=>{t.binding.read()})}}class Xa extends Sn{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Za={id:"slider",type:"blade",accept(n){const t=O,e=J(n,{max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number});return e?{params:e}:null},controller(n){var t,e;const r=(t=n.params.value)!==null&&t!==void 0?t:0,h=new Rn(n.document,{baseStep:1,parser:Lt,sliderProps:k.fromObject({maxValue:n.params.max,minValue:n.params.min}),textProps:k.fromObject({draggingScale:ce(void 0,r),formatter:(e=n.params.format)!==null&&e!==void 0?e:Ko}),value:N(r),viewProps:n.viewProps});return new ae(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:h})},api(n){return!(n.controller instanceof ae)||!(n.controller.valueController instanceof Rn)?null:new as(n.controller)}},Ja=function(){return{id:"text",type:"blade",accept(n){const t=O,e=J(n,{parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string});return e?{params:e}:null},controller(n){var t;const e=new Xe(n.document,{parser:n.params.parse,props:k.fromObject({formatter:(t=n.params.format)!==null&&t!==void 0?t:r=>String(r)}),value:N(n.params.value),viewProps:n.viewProps});return new ae(n.document,{blade:n.blade,props:k.fromObject({label:n.params.label}),valueController:e})},api(n){return!(n.controller instanceof ae)||!(n.controller.valueController instanceof Xe)?null:new ls(n.controller)}}}();function Qa(n){const t=n.createElement("div");return t.classList.add(_("dfw")()),n.body&&n.body.appendChild(t),t}function cs(n,t,e){if(n.querySelector(`style[data-tp-style=${t}]`))return;const r=n.createElement("style");r.dataset.tpStyle=t,r.textContent=e,n.head.appendChild(r)}class tl extends Ya{constructor(t){var e;const r=t||{},h=(e=r.document)!==null&&e!==void 0?e:_t(),x=Ga(),E=new Xa(h,{expanded:r.expanded,blade:xe(),props:k.fromObject({title:r.title}),viewProps:qt.create()});super(E,x);this.pool_=x,this.containerElem_=r.container||Qa(h),this.containerElem_.appendChild(this.element),this.doc_=h,this.usesDefaultWrapper_=!r.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw b.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw b.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(r=>{this.pool_.register(r),this.embedPluginStyle_(r)})}embedPluginStyle_(t){t.css&&cs(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){cs(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(t=>{this.embedPluginStyle_(t)}),this.registerPlugin({plugins:[Za,Ka,ki,Ja]})}}const el=new o("3.0.8");s.BladeApi=a,s.ButtonApi=C,s.FolderApi=En,s.InputBindingApi=xn,s.ListApi=rs,s.MonitorBindingApi=Cn,s.Pane=tl,s.SeparatorApi=wi,s.SliderApi=as,s.TabApi=Ei,s.TabPageApi=Ci,s.TextApi=ls,s.TpChangeEvent=c,s.VERSION=el,Object.defineProperty(s,"__esModule",{value:!0})})})(ai,ai.exports);var fn=function(T,i,s){var o=new nl,a=new Ns,l=new we,c=new ct,d=new ct,p=new ct,v=new il,m=[],w=null,f=null,b=this;function g(){s.addEventListener("pointermove",_,!1),s.addEventListener("pointerdown",S,!1),s.addEventListener("pointerup",V,!1),s.addEventListener("pointerleave",V,!1),s.addEventListener("touchmove",F,!1),s.addEventListener("touchstart",H,!1),s.addEventListener("touchend",z,!1)}function C(){s.removeEventListener("pointermove",_,!1),s.removeEventListener("pointerdown",S,!1),s.removeEventListener("pointerup",V,!1),s.removeEventListener("pointerleave",V,!1),s.removeEventListener("touchmove",F,!1),s.removeEventListener("touchstart",H,!1),s.removeEventListener("touchend",z,!1),s.style.cursor=""}function y(){C()}function P(){return T}function _(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":M(L);break}}function M(L){var q=s.getBoundingClientRect();if(l.x=(L.clientX-q.left)/q.width*2-1,l.y=-((L.clientY-q.top)/q.height)*2+1,a.setFromCamera(l,i),w&&b.enabled){a.ray.intersectPlane(o,d)&&w.position.copy(d.sub(c).applyMatrix4(v)),b.dispatchEvent({type:"drag",object:w});return}if(m.length=0,a.setFromCamera(l,i),a.intersectObjects(T,!0,m),m.length>0){var B=m[0].object;o.setFromNormalAndCoplanarPoint(i.getWorldDirection(o.normal),p.setFromMatrixPosition(B.matrixWorld)),f!==B&&(b.dispatchEvent({type:"hoveron",object:B}),s.style.cursor="pointer",f=B)}else f!==null&&(b.dispatchEvent({type:"hoveroff",object:f}),s.style.cursor="auto",f=null)}function S(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":A(L);break}}function A(L){L.preventDefault(),m.length=0,a.setFromCamera(l,i),a.intersectObjects(T,!0,m),m.length>0&&(w=b.transformGroup===!0?T[0]:m[0].object,a.ray.intersectPlane(o,d)&&(v.copy(w.parent.matrixWorld).invert(),c.copy(d).sub(p.setFromMatrixPosition(w.matrixWorld))),s.style.cursor="move",b.dispatchEvent({type:"dragstart",object:w}))}function V(L){switch(L.preventDefault(),L.pointerType){case"mouse":case"pen":I(L);break}}function I(L){L.preventDefault(),w&&(b.dispatchEvent({type:"dragend",object:w}),w=null),s.style.cursor=f?"pointer":"auto"}function F(L){L.preventDefault(),L=L.changedTouches[0];var q=s.getBoundingClientRect();if(l.x=(L.clientX-q.left)/q.width*2-1,l.y=-((L.clientY-q.top)/q.height)*2+1,a.setFromCamera(l,i),w&&b.enabled){a.ray.intersectPlane(o,d)&&w.position.copy(d.sub(c).applyMatrix4(v)),b.dispatchEvent({type:"drag",object:w});return}}function H(L){L.preventDefault(),L=L.changedTouches[0];var q=s.getBoundingClientRect();l.x=(L.clientX-q.left)/q.width*2-1,l.y=-((L.clientY-q.top)/q.height)*2+1,m.length=0,a.setFromCamera(l,i),a.intersectObjects(T,!0,m),m.length>0&&(w=b.transformGroup===!0?T[0]:m[0].object,o.setFromNormalAndCoplanarPoint(i.getWorldDirection(o.normal),p.setFromMatrixPosition(w.matrixWorld)),a.ray.intersectPlane(o,d)&&(v.copy(w.parent.matrixWorld).invert(),c.copy(d).sub(p.setFromMatrixPosition(w.matrixWorld))),s.style.cursor="move",b.dispatchEvent({type:"dragstart",object:w}))}function z(L){L.preventDefault(),w&&(b.dispatchEvent({type:"dragend",object:w}),w=null),s.style.cursor="auto"}g(),this.enabled=!0,this.transformGroup=!1,this.activate=g,this.deactivate=C,this.dispose=y,this.getObjects=P};fn.prototype=Object.create(sl.prototype);fn.prototype.constructor=fn;var oh={computeTangents:function(T){var i=T.index,s=T.attributes;if(i===null||s.position===void 0||s.normal===void 0||s.uv===void 0){console.error("THREE.BufferGeometryUtils: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}var o=i.array,a=s.position.array,l=s.normal.array,c=s.uv.array,d=a.length/3;s.tangent===void 0&&T.setAttribute("tangent",new ln(new Float32Array(4*d),4));for(var p=s.tangent.array,v=[],m=[],w=0;w<d;w++)v[w]=new ct,m[w]=new ct;var f=new ct,b=new ct,g=new ct,C=new we,y=new we,P=new we,_=new ct,M=new ct;function S(Y,nt,O){f.fromArray(a,Y*3),b.fromArray(a,nt*3),g.fromArray(a,O*3),C.fromArray(c,Y*2),y.fromArray(c,nt*2),P.fromArray(c,O*2),b.sub(f),g.sub(f),y.sub(C),P.sub(C);var J=1/(y.x*P.y-P.x*y.y);!isFinite(J)||(_.copy(b).multiplyScalar(P.y).addScaledVector(g,-y.y).multiplyScalar(J),M.copy(g).multiplyScalar(y.x).addScaledVector(b,-P.x).multiplyScalar(J),v[Y].add(_),v[nt].add(_),v[O].add(_),m[Y].add(M),m[nt].add(M),m[O].add(M))}var A=T.groups;A.length===0&&(A=[{start:0,count:o.length}]);for(var w=0,V=A.length;w<V;++w)for(var I=A[w],F=I.start,H=I.count,z=F,L=F+H;z<L;z+=3)S(o[z+0],o[z+1],o[z+2]);var q=new ct,B=new ct,R=new ct,N=new ct,k,X,K;function $(Y){R.fromArray(l,Y*3),N.copy(R),X=v[Y],q.copy(X),q.sub(R.multiplyScalar(R.dot(X))).normalize(),B.crossVectors(N,X),K=B.dot(m[Y]),k=K<0?-1:1,p[Y*4]=q.x,p[Y*4+1]=q.y,p[Y*4+2]=q.z,p[Y*4+3]=k}for(var w=0,V=A.length;w<V;++w)for(var I=A[w],F=I.start,H=I.count,z=F,L=F+H;z<L;z+=3)$(o[z+0]),$(o[z+1]),$(o[z+2])},mergeBufferGeometries:function(T,i){for(var s=T[0].index!==null,o=new Set(Object.keys(T[0].attributes)),a=new Set(Object.keys(T[0].morphAttributes)),l={},c={},d=T[0].morphTargetsRelative,p=new Ts,v=0,m=0;m<T.length;++m){var w=T[m],f=0;if(s!==(w.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(var b in w.attributes){if(!o.has(b))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+'. All geometries must have compatible attributes; make sure "'+b+'" attribute exists among all geometries, or in none of them.'),null;l[b]===void 0&&(l[b]=[]),l[b].push(w.attributes[b]),f++}if(f!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". Make sure all geometries have the same number of attributes."),null;if(d!==w.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(var b in w.morphAttributes){if(!a.has(b))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+".  .morphAttributes must be consistent throughout all geometries."),null;c[b]===void 0&&(c[b]=[]),c[b].push(w.morphAttributes[b])}if(p.userData.mergedUserData=p.userData.mergedUserData||[],p.userData.mergedUserData.push(w.userData),i){var g;if(s)g=w.index.count;else if(w.attributes.position!==void 0)g=w.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+m+". The geometry must have either an index or a position attribute"),null;p.addGroup(v,g,m),v+=g}}if(s){for(var C=0,y=[],m=0;m<T.length;++m){for(var P=T[m].index,_=0;_<P.count;++_)y.push(P.getX(_)+C);C+=T[m].attributes.position.count}p.setIndex(y)}for(var b in l){var M=this.mergeBufferAttributes(l[b]);if(!M)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+b+" attribute."),null;p.setAttribute(b,M)}for(var b in c){var S=c[b][0].length;if(S===0)break;p.morphAttributes=p.morphAttributes||{},p.morphAttributes[b]=[];for(var m=0;m<S;++m){for(var A=[],_=0;_<c[b].length;++_)A.push(c[b][_][m]);var V=this.mergeBufferAttributes(A);if(!V)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+b+" morphAttribute."),null;p.morphAttributes[b].push(V)}}return p},mergeBufferAttributes:function(T){for(var i,s,o,a=0,l=0;l<T.length;++l){var c=T[l];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(i===void 0&&(i=c.array.constructor),i!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(s===void 0&&(s=c.itemSize),s!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(o===void 0&&(o=c.normalized),o!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;a+=c.array.length}for(var d=new i(a),p=0,l=0;l<T.length;++l)d.set(T[l].array,p),p+=T[l].array.length;return new ln(d,s,o)},interleaveAttributes:function(T){for(var i,s=0,o=0,a=0,l=T.length;a<l;++a){var c=T[a];if(i===void 0&&(i=c.array.constructor),i!==c.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;s+=c.array.length,o+=c.itemSize}for(var d=new ol(new i(s),o),p=0,v=[],m=["getX","getY","getZ","getW"],w=["setX","setY","setZ","setW"],f=0,l=T.length;f<l;f++){var c=T[f],b=c.itemSize,g=c.count,C=new rl(d,b,p,c.normalized);v.push(C),p+=b;for(var y=0;y<g;y++)for(var P=0;P<b;P++)C[w[P]](y,c[m[P]](y))}return v},estimateBytesUsed:function(T){var i=0;for(var s in T.attributes){var o=T.getAttribute(s);i+=o.count*o.itemSize*o.array.BYTES_PER_ELEMENT}var a=T.getIndex();return i+=a?a.count*a.itemSize*a.array.BYTES_PER_ELEMENT:0,i},mergeVertices:function(T,i=1e-4){i=Math.max(i,Number.EPSILON);for(var s={},o=T.getIndex(),a=T.getAttribute("position"),l=o?o.count:a.count,c=0,d=Object.keys(T.attributes),p={},v={},m=[],w=["getX","getY","getZ","getW"],f=0,b=d.length;f<b;f++){var g=d[f];p[g]=[];var C=T.morphAttributes[g];C&&(v[g]=new Array(C.length).fill().map(()=>[]))}for(var y=Math.log10(1/i),P=Math.pow(10,y),f=0;f<l;f++){for(var _=o?o.getX(f):f,M="",S=0,b=d.length;S<b;S++)for(var g=d[S],A=T.getAttribute(g),V=A.itemSize,I=0;I<V;I++)M+=`${~~(A[w[I]](_)*P)},`;if(M in s)m.push(s[M]);else{for(var S=0,b=d.length;S<b;S++)for(var g=d[S],A=T.getAttribute(g),C=T.morphAttributes[g],V=A.itemSize,F=p[g],H=v[g],I=0;I<V;I++){var z=w[I];if(F.push(A[z](_)),C)for(var L=0,q=C.length;L<q;L++)H[L].push(C[L][z](_))}s[M]=c,m.push(c),c++}}const B=T.clone();for(var f=0,b=d.length;f<b;f++){var g=d[f],R=T.getAttribute(g),N=new R.array.constructor(p[g]),A=new ln(N,R.itemSize,R.normalized);if(B.setAttribute(g,A),g in v)for(var S=0;S<v[g].length;S++){var k=T.morphAttributes[g][S],N=new k.array.constructor(v[g][S]),X=new ln(N,k.itemSize,k.normalized);B.morphAttributes[g][S]=X}}return B.setIndex(m),B},toTrianglesDrawMode:function(T,i){if(i===al)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),T;if(i===ds||i===ll){var s=T.getIndex();if(s===null){var o=[],a=T.getAttribute("position");if(a!==void 0){for(var l=0;l<a.count;l++)o.push(l);T.setIndex(o),s=T.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),T}var c=s.count-2,d=[];if(i===ds)for(var l=1;l<=c;l++)d.push(s.getX(0)),d.push(s.getX(l)),d.push(s.getX(l+1));else for(var l=0;l<c;l++)l%2===0?(d.push(s.getX(l)),d.push(s.getX(l+1)),d.push(s.getX(l+2))):(d.push(s.getX(l+2)),d.push(s.getX(l+1)),d.push(s.getX(l)));d.length/3!==c&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var p=T.clone();return p.setIndex(d),p.clearGroups(),p}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",i),T}};const rh=Al('<div id="progressDiv" class="w-full bg-gray-200 h-2 mb-6 absolute top-1/2" data-v-0ddbb2b6><div id="progress" class="transition-all duration-200 ease-in-out bg-main-active h-2 w-{{progressRatio}}" data-v-0ddbb2b6></div></div><div class="point point-0" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>1</div><div class="text select-none" data-v-0ddbb2b6>This is creation of Roy</div></div><div class="point point-1" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>2</div><div class="text select-none" data-v-0ddbb2b6>Switch</div></div><div class="point point-2" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>3</div><div class="text select-none" data-v-0ddbb2b6>Light Switch</div></div><div class="point point-3" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>4</div><div class="text select-none" data-v-0ddbb2b6>Power</div></div><div class="point point-4" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>5</div><div class="text select-none" data-v-0ddbb2b6>Elden Ring</div></div><div class="point point-5" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>6</div><div class="text select-none" data-v-0ddbb2b6>USB</div></div><div class="point point-6" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>7</div><div class="text select-none" data-v-0ddbb2b6>This is creation of Roy</div></div><div class="point point-7" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>8</div><div class="text select-none" data-v-0ddbb2b6>This is creation of Roy</div></div><div class="point point-8" data-v-0ddbb2b6><div class="label select-none" data-v-0ddbb2b6>9</div><div class="text select-none" data-v-0ddbb2b6>This is creation of Roy</div></div>',10),ah={setup(T){let i,s,o,a,l,c,d=Pl(0),p,v,m=0,w=!1,f=-1;new Ns,new we,new we;const b=new gl,g=[],C=[],y=new ai.exports.Pane;let P;i={},kl(()=>{S(),M(),window.addEventListener("resize",()=>{_.width=window.innerWidth,_.height=window.innerHeight,s.aspect=_.width/_.height,s.updateProjectionMatrix(),o.setSize(_.width,_.height),o.setPixelRatio(Math.min(window.devicePixelRatio,2))}),V()});const _={width:window.innerWidth,height:window.innerHeight};function M(){const F=document.querySelector("#progress"),H=document.querySelector("#progressDiv");c=new cl,s=new dl(75,_.width/_.height,.1,100),s.position.set(.7043043492115377,14.388569228135337,9.239105833036682),s.quaternion.set(-.27029782041898764,-.0006752835476387169,-.00018958467553528339,.9627765038296925),s.rotation.set(-.5474052811931926,-.0011978059034376911,-.0007301112729914485),c.add(s);const z=new hl(4210752);z.intensity=3,c.add(z);const L=20,q=new pl("#ffffff",3);q.position.set(0,34,-21),q.castShadow=!0,q.shadow.camera.far=50,q.shadow.mapSize.set(1024,1024),q.shadow.camera.top=L,q.shadow.camera.bottom=-L,q.shadow.camera.left=-L,q.shadow.camera.right=L,q.show=200,c.add(q),y.addInput(q,"intensity",{min:0,max:100,step:.001}),y.addInput(q.position,"x",{min:-100,max:100,step:.001}),y.addInput(q.position,"y",{min:-100,max:100,step:.001}),y.addInput(q.position,"z",{min:-100,max:100,step:.001});const B=new _l(()=>{window.setTimeout(()=>{Cl.to(Y.uniforms.uAlpha,{duration:1,value:0}),H.style.visibility="hidden"},500)},(O,J,Et)=>{d.value=J/Et*100,F.style.width=`${d.value}%`}),R=new yl;R.setDecoderPath("/draco/");const N=new xl(B);N.setDRACOLoader(R);const X=new ul(B).load(["/textures/environmentMaps/0/px.jpg","/textures/environmentMaps/0/nx.jpg","/textures/environmentMaps/0/py.jpg","/textures/environmentMaps/0/ny.jpg","/textures/environmentMaps/0/pz.jpg","/textures/environmentMaps/0/nz.jpg"]);Promise.all([N.loadAsync("models/DSPEC_jr/DSPEC_jr.gltf"),N.loadAsync("models/Detector_model/Detector.gltf"),N.loadAsync("models/PortalGun/portalGun.gltf"),N.loadAsync("models/modern_coffee_table_01_2k_2.blend/modern_coffee_table_01_2k.gltf")]).then(O=>{const[J,Et,oe,Dt]=O;let dt;J.scene.traverse(function(yt){yt.name==="DSPEC_jr"&&(dt=I(yt.children),dt.geometry.center())}),dt.scale.set(.7,.7,.7),dt.position.set(0,8.28,0),dt.userData.i=0;const Yt=new hs().setFromObject(dt),ft=new Ue(Yt.getSize().divide(new ct(2,2,2))),Vt=new j({mass:1,material:v});Vt.addShape(ft),Vt.position.copy(dt.position),p.addBody(Vt),c.add(dt),g.push(Vt),C.push(dt);let bt;Et.scene.traverse(function(yt){yt.name==="Detector"&&(bt=I(yt.children),bt.geometry.center())}),bt.userData.i=1,bt.position.set(5,8.28,0),bt.rotation.z=-Math.PI/2,bt.rotation.y=-Math.PI/2;const _e=new Nc(.57,.57,3.55,20),Xt=new j({mass:20,material:v});Xt.addShape(_e),Xt.position.copy(bt.position),Xt.quaternion.copy(bt.quaternion),p.addBody(Xt),c.add(bt),g.push(Xt),C.push(bt);let _t;Dt.scene.traverse(function(yt){yt.name==="modern_coffee_table_01"&&(_t=yt,_t.geometry.center())}),_t.userData.i=-1,_t.scale.set(20,20,20),_t.position.set(0,3.9,0);let bn=new hs().setFromObject(_t);const wn=new Ue(bn.getSize().divide(new ct(2,2,2))),Bt=new j({mass:20,material:v});Bt.addShape(wn),Bt.position.copy(_t.position),p.addBody(Bt),c.add(_t),g.push(Bt),C.push(_t),A(),w=!0});const K=new cn(new ps(50,50),new ti({color:"#777777",metalness:.3,roughness:.4,envMap:X}));K.receiveShadow=!0,K.rotation.x=-Math.PI*.5,c.add(K);const $=new ps(2,2,1,1),Y=new vl({wireframe:!0,transparent:!0,uniforms:{uAlpha:{value:1}},vertexShader:`

    void main(){
        gl_Position = vec4(position, 1.0);
        
    }`,fragmentShader:`
    uniform float uAlpha;

    void main(){
        gl_FragColor = vec4(0.0, 0.0, 0.0, uAlpha);
    }`}),nt=new cn($,Y);c.add(nt),X.encoding=us,c.background=X,c.environment=X,o=new ml({antialias:!0}),o.setSize(_.width,_.height),o.setPixelRatio(window.devicePixelRatio),o.physicallyCorrectLights=!0,o.outputEncoding=us,o.toneMapping=fl,o.toneMappingExposure=3,o.shadowMap.enabled=!0,o.shadowMap.type=bl,document.body.appendChild(o.domElement),a=new wl(s,o.domElement),a.enableDamping=!0,l=new fn(C,s,o.domElement),l.addEventListener("dragstart",function(O){f=O.object.userData.i,console.log(f),f!==-1&&(a.enabled=!1)}),l.addEventListener("dragend",function(O){f=-1,a.enabled=!0}),l.addEventListener("drag",function(O){})}function S(){p=new Jd,p.gravity.set(0,-9.8,0),p.allowSleep=!0,v=new Ke("physics");const F=new Ge(v,v,{friction:10,restitution:0});p.addContactMaterial(F);const H=new Tc,z=new j({mass:0,material:v});z.addShape(H),z.quaternion.setFromEuler(-Math.PI/2,0,0),p.addBody(z)}i.envMapIntensity=10,y.addInput(i,"envMapIntensity",{min:0,max:10,step:.01}).on("change",A);function A(){c.traverse(F=>{F instanceof cn&&F.material instanceof ti&&(F.material.envMapIntensity=i.envMapIntensity,F.material.needsUpdate=!0,F.castShadow=!0,F.receiveShadow=!0)})}Sl(()=>{});const V=()=>{const F=b.getElapsedTime(),H=F-m;m=F,p.step(1/60,H,3),w&&C.forEach((z,L)=>{L===f?(g[L].position.copy(z.position),g[L].quaternion.copy(z.quaternion),g[L].velocity.set(0,0,0),g[L].angularVelocity.set(0,0,0)):(z.position.copy(g[L].position),z.quaternion.copy(g[L].quaternion))}),a.update(),P.update(),o.render(c,s),window.requestAnimationFrame(V)};function I(F){var H=[],z=[],L=new Ts,q,B;return F.forEach(function(R,N){R.updateMatrix(),z.push(R.geometry),q=new ti(R.material),H.push(q)}),L=oh.mergeBufferGeometries(z,!0),L.groupsNeedUpdate=!0,B=new cn(L,H),B}return(F,H)=>rh}};var ph=Ml(ah,[["__scopeId","data-v-0ddbb2b6"]]);export{ph as default};
